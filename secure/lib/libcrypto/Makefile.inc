# $FreeBSD$

LCRYPTO_SRC=	${.CURDIR}/../../../crypto/openssl/crypto
CFLAGS+= -DTERMIOS -DANSI_SOURCE -DNO_IDEA -I${LCRYPTO_SRC} -I${.OBJDIR}

.if ${MACHINE_ARCH} == "i386"
CFLAGS+= -DL_ENDIAN
# -DBN_ASM -DSHA1_ASM -DMD5_ASM -DRMD160_ASM - XXX notyet
CFLAGS+= -DDEVRANDOM=\"/dev/urandom\"
.else
.if ${MACHINE_ARCH} == "alpha"
# no ENDIAN stuff defined for alpha (64-bit)
.endif
.endif

WITH_RSA?= YES

SRCS+=		buildinf.h
CLEANFILES+=	buildinf.h
CLEANDIRS+=	openssl

#	this bogus dependency was the easiest way to get the openssl/ 
#	directory populated
buildinf.h:  openssl/opensslconf.h openssl/headers-copied
	( echo "#ifndef MK1MF_BUILD"; \
	echo "  /* auto-generated by crypto/Makefile.ssl for crypto/cversion.c */"; \
	echo "  #define CFLAGS \"$(CC)\""; \
	echo "  #define PLATFORM \"`uname -s`-`uname -m`\""; \
	echo "  #define DATE \"`LC_TIME=C date`\""; \
	echo "#endif" ) > ${.TARGET}

openssl/opensslconf.h:  ../libcrypto/opensslconf-${MACHINE_ARCH}.h
	@mkdir -p openssl
	cp ${.OODATE} ${.TARGET}

openssl/headers-copied:
	@mkdir -p openssl
	${INSTALL} ${COPY} -m 444 ${CRYPTO_HDRS} ${EXTRA_HDRS} openssl
	@touch ${.TARGET}

************************************************************************
* Official mandoc TODO.
* $Id: TODO,v 1.337 2025/04/08 21:53:14 schwarze Exp $
************************************************************************

Many issues are annotated for difficulty as follows:

 - loc = locality of the issue
    *    single file issue, affects file only, or very few
    **   single module issue, affects several files of one module
    ***  cross-module issue, significantly impacts multiple modules
         and may require substantial changes to internal interfaces
 - exist = difficulty of the existing code in this area
    *    affected code is straightforward and easy to read and change
    **   affected code is somewhat complex, but once you understand
         the design, not particularly difficult to understand
    ***  affected code uses a special, exceptionally tricky design
 - algo = difficulty of the new algorithm to be written
    *    the required logic and code is straightforward
    **   the required logic is somewhat complex and needs a careful design
    ***  the required logic is exceptionally tricky,
         maybe an approach to solve that is not even known yet
 - size = the amount of code to be written or changed
    *    a small number of lines (at most 100, usually much less)
    **   a considerable amount of code (several dozen to a few hundred)
    ***  a large amount of code (many hundreds, maybe thousands)
 - imp = importance of the issue
    *    mostly for completeness
    **   would be nice to have
    ***  issue causes considerable inconvenience

Obviously, as the issues have not been solved yet, these annotations
are mere guesses, and some may be wrong.

************************************************************************
* assertion failures
************************************************************************

- .if n .ce in the middle of .TS data
  afl case f1/id:000103,sig:06,src:009024+009105,op:splice,rep:2 (jes@)
  While roff_parseln() prevents .ce and similar requests in the middle
  of a tbl, the guard is no longer effective when the .ce is wrapped
  in a roff block, for example a conditional.  The resulting assertion
  has never been seen in any real-world manual page.
  This is too dangerous to fix before release because it requires
  reorganizing the very delicate internals of roff_parseln(),
  which risks causing more severe bugs.
  loc * exist *** algo *** size * imp *


************************************************************************
* bugs: invalid output
************************************************************************

- wrong number of layout columns in tbl(7) code generated by -T man
  https://savannah.gnu.org/bugs/?57720
  The reason likely is that tbl(7) does not support the -Bl -column
  feature of not explicitly specifying the last table column.
  loc **  exist *  algo **  size *  imp ***

- eqn(7) delimiters cause conditional lines to misbehave
  nabijaczleweli 8 Sep 2021 15:24:48 +0200
  loc *  exist ***  algo ***  size *  imp *

- roff.c, roff_expand() should not remove blanks before comments
  to Oliver Corff, Sep 7, 2021
  loc *  exist *  algo *  size *  imp *
  but watch out for regressions in the high-level parsers
  maybe it should not even remove comments? - consider T{\"

- In the body of conditional requests, escape sequence expansion
  must not be performed if the condition is false.  This implies
  the first part of a request line must be expanded before
  request parsing (like it is now), but expansion in the second
  part must be delayed.
  to Nab 8 Aug 2023 20:05:32 +0200 Subject: if/ie d condition always true
  loc **  exist ***  algo ***  size **  imp *


************************************************************************
* missing features
************************************************************************

--- missing roff features ----------------------------------------------

- .ad (adjust margins)
  .ad l -- adjust left margin only (flush left)
  .ad r -- adjust right margin only (flush right)
  .ad c -- center text on line
  .ad b -- adjust both margins (alias: .ad n)
  .na   -- temporarily disable adjustment without changing the mode
  .ad   -- re-enable adjustment without changing the mode
  Adjustment mode is ignored while in no-fill mode (.nf).
  loc ***  exist ***  algo **  size **  imp **  (parser reorg would help)

- .fc (field control)
  found by naddy@ in xloadimage(1)
  loc **  exist ***  algo *  size *  imp *

- .ns (no-space mode) occurs in xine-config(1)
  when implementing this, also let .TH set it
  reported by brad@  Sat, 15 Jan 2011 15:45:23 -0500
  loc ***  exist ***  algo ***  size **  imp *

- \w'' improve width measurements
  would not be very useful without an expression parser, see below
  needed for Tcl_NewStringObj(3) via wiz@  Wed, 5 Mar 2014 22:27:43 +0100
  loc **  exist ***  algo ***  size *  imp ***

- .als only works for macros in mandoc, not for user-defined strings.
  Also, the "val" field in struct roffkv would have to be replaced
  with a pointer to a reference-counted wrapper, and an alias
  would have to point to the same wrapper as the original.
  .als to undefined does nothing; the alias is not created.
  .rm'ing the original leaves the alias to point to the old value.
  .de .als .de changes both, but
  .de .als .rm .de only changes the new value, not the alias.
  Found in groffer(1) version 1.19
  Jan Stary 20 Apr 2019 20:16:54 +0200
  loc *  exist **  algo **  size **  imp *

- roff string condition comparisons fail when vars contain quotes:
  .ds s '
  .if '\*s'' \&...
  hard to fix because of the basic architecture (string replacement
  happens before roff(7) syntax parsing)
  Found in groffer(1) version 1.19
  Jan Stary 20 Apr 2019 20:16:54 +0200
  loc *  exist ***  algo ***  size **  imp *

- mandoc replaces all ASCII control characters except tab and line feed
  with '?' during input.  It would be better to replace them with
  Unicode escapes in preconv_encode() or somewhere in the vicinity,
  such that the already existing better replacement strings show
  up in the output.  Emulating groff is not desirable: groff replaces
  0x00, 0x0b, and 0x0d to 0x1f with the empty string (bad because
  that's easy to overlook for the document author), 0x01 with '.'
  (very confusing), and passes through 0x02 to 0x08, 0x0c, and 0x7f
  raw (bad because that is insecure output).  Remember that 0x07 may
  need special handling because it is sometimes used for certain
  delimiters, so it may need handling *after* roff.c rather than before.
  reminded by John Gardner 16 Jun 2020 14:26:28 +1000
  Actually, more ASCII control characters than just 0x07 may need
  later handling because they can for example be used in macro names.
  So they may need handling after roff(7) processing.
  pointed out by John Gardner 23 Jun 2020 18:28:08 +1000
  more info from John Gardner 29 Jun 2020 19:54:04 +1000
  loc **  exist **  algo **  size **  imp *

- many missing features used in old groff_char(7),
  some can possibly be supported
  kamil at netbsd 12 Nov 2020 17:27:09 +0100 + reply

- \s with arbitrary arg delimiters as already supported for other escapes
  found following jmc@'s mail 28 Apr 2021 18:31:41 +0100
  loc *  exist *  algo *  size *  imp *

--- missing mdoc features ----------------------------------------------

- support mixed case for section names
  also, first section is not "NAME" should not appear more than once per page
  Alejandro Colomar 28 Apr 2023 16:57:49 +0200
  loc * exist * algo * size * imp ***

- .Sh and .Ss should be parsed and partially callable, see groff_mdoc(7)
  reed at reedmedia dot net Sat, 21 Dec 2019 17:13:07 -0600
  loc **  exist **  algo **  size **  imp *

- .Bl -column .Xo support is missing
  ultimate goal:
  restore .Xr and .Dv to
  lib/libc/compat-43/sigvec.3
  lib/libc/gen/signal.3
  lib/libc/sys/sigaction.2
  loc *  exist ***  algo ***  size *  imp **

- edge case: decide how to deal with blk_full bad nesting, e.g.
  .Sh .Nm .Bk .Nm .Ek .Sh found by jmc@ in ssh-keygen(1)
  from jmc@  Wed, 14 Jul 2010 18:10:32 +0100
  loc *  exist ***  algo ***  size **  imp **

- .Bd -filled should not be the same as .Bd -ragged, but align both
  the left and right margin.  In groff, it is implemented in terms
  of .ad b, which we don't have either.  Found in cksum(1).
  loc ***  exist ***  algo **  size **  imp **  (parser reorg would help)

- implement blank `Bl -column', such as
  .Bl -column
  .It foo Ta bar
  .El
  loc *  exist ***  algo ***  size *  imp *

- explicitly disallow nested `Bl -column', which would clobber internal
  flags defined for struct mdoc_macro
  loc *  exist *  algo *  size *  imp **

- In .Bl -column .It, the end of the line probably has to be regarded
  as an implicit .Ta, if there could be one, see the following mildly
  ugly code from login.conf(5):
    .Bl -column minpasswordlen program xetcxmotd
    .It path Ta path Ta value of Dv _PATH_DEFPATH
    .br
    Default search path.
  reported by Michal Mazurek <akfaew at jasminek dot net>
  via jmc@ Thu, 7 Apr 2011 16:00:53 +0059
  loc *  exist ***  algo **  size *  imp **

- inside `.Bl -column' phrases, punctuation is handled like normal
  text, e.g. `.Bl -column .It Fl x . Ta ...' should give "-x -."

- inside `.Bl -column' phrases, TERMP_IGNDELIM handling by `Pf'
  is not safe, e.g. `.Bl -column .It Pf a b .' gives "ab."
  but should give "ab ."

- prohibit `Nm' from having non-text HEAD children
  (e.g., NetBSD mDNSShared/dns-sd.1)
  (mdoc_html.c and mdoc_term.c `Nm' handlers can be slightly simplified)

- support translated section names
  e.g. x11/scrotwm scrotwm_es.1:21:2: error: NAME section must be first
  that one uses NOMBRE because it is spanish...
  deraadt tends to think that section-dependent macro behaviour
  is a bad idea in the first place, so this may be irrelevant
  loc **  exist **  algo **  size *  imp **

- When there is free text in the SYNOPSIS and that free text contains
  the .Nm macro, groff somehow understands to treat the .Nm as an in-line
  macro, while mandoc treats it as a block macro and breaks the line.
  No idea how the logic for distinguishing in-line and block instances
  should be, needs investigation.
  uqs@  Thu, 2 Jun 2011 11:03:51 +0200
  uqs@  Thu, 2 Jun 2011 11:33:35 +0200
  loc *  exist **  algo ***  size *  imp **

--- missing man features -----------------------------------------------

- When calling less(1), specify -P to print "name(sec) lines ..."
  in the bottom line instead of "/tmp/man..."
  Jan Engelhardt (SuSE) via Matej Cepl 06 Apr 2025 14:42:52 +0200
  loc *  exist *  algo *  size *  imp **

- MANWIDTH
  Markus Waldeck <waldeck at gmx dot de> 9 Jun 2015 05:49:56 +0200
  Laura Morales <lauretas at mail dot com> 26 Apr 2018 08:15:55 +0200
  Kamil Rytarowski <kamil at netbsd> 13 Nov 2020 00:19:36 +0100
  patch from Kamil 13 Nov 2020 22:37:07 +0100
  loc *  exist *  algo *  size *  imp *

- groff_www(7) .MTO and .URL
  These macros were used by the GNU grep(1) man page.
  The groff_www(7) manual page itself uses them, too.
  We should probably *not* add them to mandoc.
  Just mentioning this here to keep track of the abuse.
  Laura Morales <lauretas at mail dot com> 20 Apr 2018 07:33:02 +0200
  loc **  exist *  algo *  size **  imp *

--- missing tbl features -----------------------------------------------

- vertical centering in cells vertically spanned with ^
  pali dot rohar at gmail dot com 16 Jul 2018 13:03:35 +0200
  loc *  exist ***  algo ***  size **  imp *

- support mdoc(7) and man(7) macros inside tbl(7) code;
  probably requires the parser reorg and letting tbl(7)
  use roff_node such that macro sets can mix;
  informed by bapt@ that FreeBSD needs this: 3 Jan 2015 23:32:23 +0100
  loc ***  exist **  algo ***  size **  imp ***

- look at the POSIX manuals in the books/man-pages-posix port,
  they use some unsupported tbl(7) features, mostly macros in tbl(7).
  loc *  exist **  algo **  size **  imp ***

- look what Joerg Schilling manual pages use
  Thu, 19 Mar 2015 18:31:48 +0100

--- missing eqn features -----------------------------------------------

- In a matrix, break the output line after each matrix line.
  Found in the discussion at CDBUG 2015.  Suggested by Avi Weinstock.
  This may not be the ideal solution after all: eqn(7) matrices
  are lists of columns, so Avi's proposal would show each *column*
  on its own *line*, which is likely to cause confusion.
  A better solution, but much harder to implement, would be to
  actually show the coordinates of column vectors on different
  terminal output lines, using the clumnated output facilities
  developed for .Bl -tag, .Bl -column, and also used for tbl(7).
  loc *  exist *  algo **  size **  imp **

- The "size" keyword is parsed, but ignored by the formatter.
  loc *  exist *  algo *  size *  imp *

- The spacing characters `~', `^', and tab are currently ignored,
  see User's Guide (Second Edition) page 2 section 4.
  loc *  exist *  algo **  size *  imp **

- Mark and lineup are parsed and ignored,
  see User's Guide (Second Edition) page 5 section 15.
  loc **  exist **  algo **  size **  imp **

- GNU eqn converts some operators to special characters, for example,
  input HYPHEN-MINUS becomes output \(mi, unless it is part of a
  quoted word.  mandoc(1) only does this when the operator is
  surrounded by blanks, not when it is part of an unquoted word.
  Also, check whether there are more such cases (e.g., +?).
  reported by bentley@  20 Jun 2017 02:04:29 -0600
  loc *  exist **  algo **  size *  imp *

- Primes, opprime, and '
  bentley@  Thu, 13 Jul 2017 23:14:20 -0600

--- missing misc features ----------------------------------------------

- use the default volume headers for sections with suffixes
  certainly affects man(7); possibly mdoc(7)?; and also groff(1)
  Alejandro Colomar 21 Aug 2022

- consider whether man(1) fallback code in main.c/fs_*() can find files
  like man3c/fopen.3c (illumos, Solaris) and man3p/fopen.3p (POSIX)
  discussed with Robert Mustacchi 21 Sep 2021 10:39:40 -0700
  loc *  exist *  algo **  size *  imp **

- let makewhatis(8) follow symbolic links to dirs below READ_ALLOWED_PATH
  this may be feasible using fts_set(FTS_FOLLOW)
  mail to sternenseemann 19 Aug 2021 19:11:50 +0200
  loc *  exist **  algo **  size *  imp **

- handle Unicode letters in tags in both HTML and terminal output
  thread "section headers with diacritics" starting with
  Mario Blaettermann 24 Mar 2022 18:13:23 +0100
  loc **  exist *  algo *  size *  imp **

- -T man does not handle eqn(7) and tbl(7)
  Stephen Gregoratto 16 Feb 2020 01:28:07 +1100
  also https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=901636
  loc **  exist **  algo **  size ***  imp **

- man -ks 1,8 route; kn@ Jul 13, 2018 orally

- italic correction (\/) in PostScript mode
  Werner LEMBERG on groff at gnu dot org  Sun, 10 Nov 2013 12:47:46
  loc **  exist **  algo *  size *  imp *

- change the default PAGER to more -Es and use the pager
  even for apropos title line output; req by bapt@
  loc *  exist *  algo *  size *  imp ***

- clean up escape sequence handling, creating three classes:
  (1) fully implemented, or parsed and ignored without loss of content
  (2) unimplemented, potentially causing loss of content
      or serious mangling of formatting (e.g. \n) -> ERROR
      see textproc/mgdiff(1) for nice examples
  (3) undefined, just output the character -> perhaps WARNING
  loc ***  exist **  algo **  size **  imp *** (parser reorg helps)

- man.conf(5) alias aliasname dirname or just -Mb -Mx -Mp
  mail to jmc@ Mar 23, 2015 03:53:14PM +0100
  loc *  exist *  algo *  size *  imp **

- kettenis wants base roff, ms, and me  Fri, 1 Jan 2010 22:13:15 +0100 (CET)
  loc **  exist **  algo **  size ***  imp *

--- compatibility checks -----------------------------------------------

- is .Bk implemented correctly in modern groff?
  sobrado@  Tue, 19 Apr 2011 22:12:55 +0200

- compare output to Heirloom roff, Solaris roff, and
  http://repo.or.cz/w/neatroff.git  http://litcave.rudi.ir/

- look at AT&T DWB http://www2.research.att.com/sw/download
  Carsten Kunze <carsten dot kunze at arcor dot de> has patches
  Mon, 4 Aug 2014 17:01:28 +0200
  ported version: https://github.com/n-t-roff/DWB3.3
  Carsten Kunze  Wed, 22 Apr 2015 11:21:43 +0200

- look at pages generated from reStructeredText, e.g. devel/mercurial hg(1)
  These are a weird mixture of man(7) and custom autogenerated low-level
  roff stuff.  Figure out to what extent we can cope.
  For details, see http://docutils.sourceforge.net/rst.html
  noted by stsp@  Sat, 24 Apr 2010 09:17:55 +0200
  reminded by nicm@  Mon, 3 May 2010 09:52:41 +0100

- look at pages generated from ronn(1) github.com/rtomayko/ronn
  (based on markdown)

- look at pages generated from Texinfo source by yat2m, e.g. security/gnupg
  First impression is not that bad.

- look at pages generated by pandoc; see
  https://github.com/jgm/pandoc/blob/master/src/Text/Pandoc/Writers/Man.hs
  porting planned by kili@  Thu, 19 Jun 2014 19:46:28 +0200

- check compatibility with Plan9:
  http://swtch.com/usr/local/plan9/tmac/tmac.an
  http://swtch.com/plan9port/man/man7/man.html
  "Anthony J. Bentley" <anthonyjbentley@gmail.com> 28 Dec 2010 21:58:40 -0700

- check compatibility with COHERENT troff:
  http://www.nesssoftware.com/home/mwc/source.php

- check compatibility with the man(7) formatter
  https://raw.githubusercontent.com/rofl0r/hardcore-utils/master/man.c

- check compatibility with
  http://ikiwiki.info/plugins/contrib/mandoc/
  https://github.com/schmonz/ikiwiki/compare/mandoc
  Amitai Schlair  Mon, 19 May 2014 14:05:53 -0400

- check compatibility with
  https://git.sr.ht/~sircmpwn/scdoc

- check features of the Slackware man.conf(5) format
  Carsten Kunze  Wed, 11 Mar 2015 17:57:24 +0100

- look at http://www.snake.net/software/troffcvt/  (troff to HTML)
  mentioned by Oliver Corff  22 Jan 2021 01:36:49 +0100


************************************************************************
* formatting issues: ugly output
************************************************************************

- revisit empty in-line macros
  look at the difference between "Em x Em ." and "Sq x Em ."
  Carsten Kunze  Fri, 12 Dec 2014 00:15:41 +0100
  loc *** exist *** algo *** size * imp **

- a column list with blank `Ta' cells triggers a spurious
  start-with-whitespace printing of a newline

- In .Bl -column, .It a<tab>"b<tab>c"
  shows the quotes in groff, but not in mandoc
  loc * exist *** algo ** size * imp **

- In .Bl -column,
  .It Em Authentication<tab>Key Length
  ought to render "Key Length" with emphasis, too,
  see OpenBSD iked.conf(5).
  reported again Nicolas Joly via wiz@ Wed, 12 Oct 2011 00:20:00 +0200
  loc *  exist ***  algo ***  size **  imp ***

- empty phrases in .Bl column produce too few blanks
  try e.g. .Bl -column It Ta Ta
  reported by millert Fri, 02 Apr 2010 16:13:46 -0400
  loc *  exist ***  algo ***  size *  imp **

- .%T can have trailing punctuation.  Currently, it puts the trailing
  punctuation into a trailing MDOC_TEXT element inside its own scope.
  That element should rather be outside its scope, such that the
  punctuation does not get underlines.  This is not trivial to
  implement because .%T then needs some features of in_line_eoln() -
  slurp all arguments into one single text element - and one feature
  of in_line() - put trailing punctuation out of scope.
  Found in mount_nfs(8) and exports(5), search for "Appendix".
  loc **  exist **  algo ***  size *  imp **

- Trailing punctuation after .%T triggers EOS spacing, at least
  outside .Rs (eek!).  Simply setting ARGSFL_DELIM for .%T is not
  the right solution, it sends mandoc into an endless loop.
  reported by Nicolas Joly  Sat, 17 Nov 2012 11:49:54 +0100
  loc *  exist **  algo **  size *  imp **

- global variables in the SYNOPSIS of section 3 pages
  .Vt vs .Vt/.Va vs .Ft/.Va vs .Ft/.Fa ...
  from kristaps@  Tue, 08 Jun 2010 11:13:32 +0200

- implicit whitespace around inline equations
  example code:  where '$times$' denotes matrix multiplication
  must not have an HTML line break, nor a blank, before <math>
  partial solution: html.c {"math", HTML_NLINSIDE | HTML_INDENT},
  bentley@  Thu, 13 Jul 2017 19:00:59 -0600

- in enclosures, mandoc sometimes fancies a bogus end of sentence
  reminded by jmc@  Thu, 23 Sep 2010 18:13:39 +0059
  loc *  exist **  algo ***  size *  imp ***

- the man(7) single-font macros (e.g. .B) use .itc,
  so ".B foo\c" followed by "bar" prints "bar" in bold
  gbranden@ Sun, 5 Jun 2022 18:08:46 -0500

- a line starting with "\fB something" counts as starting with whitespace
  and triggers a line break; found in audio/normalize-mp3(1)
  This will become easier once escape sequences are represented
  by syntax tree nodes.
  loc **  exist *  algo **  size *  imp **

- formatting /usr/local/man/man1/latex2man.1 with groff and mandoc
  reveals lots of bugs both in groff and mandoc...
  reported by bentley@  Wed, 22 May 2013 23:49:30 -0600

- Make an underlined blank an underscore rather than a blank in both
  groff and mandoc terminal output (likely tricky, needs investigation)
  job@  21 Jan 2025 18:03:52 +0000

--- PostScript and PDF issues ------------------------------------------

- PDF output doesn't use a monospaced font for .Bd -literal
  Example: "mandoc -Tpdf afterboot.8 > output.pdf && pdfviewer output.pdf".
  Search the text "Routing tables".
  Also check what PostScript mode does when fixing this.
  reported by juanfra@ Wed, 04 Jun 2014 21:44:58 +0200
  instructions from juanfra@  Wed, 11 Jun 2014 02:21:01 +0200
    add a new <</Type /Font>> block to the PDF files with /BaseFont /Courier
    and change the /Name from /F0 to the new font (/F5 (?)).
  re-reported by tb@ Mon, 16 Mar 2015 16:47:21 +0100
  loc **  exist **  algo **  size *  imp **

--- HTML issues --------------------------------------------------------

- support the idiom .TP .IP .TP for multi-paragraph list item bodies
  to: Alejandro Colomar Thu, 19 Oct 2023 16:45:21 +0200
  loc **  exist **  algo **  size **  imp **

- .Nm without an argument and .Bx cause premature </pre>
  Nab Sun, 5 Jun 2022 18:30:09 +0200

- .Aq Mt could set and reset "white-space: nowrap";
  Check whether other enclosure macros could profit from similar handling,
  or whether that is covered by Unicode line-breaking classes WJ, ZW, GL, ZWJ.
  John Gardner 25 Mar 2022 04:44:27 +1100

- make the HTML scaffolding customizable with -O skip=...
  mail to Oliver Corff  3 Jun 2021 17:28:02 +0200
  more feedback from Oliver  3 Jun 2021 18:27:56 +0200
  more feedback from Oliver  3 Jun 2021 23:37:18 +0200
  would also be useful for
  https://github.com/gbdev/rgbds-www/blob/master/
  maintainer/support/man_postproc.awk

- .Bd -unfilled should not use monospaced font
  anton@  4 Mar 2021 08:19:35 +0100
  loc **  exist *  algo *  size *  imp **

- HTML formatting of .nf should avoid <br/>,
  even when input lines start with whitespace,
  and not close and re-open <pre> on .P
  my mail to ports@ 27 Jun 2021 16:09:20 +0200
  reported again by Mohamed Akram 25 Jun 2022 16:28:18 +0000
  loc **  exist **  algo *  size *  imp **

- tbl(7) HTML output does not implement column width specifications
  reported by Ted Bullock 11 Jan 2022 16:00:44 -0700
  loc *  exist *  algo ?  size ?  imp *

- link from flags in the SYNOPSIS to their descriptions
  https://github.com/gbdev/rgbds-www/blob/master/
  maintainer/support/man_postproc.awk
  loc *  exist *  algo **  size *  imp *

- get rid of the last handful of style= attributes such that
  Content-Security-Policy: can be enabled without unsafe-inline
  suggested by bentley@  Nov 10, 2019 at 06:02:49AM -0700
  loc *  exist *  algo *  size *  imp **

- .Bf at the beginning of a paragraph inserts a bogus 1ex horizontal
  space, see for example random(3).  Introduced in
  http://mdocml.bsd.lv/cgi-bin/cvsweb/mdoc_html.c.diff?r1=1.91&r2=1.92
  reported by deraadt@ Mon, 28 Sep 2015 20:14:13 -0600 (MDT)
  loc **  exist **  algo **  size *  imp *

- jsg on icb, Nov 3, 2014:
  try to guess Xr in man(7) for hyperlinking
  and render them with <a class="Xr" href=...>
  https://github.com/Debian/debiman/issues/15
  loc *  exist *  algo **  size **  imp **

- space characters can end up in href= attributes, for example coming
  from the first .Xr argument (where they make no sense, but still);
  does this affect other characters, other source macros...?
  Jackson Pauls  29 Aug 2017 16:56:27 +0100

- generate <img> tags in HTML
  idea from florian@  Tue, 7 Apr 2015 00:26:28 +0000
  may be possible to implement with .Lk img://something.png alt_text

- check https://github.com/trentm/mdocml

--- CSS issues ---------------------------------------------------------

- use flexbox for .Bl-tag instead of the fragile float/clear mechanism
  John Gardner 25 Mar 2022 04:44:27 +1100


************************************************************************
* formatting issues: gratuitous differences
************************************************************************

- .Fn reopens a new scope after punctuation in mandoc,
  but closes its scope for good in groff.
  Do we want to change mandoc or groff?
  Steffen Nurpmeso  Sat, 08 Nov 2014 13:34:59 +0100
  loc *  exist **  algo **  size *  imp **

- Multiple issues with .In below SYNOPSIS; groff behaviour is:
  text line + .In -> no line break before #include
  called .In -> no line break before angle bracket
  .In + .In -> second one gets #include, too
  two arguments -> line break before second
  child macro -> line break before child
  .In + text line -> line break before the text line
  Evan Silberman  Fri, 20 Sep 2024 16:48:19 -0700
  loc **  exist **  algo *  size *  imp *

- In .Bl -enum -width 0n, groff continues on the same line after
  the number, mandoc breaks the line.
  mail to kristaps@  Mon, 20 Jul 2009 02:21:39 +0200
  loc *  exist **  algo **  size *  imp **

- .Pp between two .It in .Bl -column should produce one,
  not two blank lines, see e.g. login.conf(5).
  reported by jmc@  Sun, 17 Apr 2011 14:04:58 +0059
  reported again by sthen@  Wed, 18 Jan 2012 02:09:39 +0000 (UTC)
  loc *  exist ***  algo **  size *  imp **

- If the *first* line after .It is .Pp, break the line right after
  the tag, do not pad with space characters before breaking.
  See the description of the a, c, and i commands in sed(1).
  loc *  exist **  algo **  size *  imp **

- If the first line after .It is .D1, do not assert a blank line
  in between, see for example tmux(1).
  reported by nicm@  13 Jan 2011 00:18:57 +0000
  loc *  exist **  algo **  size *  imp **

- Trailing punctuation after .It should trigger EOS spacing.
  reported by Nicolas Joly  Sat, 17 Nov 2012 11:49:54 +0100
  Probably, this should be fixed somewhere in termp_it_pre(), not sure.
  loc *  exist **  algo **  size *  imp **

- When the -width string contains macros, the macros must be rendered
  before measuring the width, for example
    .Bl -tag -width ".Dv message"
  in magic(5), located in src/usr.bin/file, is the same
  as -width 7n, not -width 11n.
  The same applies to .Bl -column column widths;
  reported again by Nicolas Joly Thu, 1 Mar 2012 13:41:26 +0100 via wiz@ 5 Mar
  reported again by Franco Fichtner Fri, 27 Sep 2013 21:02:28 +0200
  reported again by Bruce Evans Fri, 17 Feb 2017 21:22:44 +0100 via bapt@
  https://reviews.freebsd.org/D35245
  even groff_mdoc(7) uses this: Nab Sun, 5 Jun 2022 22:16:37 +0200
  When implementing this, try to avoid breaking existing manuals,
  or at least fix them: Jan Stary Sun, 5 Jun 2022 22:48:05 +0200
  loc ***  exist ***  algo ***  size **  imp ***
  An easy partial fix has been implemented as skip_leading_dot_word().

- The \& zero-width character counts as output.
  That is, when it is alone on a line between two .Pp,
  we want three blank lines, not two as in mandoc.
  loc **  exist **  algo **  size *  imp **

- Sequences of multiple man(7) paragraphs (.PP, .IP) interspersed
  with .ps and .nf/.fi produce execessive blank lines, see libJudy
  and graphics/dcmtk.  The parser reorg may help with this.

- The man(7) .UR macro produces UTF-8 angle brackets in -Tutf8 output mode
  with groff, but ASCII <> with mandoc
  Alejandro Colomar Mon, 7 Aug 2023 17:13:29 +0200 Subject: hostname

- trailing whitespace must be ignored even when followed by a font escape,
  see for example
    makes
    \fBdig \fR
    operate in batch mode
  in dig(1).
  loc **  exist **  algo **  size *  imp **

************************************************************************
* warning issues
************************************************************************

- shorten/simplify error messages for usage errors
  To: deraadt@ 25 Oct 2020 23:37:01 +0100
  loc **  exist *  algo *  size **  imp ***

- warn about \\ and \. in interpretation mode
  gbranden@, groff issue #62776, 10 Nov 2023 01:57:32 -0500

- warn about output lines exceeding 80 characters
  Alejandro Colomar Aug 22, 2022
  not trivial because -T lint does not call any formatter
  loc ***  exist *  algo **  size **  imp **

- warn about duplicate .Sh/.Ss heads
  gre(4): Rename duplicate sections 20 Apr 2018 15:27:33 +0200
  loc *  exist *  algo *  size *  imp **

- style message about macros inside .Bd -literal and .Dl, in particular
  font changing macros like .Cm, .Ar, .Fa (from the mdoclint TODO)

- style message about mismatches between the section number in the
  file name (if it is known) and the section number in .Dt
  (from the mdoclint TODO)

- style message about NULL without .Dv (from the mdoclint TODO)

- style message about error constants without .Er (from the mdoclint TODO)

- warn when .Sh or .Ss contain other macros
  Steffen Nurpmeso, savannah.gnu.org/bugs/index.php?45034
  loc *  exist *  algo *  size *  imp **

- style message about violations of the convention
  .An name Aq Mt localpart@domain in AUTHORS (from the mdoclint TODO)

- warn about attempts to call non-callable macros
  Steffen Nurpmeso  Tue, 11 Nov 2014 22:55:16 +0100
  Note that formatting is inconsistent in groff.
  .Fn Po prints "Po()", .Ar Sh prints "file ..." and no "Sh".
  Relatively hard because the relevant code is scattered
  all over mdoc_macro.c and all subtly different.
  loc **  exist **  algo **  size **  imp **

- warn about punctuation - e.g. ',' and ';' - at the beginning
  of a text line, if it is likely intended to follow the preceding
  output without intervening whitespace, in particular after a
  macro line (from the mdoclint TODO)

- report double .TH in man(7) as an ERROR and let the first win
  kristaps@  28 Mar 2021 13:30:41 +0200
  loc *  exist *  algo *  size *  imp *

- makewhatis -p complains about language subdirectories:
  /usr/local/man//ru: Unknown directory part


************************************************************************
* documentation issues
************************************************************************

- mark macros as: page structure domain, manual domain, general text domain
  is this useful?

- mention /usr/share/misc/mdoc.template in mdoc(7)?

- Is all the content from http://www.std.com/obi/BSD/doc/usd/28.tbl/tbl
  covered in tbl(7)?

************************************************************************
* performance issues
************************************************************************

- the PDF file is HUGE: this can be reduced by using relative offsets

************************************************************************
* structural issues
************************************************************************

- POSIX says in the documentation of sysconf(3) that PATH_MAX
  is allowed to be so large that it is a bad idea to use it
  for sizing static buffers.  So use dynamic buffers throughout.
  See the file test-PATH_MAX.c for details.
  Found by Aaron M. Ucko in the GNU Hurd via Bdale Garbee,
  https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=829624

- Is it possible to further simplify ENDBODY_SPACE?

- Find better ways to prevent endless loops
  in roff(7) macro and string expansion.

- make buffers for parsing functions const
  christos@ via wiz@  Fri, 18 Dec 2015 17:10:01 +0100

- struct mparse refactoring
  Steffen Nurpmeso  Thu, 04 Sep 2014 12:50:00 +0200

************************************************************************
* CGI issues
************************************************************************

 - Inspect httpd(8) logs on man.openbsd.org and consider
   whether logging can be improved, where bad syntax comes from,
   and what needs to be done to get rid of COMPAT_OLDURI.
 - Enable HTTP compression by detecting gzip encoding and filtering
   output through libz.
 - Privilege separation (see OpenSSH).
 - Enable caching support via HTTP 304 and If-Modified-Since.

************************************************************************
* to improve in the groff_mdoc(7) macros
************************************************************************

- delete OS release verification from .Dx, .Fx, .Nx, .Ox etc.
  https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=629161
  also Branden Robinson 18 Dec 2019 00:59:52 +1100

- Can the distinction between .Vt and .Va be made stricter,
  recommending .Vt extern char * Ns Va optarg ; ?
  What about the block macro properties of .Vt in the SYNOPSIS?
  zeurkous 25 Dec 2019 08:48:36 +0100

- .Cd # arch1, arch2 in section 4 pages:
  find better way to indicate multiple architectures, maybe:
  allow .Dt vgafb 4 "macppc sparc64"
  already shown as "Device Drivers Manual (macppc sparc64)"
  for apropos, make that "vgafb(4) - macppc # sparc64" instead of "- all"
  groff can be made to show multiple arches, too, but it is
  tedious to do the string parsing in roff code...
  jmc@ 23 Apr 2018 07:24:52 +0100 [man for vgafb(4)...]
  loc **  exist **  algo *  size *  imp ***

- use uname(1) to set doc-default-operating-system at install time
  tobimensch  Mon, 1 Dec 2014 00:25:07 +0100

- apostrophe (39), circumflex (94), grave (96), tilde (126)
  in manuals: \(aq, \(ha, \`, \(ti
  Re: [Groff] ASCII Minus Sign in man Pages.
  bentley@ 26 Apr 2017 10:02:06 -0600
  Do we need to fix existing manuals?
  Do we need to fix the definition of the mdoc(7) language?

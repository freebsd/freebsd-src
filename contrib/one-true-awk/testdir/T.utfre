echo T.utfre: tests of regular expression code for Unicode/utf-8
# adapted from T.re

awk '
BEGIN {
	FS = "\t"
	awk = "../a.out"
}
NF == 0 {
	next
}
$1 != "" {	# new test
	re = $1
}
$2 != "" {	# either ~ or !~
	op = $2
	if (op == "~")
		neg = "!"
	else if (op == "!~")
		neg = ""
}
$3 != "" {	# new test string
	str = $3
}
$3 == "\"\"" {	# explicit empty line
	$3 = ""
}
NF > 2 {	# generate a test
	input = $3
	test = sprintf("./echo '"'"'%s'"'"' | %s '"'"'%s/%s/ {print \"%d fails %s %s %s\"}'"'"'",
		input, awk, neg, re, NR, re, op, input)
	# printf(" %3d   %s %s %s:\n", NR, re, op, input)
	# print "test is |" test "|"
	system(test)
	# system("bprint -c ../a.out")
	nt++
}
END { print "	" nt, "tests" }
' <<\!!!!
	~	ğŸ–•
		ğŸ–•ğŸ–•
		ğŸ–•ğŸ–•ğŸ–•
		""
ğŸ–•	~	ğŸ–•
		bğŸ–•
		bğŸ–•b
	!~	""
		æ—¶
		xxxxx
.	~	æ—¶
		xæ—¶x
		ğŸ™‚
	!~	""			
.ã®	~	xã®
		xxã®
		xã®x
	!~	ã®
		ã®x
		""
$	~	x
		ğŸ™‚
		""
.$	~	ëª¨
		xxëª¨
		xëª¨x
	!~	""
Ğ´$	~	Ğ´
		bĞ´
		bbbĞ´
	!~	Ğ´b
		x
		""
^	~	Ğ¸
		""
		^
^Î»$	~	Î»
	!~	xÎ»
		Î»x
		xÎ»x
		""
^Î».$	~	Î»x
		Î»Î»
	!~	xÎ»
		Î»Î»Î»
		Î»xy
		""
^$	~	""
	!~	ã«
		^
^.í•´	~	ã‚í•´
		ã‚í•´í•´
	!~	í•´
		""
^.*í•´	~	í•´
		ã‚í•´
		ã‚ã‚ã‚ã‚ã‚ã‚í•´
	!~	""
^.+í•´	~	ã‚í•´
		ã‚ã‚ã‚ã‚ã‚ã‚í•´
	!~	""
		í•´
		í•´ã‚
í•´*	~	""
		í•´
		í•´í•´í•´í•´
		ã‚í•´
		ã‚ã‚ã‚ã‚
í•´í•´*	~	í•´
		í•´í•´í•´
		ã‚í•´
	!~	ã‚ã‚ã‚ã‚
		""
\$	~	ğŸ–•$
		$
		$ğŸ–•
		ğŸ–•$ğŸ–•
	!~	""
		ğŸ–•
\.	~	.
	!~	ğŸ–•
		""
xÎ¸+y	~	xÎ¸y
		xÎ¸Î¸y
		xÎ¸Î¸Î¸Î¸Î¸Î¸y
	!~	Î¸y
		xy
		xÎ¸
xÎ¸?y	~	xy
		xÎ¸y
	!~	xÎ¸Î¸y
Î¸?b?ã®?	~	""
		x
^a?b?ã‚	~	ã‚
		aã‚
		bã‚
		abã‚
		ã‚a
	!~	""
		ab
		aba			
[Î‘-Î©]	~	Î‘
		aÎ”b
		xyÎ©
	!~	abc
		Î²
		""
[^Î‘-Î©]	~	Î´
		aÎ”b
		xyÎ©
	!~	Î‘
		Î”
		""
[Î‘-Î”Î¦-Î©]	~	Î‘
		Î’
		Î”
		Î¦
		Î©
	!~	Î 
		Î£
Î [[:lower:]]+	~	Î a
		Î ab
	!~	Î 
		Î X
		Î :
		Î [
		Î ]
ã®[0-9]+ã«	~	ã®0ã«
		ã®23ã«
		ã®12345ã«
	!~	0ã«
		ã®ã«
ã®[0-9]?ã«	~	ã®ã«
		ã®1ã«
	!~	ã®23ã«
ã®[[]ã«	~	ã®[ã«
	!~	ã®ã«
		ã®[[]ã«
		ã®]ã«
ã®[[-]ã«	~	ã®[ã«
		ã®-ã«
	!~	ã®ã«
		ã®[[]ã«
		ã®]ã«
ã®[[-a]ã«	~	ã®[ã«
		ã®aã«
		ã®]ã«
	!~	ã®ã«
		ã®[[]ã«
		ã®-ã«
ã®[]-a]ã«	~	ã®]ã«
		ã®aã«
	!~	ã®ã«
		ã®[ã«
		ã®-ã«
ã®[]]ã«	~	ã®]ã«
	!~	ã®ã«
		ã®[]]ã«
		ã®[ã«
ã®[^[]ã«	~	ã®aã«
	!~	ã®[ã«
ã®[-]ã«	~	ã®-ã«
	!~	ã®ã«
		ã®+ã«
ã®[^-]ã«	~	ã®+ã«
	!~	ã®-ã«
		ã®ã«
ã®[][]ã«	~	ã®[ã«
		ã®]ã«
	!~	ã®ã«
		ã®][ã«
		ã®[]ã«
ã®[z-a]ã«	~	ã®ã«
	!~	ã®
		ã«
		ã®aã«
		ã®zã«
		ã®-ã«
ã«|ã 	~	ã 
		ã«
		ã ã«
	!~	a
		""
^ÏƒÏ„Î¿|Ï„Î¿Ï…Ï‚$	~	ÏƒÏ„Î¿
		ÏƒÏ„Î¿d
		aÏ„Î¿Ï…Ï‚
		Ï„Î¿Ï…Ï‚
	!~	xÏƒÏ„Î¿
		Ï„Î¿Ï…Ï‚a
^(ÏƒÏ„Î¿|Ï„Î¿Ï…Ï‚)$	~	ÏƒÏ„Î¿
		Ï„Î¿Ï…Ï‚
	!~	ÏƒÏ„Î¿Ï„Î¿Ï…Ï‚
		ÏƒÏ„Î¿x
		cÏ„Î¿Ï…Ï‚
!!!!

<!-- $Id: install.sgml,v 1.5 1995/07/16 17:06:22 jfieber Exp $ -->
<!-- The FreeBSD Documentation Project -->

<!--
<!DOCTYPE linuxdoc PUBLIC '-//FreeBSD//DTD linuxdoc//EN'>
-->
<chapt><heading>Installing FreeBSD<label id="install"></heading>

    <sect>MS-DOS user's Questions and Answers

      <p><bf>Help!  I have no space!  Do I need to delete
	  everything first?</bf>

	If your machine is already running MS-DOS and has little
	or no free space available for FreeBSD's installation,
	all is not lost!  You may find the FIPS utility, provided
	in the <tt>tools</tt> directory on the FreeBSD CDROM or
	on the various FreeBSD ftp sites, to be quite useful.

	FIPS allows you to split an existing MS-DOS partition
	into two pieces, preserving the original partition and
	allowing you to install onto the second free piece.  You
	first defragment your MS-DOS partition, using the DOS
	6.xx DEFRAG utility or the Norton Disk tools, then run
	FIPS.  It will prompt you for the rest of the information
	it needs.  Afterwards, you can reboot and install FreeBSD
	on the new free slice.  See the <em>Distributions</em>
	menu for an estimation of how much free space you'll need
	for the kind of installation you want.


	<bf>Can I use compressed MS-DOS filesystems from
	  FreeBSD?</bf>

	No.  If you are using a utility such as Stacker(tm) or
	DoubleSpace(tm), FreeBSD will only be able to use
	whatever portion of the filesystem you leave
	uncompressed.  The rest of the filesystem will show up as
	one large file (the stacked/dblspaced file!).  <bf>Do not
	remove that file!</bf> You will probably regret it
	greatly!

	It is probably better to create another uncompressed
	MS-DOS primary partition and use this for communications
	between MS-DOS and FreeBSD.


	<bf>Can I mount my MS-DOS extended partitions?</bf>

	This feature isn't in FreeBSD 2.0.5 but should be in 2.1.
	We've laid all the groundwork for making this happen, now
	we just need to do the last 1 percent of the work involved.


	<bf>Can I run MS-DOS binaries under FreeBSD?</bf>

	Not yet!  We'd like to add support for this someday, but
	are still lacking anyone to actually do the work.
	Ongoing work with Linux's PCEMU utility may bring this
	much closer to being a reality sometime soon.  Send mail
	to hackers@freebsd.org if you're interested in joining
	this effort!



    <sect>Supported Configurations<label id="install:hw">

      <p>FreeBSD currently runs on a wide variety of ISA, VLB,
	EISA and PCI bus based PC's, ranging from 386sx to
	Pentium class machines (though the 386sx is not
	recommended).  Support for generic IDE or ESDI drive
	configurations, various SCSI controller, network and
	serial cards is also provided.

	A minimum of four megabytes of RAM is required to run FreeBSD.
	To run the X-window system, eight megabytes of RAM is the
	recommended minimum.

	Following is a list of all disk controllers and ethernet
	cards currently known to work with FreeBSD.  Other
	configurations may very well work, and we have simply not
	received any indication of this.

      <sect1>Disk Controllers

	<p>
	  <itemize>
	    <item>WD1003 (any generic MFM/RLL)
	    <item>WD1007 (any generic IDE/ESDI)
	    <item>WD7000
	    <item>IDE
	    <item>ATA

	    <item>Adaptec 152x series ISA SCSI controllers
	    <item>Adaptec 154x series ISA SCSI controllers
	    <item>Adaptec 174x series EISA SCSI controller in
	      standard and enhanced mode.
	    <item>Adaptec 274X/284X/2940 (Narrow/Wide/Twin)
	      series ISA/EISA/PCI SCSI controllers
	    <item>Adaptec AIC-6260 and AIC-6360 based boards,
	      which includes the AHA-152x and SoundBlaster SCSI
	      cards.

	      <bf>Note:</bf> You cannot boot from the
	      SoundBlaster cards as they have no on-board BIOS,
	      which is necessary for mapping the boot device into
	      the system BIOS I/O vectors.  They are perfectly
	      usable for external tapes, CDROMs, etc, however.
	      The same goes for any other AIC-6x60 based card
	      without a boot ROM.  Some systems DO have a boot
	      ROM, which is generally indicated by some sort of
	      message when the system is first powered up or
	      reset.  Check your system/board documentation for
	      more details.

	    <item>Buslogic 545S &amp; 545c
		<bf>Note:</bf> that Buslogic was formerly known as "Bustec".
	    <item>Buslogic 445S/445c VLB SCSI controller
	    <item>Buslogic 742A, 747S, 747c EISA SCSI controller.
	    <item>Buslogic 946c PCI SCSI controller
	    <item>Buslogic 956c PCI SCSI controller

	    <item>NCR 53C810 and 53C825 PCI SCSI controller.
	    <item>NCR5380/NCR53400 ("ProAudio Spectrum") SCSI controller. 

	    <item>DTC 3290 EISA SCSI controller in 1542 emulation mode.

	    <item>UltraStor 14F, 24F and 34F SCSI controllers.

	    <item>Seagate ST01/02 SCSI controllers.

	    <item>Future Domain 8xx/950 series SCSI controllers.
	  </itemize>

	  With all supported SCSI controllers, full support is
	  provided for SCSI-I &amp; SCSI-II peripherals,
	  including Disks, tape drives (including DAT) and CD ROM
	  drives.

	  The following CD-ROM type systems are supported at this
	  time:

	  <itemize>
	    <item>SCSI (also includes ProAudio Spectrum and
	      SoundBlaster SCSI) (cd)
	    <item>Mitsumi proprietary interface (mcd)   
	    <item>Matsushita/Panasonic (Creative) proprietary
	      interface (matcd) 
	    <item>Sony proprietary interface (scd)
	  </itemize>

	  <bf>Note:</bf> CD-Drives with IDE interfaces are not
	  supported at this time.

	  Some controllers have limitations with the way they
	  deal with &gt;16MB of memory, due to the fact that the
	  ISA bus only has a DMA address space of 24 bits.  If
	  you do your arithmetic, you'll see that this makes it
	  impossible to do direct DMA to any address &gt;16MB.
	  This limitation is even true of some EISA controllers
	  (which are normally 32 bit) when they're configured to
	  emulate an ISA card, which they then do in *all*
	  respects.  This problem is avoided entirely by IDE
	  controllers (which do not use DMA), true EISA
	  controllers (like the UltraStor, Adaptec 1742A or
	  Adaptec 2742) and most VLB (local bus) controllers.  In
	  the cases where it's necessary, the system will use
	  "bounce buffers" to talk to the controller so that you
	  can still use more than 16Mb of memory without
	  difficulty.


      <sect1>Ethernet cards

	<p>
	  <itemize>

	    <item>SMC Elite 16 WD8013 ethernet interface, and
	      most other WD8003E, WD8003EBT, WD8003W, WD8013W,
	      WD8003S, WD8003SBT and WD8013EBT based clones.  SMC
	      Elite Ultra is also supported.

	    <item>DEC EtherWORKS III NICs (DE203, DE204, and DE205)
	    <item>DEC EtherWORKS II NICs (DE200, DE201, DE202, and DE422)
	    <item>DEC DC21140 based NICs (SMC???? DE???)
	    <item>DEC FDDI (DEFPA/DEFEA) NICs

	    <item>Fujitsu MB86960A family of NICs

	    <item>Intel EtherExpress

	    <item>Isolan AT 4141-0 (16 bit)
	    <item>Isolink 4110     (8 bit)

	    <item>Novell NE1000, NE2000, and NE2100 ethernet interface.

	    <item>3Com 3C501 cards

	    <item>3Com 3C503 Etherlink II

	    <item>3Com 3c505 Etherlink/+

	    <item>3Com 3C507 Etherlink 16/TP

	    <item>3Com 3C509, 3C579, 3C589 (PCMCIA) Etherlink III

	    <item>Toshiba ethernet cards

	    <item>PCMCIA ethernet cards from IBM and National
	      Semiconductor are also supported.
	  </itemize>

      <sect1>Misc

	<p>
	  <itemize>
	    <item>AST 4 port serial card using shared IRQ.

	    <item>ARNET 8 port serial card using shared IRQ.

	    <item>BOCA ATIO66 6 port serial card using shared IRQ.

	    <item>Cyclades Cyclom-y Serial Board.

	    <item>STB 4 port card using shared IRQ.

	    <item>Mitsumi (all models) CDROM interface and drive.

	    <item>SDL Communications Riscom/8 Serial Board.

	    <item>Soundblaster SCSI and ProAudio Spectrum SCSI
	      CDROM interface and drive.

	    <item>Matsushita/Panasonic (Creative SoundBlaster)
	      CDROM interface and drive.

	    <item>Adlib, SoundBlaster, SoundBlaster Pro,
	      ProAudioSpectrum, Gravis UltraSound and Roland
	      MPU-401 sound cards.

	  </itemize>

	  FreeBSD currently does NOT support IBM's microchannel
	  (MCA) bus, but support is apparently close to
	  materializing.  Details will be posted as the situation
	  develops.

    <sect>Preparing for the installation</heading>

      <p>There are a number of different methods by which FreeBSD
	can be installed.  The following describes what
	preparation needs to be done for each type.

      <sect1>Before installing from CDROM

	<p>If your CDROM is of an unsupported type, such as an
	  IDE CDROM, then please skip to section 2.3: MS-DOS
	  Preparation.

	  There is not a lot of preparatory work that needs to be
	  done to successfully install from one of Walnut Creek's
	  FreeBSD CDROMs (other CDROM distributions may work as
	  well, but I can't say for sure as I have no hand or say
	  in their creation).  You can either boot into the CD
	  installation directly from MS-DOS using Walnut Creek's
	  supplied "install" batch file or you can make a boot
	  floppy by writing the supplied image
	  (floppies/boot.flp) onto a floppy with the "go"
	  command, which invokes the rawrite.exe command found in
	  the tools/ subdirectory.

	  If you're creating the boot floppy from a UNIX machine,
	  you may find that ``dd if=floppies/boot.flp
	  of=/dev/rfd0'' or ``dd if=floppies/boot.flp
	  of=/dev/floppy'' works well, depending on your hardware
	  and operating system environment.

	  Once you've booted from MS-DOS or floppy, you should be
	  able to select CDROM as the media type in the Media
	  menu and load the entire distribution from CDROM.  No
	  other types of installation media should be required.

	  After your system is fully installed and you have
	  rebooted from the hard disk, you should find the CD
	  mounted on the directory /cdrom.  A utility called
	  `lndir' comes with the XFree86 distribution which you
	  may also find useful: It allows you to create "link
	  tree" directories to things on Read-Only media like
	  CDROM.  One example might be something like this:
	  <tscreen>mkdir /usr/ports<newline>lndir /cdrom/ports
	  /usr/ports</tscreen>

	  Which would allow you to then "cd /usr/ports; make" and
	  get all the sources from the CD, but yet create all the
	  intermediate files in /usr/ports, which is presumably
	  on a more writable media! 


      <sect1>Before installing from Floppy</heading>

	<p>If you must install from floppy disks, either due to
	  unsupported hardware or just because you enjoy doing
	  things the hard way, you must first prepare some
	  floppies for the install.

	  The first floppy you'll need is ``floppies/root.flp'',
	  which is somewhat special in that it's not a MS-DOS
	  filesystem floppy at all, but rather an "image" floppy
	  (it's actually a gzip'd cpio file).  You can use the
	  rawrite.exe program to do this under DOS, or ``dd'' to
	  do it on a UNIX Workstation (see notes in section 2.1
	  concerning the ``floppies/boot.flp'' image).  Once this
	  floppy is made, put it aside.  You'll be asked for it
	  later.

	  You will also need, at minimum, as many 1.44MB or 1.2MB
	  floppies as it takes to hold all files in the bin
	  (binary distribution) directory.  THESE floppies *must*
	  be formatted using MS-DOS, using with the FORMAT
	  command in MS-DOS or the File Manager format command in
	  Microsoft Windows(tm).  Factory preformatted floppies
	  will also work well, provided that they haven't been
	  previously used for something else.

	  Many problems reported by our users in the past have
	  resulted from the use of improperly formatted media, so
	  we simply take special care to mention it here!

	  After you've MS-DOS formatted the floppies, you'll need
	  to copy the files onto them.  The distribution files
	  are split into chunks conveniently sized so that 5 of
	  them will fit on a conventional 1.44MB floppy.  Go
	  through all your floppies, packing as many files as
	  will fit on each one, until you've got all the
	  distributions you want packed up in this fashion.
	  Select ``Floppy'' from the Media menu at installation
	  time and you will be prompted for everything after
	  that.


      <sect1>Before installing from a MS-DOS partition</heading>

	<p>To prepare for installation from an MS-DOS partition,
	  copy the files from the distribution into a directory
	  called <tt>C:&bsol;FREEBSD</tt>.  The directory tree structure
	  of the CDROM must be partially reproduced within this directory
	  so we suggest using the DOS <tt>xcopy</tt>
	  command.  For example, to prepare for a minimal installation of
	  FreeBSD:
<tscreen><verb>
C> MD C:\FREEBSD
C> XCOPY /S E:\FLOPPIES C:\FREEBSD\FLOPPIES\
C> XCOPY /S E:\DISTS\BIN C:\FREEBSD\BIN\
</verb></tscreen>
	  asssuming that <tt>C:</tt> is where you have free space
	  and <tt>E:</tt> is where your CDROM is mounted.  Note
	  that you need the <tt>FLOPPIES</tt> directory because
	  the <tt>root.flp</tt> image is needed during an MS-DOS
	  installation.

	  For as many `DISTS' you wish to install from MS-DOS
	  (and you have free space for), install each one under
	  <tt>C:&bsol;FREEBSD</tt> - the <tt>BIN</tt> dist is only the
	  minimal requirement.  If you have room on your MS-DOS
	  partition for all the distributions, you could replace
	  the last line above with:
<tscreen><verb>
C> XCOPY /S E:\DISTS C:\FREEBSD\
</verb></tscreen>
	  which would copy all the subdirectories of 
          <tt>E:&bsol;DISTS</tt> to <tt>C:&bsol;FREEBSD</tt>.

      <sect1>Before installing from QIC/SCSI Tape</heading>

	<p>Installing from tape is probably the easiest method,
	  short of an on-line install using FTP or a CDROM
	  instal.  The installation program expects the files to
	  be simply tar'ed onto the tape, so after getting all of
	  the files for distribution you're interested in, simply
	  tar them onto the tape with a command like:
<tscreen>
        cd /freebsd/distdir<newline>
        tar cvf /dev/rwt0 (or /dev/rst0) dist1 .. dist2
	  </tscreen>
	  Make sure that the `floppies/' directory is one of the
	  "dists" given above, since the installation will look
	  for `floppies/root.flp' on the tape.

	  When you go to do the installation, you should also
	  make sure that you leave enough room in some temporary
	  directory (which you'll be allowed to choose) to
	  accommodate the FULL contents of the tape you've
	  created.  Due to the non-random access nature of tapes,
	  this method of installation requires quite a bit of
	  temporary storage!  You should expect to require as
	  much temporary storage as you have stuff written on
	  tape.


<sect1>Before installing over a network</heading>

      <p>You can do network installations over 3 types of
	communications links:
	<descrip>
        <tag>Serial port</tag> SLIP or PPP <tag>Parallel
        port</tag> PLIP (laplink cable) <tag>Ethernet</tag> A
        standard ethernet controller (includes some PCMCIA).
	</descrip>

	SLIP support is rather primitive, and limited primarily
	to hard-wired links, such as a serial cable running
	between a laptop computer and another computer.  The link
	should be hard-wired as the SLIP installation doesn't
	currently offer a dialing capability; that facility is
	provided with the PPP utility, which should be used in
	preference to SLIP whenever possible.

	If you're using a modem, then PPP is almost certainly
	your only choice.  Make sure that you have your service
	provider's information handy as you'll need to know it
	fairly soon in the installation process.  You will need
	to know, at the minimum, your service provider's IP
	address and possibly your own (though you can also leave
	it blank and allow PPP to negotiate it with your ISP).
	You also need to know how to use the various "AT
	commands" to dial the ISP with your particular modem as
	the PPP dialer provides only a very simple terminal
	emulator.

	If a hard-wired connection to another FreeBSD (2.0R or
	later) machine is available, you might also consider
	installing over a "laplink" parallel port cable.  The
	data rate over the parallel port is much higher than is
	what's typically possible over a serial line (up to
	50k/sec), thus resulting in a quicker installation.

	Finally, for the fastest possible network installation,
	an ethernet adaptor is always a good choice!  FreeBSD
	supports most common PC ethernet cards, a table of
	supported cards (and their required settings) provided as
	part of the FreeBSD Hardware Guide - see the
	Documentation menu on the boot floppy.  If you are using
	one of the supported PCMCIA ethernet cards, also be sure
	that it's plugged in _before_ the laptop is powered on!
	FreeBSD does not, unfortunately, currently support "hot
	insertion" of PCMCIA cards.

	You will also need to know your IP address on the
	network, the "netmask" value for your address class and
	the name of your machine.  Your system administrator can
	tell you which values to use for your particular network
	setup.  If you will be referring to other hosts by name
	rather than IP address, you'll also need a name server
	and possibly the address of a gateway (if you're using
	PPP, it's your provider's IP address) to use in talking
	to it.  If you do not know the answers to all or most of
	these questions, then you should really probably talk to
	your system administrator _first_ before trying this type
	of installation!

	Once you have a network link of some sort working, the
	installation can continue over NFS or FTP.

	<sect2>Preparing for NFS installation

	  <p>NFS installation is fairly straight-forward: Simply
	    copy the FreeBSD distribution files you're interested
	    onto a server somewhere and then point the NFS media
	    selection at it.

	    If this server supports only "privileged port" access
	    (as is generally the default for Sun workstations),
	    you will need to set this option in the Options menu
	    before installation can proceed.

	    If you have a poor quality ethernet card which
	    suffers from very slow transfer rates, you may also
	    wish to toggle the appropriate Options flag.

	    In order for NFS installation to work, the server
	    must support "subdir mounts", e.g. if your FreeBSD
	    2.0.5 distribution directory lives on:
	    ziggy:/usr/archive/stuff/FreeBSD Then ziggy will have
	    to allow the direct mounting of
	    /usr/archive/stuff/FreeBSD, not just /usr or
	    /usr/archive/stuff.

	    In FreeBSD's /etc/exports file, this is controlled by
	    the ``-alldirs'' option.  Other NFS servers may have
	    different conventions.  If you are getting
	    `Permission Denied' messages from the server then
	    it's likely that you don't have this enabled
	    properly!


	<sect2>Preparing for FTP Installation

	  <p>FTP installation may be done from any mirror site
	    containing a reasonably up-to-date version of FreeBSD
	    2.0.5, a full menu of reasonable choices from almost
	    anywhere in the world being provided by the FTP site
	    menu.

	    If you are installing from some other FTP site not
	    listed in this menu, or you are having troubles
	    getting your name server configured properly, you can
	    also specify your own URL by selecting the ``Other''
	    choice in that menu.  A URL can also be a direct IP
	    address, so the following would work in the absence
	    of a name server: <tscreen>
	    ftp://192.216.222.4/pub/FreeBSD/2.0.5-RELEASE</tscreen>
        
	    <em><bf>NOTE:</bf> Substitute "ALPHA" for "RELEASE"
	      during the ALPHA test period!</em>

	    If you are installing through a firewall then you
	    should probably select ``Passive mode'' ftp, which is
	    the default.  If you are talking to a server which
	    does not support passive mode for some reason, see
	    the Options menu to select Active mode transfers.


    <sect>Installing FreeBSD

      <p>Once you've taken note of the appropriate
	preinstallation steps, you should be able to install
	FreeBSD without any further trouble.

	Should this not be true, then you may wish to go back and
	re-read the relevant preparation section (section 2.x)
	for the installation media type you're trying to use -
	perhaps there's a helpful hint there that you missed the
	first time?  If you're having hardware trouble, or
	FreeBSD refuses to boot at all, read the Hardware Guide
	provided on the boot floppy for a list of possible
	solutions.

	The FreeBSD boot floppy contains all the on-line
	documentation you should need to be able to navigate
	through an installation and if it doesn't then I'd like
	to know what you found most confusing!  It is the
	objective of the FreeBSD installation program
	(sysinstall) to be self-documenting enough that painful
	"step-by-step" guides are no longer necessary.  It may
	take us a little while to reach that objective, but
	that's the objective!

	Meanwhile, you may also find the following "typical
	installation sequence" to be helpful:

	<enum>

	  <item>Boot the boot floppy.  After a boot sequence
	    which can take anywhere from from 30 seconds to 3
	    minutes, depending on your hardware, you should be
	    presented with a menu of initial choices.  If the
	    floppy doesn't boot at all, or the boot hangs at some
	    stage, go read the Q&amp;A section of the Hardware Guide
	    for possible causes.

	  <item>Press F1.  You should see some basic usage
	    instructions on the menu system and general
	    navigation.  If you haven't used this menu system
	    before then PLEASE read this thoroughly!

	  <item>If English is not your native language, you may
	    wish to proceed directly to the Language option and
	    set your preferred language.  This will bring up some
	    of the documentation in that language instead of
	    english.

	  <item>Select the Options item and set any special
	    preferences you may have.

	  <item>Select Proceed, bringing you to the Installation Menu.

	</enum>

      <sect1>The installation menu

	<p>You can do anything you like in this menu without
	  altering your system <em>except</em> for "Commit",
	  which will perform any requests to alter your system
	  you may have made.

	  If you're confused at any point, the F1 key usually
	  pulls up the right information for the screen you're
	  in.

	  <enum>

	    <item>The first step is generally `Partition', which
	      allows you to chose how your drives will be used
	      for FreeBSD.

	    <item>Next, with the `Label' editor, you can specify
	      how the space in any allocated FreeBSD partitions
	      should be used by FreeBSD, or where to mount a
	      non-FreeBSD partition (such as DOS).

	    <item>Next, the `Distributions' menu allows you to
	      specify which parts of FreeBSD you wish to load.  A
	      good choice is "User" for a small system or
	      "Developer" for someone wanting a bit more out of
	      FreeBSD.  If none of the existing collections sound
	      applicable, select Custom.

	    <item>Next, the `Media' menu allows you to specify
	      what kind of media you wish to install from.  If a
	      desired media choice is found and configured
	      automatically then this menu will simply return,
	      otherwise you'll be asked for additional details on
	      the media device type.

	    <item>Finally, the Commit command will actually
	      perform all the actions at once (nothing has been
	      written to your disk so far, nor will it until you
	      give the final confirmation).  All new or changed
	      partition information will be written out, file
	      systems will be created and/or non-destructively
	      labelled (depending on how you set their newfs
	      flags in the Label editor) and all selected
	      distributions will be extracted.

	    <item>The Configure menu choice allows you to furthur
	      configure your FreeBSD installation by giving you
	      menu-driven access to various system defaults.
	      Some items, like networking, may be especially
	      important if you did a CDROM/Tape/Floppy
	      installation and have not yet configured your
	      network interfaces (assuming you have some).
	      Properly configuring your network here will allow
	      FreeBSD to come up on the network when you first
	      reboot from the hard disk.

	    <item>Exit returns you to the top menu.

	  </enum>

	  At this point, you're generally done with the
	  sysinstall utility and can select the final `Quit'.  If
	  you're running it as an installer (e.g. before the
	  system is all the way up) then the system will now
	  reboot.  If you selected the boot manager option, you
	  will see a small boot menu with an `F?' prompt.  Press
	  the function key for BSD (it will be shown) and you
	  should boot up into FreeBSD off the hard disk.

	  If this fails to happen for some reason, see the Q&amp;A
	  section of the Hardware Guide for possible clues!


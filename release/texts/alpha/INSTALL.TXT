+=====================  Installing FreeBSD  ==========================+
|                                                                     |
| Table of Contents:                                                  |
|                                                                     |
| 0.0     Quick Start:                                                |
|         0.1     Installing FreeBSD from CDROM or the Internet.      |
|                                                                     |
| 1.0     Detail on various installation types:                       |
|         1.1     Installing from a network CDROM                     |
|         1.2     Installing from Floppies                            |
|         1.3     Installing from QIC/SCSI tape                       |
|         1.4     Installing over a network using NFS or FTP          |
|                 1.4.1   NFS Installation tips                       |
|                 1.4.2   FTP Installation tips                       |
|                                                                     |
+=====================================================================+

Author:         Jordan K. Hubbard
Last updated:   Fri Mar 16 14:47:31 PST 2001

0.0     Quick Start
---     -----------

This manual documents the process of making a new installation of
FreeBSD on your machine.  If you are upgrading from a previous
release of FreeBSD, please see the file UPGRADE.TXT for important
information on upgrading.  If you are not familiar with configuring
hardware for FreeBSD, you should also read the HARDWARE.TXT file -
it contains important information which may save you a lot of grief.

If you're new to FreeBSD then you should also read EVERYTHING listed
in the Documentation menu on the boot floppy.  It may seem like a lot
to read, but the time you spend now reading the documents will be made
up many times over because you were adequately prepared. Also, you will
know the types of information available should you get stuck later.
Once the system is installed, you can also revisit this menu and use a 
WEB browser to read the installed FAQ (Frequently Asked Questions) and 
Handbook HTML documentation sets for FreeBSD.  You can also use the 
browser to visit other WEB sites on the net (like http://www.freebsd.org)
if you have an Internet connection. See ABOUT.TXT for more information
on the resources available to you.

The best laid plans sometimes go awry, so if you run into trouble take a 
look at TROUBLE.TXT which contains valuable troubleshooting information.

DISCLAIMER: While FreeBSD does its best to safeguard against
accidental loss of data, it's still more than possible to WIPE OUT
YOUR ENTIRE DISK with this installation!  Please do not proceed to the
final FreeBSD installation menu unless you've adequately backed up any
important data first!  We really mean it!

FreeBSD/alpha supports the alpha platforms described in HARDWARE.TXT

You will need a dedicated disk for FreeBSD/alpha. It is not possible
to share a disk with another operating system at this time. This disk
will need to be attached to a SCSI controller which is supported by
the SRM firmware or an IDE disk assuming the SRM in your machine
supports booting from IDE disks.

Your root filesystem MUST be the first partition (partition a) on the
disk to be bootable.

You will need the SRM console firmware for your platform. In some
cases, it is possible to switch between AlphaBIOS (or ARC) firmware
and SRM. In others it will be necessary to download new firmware from
the vendor's Website.

0.1     Installing FreeBSD from CDROM or the Internet
---     ---------------------------------------------

The easiest type of installation is from CD.  If you have a supported
CDROM drive and a FreeBSD installation CD from Walnut Creek CDROM, you 
can boot FreeBSD directly from the CDROM. Insert the CDROM into the
drive and type the following command to start the installation:

	>>>boot dka0 (or whatever device your CDROM drive is)

Alternatively you can boot the installation from floppy disk. You
should start the installation by building a set of FreeBSD boot floppy
from the files floppies/kern.flp and floppies/mfsroot.flp using the
instructions found in floppies/README.TXT. From the SRM console prompt 
(>>>), just insert the kern.flp floppy and type the following command
to start the installation:

	>>>boot dva0

Insert the mfsroot.flp floppy when prompted and you will end up at the 
first screen of the install program.

If you don't have a CDROM and would like to simply install over the
net using PPP, slip or a dedicated connection, simply fetch the
<FreeBSD-release>/floppies/kern.flp and mfsroot.flp files from:

        ftp://ftp.freebsd.org/pub/FreeBSD

or one of its many mirrors (http://www.freebsd.org/handbook/mirrors.html)
and follow step 3 above.  You should also read the floppies/README.TXT
file as it contains important information for downloaders.

Once you have a boot floppy made, please go to section 1.4 of this
document for additional tips on installing via FTP or NFS.


1.0     Detail on various installation types
---     ------------------------------------

Once you've gotten yourself to the initial installation screen
somehow, you should be able to follow the various menu prompts and go
from there.  If you've never used the FreeBSD installation before, you
are also encouraged to read some of the documentation in the the
Documentation submenu as well as the general "Usage" instructions on
the first menu.

   REMEMBER:  If you get stuck at a screen, hit F1 for the online
   documentation for that section.

If you've never installed FreeBSD before, or even if you have, the
"Standard" installation mode is the most recommended since it makes sure
that you'll visit all the various important checklist items along the
way.  If you're much more comfortable with the FreeBSD installation
process and know _exactly_ what you want to do, use the Express or
Custom installation options.  If you're upgrading an existing system,
use the Upgrade option.

The FreeBSD installer supports the direct use of floppy, DOS, tape,
CDROM, FTP, NFS and UFS partitions as installation media, further tips
on installing from each type of media listed below.

Once the install procedure has finished, you will be able to start
FreeBSD/alpha by typing something like this to the SRM prompt:

	>>>boot dkc0

This instructs the firmware to boot the specified disk. To find the
SRM names of disks in your machine, use the show device command:

	>>>show device
	dka0.0.0.4.0               DKA0           TOSHIBA CD-ROM XM-57  3476
	dkc0.0.0.1009.0            DKC0                       RZ1BB-BS  0658
	dkc100.1.0.1009.0          DKC100             SEAGATE ST34501W  0015
	dva0.0.0.0.1               DVA0
	ewa0.0.0.3.0               EWA0              00-00-F8-75-6D-01
	pkc0.7.0.1009.0            PKC0                  SCSI Bus ID 7  5.27
	pqa0.0.0.4.0               PQA0                       PCI EIDE
	pqb0.0.1.4.0               PQB0                       PCI EIDE


This example is from a Digital Personal Workstation 433au and shows
three disks attached to the machine. The first is a CDROM called dka0
and the other two are disks and are called dkc0 and dkc100
repectively.

You can specify which kernel file to load and what boot options to use 
with the -file and -flags options to boot, e.g.:

	>>>boot -file kernel.old -flags s

To make FreeBSD/alpha boot automatically, use these commands:

	>>>set boot_osflags a
	>>>set bootdef_dev dkc0
	>>>set auto_action BOOT


1.1     Installing from a network CDROM
---     -------------------------------

If you simply wish to install from a local CDROM drive then see the
Quick Start section.  If you don't have a CDROM drive on your system
and wish to use a FreeBSD distribution CD in the CDROM drive of
another system to which you have network connectivity, there are
several ways of going about it:

1. If you would be able to FTP install FreeBSD directly from the CDROM
   drive in some FreeBSD machine, it's quite easy: You simply add the
   following line to the password file (using the vipw command):

        ftp:*:99:99::0:0:FTP:/cdrom:/sbin/nologin

   Warning:  This may allow anyone on the local network (or Internet) to
   make "anonymous FTP" connections to this machine, which may not be 
   desirable.

   On the machine on which you are running the install, go to the "Options"
   menu and set "Release Name" to "any".  You may then choose a Media
   type of FTP and type in: ``ftp://<machine with CDROM drive>'' after
   picking "URL" in the ftp sites menu.

2. If you would rather use NFS to export the CDROM directly to the
   machine(s) you'll be installing from, you need to first add an
   entry to the /etc/exports file (on the machine with the CDROM drive)
   which looks something like this:

        /cdrom          -ro             ziggy.foo.com

   To allow the machine "ziggy.foo.com" to mount the CDROM directly
   via NFS during installation.  The machine with the CDROM must also
   be configured as an NFS server, of course, and if you're not sure how
   to do that then an NFS installation is probably not the best choice
   for you unless you're willing to read up on rc.conf(5) and configure
   things appropriately.  Assuming that this part goes smoothly, you
   should be able to enter:  <cdrom-host>:/cdrom as the path for an NFS
   installation when the target machine is installed.


1.2     Installing from Floppies
---     ------------------------

If you must install from floppy disks, either due to unsupported
hardware or just because you enjoy doing things the hard way, you must
first prepare some floppies for the install.

First, make a set of boot floppies as described in floppies/README.TXT.

Second, read the file LAYOUT.TXT and pay special attention to the
"Distribution format" section since it describes which files you're
going to need to put onto floppy and which you can safely skip.

Next you will need, at minimum, as many 1.44MB floppies as it takes to
hold all files in the bin (binary distribution) directory.  If you're
preparing these floppies under DOS, then THESE floppies *must* be
formatted using the MS-DOS FORMAT command.  If you're using Windows,
use the Windows File Manager format command.

Don't trust Factory Preformatted floppies!  Format them again
yourself, just to make sure.  Many problems reported by our users in
the past have resulted from the use of improperly formatted media,
which is why I'm taking such special care to mention it here!

If you're creating the floppies from another FreeBSD machine, a format
is still not a bad idea though you don't need to put a DOS filesystem
on each floppy.  You can use the `disklabel' and `newfs' commands to
put a UFS filesystem on a floppy, as the following sequence of
commands illustrates:

        fdformat -f 1440 fd0.1440
        disklabel -w -r fd0.1440 floppy3
        newfs -t 2 -u 18 -l 1 -i 65536 /dev/fd0

After you've formatted the floppies for DOS or UFS, you'll need to
copy the files onto them.  The distribution files are split into
chunks conveniently sized so that 5 of them will fit on a conventional
1.44MB floppy.  Go through all your floppies, packing as many files as
will fit on each one, until you've got all the distributions you want
packed up in this fashion.  Each distribution should go into its own
subdirectory on the floppy, e.g.: a:\bin\bin.inf, a:\bin\bin.aa,
a:\bin\bin.ab, ...

IMPORTANT NOTE: The bin.inf file also needs to go on the first floppy
of the bin set since it is read by the installation program in order
to figure out how many additional pieces to look for when fetching and
concatenating the distribution.  When putting distributions onto
floppies, the <distname>.inf file MUST occupy the first floppy of each
distribution set!

Once you come to the Media screen of the install, select "Floppy" and
you'll be prompted for the rest.


1.3     Installing from QIC/SCSI Tape
---     -----------------------------

When installing from tape, the installation program expects the files
to be simply tar'ed onto it, so after fetching all of the files for
the distributions you're interested in, simply tar them onto the tape
with a command something like this:

        cd /where/you/have/your/dists
        tar cvf /dev/rwt0 (or /dev/rsa0) dist1 .. dist2

When you go to do the installation, you should also make sure that you
leave enough room in some temporary directory (which you'll be allowed
to choose) to accommodate the FULL contents of the tape you've
created.  Due to the non-random access nature of tapes, this method of
installation requires quite a bit of temporary storage!  You should
expect to require as much temporary storage as you have stuff written
on tape.

SPECIAL NOTE: When going to do the installation, the tape must be in
the drive *before* booting from the boot floppy.  The installation
"probe" may otherwise fail to find it.

Now create a boot floppy as described in section 0.1 and proceed with
the installation.


1.4     Installing over a network using FTP or NFS
---     ------------------------------------------

After making a boot floppy as described in the first section, you can
load the rest of the installation over a network using one of 3 types
of connections:

        Serial port:    SLIP / PPP
        Parallel port:  PLIP (using ``laplink'' style cable)
        Ethernet:       A standard Ethernet controller (including
                        certain PCCARD devices).

Serial Port
-----------

SLIP support is rather primitive, and is limited primarily to
hard-wired links, such as a serial cable running between two
computers.  The link must be hard-wired because the SLIP installation
doesn't currently offer a dialing capability.  If you need to dial out
with a modem or otherwise dialog with the link before connecting to
it, then I recommend that the PPP utility be used instead.

If you're using PPP, make sure that you have your Internet Service
Provider's IP address and DNS information handy as you'll need to know
it fairly early in the installation process.  You may also need to
know your own IP address, though PPP supports dynamic address
negotiation and may be able to pick up this information directly from
your ISP if they support it.

You will also need to know how to use the various "AT commands" for
dialing out with your particular brand of modem as the PPP dialer
provides only a very simple terminal emulator.


Parallel Port
-------------

If a hard-wired connection to another FreeBSD or Linux machine is
available, you might also consider installing over a "laplink"
style parallel port cable.  The data rate over the parallel port
is much higher than what is typically possible over a serial line
(up to 50k/sec), thus resulting in a quicker installation.  It's not
typically necessary to use "real" IP addresses when using a
point-to-point parallel cable in this way and you can generally just
use RFC 1918 style addresses for the ends of the link (e.g. 10.0.0.1,
10.0.0.2, etc).

IMPORTANT NOTE: If you use a Linux machine rather than a FreeBSD
machine as your PLIP peer, you will also have to specify "link0" in
the TCP/IP setup screen's ``extra options for ifconfig'' field.


Ethernet
--------

FreeBSD supports most common Ethernet cards, a table of supported
cards (and their required settings) being provided as part of the
FreeBSD Hardware Guide (see the Documentation menu on the boot floppy
or the top level directory of the CDROM).  

You will also need to know your IP address on the network, the
"netmask" value for your address class and the name of your machine.
Your system administrator can tell you which values are appropriate to
your particular network setup.  If you will be referring to other
hosts by name rather than IP address, you'll also need a name server
and possibly the address of a gateway (if you're using PPP, it's your
provider's IP address) to use in talking to it.

If you do not know the answers to these questions then you should
really probably talk to your system administrator _first_ before
trying this type of installation!  Using a randomly chosen IP address
or netmask on a live network will almost certainly get you shot at
dawn.

Once you have a network connection of some sort working, the
installation can continue over NFS or FTP.


1.4.1   NFS installation tips
-----   ---------------------

        NFS installation is fairly straight-forward: Simply copy the
        FreeBSD distribution files you want onto a server somewhere
        and then point the NFS media selection at it.

        If this server supports only "privileged port" access (as is
        generally the default for Sun and Linux workstations), you
        will need to set this option in the Options menu before
        installation can proceed.

        If you have a poor quality Ethernet card which suffers from very
        slow transfer rates, you may also wish to toggle the appropriate
        Options flag.

        In order for NFS installation to work, the server must also support
        "subdir mounts", e.g. if your FreeBSD 2.2 distribution directory
        lives on:  ziggy:/usr/archive/stuff/FreeBSD
        Then ziggy will have to allow the direct mounting of
        /usr/archive/stuff/FreeBSD, not just /usr or /usr/archive/stuff.

        In FreeBSD's /etc/exports file this is controlled by the
        ``-alldirs'' option.  Other NFS servers may have different
        conventions.  If you are getting `Permission Denied' messages
        from the server then it's likely that you don't have this
        properly enabled!


1.4.2   FTP Installation tips
-----   ---------------------

        FTP installation may be done from any mirror site containing a
        reasonably up-to-date version of FreeBSD.  A full menu of
        reasonable choices for almost any location in the world is
        provided in the FTP site menu during installation.

        If you are installing from some other FTP site not listed in
        this menu, or you are having troubles getting your name server
        configured properly, you can also specify your own URL by
        selecting the ``URL'' choice in that menu.  A URL can
        contain a hostname or an IP address, so the following would
        work in the absence of a name server:

                ftp://192.216.191.11/pub/FreeBSD

        There are three FTP installation modes you can use:

           o FTP:

             This method uses the standard "Active" mode for file
             transfers which allows the server to initiate a connection
             to the client.  This will not work through most firewalls
             but will often work best with older FTP servers that do
             not support passive mode.  If your connection hangs with
             passive mode, try this one!

           o FTP Passive:

             This sets the FTP "Passive" mode which prevents the
             server from opening connections to the client.  This
             option is best for users to pass through firewalls that
             do not allow incoming connections on random port
             addresses.

           o FTP via an HTTP proxy:

             This option instructs FreeBSD to use HTTP to connect to a
             proxy for all FTP operations.  The proxy will translate
             the requests and send them to the FTP server.  This
             allows the user to pass through firewalls that do not
             allow FTP at all, but offer an HTTP proxy.  You must
             specify the hostname of the proxy in addition to the FTP
             server.

        In the rare case that you have an FTP proxy that does not go
        through HTTP, you can specify the URL as something like :

                ftp://foo.bar.com:1234/pub/FreeBSD

        Where "1234" is the port number of the proxy ftp server.


---- End of Installation Guide ---

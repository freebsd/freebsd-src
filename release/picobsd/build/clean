#! /bin/sh -

#
# $FreeBSD$
#
set -e

# Get a list of targets.
TARGETS=""
for i in ../* ; do
    if [ -d $i -a -f $i/PICOBSD ] ; then
	TARGETS="$TARGETS `basename $i`"
    fi
done

if [ $# -lt 1 ]; then
    echo "What to clean?"
    echo "Possible targets are:${TARGETS} or 'all'"
    exit 1
fi

if [ "$1" = "all" ]; then
    list=${TARGETS}
    old="old"
else
    list=$1
    old=$1
fi
if [ -f picobsd.bin ]; then
    mv -f picobsd.bin picobsd.bin.${old}
fi

rm -fr kernel kernel.gz fs.PICOBSD *.o *core *.db \
	.build.reply stage1.out build.status .image.list \
	floppy.tree loader
cd ..
rm -rf help/tmp_hlp
echo "===================== $0 tools started ===================="
for j in $list ; do
	echo "===================== $0 $j started ======================"
	(cd ${j}/crunch1; \
	if [ -f crunch1.mk ]; then \
		make -f crunch1.mk realclean || true ; \
	fi ; \
	make -f ../../build/Makefile.crunch clean)
	echo "=============== $0 $j completed successfuly =============="
done

<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook V4.1-Based Extension//EN" [
<!ENTITY % articles.ent PUBLIC "-//FreeBSD//ENTITIES DocBook FreeBSD Articles Entity Set//EN">
%articles.ent;

<!ENTITY % release PUBLIC "-//FreeBSD//ENTITIES Release Specification//EN">
%release;

<!-- Text constants which probably don't need to be changed.-->

<!ENTITY % include.historic "IGNORE">
<!ENTITY % no.include.historic "IGNORE">
]>

<article>
  <articleinfo>
    <title>&os; &release.current; Release Notes</title>

    <corpauthor>The &os; Project</corpauthor>

    <pubdate>$FreeBSD$</pubdate>

    <copyright>
      <year>2010</year>
      <holder role="mailto:doc@FreeBSD.org">The &os; Documentation Project</holder>
    </copyright>

    <legalnotice id="trademarks" role="trademarks">
      &tm-attrib.freebsd;
      &tm-attrib.ibm;
      &tm-attrib.ieee;
      &tm-attrib.intel;
      &tm-attrib.sparc;
      &tm-attrib.general;
    </legalnotice>

    <abstract>
      <para>The release notes for &os; &release.current; contain a summary
	of the changes made to the &os; base system on the
	&release.branch; development line.
	This document lists applicable security advisories that were issued since
	the last release, as well as significant changes to the &os;
	kernel and userland.
	Some brief remarks on upgrading are also presented.</para>
    </abstract>
  </articleinfo>

  <sect1 id="intro">
    <title>Introduction</title>

    <para>This document contains the release notes for &os;
      &release.current;.  It
      describes recently added, changed, or deleted features of &os;.
      It also provides some notes on upgrading
      from previous versions of &os;.</para>

<![ %release.type.current [

    <para>The &release.type; distribution to which these release notes
      apply represents the latest point along the &release.branch; development
      branch since &release.branch; was created.  Information regarding pre-built, binary
      &release.type; distributions along this branch
      can be found at <ulink url="&release.url;"></ulink>.</para>

]]>

<![ %release.type.snapshot [

    <para>The &release.type; distribution to which these release notes
      apply represents a point along the &release.branch; development
      branch between &release.prev; and the future &release.next;.
      Information regarding
      pre-built, binary &release.type; distributions along this branch
      can be found at <ulink url="&release.url;"></ulink>.</para>

]]>

<![ %release.type.release [

    <para>This distribution of &os; &release.current; is a
      &release.type; distribution.  It can be found at <ulink
      url="&release.url;"></ulink> or any of its mirrors.  More
      information on obtaining this (or other) &release.type;
      distributions of &os; can be found in the <ulink
      url="&url.books.handbook;/mirrors.html"><quote>Obtaining
      &os;</quote> appendix</ulink> to the <ulink
      url="&url.books.handbook;/">&os; Handbook</ulink>.</para>

]]>

    <para>All users are encouraged to consult the release errata before
      installing &os;.  The errata document is updated with
      <quote>late-breaking</quote> information discovered late in the
      release cycle or after the release.  Typically, it contains
      information on known bugs, security advisories, and corrections to
      documentation.  An up-to-date copy of the errata for &os;
      &release.current; can be found on <ulink url="&url.errata;"></ulink>.</para>
  </sect1>

  <sect1 id="new">
    <title>What's New</title>

    <para>This section describes the most user-visible new or changed
      features in &os; since &release.prev;.</para>

    <para>Typical release note items document recent security
      advisories issued after &release.prev;, new drivers or hardware
      support, new commands or options, major bug fixes, or
      contributed software upgrades.  They may also list changes to
      major ports/packages or release engineering practices.  Clearly
      the release notes cannot list every single change made to &os;
      between releases; this document focuses primarily on security
      advisories, user-visible changes, and major architectural
      improvements.</para>

    <sect2 id="security">
      <title>Security Advisories</title>

      <para>Problems described in the following security advisories have
	been fixed.  For more information, consult the individual
	advisories available from
	<ulink url="http://security.FreeBSD.org/"></ulink>.</para>

      <informaltable frame="none" pgwide="0">
	<tgroup cols="3">
	  <colspec colwidth="1*">
	  <colspec colwidth="1*">
	  <colspec colwidth="3*">
	    <thead>
	      <row>
		<entry>Advisory</entry>
		<entry>Date</entry>
		<entry>Topic</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:09.pipe.asc"
			      >SA-09:09.pipe</ulink></entry>
		<entry>10&nbsp;June&nbsp;2009</entry>
		<entry><para>Local information disclosure via direct pipe writes</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:10.ipv6.asc"
			      >SA-09:10.ipv6</ulink></entry>
		<entry>10&nbsp;June&nbsp;2009</entry>
		<entry><para>Missing permission check on SIOCSIFINFO_IN6 ioctl</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:11.ntpd.asc"
			      >SA-09:11.ntpd</ulink></entry>
		<entry>10&nbsp;June&nbsp;2009</entry>
		<entry><para>ntpd stack-based buffer-overflow vulnerability</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:12.bind.asc"
			      >SA-09:12.bind</ulink></entry>
		<entry>29&nbsp;July&nbsp;2009</entry>
		<entry><para>BIND &man.named.8; dynamic update message remote DoS</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:14.devfs.asc"
			      >SA-09:14.devfs</ulink></entry>
		<entry>2&nbsp;Oct&nbsp;2009</entry>
		<entry><para>Devfs / VFS NULL pointer race condition</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:15.ssl.asc"
			      >SA-09:15.ssl</ulink></entry>
		<entry>3&nbsp;Dec&nbsp;2009</entry>
		<entry><para>SSL protocol flaw</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:16.rtld.asc"
			      >SA-09:16.rtld</ulink></entry>
		<entry>3&nbsp;Dec&nbsp;2009</entry>
		<entry><para>Improper environment sanitization in &man.rtld.1;</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:17.freebsd-update.asc"
			      >SA-09:17.freebsd-update</ulink></entry>
		<entry>3&nbsp;Dec&nbsp;2009</entry>
		<entry><para>Inappropriate directory permissions in &man.freebsd-update.8;</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:01.bind.asc"
			      >SA-10:01.bind</ulink></entry>
		<entry>6&nbsp;Jan&nbsp;2010</entry>
		<entry><para>BIND &man.named.8; cache poisoning with DNSSEC validation</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:02.ntpd.asc"
			      >SA-10:02.ntpd</ulink></entry>
		<entry>6&nbsp;Jan&nbsp;2010</entry>
		<entry><para>ntpd mode 7 denial of service</para></entry>
	      </row>

	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:03.zfs.asc"
			      >SA-10:03.zfs</ulink></entry>
		<entry>6&nbsp;Jan&nbsp;2010</entry>
		<entry><para>ZFS ZIL playback with insecure permissions</para></entry>
	      </row>
	    </tbody>
	</tgroup>
      </informaltable>
    </sect2>

    <sect2 id="kernel">
      <title>Kernel Changes</title>

      <para>The &man.closefrom.2; system call has been added.  This
	closes any open file descriptors which are equal to or larger
	than the specified value.  Note that this does not fail with
	any errors and this is not multi-thread safe.</para>

      <para>The &man.ddb.8; subcommands for &man.geom.8; now supports
	pagination.</para>

      <para>The &man.futimes.2;, &man.lutimes.2;, and &man.utimes.2;
	system call now support a sysctl variable
	<varname>vfs.timestamp_precision</varname>.</para>

      <para>The &man.jail.8; subsystem now supports
	<varname>security.jail.ip4_saddrsel</varname> and
	<varname>security.jail.ip6_saddrsel</varname> sysctl variables
	to control whether to use source address selection or the
	primary jail address for unbound outgoing connections.  The
	default is that the source address selection is enabled.
	Also, the jail parameter <varname>ip4.saddrsel</varname> and
	<varname>ip6.saddrsel</varname> are boolean option to enable
	the source address selection for IPv4 and IPv6, respectively.
	If the boolean parameters
	<varname>ip4.nosaddrsel</varname> and
	<varname>ip6.nosaddrsel</varname> are set, the child jails do
	not inherit the address selection options of the
	parent.</para>

      <para arch="amd64">The <varname>kmem_map</varname> KVA space has
	been increased to 512GB.</para>

      <para>The &man.lindev.4; driver has been added.  This is for
	Linux-specific pseudo devices and currently used only for
	<filename>/dev/full</filename>.</para>

      <para>&os; Linux emulation layer now supports
	<varname>SO_PEERCRED</varname> socket option,
	<varname>MSG_CMSG_CLOEXEC</varname> for
	<function>recvmsg()</function>, and robust futex.  The futex
	has been reimplemented by using &man.sx.9; lock.  Initial
	support of &man.ktr.4; tracing has also been added.</para>

      <para>A lock handling error has been fixed in interaction
	between &man.malloc.3; implementation and threading library.
	When a multi-threaded process calls the &man.fork.2; system
	call in a thread and the &man.malloc.3; function in another
	thread, it caused a deadlock in the child process.</para>

      <para>PECOFF image activator support has been removed.</para>

      <para>&os; now supports POSIX semaphores
	(<varname>P1003_1B_SEMAPHORES</varname> kernel option) by
	default.</para>

      <para>A deadlock in the &man.sched.ule.4; scheduler has been
	fixed.  For more details, see <ulink
	  url="http://security.freebsd.org/advisories/FreeBSD-EN-10:02.sched_ule.asc">EN-10:02.sched_ule</ulink>.</para>

      <para>&os; now supports shared memory segments for System V IPC
	which is larger than 2GB on 64-bit platforms.  For more
	details, see <filename>/usr/src/UPDATING</filename>
	file.</para>

      <para>The &man.sglist.9; API to manage scatter/gather lists of
	physical addresses has been added.</para>

      <para>&os; ABI of some of the structures used by the System V
	IPC API has been changed internally.  For new kernel modules,
	the <function>kern_msgctl()</function>,
	<function>kern_semctl()</function>, and
	<function>kern_shmctl()</function> functions will be
	transparently renamed to the new
	<function>kern_new_*()</function> functions by using ABI
	shims.  The old functions remain as the old names to provide
	backward compatibility for older kernel modules.</para>

      <para>A new sysctl variable
	<varname>security.bsd.map_at_zero</varname> has been added and
	set to <literal>1</literal> (allow) by default.  This controls
	whether &os; allows to map an object at the address
	<literal>0</literal>, which is part of the user-controlled
	portion of the virtual address space.  Disabling this has some
	effect on preventing an attack which injects malicious code
	into that location and triggers a NULL pointer dereference in
	the kernel.</para>

      <sect3 id="boot">
	<title>Boot Loader Changes</title>

	<para>A new boot loader <literal>gptzfsboot</literal>, which
	  supports GPT and ZFS has been added.</para>

	<para>The boot loader <literal>zfsboot</literal> now always
	  uses 64-bit LBAs and supports more than seven drives in the
	  ZFS pools.</para>

	<para>A bug in <literal>zfsboot</literal> has been fixed.  A
	  <filename>/boot.config</filename> smaller than 512 bytes
	  was ignored.</para>

	<para><literal>zfsloader</literal>, the final boot loader
	  similar to &man.loader.8; which supports ZFS has been
	  added.</para>

	<para>A bug in the boot loader has been fixed.  It failed to
	  recognize GPT correctly when the system supports both of MBR
	  and GPT and they are synchronized with each other.</para>

	<para arch="pc98">The <application>boot2</application> program
	  has been reimplemented based on the latest version for
	  &arch.i386;.</para>
      </sect3>

      <sect3 id="proc">
	<title>Hardware Support</title>

	<para>The <application>amdsbwd(4)</application> driver for AMD
	  SB600/SB7xx watchdog timer has been added.</para>

	<para>The &man.cpuctl.4; driver now supports atomically
	  setting/clearing individual bits of a MSR register.  Two new
	  ioctl calls <varname>CPUCTL_MSRSBIT</varname> and
	  <varname>CPUCTL_MSRCBIT</varname> treat the data field of
	  struct in the argument passed as a mask and set/clear bits
	  of the MSR register according to the mask value.  The
	  &man.cpucontrol.8; utility also supports this feature.  For
	  more details, see Userland Changes section.</para>

	<para>The &man.cpufreq.4; driver now supports Phenom (Family
	  10h).</para>

	<para arch="amd64,i386">CPU cache flushing has been optimized
	  when changing caching attributes of pages by doing nothing
	  for CPUs that support self-snooping and using
	  <literal>CLFLUSH</literal> instead of a full cache
	  invalidate when possible.  &os; does not use
	  <literal>CLFLUSH</literal> on Intel CPUs due to problems
	  with flushing the local APIC range by default.  This can be
	  controlled via the <varname>hw.clflush_disable</varname>
	  loader tunable.  A setting of <literal>1</literal> disables
	  the use of <literal>CLFLUSH</literal>.  A setting of
	  <literal>0</literal> allows <literal>CLFLUSH</literal> to be
	  used for Intel CPUs when <literal>CPUID_SS</literal> is not
	  present.  This fixes a kernel panic occurred on Xen which
	  disables self-snooping.</para>

	<para arch="sparc64">The epic(4) driver for the front panel
	  LEDs in Sun Fire V215/V245 has been added.</para>

	<para arch="sparc64">The fire(4) driver for
	  <quote>Fire</quote> JBus to PCIe bridges found in at least
	  the Sun Fire V215/V245 and Sun Ultra 25/45 machines has been
	  added.</para>

	<para arch="amd64,i386">The &man.hwpmc.4; driver for Hardware
	  Performance Monitoring Counter support has been added.  This
	  consists of the kernel driver, &man.pmc.3; interface
	  library, and userland utilities &man.pmcannotate.8;,
	  &man.pmccontrol.8;, and &man.pmcstat.8;, and allows applications
	  to use hardware performance counters to gather performance
	  data about specific processes or for the system as a
	  whole.</para>

	<para>Several bugs in the &man.ipmi.4; driver which prevents
	  the watchdog timeout setting from working, have been
	  fixed.</para>

	<para>The &man.k8temp.4; driver has been renamed with
	  &man.amdtemp.4;.  The new driver supports AMD K10 and K11 as
	  well as K8.</para>

	<para>A loader tunable <varname>hw.mca.enabled</varname> has
	  been added.  This can be used to enable/disable the machine
	  check code.  Disabled by default.</para>

	<para>A sysctl variable <varname>hw.pagesizes</varname> has
	  been added.  This reports all of the supported page sizes on
	  the system.</para>

	<para>PCI Express memory-mapped configuration space access,
	  ACPI MCFG table support, and BAR (Base Address Register)
	  handling in the &man.pci.4; subsystem has been improved.
	  This is disabled by default and can be enabled by setting a
	  loader tunable <varname>hw.pci.mcfg</varname> to
	  <literal>1</literal>.  This value can be queried via a
	  sysctl variable of the same name.</para>

	<para arch="amd64,i386">&os; now supports VIA Nano processor
	  family.</para>

	<sect4 id="mm">
	  <title>Multimedia Support</title>

	  <para><application>DRM</application> now supports Radeon HD
	    4200 (RS880), 4770 (RV740), and R6/7xx 3D, and Intel G41
	    chips.</para>

	  <para>The vgapci(4) driver for PCI VGA display devices
	    which can attach devices as the children now supports
	    proxying of PCI MSI/MSI-X (Message Signaled Interrupt)
	    requests and bus interrupt requests for the child devices.
	    This allows child devices to use MSI/MSI-X interrupts.</para>
	</sect4>

	<sect4 id="net-if">
	  <title>Network Interface Support</title>

	  <para>The &man.alc.4; driver for Atheros AR8131/AR8132 PCIe
	    Ethernet controller has been added.</para>

	  <para>A bug in the &man.bce.4; driver has been fixed.  When
	    adding a &man.bce.4; interface on the system as a
	    &man.lagg.4; member with the LACP aggregation protocol
	    enabled network communication via the &man.bce.4;
	    interface stopped completely.  Although the &man.bce.4;
	    interface worked if it was not a &man.lagg.4; member, the
	    incoming traffic statistics which can be found in
	    &man.netstat.1; output was incorrect because every packet
	    was recognized as full-sized one.</para>

	  <para>Several bugs in the &man.bge.4; driver have been
	    fixed.  It caused a panic when a lot of traffic is being
	    handled on the interface while the system is shutting
	    down, and had a DMA issue when buffer address crosses a
	    multiple of the 4GB boundaries.</para>

	  <para>The &man.bge.4; driver now supports TSO (TCP
	    segmentation offloading) for BCM5755 or newer
	    chips.</para>

	  <para arch="sparc64">The &man.cas.4; driver has been added
	    to provide support for Sun Cassini/Cassini+ and National
	    Semiconductor DP83065 Saturn Gigabit Ethernet
	    devices.</para>

	  <para>The &man.cxgb.4; driver has been upgraded to the
	    latest version.  The firmware version is 7.8.0.</para>

	  <para>The &man.et.4; driver now supports IPv4/TCP/UDP Tx
	    checksum offloading.</para>

	  <para>The &man.fxp.4; driver has been improved.  The
	    multicast filter re-programming is now more robust.  A bug
	    which caused incorrect IP packet length in the header when
	    TSO (TCP segmentation offloading) is enabled has been
	    fixed.  This fixes poor performance when TSO is enabled in
	    the previous releases.</para>

	  <para>The &man.msk.4; driver has been improved for robust
	    operation.  Also, it now supports Yukon FE+ A0 including
	    88E8040, 88E8040T, 88E8042, 88E8048, 88E8057, and
	    88E8070.</para>

	  <para>Several bugs in the &man.mxge.4; driver have been
	    fixed and the firmware version is now 1.4.48b.  It could
	    lose the promiscuous flag on resetting and cause a kernel
	    panic on the hardware fault.</para>

	  <para>A bug in the &man.nfe.4; driver has been fixed.  It
	    caused buffer allocation failure for jumbo frames.</para>

	  <para>The &man.nge.4; driver has been improved and now works
	    on all supported platforms.  It now supports &man.altq.4;,
	    hardware checksum offloading for &man.vlan.4; tagged
	    frames, WoL (Wake-on-Lan), jumbo frames, and PCI MWI
	    (Memory Write and Invalidate) commands.  Hardware MAC
	    statistics can be obtained via a new sysctl variable
	    <varname>dev.nge.<replaceable>N</replaceable>.stats</varname>.
	    Another new sysctl variable
	    <varname>dev.nge.<replaceable>N</replaceable>.int_holdoff</varname>
	    has been added to control interrupt moderation.  The valid
	    ranges are <literal>1</literal> (100us) to
	    <literal>255</literal>, and the actual delivery of
	    interrupt would be delayed based on this value.  The
	    default is <literal>1</literal>.  For more details, see
	    &man.nge.4; manual page.</para>

	  <para>The &man.ste.4; driver has been improved and now works
	    on all supported platforms.  It now supports
	    suspend/resume and WoL (Wake-on-Lan).  Hardware MAC
	    statistics can be obtained via a new sysctl variable
	    <varname>dev.ste.<replaceable>N</replaceable>.stats</varname>.
	    Another new sysctl variables
	    <varname>dev.ste.<replaceable>N</replaceable>.int_rx_mod</varname>
	    has been added to control RX interrupt moderation time.
	    The default value is <literal>150</literal> (150us).  For
	    more details, see &man.ste.4; manual page.</para>

	  <para>The &man.vge.4; driver has been improved.  It now
	    supports hardware checksum offloading for &man.vlan.4;
	    tagged frames and WoL (Wake-on-Lan).  Hardware MAC
	    statistics can be obtained via a new sysctl variable
	    <varname>dev.vge.<replaceable>N</replaceable>.stats</varname>.
	    Another new sysctl variables
	    <varname>dev.nge.<replaceable>N</replaceable>.int_holdoff</varname>,
	    <varname>dev.nge.<replaceable>N</replaceable>.rx_coal_pkt</varname>,
	    and
	    <varname>dev.nge.<replaceable>N</replaceable>.tx_coal_pkt</varname>
	    has been added to control interrupt moderation.  For more
	    details, see &man.vge.4; manual page.</para>

	  <para>A bug in the &man.xl.4; driver which caused occasional
	    watchdog timeouts has been fixed.</para>
	</sect4>
      </sect3>

      <sect3 id="net-proto">
	<title>Network Protocols</title>

	<para>A bug in the &man.gif.4; that EtherIP packets sent by
	  combination of &man.if.bridge.4; and &man.gif.4; have a
	  reversed version field has been fixed.  If you need to
	  communicate with older &os; releases via EtherIP, use new
	  flags <literal>accept_rev_ethip_ver</literal> and
	  <literal>send_rev_ethip_ver</literal> to control handling
	  the reversed version field. These can be set by
	  &man.ifconfig.8 utility to &man.gif.4; interfaces.  The
	  EtherIP implementation found on &os; 6.1, 6.2, 6.3, 7.0,
	  7.1, and 7.2 had an interoperability issue because it sent
	  the incorrect EtherIP packets and discarded the correct
	  ones.  For more details, see &man.gif.4; manual page.</para>

	<para>IPcomp protocol is now enabled by default.  This can be
	  controlled by a sysctl variable
	  <varname>net.inet.ipcomp.ipcomp_enable</varname>.</para>

	<para>A bug in the &man.ng.iface.4; driver has been fixed.
	  An infinite loop happened when a packet passes out via two
	  different &man.netgraph.3; interfaces sequentially due to
	  tunneling.</para>

	<para>A kernel option
	  <varname>IPFW_DEFAULT_TO_ACCEPT</varname> has been replaced
	  with a new loader tunable
	  <varname>net.inet.ip.fw.default_to_accept</varname>.  The
	  value can be queried via a sysctl variable of the same
	  name.</para>

	<para>The &man.tap.4; software network interface supports a
	  new ioctl <varname>TAPGIFNAME</varname>.  This is
	  convenient shortcut ported from NetBSD to obtain network
	  interface name using file descriptor for character
	  device.</para>

	<para>The &man.vlan.4; driver is now enabled in the
	  <filename>GENERIC</filename> kernel.</para>
      </sect3>

      <sect3 id="disks">
	<title>Disks and Storage</title>

	<para>The &man.aac.4; driver has been synchronized with the
	  latest official vendor driver.</para>

	<para>The &man.ahc.4; driver now supports Adaptec 39320LPE
	  adapters.</para>

	<para>ATA command timeout in the &man.ata.4; driver has been
	  increased.  This value can be set by using a kernel option
	  <option>ATA_REQUEST_TIMEOUT</option>.</para>

	<para>A bug in the &man.ata.4; driver has been fixed.  It
	  could generate an I/O request larger than controller's
	  maximum I/O size and caused a kernel panic.</para>

	<para>An algorithm for <literal>load</literal> balancing mode
	  in the &man.gmirror.8; GEOM class has been changed and this
	  mode is now set by default instead of
	  <literal>split</literal>.  The <literal>load</literal> mode
	  uses averaged number of requests, running on each drive
	  instead of measuring last request execution time for each
	  drive and choosing one with smallest time.</para>

	<para>A bug in the &man.gpart.8; GEOM class has been fixed.
	  It could not handle a GPT header whose size is greater than
	  92 bytes which is written by OpenSolaris.</para>

	<para>The default stripe size of &man.gstripe.8; GEOM class
	  has been changed from 4KB to 64KB.  This change will affect
	  users preferring the <command>create</command> command over
	  the <command>label</command> command, which will now need to
	  explicitly specify the old stripe size (<option>-s</option>
	  <literal>4096</literal>) in order to use their old
	  &man.gstripe.8; volumes.</para>

	<para>The &man.hptrr.4; driver now supports a new loader
	  tunable <varname>hw.hptrr.attach_generic</varname> to
	  prevent the driver from being attached to some Marvell chips
	  which have no HPT RAID BIOS.</para>

	<para>The &man.mfi.4; driver now supports LSI MegaRAID SAS
	1078 and Dell PERC6.</para>
      </sect3>

      <sect3 id="fs">
	<title>File Systems</title>

	<para>The &man.ext2fs.5; file system has been improved.  A bug
	  when the inode size is other than 128 has been fixed.</para>

	<para>&os; Network File System now supports caching of
	  negative pathname lookup in the NFS client, and uses 3
	  seconds timeout (30 seconds in the prior releases) for
	  caching attributes of a directory in the client.</para>

	<para>The &man.pseudofs.9; subsystem used in &man.procfs.5;
	  and &man.linprocfs.5; are now MPSAFE.</para>

	<para><application>UFS_DIRHASH</application> (enabled by
	  default) now supports removing the cache data when the
	  system memory is low (via <varname>vm_lowmem</varname> event
	  handler).  A bug that the system caused a panic when
	  decreasing a sysctl variable
	  <varname>vfs.ufs.dirhash_maxmem</varname> below the current
	  amount of memory used by
	  <application>UFS_DIRHASH</application>, has been
	  fixed.</para>

	<para>A new sysctl variable for the &man.VFS.9; subsystem
	  <varname>vfs.flushbufqtarget</varname> has been added.
	  This can fix issues in <literal>bufdaemon</literal>, a
	  kernel process responsible for flushing dirty buffers, which
	  can cause the process to deadlock in a certain workload.
	  The value of the variable determines the number of buffers
	  will be flushed before allocating a new buffer.  The default
	  value of the variable on 7.3-RELEASE is
	  <literal>-1</literal> (disabled).  The &os; 8.0-RELEASE uses
	  <literal>100</literal> by default.</para>

	<para>ZFS has been updated from version 6 to version 13.
	  This update includes numerous new ZFS features, such as
	  permitting non-<username>root</username> users to perform
	  some administrative functions, supporting additional disks
	  for caching or the ZFS Intent Log, and partial &man.chflags.2;
	  support.  It also includes some &os;-specific additions,
	  such as booting from ZFS file systems, removal of ARC
	  size limitations, ARC back pressure (which allows ZFS to work
	  without tunables on &arch.amd64;), and many bugfixes.</para>
      </sect3>
    </sect2>

    <sect2 id="userland">
      <title>Userland Changes</title>

      <para>The &man.acpidump.8; utility now supports parsing SRAT
	(System Resource Affinity Table used to describe affinity
	relationships between CPUs and memory.</para>

      <para>The &man.apropos.1; command no longer sets the necessary
	directories to <varname>PATH</varname> variable.  This means
	if the caller does not have <filename
	role="directory">/bin</filename> and <filename
	role="directory">/usr/bin</filename> in
	<varname>PATH</varname>, then it does not work.</para>

      <para>The &man.bluetooth.3; library now supports Bluetooth HCI
	API.</para>

      <para>The &man.btpand.8; daemon now supports Bluetooth device
	node names in a <option>-d</option> option.</para>

      <para>A bug in the &man.chflags.1; <option>-h</option> option
	has been fixed.  It used link target's flags as the original
	one.</para>

      <para>The &man.cp.1; command now preserves file flags on
	symbolic links when options <option>-Rp</option> are
	specified.  It reported an error <quote>function not
	implemented</quote>.</para>

      <para>The &man.cpucontrol.8; command now allows user to perform
	atomic bitwise AND and OR operations on MSR registers.  Two new
	operations (<literal>&=</literal> and <literal>|=</literal>)
	have been added.  The first one applies bitwise AND operation
	between the current contents of the MSR register and the mask,
	and the second performs bitwise OR.  The argument can be
	optionally prefixed with <literal>~</literal> inversion
	operator.  The following is an example to clear the second bit
	of TSC MSR:</para>

      <screen>&prompt.root; cpucontrol -m 0x10&=~0x02</screen>

      <para>The &man.cpuset.1; command now supports interrupt binding
	by a new option <option>-x
	  <replaceable>irq</replaceable></option>.</para>

      <para>The default &man.crontab.5; file no longer define a
	variable <varname>HOME</varname>.</para>

      <para>The &man.df.1; command now uses human-readable output for
	inode counts when an <option>-H</option> or <option>-h</option>
	is specified.</para>

      <para>A bug in the &man.dhclient.8; utility when appending a
	NUL-terminated text provided by a DHCP server, has been
	fixed.</para>

      <para>The &man.dhclient.8; utility now
	uses <literal>68</literal> (bootpc) as the source port for
	unicast <literal>DHCPREQUEST</literal> packets instead of
	allowing the protocol stack to pick a random source port.
	This fixes the behavior where &man.dhclient.8; would never
	transition from <literal>RENEWING</literal>
	to <literal>BOUND</literal> without going
	through <literal>REBINDING</literal> in some networks which
	has a tight policy on DHCP spoofing.</para>

      <para>The &man.fdisk.8; utility now supports size qualifiers (K,
	M, and G) and <literal>*</literal> for automatic calculation
	in the <command>p</command> command.</para>

      <para>The &man.fetch.1; command now supports HTTP digest
	authentication.</para>

      <para>The &man.fetch.1; command now supports
	<varname>NO_PROXY</varname> and <varname>no_proxy</varname>
	environment variables to disable use of HTTP proxy.  For more
	details, see &man.fetch.3; manual page.</para>

      <para>A bug in the &man.fetch.1; command that
	<varname>FTP_TIMEOUT</varname> and
	<varname>HTTP_TIMEOUT</varname> environment variables were
	ignored, has been fixed.</para>

      <para>A bug in the &man.fetch.1; command that default parameters
	such as connection timeout were not set for HTTPS protocol,
	has been fixed.  It now uses the same parameters as
	HTTP.</para>

      <para>A bug in the &man.find.1; command has been fixed.  It
	ignored an <option>-L</option> option when
	<option>-delete</option> is specified.
	The following command can be safely used to remove broken links:</para>

      <screen>find -L . -type l -print0 | xargs rm -0</screen>

      <para>A bug in the &man.find.1; and &man.rm.1; command has been
	fixed.  When a symbolic link has <literal>uchg</literal> or
	<literal>uappend</literal> flag, the commands attempted to
	clear the target file, not the symbolic link itself.</para>

      <para>The &man.gzip.1; command now supports uncompressing files
	compressed by pack(1), which is found in some commercial Unix
	systems.</para>

      <para>The &man.ktrace.1; utility now supports a new
	<literal>KTRACE</literal> record for &man.sysctl.3;
	invocations.</para>

      <para>&os; <application>libc</application> library now includes
	&man.fdopendir.3; function.</para>

      <para>&os; <application>libc</application> library now includes
	&man.feature.present.3; function which checks to see if a
	named kernel feature is present by checking the
	<varname>kern.features</varname> sysctl MIB.</para>

      <para>&os; <application>libc</application> library now includes
	&man.getpagesize.3; function that returns either the number of
	page sizes supported by the system or a specified subset of
	the supported page sizes.</para>

      <para>The &man.libradius.3; now supports simple embedded RADIUS
	server.</para>

      <para>The &man.lp.1; command now supports <option>-m</option>
	option to send an email after the files have been printed, and
	<option>-t <replaceable>title</replaceable></option> option to
	write <replaceable>title</replaceable> on the banner page of
	the output.  These are required by POSIX standard.</para>

      <para>The &man.lpq.1; command now correctly translates remote
	host names which contain non-standard end-of-line
	characters.</para>

      <para>The &man.man.1; command now supports manual pages in UTF-8.</para>

      <para>The &man.mergemaster.8; utility now uses an
	<option>-L</option> option when it invokes &man.mtree.8;
	command to follow symbolic links.</para>

      <para>The &man.mergemaster.8; utility now supports
	<varname>DELETE_STALE_RC_FILES</varname> variable in
	<filename>mergemaster.rc</filename> file to delete stale rc.d
	scripts automatically.</para>

      <para>A userland utility &man.mfiutil.8; for the
	&man.mfi.4; devices has been added.  This includes basic
	features to monitor controller, array, and drive status,
	change basic attributes, create/delete arrays and spares,
	and flush the controller firmware.  Note that this is a
	small utility, not a replacement of MegaCLI in the Ports
	Collection which is supported officially and provides more
	functionality.</para>

      <para>A userland utility &man.mptutil.8; for the
	&man.mpt.4; devices has been added.  This includes basic
	features to monitor controller, array, and drive status,
	change basic attributes, and create/delete arrays and
	spares.</para>

      <para>The &man.newfs.msdos.8; command now supports media which
	have no CHS parameter.</para>

      <para>The &man.ntpd.8; daemon no longer tries to bind an IPv6
	anycast address.</para>

      <para>The &man.pkill.1; command now ignores itself and the
	ancestors when finding processes.  An <option>-a</option>
	option has been added for backward compatible behavior.</para>

      <para>A race condition in the &man.ppp.8; daemon has been
	fixed.</para>

      <para>The &man.ps.1; command now supports a new flag
	<option>-p</option>.  This displays descendant info with the
	output similar to Linux's <option>-H</option> (or
	<option>-f</option>).</para>

      <para>The &man.pwait.1; command, which waits for any process to
	terminate has been added.</para>

      <para>The &man.pwd.mkdb.8; now verifies login name length is
	shorter than <varname>MAXLOGNAME</varname> when a
	<option>-C</option> option is specified.  Note that entries
	with oversized login names are still allowed in the passwd
	database, and <function>getpwent*()</function> and
	<function>getpwuid*()</function> functions return them
	correctly.  The <function>getpwnam*()</function> truncates
	them to <varname>MAXLOGNAME</varname> - 1 when reading the
	database.  The &man.su.1; utility fails for the long
	names.</para>

      <para>The &os; runtime linker, &man.rtld.1; now supports a new
	environment variable <varname>LD_ELF_HINTS_PATH</varname> for
	overriding the rtld hints file.  This feature gives a
	convenient way of using a custom set of shared library that is
	not located in the default location and switch back.  This
	environment variable is automatically unset if the process is
	tainted with setuid/setgid.</para>

      <para>The &man.strptime.3; function now supports
	<literal>%z</literal> format specifier.</para>

      <para>The &man.sysinstall.8; utility now supports a
	comma-separated list of network interfaces in
	<varname>netDev</varname> option in
	<filename>install.cfg</filename>.</para>

      <para arch="ia64">The &man.sysinstall.8; utility now uses 400MB
	for the EFI partition instead of 100MB in the previous
	releases.</para>

      <para>The &man.tail.1; <option>-F</option> flag now persists in
	trying to open files rather than giving up when it encounters
	an error.  <literal>ENOENT</literal> errors are not reported.
	This behavior is consistent with the GNU version.</para>

      <para>The &man.tftp.1; command now returns a correct exit status
	in the case of successful file transfer.</para>

      <para>The &man.traceroute.8; program now uses in-kernel source
	address selection even in a &man.jail.8; environment.</para>

      <para>The &man.traceroute.8; and &man.traceroute6.8; now support
	an <option>-a</option> flag to display AS number corresponding
	to the lookup IP address on each hop.  It will query the
	number to WHOIS server specified in <option>-A</option>
	option.  If no <option>-A</option> is specified,
	<hostid>whois.radb.net</hostid> will be used as the default value.</para>

      <para>The &man.tzsetup.8; command now supports an
	<option>-s</option> option to skip the initial question about
	adjusting the clock if not set to UTC.</para>

      <para>The &man.whois.1; utility has been updated.  A
	<option>-d</option> option has been removed because
	<hostid>whois.nic.mil</hostid> no longer exists, and it
	supports searching for IPv6 addresses just like it can do for
	IPv4 addresses without having to explicitly specify that the
	ARIN server should be used to get the initial
	information.</para>

      <para>The &man.yp.8; utilities now support
	<filename>shadow.byname</filename> and
	<filename>shadow.byuid</filename> maps.  These requires
	privileged port access.</para>

      <sect3 id="rc-scripts">
	<title><filename>/etc/rc.d</filename> Scripts</title>

	<para>The &man.service.8; command as an easy interface for the
	  rc.d scripts has been added.</para>

	<para>The &man.rc.conf.5; file now supports
	  <varname>create_args_<replaceable>IF</replaceable></varname>
	  for interfaces created via
	  <varname>cloned_interfaces</varname></para>

	<para>The &man.rc.conf.5; file now supports
	  <varname>vlans_<replaceable>IF</replaceable></varname> for
	  creating &man.vlan.4; interfaces.  If a vlan interface is a
	  number, then that number is treated as the vlan tag for the
	  interface and the interface will be named
	  <quote><replaceable>IF</replaceable>.<replaceable>N</replaceable></quote>.
	  Otherwise, the vlan tag must be provided via a
	  <option>vlan</option> parameter in a <varname>create_args_<replaceable>IF</replaceable></varname>
	  variable.</para>

	<para>The <filename>rc.d/fsck</filename> script now supports
	  options for <varname>fsck_y_enable</varname> via
	  <varname>fsck_y_flags</varname>.</para>

	<para>The <filename>rc.d/named</filename> script now supports
	  zone file check by &man.named-checkconf.8; before the
	  startup and the following options:</para>

	<itemizedlist>
	  <listitem>
	    <para><varname>named_wait</varname> has the script loop
	      until a specified hostname in <varname>named_wait_host</varname>
	      (<hostid>localhost</hostid> by default) can be
	      successfully looked up. This is disabled by
	      default.</para>
	  </listitem>

	  <listitem>
	    <para><varname>named_auto_forward</varname> creates a
	      forwarder configuration file based on the contents of
	      <filename>/etc/resolv.conf</filename>.  This allows you
	      to utilize a local resolver for better performance, less
	      network traffic, custom zones, etc.  while still relying
	      on the benefits of your local network resolver.  This is
	      disabled by default.</para>
	  </listitem>
	</itemizedlist>

	<para>The <filename>rc.d/savecore</filename> script now
	  supports invoking &man.crashinfo.8; automatically during
	  boot.  A new variable <varname>crashinfo_enable</varname>
	  has been added to enable it.</para>

	<para>The <filename>rc.d/static_arp</filename> script has been
	  added.  This allows the administrator to statically bind MAC
	  to IPv4 address at boot time.  An example is as
	  follows:</para>

	<programlisting>static_arp_pairs="gw"
static_arp_gw="192.168.1.1 00:01:02:03:04:05"</programlisting>
      </sect3>
    </sect2>

    <sect2 id="contrib">
      <title>Contributed Software</title>

      <para><application>ISC BIND</application> has been updated to
	version 9.4-ESV.</para>

      <para><application>sendmail</application> has been updated from
        version 8.14.3 to version 8.14.4.</para>

      <para>The timezone database has been updated
	to the <application>tzdata2010b</application> release.</para>

      <para>The timezone libraries (stdtime part of
	<application>libc</application>) and related binaries
	(&man.zic.8; and &man.zdump.8;) have been updated to the
	<application>tzcode2009k</application> release.  Note that
	&man.tzsetup.8; needs to be run after the installation.</para>

      <para><application>unifdef</application> has been updated to
	version 1.188.</para>
    </sect2>

    <sect2 id="ports">
      <title>Ports/Packages Collection Infrastructure</title>

      <para>A bug in the &man.pkg.info.1; command which caused a
	segmentation fault when an invalid long option is specified,
	has been fixed.</para>
    </sect2>

    <sect2 id="releng">
      <title>Release Engineering and Integration</title>

      <para>&os; release ISO images now have <quote>FreeBSD-</quote>
	at the beginning of the filenames.</para>

      <para>The supported version of the
	<application>GNOME</application> desktop environment
	(<filename role="package">x11/gnome2</filename>) has been
	updated to 2.28.2.</para>

      <para>The supported version of the
	<application>KDE</application> desktop environment (<filename
	role="package">x11/kde4</filename>) has been updated to
	4.3.5.</para>
    </sect2>
  </sect1>

  <sect1 id="upgrade">
    <title>Upgrading from previous releases of &os;</title>

    <para arch="amd64,i386">Beginning with &os; 6.2-RELEASE, binary
      upgrades between RELEASE versions (and snapshots of the various
      security branches) are supported using the
      &man.freebsd-update.8; utility.  The binary upgrade procedure
      will update unmodified userland utilities, as well as unmodified
      GENERIC or SMP kernels distributed as a part of an official &os;
      release.  The &man.freebsd-update.8; utility requires that the
      host being upgraded has Internet connectivity.</para>

    <para>An older form of binary upgrade is supported through the
      <command>Upgrade</command> option from the main
      &man.sysinstall.8; menu on CDROM distribution media.  This type
      of binary upgrade may be useful on non-&arch.i386;,
      non-&arch.amd64; machines or on systems with no Internet
      connectivity.</para>

    <para>Source-based upgrades (those based on recompiling the &os;
      base system from source code) from previous versions are
      supported, according to the instructions in
      <filename>/usr/src/UPDATING</filename>.</para>

    <important>
      <para>Upgrading &os; should, of course, only be attempted after
	backing up <emphasis>all</emphasis> data and configuration
	files.</para>
    </important>
  </sect1>
</article>

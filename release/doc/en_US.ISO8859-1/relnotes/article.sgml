<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook V4.1-Based Extension//EN" [
<!ENTITY % articles.ent PUBLIC "-//FreeBSD//ENTITIES DocBook FreeBSD Articles Entity Set//EN">
%articles.ent;

<!ENTITY % release PUBLIC "-//FreeBSD//ENTITIES Release Specification//EN">
%release;
]>

<article>
<articleinfo>
  <title>&os; &release.current; Release Notes</title>

  <corpauthor>The &os; Project</corpauthor>

  <pubdate>$FreeBSD$</pubdate>

  <copyright>
    <year>2010</year>
    <holder role="mailto:doc@FreeBSD.org">The &os; Documentation Project</holder>
  </copyright>

  <legalnotice id="trademarks" role="trademarks">
    &tm-attrib.freebsd;
    &tm-attrib.ibm;
    &tm-attrib.ieee;
    &tm-attrib.intel;
    &tm-attrib.sparc;
    &tm-attrib.general;
  </legalnotice>

  <abstract>
    <para>The release notes for &os; &release.current; contain a summary
      of the changes made to the &os; base system on the
      &release.branch; development line.
      This document lists applicable security advisories that were issued since
      the last release, as well as significant changes to the &os;
      kernel and userland.
      Some brief remarks on upgrading are also presented.</para>
  </abstract>
</articleinfo>

<sect1 id="intro">
  <title>Introduction</title>

  <para>This document contains the release notes for &os;
    &release.current;.	It
    describes recently added, changed, or deleted features of &os;.
    It also provides some notes on upgrading
    from previous versions of &os;.</para>

<![ %release.type.current [

  <para>The &release.type; distribution to which these release notes
    apply represents the latest point along the &release.branch; development
    branch since &release.branch; was created.	Information regarding pre-built, binary
    &release.type; distributions along this branch
    can be found at <ulink url="&release.url;"></ulink>.</para>

]]>

<![ %release.type.snapshot [

  <para>The &release.type; distribution to which these release notes
    apply represents a point along the &release.branch; development
    branch between &release.prev; and the future &release.next;.
    Information regarding
    pre-built, binary &release.type; distributions along this branch
    can be found at <ulink url="&release.url;"></ulink>.</para>

]]>

<![ %release.type.release [

  <para>This distribution of &os; &release.current; is a
    &release.type; distribution.  It can be found at <ulink
    url="&release.url;"></ulink> or any of its mirrors.	 More
    information on obtaining this (or other) &release.type;
    distributions of &os; can be found in the <ulink
    url="&url.books.handbook;/mirrors.html"><quote>Obtaining
    &os;</quote> appendix</ulink> to the <ulink
    url="&url.books.handbook;/">&os;
    Handbook</ulink>.</para>

]]>

  <para>All users are encouraged to consult the release errata before
    installing &os;.  The errata document is updated with
    <quote>late-breaking</quote> information discovered late in the
    release cycle or after the release.	 Typically, it contains
    information on known bugs, security advisories, and corrections to
    documentation.  An up-to-date copy of the errata for &os;
    &release.current; can be found on the &os; Web site.</para>

</sect1>

  <sect1 id="new">
    <title>What's New</title>

    <para>This section describes the most user-visible new or changed
      features in &os; since &release.prev;.</para>

    <para>Typical release note items document recent security
      advisories issued after &release.prev;, new drivers or hardware
      support, new commands or options, major bug fixes, or
      contributed software upgrades.  They may also list changes to
      major ports/packages or release engineering practices.  Clearly
      the release notes cannot list every single change made to &os;
      between releases; this document focuses primarily on security
      advisories, user-visible changes, and major architectural
      improvements.</para>

    <sect2 id="security">
      <title>Security Advisories</title>

      <para>Problems described in the following security advisories have
	been fixed.  For more information, consult the individual
	advisories available from
	<ulink url="http://security.FreeBSD.org/"></ulink>.</para>

      <informaltable frame="none" pgwide="0">
	<tgroup cols="3">
	  <colspec colwidth="1*">
	  <colspec colwidth="1*">
	  <colspec colwidth="3*">
	    <thead>
	      <row>
		<entry>Advisory</entry>
		<entry>Date</entry>
		<entry>Topic</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:15.ssl.asc"
			      >SA-09:15.ssl</ulink></entry>
		<entry>3&nbsp;Dec&nbsp;2009</entry>
		<entry><para>SSL protocol flaw</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:16.rtld.asc"
			      >SA-09:16.rtld</ulink></entry>
		<entry>3&nbsp;Dec&nbsp;2009</entry>
		<entry><para>Improper environment sanitization in &man.rtld.1;</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-09:17.freebsd-update.asc"
			      >SA-09:17.freebsd-update</ulink></entry>
		<entry>3&nbsp;Dec&nbsp;2009</entry>
		<entry><para>Inappropriate directory permissions in &man.freebsd-update.8;</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:01.bind.asc"
			      >SA-10:01.bind</ulink></entry>
		<entry>6&nbsp;Jan&nbsp;2010</entry>
		<entry><para>BIND &man.named.8; cache poisoning with DNSSEC validation</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:02.ntpd.asc"
			      >SA-10:02.ntpd</ulink></entry>
		<entry>6&nbsp;Jan&nbsp;2010</entry>
		<entry><para>ntpd mode 7 denial of service</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:03.zfs.asc"
			      >SA-10:03.zfs</ulink></entry>
		<entry>6&nbsp;Jan&nbsp;2010</entry>
		<entry><para>ZFS ZIL playback with insecure permissions</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:04.jail.asc"
			      >SA-10:04.jail</ulink></entry>
		<entry>27&nbsp;May&nbsp;2010</entry>
		<entry><para>Insufficient environment sanitization in &man.jail.8;</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:05.opie.asc"
			      >SA-10:05.opie</ulink></entry>
		<entry>27&nbsp;May&nbsp;2010</entry>
		<entry><para>OPIE off-by-one stack overflow</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:06.nfsclient.asc"
			      >SA-10:06.nfsclient</ulink></entry>
		<entry>27&nbsp;May&nbsp;2010</entry>
		<entry><para>Unvalidated input in nfsclient</para></entry>
	      </row>
	      <row>
		<entry><ulink url="http://security.freebsd.org/advisories/FreeBSD-SA-10:07.mbuf.asc"
			      >SA-10:07.mbuf</ulink></entry>
		<entry>13&nbsp;July&nbsp;2010</entry>
		<entry><para>Lost mbuf flag resulting in data corruption</para></entry>
	      </row>
	    </tbody>
	</tgroup>
      </informaltable>
    </sect2>

    <sect2 id="kernel">
      <title>Kernel Changes</title>

      <para></para>

      <para>The <command>show mount</command> command in the
	&man.ddb.4; debugger now prints active string mount
	options.</para>

      <para>The &man.ddb.4; now supports <command>show
	  vnetrcrs</command> command to dump the whole log of
	distinctive <varname>curvnet</varname> recursion
	events.</para>

      <para>The default &man.devfs.5; rules now expose the upper 256
	of &man.pty.4; device nodes.</para>

      <para>A new kernel thread called <quote>deadlock
	  resolver</quote> has been added.  This can be used to detect
	possible deadlock by using information of thread state and
	heuristical analysis.  This is not enabled by default.  To
	enable this, an option <option>option DEADLKRES</option> in
	kernel configuration file and recompilation of the
	kernel.</para>

      <para>Two commands to enable/disable read-ahead have been added
	to &man.fcntl.2; system call:</para>

      <itemizedlist>
	<listitem>
	  <para><varname>F_READAHEAD</varname> specifies the amount
	    for sequential access.  The amount is specified in bytes and is
	    rounded up to nearest block size.</para>
	</listitem>

	<listitem>
	  <para><varname>F_RDAHEAD</varname> is a Darwin compatible
	    version that use 128KB as the sequential access
	    size.</para>
	</listitem>
      </itemizedlist>

      <para>Note that the read-ahead amount is also constrainted by
	sysctl variable <varname>vfs.read_max</varname>, which may
	need to be raised in order to better utilize this
	feature.</para>

      <para>The &man.lindev.4; driver has been added.  This is for
	supporting various linux-specific pseudo devices such as
	<filename>/dev/full</filename>.  Note that this is not
	included in <filename>GENERIC</filename> kernel.</para>

      <para>A POSIX function pselect(3) has been reimplemented as a
	system call &man.pselect.2; to eliminate race
	condition.</para>

      <para>A kernel option <option>option
	  INCLUDE_CONFIG_FILE</option> has been added to
	<filename>GENERIC</filename> kernel by default.</para>

      <para>New SDT (Statically Defined Tracing) probes such as ones
	for opencrypto have been added to &os; &man.dtrace.1;
	subsystem.</para>

      <para arch="powerpc">&os; now supports SMP in PowerPC G5
	systems.  Note that SMP support is disabled by default in
	<filename>GENERIC</filename> kernel.</para>

      <para>A bug in the &man.tty.4; driver that
	<varname>TIOCSTI</varname> did not work has been fixed.  This
	affects applications like &man.mail.1;.</para>

      <para>A bug in the &man.sched.4bsd.4; scheduler that the
	timestamp for the sleeping operation is not cleaned up on the
	wakeup has been fixed.</para>

      <para>A race condition in the &man.sched.4bsd.4; scheduler has
	been fixed.</para>

      <para>A bug in the &man.sched.ule.4; scheduler which prevented
	process usage (<literal>%CPU</literal>) from working correctly
	has been fixed.</para>

      <para>The &man.syscons.4; driver has been improved.  The history
	buffer can be fully saved/restored in the VESA mode switching
	via a loader tunable
	<varname>hint.sc.<replaceable>0</replaceable>.vesa_mode</varname>.</para>

      <para arch="amd64,i386">An x86 real mode emulator based on
	OpenBSD's x86emu implementation has been added to improve real
	mode BIOS call support on both &arch.i386; and &arch.amd64;.
	The &man.atkbdc.4;, &man.dpms.4;, vesa(4), &man.vga.4; driver
	now use this emulator and work on the both platforms.</para>

      <para>The VIMAGE &man.jail.8; virtualization container can work
	with &man.sctp.4; now.  Note that the VIMAGE is not enabled by
	default in <filename>GENERIC</filename> kernel.</para>

      <para>The VIMAGE &man.jail.8; now supports
	<varname>ip4.saddrsel</varname>,
	<varname>ip4.nosaddrsel</varname>,
	<varname>ip6.saddrsel</varname>, and
	<varname>ip6.nosaddrsel</varname> to control whether to use
	source address selection or the primary jail address for
	unbound outgoing connections.  The default value is to use
	source address selection.</para>

      <sect3 id="boot">
	<title>Boot Loader Changes</title>

	<para arch="pc98">The <filename>boot2</filename> bootcode has
	  been reimplemented based on the &arch.i386 counterpart.  It
	  now supports ELF binary, UFS2 file system, and larger number
	  of slices.</para>

	<para arch="ia64">The EFI <filename>loader</filename> program
	  now supports a command-line option <option>-dev
	    <replaceable>currdev</replaceable></option> to specify the
	  default value of <varname>currdev</varname>.  This option
	  can be set by the EFI boot manager.</para>

	<para arch="powerpc">The &man.loader.8; program now supports
	  U-Boot storage.</para>

        <para>A kernel environment variable
	  <varname>vfs.root.mountfrom</varname> now supports
	  multiple elements for root file system in a space-separated
	  list.  Each list element will be tried in order and the
	  first available one will be mounted.</para>

	<para arch="i386">The algorithm the &man.loader.8; uses has
	  been improved to choose a memory range for its heap when
	  using a range above 1MB.  This fixes a symptom that the
	  loader fails to load a kernel.</para>

        <para>The <filename>zfsloader</filename> has been added.  This
	  is a separate &man.zfs.8; enabled loader.  Note that a ZFS
	  bootcode (<filename>zfsboot</filename> or
	  <filename>gptzfsboot</filename>) need to be installed
	  to use this new loader.</para>

        <para>The <filename>zfsboot</filename> and
	  <filename>gptzfsboot</filename> bootcode now fully support
	  64-bit LBAs for disk addresses.  This allows booting from
	  large volumes.</para>

        <para></para>
      </sect3>

      <sect3 id="proc">
	<title>Hardware Support</title>

        <para arch="powerpc">The <filename>adb</filename> driver now
	  supports for interpreting taps on ADB touchpads as a button
	  click.</para>

        <para>The amdsbwd(4) driver for AMD SB600/SB7xx watchdog
	  timer has been added.</para>

        <para arch="powerpc">The <filename>apt</filename> driver for
	  the Apple Touchpad present on MacBook has been added to
	  <filename>GENERIC</filename> kernel.</para>

        <para arch="sparc64">The epic(4) driver for the front panel
	  LEDs in Sun Fire V215/V245 has been added.</para>

        <para>A bug in the &man.ipmi.4; driver that caused incorrect
	  watchdog timer setting has been fixed.</para>

        <para arch="sparc64">The &man.pci.4; driver now supports a
	  JBus to PCIe bridge (called as <quote>Fire</quote>) found in
	  the Sun Fire V215/V245 and Sun Ultra 25/45 machines.</para>

        <para arch="powerpc">The &man.smu.4; driver now provides
	  thermal management and monitoring features.  This allows fan
	  control and thermal monitoring on SMU-based Apple G5
	  machines, as well as an &man.led.4; interface to control the
	  sleep LED.</para>

	<para>The &man.tnt4882.4; driver for IEEE-488 (GPIB) bus now
	  supports National Instruments TNT5004 chip.</para>

        <para>The &man.uart.4; driver now supports NetMos NM9865
	  family of Serial/Parallel ports.</para>

	<para>A bug in the &man.uftdi.4; driver that can allow to send
	  a zero length packet has been fixed.</para>

	<sect4 id="mm">
	  <title>Multimedia Support</title>

          <para></para>

          <para>The &man.acpi.video.4; driver now supports LCD
	    brightness control notify handler.</para>

          <para>The &man.acpi.sony.4; helper driver now supports
	    default display brightness, wired LAN power, and bass
	    gain.</para>

          <para>The &man.agp.4; driver has been improved.  It includes
	    a fix for aparture size calculation issue which prevents
	    some graphics cards from working.</para>

          <para>The &man.snd.hda.4; driver now allows AD1981HD codecs
	    to use playback mixer.</para>

          <para>The &man.snd.hda.4; driver now supports multichannel
	    (4.0 and 7.1) playback support.  The 5.1 mode support is
	    disabled now due to unidentified synchonization problem.
	    Devices which supports the 7.1 mode can handle the 5.1
	    operation via software upmix done by &man.sound.4;.  Note
	    that stereo stream is no longer duplicated to all
	    ports.</para>
	</sect4>

	<sect4 id="net-if">
	  <title>Network Interface Support</title>

          <para></para>

          <para>The &man.ath.4; driver now supports Atheros
	    AR9285-based devices.</para>

          <para>A bug in the &man.ath.4; driver which causes a problem
	    of AR5416-based chipsets including AR9285 has been fixed.</para>

          <para>The &man.bge.4; driver now supports BCM5761, BCM5784, and
	    BCM57780-based devices.</para>

          <para>The &man.bge.4; driver now supports TSO (TCP
	    Segmentation Offloading) on BCM5755 or newer
	    contollers.</para>

          <para>A long-standing bug in the &man.bge.4; driver which
	    was related to ASF heartbeat sending has been
	    fixed.</para>

          <para>A long-standing stability issue of the &man.bce.4; and
	    &man.bge.4; driver due to a hardware bug in its DMA
	    handling when the system has more than 4GB memory has been
	    fixed.  This applies to BCM5714, BCM5715, and BCM5708
	    controllers.</para>

          <para>A bug in the &man.bge.4; driver that incorrectly
	    enabled TSO on BCM5754/BCM5754M controllers has been
	    fixed.</para>

          <para>The &man.cxgb.4; driver has been updated to T3
	    firmware 7.8.0.</para>

          <para>The et(4) driver now supports MSI and Tx checksum
	    offloading of IPv4, TCP, and UDP.</para>

          <para>The &man.iwn.4; driver has been updated.  This
	    includes various improvements and bugfixes regarding RF
	    switch, bgscan support, suspend/resume support, locking
	    issue, and more.  The line <literal>device iwnfw</literal>
	    in the kernel configuration file will include all firmware
	    images.</para>

          <para>The &man.msk.4; driver now supports Marvell Yukon
	    88E8042, 88E8057 devices and DGE-560SX (Yukon XL).</para>

          <para>The &man.mxge.4; driver has been updated to firmware
	    1.4.48b.</para>

          <para>The &man.re.4; driver no longer performs an
	    unnecessary interface up/down during getting IP address
	    via DHCP.</para>

          <para>The &man.ste.4; driver has been improved:</para>

	  <itemizedlist>
	    <listitem>
	      <para>The DMA handling has been improved.</para>
	    </listitem>

	    <listitem>
	      <para>Wake-On-LAN is now supported.</para>
	    </listitem>

	    <listitem>
	      <para>Unnecessary reinitialization of the
		interfaces has been eliminated.</para>
	    </listitem>

	    <listitem>
	      <para>RX interrupt moderation with single shot timer has
		been implemented.  The default parameter of the
		moderation time is 150us and this can be changed via
		sysctl variable
		<varname>dev.ste.<replaceable>0</replaceable>.int_rx_mod</varname>.
		Setting it 0 effectively disables the RX interrupt
		moderation feature.</para>
	    </listitem>
	  </itemizedlist>

          <para>The tsec(4) driver now supports &man.altq.4;.</para>

          <para>The &man.u3g.4; driver has been improved and now works
	    with ZTE MF636, Option Gi0322, Globetrotter GE40x, and
	    Novatel MC950D.</para>

          <para>The &man.uhso.4; driver for Option HSDPA USB devices
	    has been added.  A new &man.uhsoctl.1; userland utility
	    can be used to initiate and close the WAN
	    connection.</para>

          <para>The &man.vge.4; driver has been improved:</para>

	  <itemizedlist>
	    <listitem>
	      <para>The DMA handling has been improved.</para>
	    </listitem>

	    <listitem>
	      <para>Wake-On-LAN is now supported.</para>
	    </listitem>

	    <listitem>
	      <para>Unnecessary reinitialization of the
		interfaces has been eliminated.</para>
	    </listitem>

	    <listitem>
	      <para>Hardware MAC statistics are now supported via sysctl variables
		<varname>dev.vge.<replaceable>0</replaceable>.stats</varname>.</para>
	    </listitem>

	    <listitem>
	      <para>Interrupt moderation with single shot timer and
		scheme supported by VT61xx controllers have been
		implemented.  The default parameters are tuned to
		generate interrupt less than 8k per second, and these
		parameters can be changed via sysctl variables
		<varname>dev.vge.<replaceable>0</replaceable>.int_holdoff</varname>,
		<varname>dev.vge.<replaceable>0</replaceable>.rx_coal_pkt</varname>,
		and
		<varname>dev.vge.<replaceable>0</replaceable>.tx_coal_pkt</varname>.
		Note that an up/down cycle is needed to make a
		parameter change take effect.</para>
	    </listitem>
	  </itemizedlist>

          <para>The &man.urtw.4; driver has been improved and now
	    supports RTL8187B-based devices.</para>
	</sect4>
      </sect3>

      <sect3 id="net-proto">
	<title>Network Protocols</title>

        <para></para>

        <para>IPcomp (IP Payload Compression Protocol defined in RFC
	  2393) protocol is now enabled by default.  Note that this
	  requires <option>option IPSEC</option> in the kernel
	  configuration file and <filename>GENERIC</filename> kernel
	  does not include it.  This functionality can be disabled by
	  using a sysctl variable
	  <varname>net.inet.ipcomp.ipcomp_enable</varname>.</para>

	<para>A bug in the &man.ipfw.4; subsystem that
	  <command>keep-alive</command> rule did not work for IPv6
	  packets has been fixed.</para>

	<para>The &man.pf.4; subsystem now supports
	  <literal>sloppy</literal> keyword to enable a TCP state
	  machine for tracking TCP connections with no sequence number
	  check.  This feature is in the latest version of
	  <application>pf</application>.</para>

	<para>The &man.pfil.9; framework for packet filtering in &os;
	  kernel now supports separate packet filtering instances like
	  &man.ipfw.4; for each VIMAGE jail.</para>

	<para>A bug that proxy ARP entries cannot be added over
	  point-to-point link types has been fixed.</para>

        <para>The &man.vlan.4; pseudo interface has been added to
	  <filename>GENERIC</filename> kernel.</para>

        <para>The &man.vlan.4; pseudo interface now supports TSO (TCP
	  Segmentation Offloading).  The capability flag is named as
	  <varname>IFCAP_VLAN_HWTSO</varname> and it is separated from
	  <varname>IFCAP_VLAN_HWTAGGING</varname>.  The &man.mxge.4;
	  driver supports this feature.</para>

        <para>The &man.vlan.4; pseudo interface for IEEE 802.1Q VLAN
	  now ignore renaming of the parent's interface name.  The
	  configured VLAN interfaces continue to work with the new
	  name while previously the configurations were removed as the
	  renaming happens.</para>
      </sect3>

      <sect3 id="disks">
	<title>Disks and Storage</title>

        <para></para>

        <para>The &man.ada.4; driver now supports
	  <varname>BIO_DELETE</varname>.  For SSDs this uses
	  <literal>TRIM</literal> feature of <literal>DATA SET
	  MANAGEMENT</literal> command, as defined by ACS-2
	  specification working draft.  For Compact Flash use
	  <literal>CFA ERASE</literal> command, same as &man.ad.4;
	  does.  This change realizes restoring write speed of SSDs
	  which supports <literal>TRIM</literal> command by doing
	  <command>newfs -E
	  <replaceable>/dev/ada1</replaceable></command>, for
	  example.</para>

        <para>The &man.ahci.4; driver now supports SATA part of
	  Marvell 88SE912x controllers.</para>

        <para>The &man.ahci.4; driver now supports FIS-based (Frame
	  Information Structure) switching of port multiplier on
	  supported controlers.</para>

        <para>The &man.ahd.4; driver now supports three separated
	  error counters for correctable, uncorrectable, and fatal, in
	  &man.sysctl.8; MIB.</para>

        <para>A new kernel option <option>option ATA_CAM</option> has
	  been added.  This turns &man.ata.4; controller drivers into
	  &man.cam.4; interface modules.  When enabled, this option
	  deprecates all &man.ata.4; peripheral drivers and interfaces
	  such as <filename>ad</filename> and
	  <filename>acd</filename>, and allows &man.cam.4; drivers
	  <filename>ada</filename>, and <filename>cd</filename> and
	  interfaces to be natively used instead.  Note that this is
	  not enabled by default in the <filename>GENERIC</filename>
	  kernel.</para>

        <para>A bug in the &man.ata.4; driver which can lead to
	  interrupt storms and command timeouts has been fixed.</para>

        <para>The &man.ata.4; driver now supports Power-Up In Stand-by
	  (PUIS).  The PUIS is a configudation of SATA or PATA drives
	  to prevent them from automatic spin-up when power is
	  applied.  This feature can be controled via &man.cam.3;
	  framework (a typical application is staggered
	  spin-up).</para>

        <para>USB mass storage device support in the &man.ata.4;
	  driver has been removed.  Note that this was not used in
	  <filename>GENERIC</filename> kernel and the &man.umass.4;
	  driver supports such devices for a long time.</para>

	<para>&os; &man.cam.3; SCSI framework has been improved:</para>

	<itemizedlist>
	  <listitem>
	    <para>SATA and PATA support has been improved and it now
	      recognizes more detail device capabilities.  For example,
	      the &man.ahci.4; and &man.siis.4; driver now reports maximum
	      tag number to the framework to optimize the NCQ
	      handling.</para>
	  </listitem>

	  <listitem>
	    <para>A loader tunable
	      <varname>kern.cam.boot_delay</varname> has been added.
	      This controls the delay time before &man.cam.3; probes
	      the attached devices.</para>
	  </listitem>

	  <listitem>
	    <para>SCSI error recovery for devices on buses without
	      automatic sense reporting has been improved.  Typical
	      devices are on ATAPI and USB.  For example, this allows
	      &man.cam.3; to wait, while CD drive loads disk, instead
	      of immediately return error status.</para>
	  </listitem>
	</itemizedlist>

	<para>A livelock issue of the &man.ciss.4; driver under a high
	  load has been fixed.</para>

        <para>A bug in the &man.fdc.4; driver which prevents the
	  kernel module from unloading has been fixed.</para>

        <para>&man.geom.8; providers including complex ones such as
	  &man.gconcat.8;, &man.gmirror.8;, &man.graid3.8,
	  &man.gstripe.8;, and some hardware RAID device drivers like
	  &man.twa.4; now inform its optimal access block size to the
	  upper layer.</para>

        <para>The &man.gmirror.8; utility now supports
	  <command>configure <option>-p</option>
	    <replaceable>priority</replaceable></command> command to
	  change the providers priority.</para>

        <para>The balancing mode algorithm <literal>load</literal>
	  used in the &man.gmirror.8; utility has been changed and it
	  is now the default one instead of
	  <literal>split</literal>:</para>

	<itemizedlist>
	  <listitem>
	    <para>Instead of measuring last request execution time for
	      each drive and choosing one with smallest time, use
	      averaged number of requests, running on each drive. This
	      information is more accurate and timely. It allows to
	      distribute load between drives in more even and
	      predictable way.</para>
	  </listitem>

	  <listitem>
	    <para>For each drive track offset of the last submitted
	      request. If new request offset matches previous one or
	      close for some drive, prefer that drive.  It allows to
	      significantly speedup simultaneous sequential reads.</para>
	  </listitem>
	</itemizedlist>

	<para>The &man.gmultipath.8; utility now supports
	  <command>destroy</command> command.</para>

	<para>A bug in the &man.graid3.8; which causes a panic when a
	  large request arrives has been fixed.  This happens when
	  <varname>MAXPHYS</varname> is set as larger than 128k.</para>

        <para>The default block size of &man.gstripe.8; has been
	  increased from 4k to 64k.</para>

        <para>The &man.isp.4; driver has been improved in
	  stability.</para>

        <para>The Max Read Request Size in the &man.siis.4; driver for
	  PCIe chips has been increased from 512 to 1024 bytes for
	  better performance.</para>
      </sect3>

      <sect3 id="fs">
	<title>File Systems</title>

	<para>&os; NFS subsystem now supports a timeout for the
	  negative name cache entries in the client.  This avoids a
	  bogus negative name cache entry from persisting forever when
	  another client creates an entry with the same name within
	  the same NFS server time of day clock tick.  The mount
	  option <option>negnametimeo</option> can be used to override
	  the default timeout interval (60 seconds) on a
	  per-mount-point basis.  a Setting
	  <option>negnametimeo</option> to <literal>0</literal>
	  disables negative name caching for the mount point.</para>

	<para>A race condition in &os; NFS subsystem that occurs when
	  &man.nfsiod.8; threads are being created has been fixed.
	  This also fixes an interoperability issue found in
	  combination of a &os; NFS client and a Linux NFS
	  server.</para>

	<para>The inode number handling in &man.ffs.7; file system is
	  now unsigned.  Previously some large inode numbers can be
	  treated as negative, and this issue shows up at file systems
	  with the size of more than 16Tb in 16k block case.  The
	  &man.newfs.8; utility never create a file system with more
	  than 2^32 inodes by cutting back on the number of inodes per
	  cylinder group if necessary to stay under the limit.</para>

        <para>&os; &man.VFS.9; subsystem now supports a new sysctl
	   variable <varname>vfs.vlru_allow_cache_src</varname>.  This
	   allow <filename>vnlru</filename> kernel thread to reclaim
	   of the directory vnodes that are source of the namecache
	   records.  This is not enabled by default because for
	   typical workload it would make namecache unusable, but
	   large nested directory tree easily puts any process that
	   accesses file system into one second wait for
	   <filename>vnlru</filename> kernel thread.</para>

	<para>The ZFS file system now supports NFSv4 ACL.</para>

	<para>The zpool version of ZFS subsystem has been updated to
	  version 14.  It is now possible to use zpools created on
	  OpenSolaris 2009.06.</para>

	<para>Bugs in the ZFS file system that <command>zfs snapshot
	    -r</command> fails when the file system is busy, and
	  <command>zfs receive</command> can fail with an E2BIG
	  error, have been fixed.</para>
      </sect3>
    </sect2>

    <sect2 id="userland">
      <title>Userland Changes</title>

      <para>A bug in &man.bsnmpd.1; program which leads to high CPU
	consumption on a loaded system has been fixed.</para>

      <para>A bug in &man.bzip2.1; utility which prevented it from
	working with multi-session bzip2 files has been fixed.</para>

      <para>The &man.camcontrol.8; utility now supports a
	<option>-v</option> flag in the subcommand
	<command>identify</command>.  It displays whole of identify
	data block.</para>

      <para>The &man.cp.1; now supports a <option>-x</option> flag to
	make it not traverse across multiple mount points.</para>

      <para>The &man.cp.1;, &man.find.1;, &man.getfacl.1;, &man.mv.1;,
	and &man.setfacl.1; utilities now support NFSv4 ACL.</para>

      <para>The &man.diskinfo.8; now supports reporting disk stripe
	size and offset.  This helps users to make file systems
	optimally aligned and tuned for better performance.</para>

      <para>A bug in &man.ee.1; utility which can crash the
	program has been fixed.</para>

      <para>A bug in &man.factor.6; utility which leads to performance
	degradation has been fixed.</para>

      <para>The &man.fetch.1; utility now supports HTTP digest
	authentication.</para>

      <para>A bug in &man.fetch.1; utility which incorrectly evaluates
	a variable <varname>NO_PROXY</varname> has been fixed.</para>

      <para>A bug in &man.find.1; utility has been fixed.  An option
	<option>-newerXB</option> was interpreted as the same as
	<option>-newerXm</option>.</para>

      <para>A bug in the &man.fsck.ffs.8; utility which causes the
	last cylinder group of a UFS1 file system is always reported
	as broken even after it is fixed.</para>

      <para>The &man.gcore.1; utility now recognizes threads in the
	process and handles dumps on a thread scope.</para>

      <para>The &man.ifconfig.8; utility now supports manipulation of
	NDP flags handled by &man.ndp.8;.</para>

      <para>The &man.ifconfig.8; utility now supports a
	<command>description
	<replaceable>value</replaceable></command> command to add a
	description <replaceable>value</replaceable> to the specified
	interface.</para>

      <para>The &man.mount.nfs.8; utility now supports
	<literal>[<replaceable>ipaddr</replaceable>]:<replaceable>path</replaceable></literal>
	notation in addition to the existing one.  This allows IPv6
	address in the address field, and a path including
	<quote><literal>:</literal></quote> to be mounted.</para>

      <para>The &man.netstat.1; utility now supports ARP information
	in statistics shown by the <option>-s</option> flag.</para>

      <para>The &man.netstat.1; utility now supports a <option>-q
	  <replaceable>number</replaceable></option> option to specify
	the number of outputs.  This is used in conjunction with
	<option>-w</option> option.</para>

      <para>The &man.newsyslog.8; utility does not consider
	non-existence of a PID file as an error now.  A new flag
	<option>-P</option> reverts it to the old behavior.</para>

      <para>The &man.ntpd.8; program no longer tries to bind to an
	IPv6 anycast address.</para>

      <para>The &man.procstat.1; utility now supports two new flags
	<option>-i</option> and <option>-j</option> to display
	information about signal disposition and pending/blocked
	status for signals.</para>

      <para>The &man.pwait.1; utility has been added.  This is similar
	to the Solaris utility of the same name, and waits for any
	process to terminate.</para>

      <para>A bug in the &man.restore.8; utility which caused short
	reads when a option <option>-P</option> was used has been
	fixed.</para>

      <para>The &man.rtsold.8; <option>-a</option> flag now excludes
	the interfaces which IPv6 or accepting ICMPv6 Router
	Advertisement message is disabled from the auto-probed
	interface list.</para>

      <para>The &man.scandir.3; and &man.alphasort.3; functions has
	been updated to conform POSIX.1-2008 (IEEE Std
	1003.1-2008).</para>

      <para>The &man.sighold.2;, &man.sigignore.2;, &man.sigpause.2;,
	&man.sigrelse.2;, and &man.sigset.2; functions have been
	implemented for making porting software from System V-like
	systems easy.  Note that these are defined in POSIX.1-2008 XSI
	(IEEE Std 1003.1-2008, X/Open System Interface) but now
	obsolete.  Since &os; already has another
	<function>sigpause(3)</function> function derived from 4.2BSD,
	a version of the XSI interface is implemented as
	<function>xsi_sigpause()</function>.</para>

      <para>The &man.sshd.8;, &man.cron.8;, &man.inetd.8;, and
	&man.syslogd.8; programs now set
	<literal>MADV_PROTECT</literal> memory flag onto themselves to
	protect from being terminated by the &os; kernel when
	available memory becomes short.  This kind of process
	termination happens in a swap-intensive workload.</para>

      <para>The &man.strsignal.3; function is now thread-safe.</para>

      <para>The &man.sysctl.8; utility now supports a
	<option>-i</option> flag to ignore failures while retrieving
	individual OIDs.  This allows the same list of OIDs to be
	passed to &man.sysctl.8; across different systems where
	particular OIDs may not exist, and still get as much
	information as possible from them.</para>

      <para>The &man.traceroute.8; utility now performs source address
	selection correctly even in a VIMAGE &man.jail.8;
	environment.</para>

      <para>The &man.unifdef.1; utility has been updated to version
	1.188.  It now supports a new <option>-B</option> flag to
	compress blank lines around a deleted section to prevent blank
	lines around paragraphs of code from getting doubled.</para>

      <para>The &man.usbconfig.8; utility now supports a new flag
	<option>-d</option> to specify the &man.ugen.4; device, and
	<command>add_quirk</command> and
	<command>remove_quirk</command> commands.</para>

      <para>The &man.whois.1; utility now supports searching IPv6
	addresses just like IPv4 without specifying the ARIN server.
	A <option>-d</option> flag has been removed becuase it is now
	obsolete.</para>

      <para>A new errno <varname>ENOTCAPABLE</varname> has been added.
	This is to be returned when a process requests an operation on
	a file descriptor that is not authorized by the descriptor's
	capability flags.</para>

      <para>The &man.zfs.8; command now supports a new flag
	<option>receive -u</option> to specify that the received ZFS
	should not be mounted automatically.</para>

      <sect3 id="rc-scripts">
        <title><filename>/etc/rc.d</filename> Scripts</title>

        <para></para>

        <para>The &man.service.8; command has been added.  This
	  provides an easy command-line interface to the
	  <filename>rc.d</filename> system.</para>

        <para>A new <filename>rc.d</filename> script
	  <filename>rtsold</filename> has been added.  This handles
	  &man.rtsold.8; daemon.</para>

        <para>A new <filename>rc.d</filename> script
	  <filename>static_arp</filename> has been added.  This allows
	  the administrator to statically define mappings of MAC
	  address to IPv4 at boot time.  See also the &man.rc.conf.5;
	  manual page for more details.</para>

        <para>The &man.rc.conf.5; now supports a
	  <varname>firewall_coscripts</varname> variable.  This should
	  contain a list of commands which should be excuted after
	  firewall starts or stops.</para>

        <para>The &man.rc.conf.5; now supports configuring
	  &man.vlan.4; interfaces as child devices similar to
	  &man.wlan.4; interfaces.  &man.vlan.4; interfaces are listed
	  via a new
	  <varname>vlans_<replaceable>IF</replaceable></varname>
	  variable.  If a VLAN interface is a number, then that number
	  is treated as the VLAN tag for the interface and the
	  interface will be named
	  <varname><replaceable>IF</replaceable>.<replaceable>tag</replaceable></varname>.
	  Otherwise, the VLAN tag must be provided via a VLAN
	  parameter in a
	  <varname>create_args_<replaceable>IF</replaceable></varname>
	  variable.</para>
      </sect3>
    </sect2>

    <sect2 id="contrib">
      <title>Contributed Software</title>

      <para></para>

      <para>The <application>ACPI-CA</application> has been updated to
	20100121.</para>

      <para>The <application>awk</application> has been updated from
	the 23 October 2007 release to the 26 November 2009 release.</para>

      <para><application>ISC BIND</application> has been updated to
	version 9.6.1-P3.</para>

      <para><application>netcat</application> has been updated to
	version 4.6.</para>

      <para><application>sendmail</application> has been updated to
	version 8.14.4.</para>

      <para>The timezone database has been updated to the
	<application>tzdata2010e</application> release.</para>
<!--

      <para role="8.0">The <application>ee</application> (easy editor) has
	been updated to 1.5.0.	This version is now licensed under a
	2-clause BSD license, instead of the Artistic license.</para>

      <para role="8.0">The <application>hostapd</application> has been updated to
	version 0.6.8 + radius ACL support.</para>

      <para role="8.0">The <application>less</application> has been updated to
	version v436.</para>

      <para role="8.0">The <filename>libarchive</filename> library has
	been updated to version 2.7.0.</para>

      <para role="8.0">The <filename>libexpat</filename> library has
	been updated from version 1.95.5 to version 2.0.1.</para>

      <para role="8.0">The <filename>ncurses</filename> library has been updated
	to version 5.7-20081102.</para>

      <para role="8.0"><application>OpenBSM</application> 1.1 from
	Trusted BSD Project has been merged.</para>

      <para role="8.0"><application>TCPDUMP</application> has been
	updated to 4.0.0.</para>

      <para role="8.0"><application>wpa_supplicant</application> has been updated to
	version 0.6.8</para>

      <para role="8.0">The <application>ZFS</application> file system
	has been updated from version 6 to version 13.</para>

      <para role="7.1">The <application>am-utils</application> has been updated from
	version 6.0.10p1 to version 6.1.5.</para>

      <para role="7.1">The <application>bzip2</application> has been updated from
	version 1.0.4 to version 1.0.5.</para>

      <para role="7.1">The <application>CVS</application> has been updated to
	version 1.11.22.1.</para>

      <para role="7.1"><application>NTP</application> has been updated to version
	4.2.4p5.</para>

      <para role="7.1"><application>OpenPAM</application> has been updated from the
	Figwort release to the Hydrangea release.</para>

      <para role="7.1"><application>OpenSSH</application> has been updated from
	version 4.5p1 to version 5.1p1.</para>

      <para role="7.1">The &man.resolver.3; library has been updated to
	one of <application>ISC BIND</application> 9.4.3.</para>

-->
    </sect2>

    <sect2 id="ports">
      <title>Ports/Packages Collection Infrastructure</title>

      <para></para>
    </sect2>

    <sect2 id="releng">
      <title>Release Engineering and Integration</title>

      <para>The filename of ISO images for &os; releases now has a
	<filename>FreeBSD-</filename> at the beginning.</para>

      <para>The supported version of
	the <application>GNOME</application> desktop environment
	(<filename role="package">x11/gnome2</filename>) has been
	updated to 2.28.2.</para>

      <para>The supported version of
	the <application>KDE</application> desktop environment
	(<filename role="package">x11/kde4</filename>) has been
	updated to 4.4.3.</para>
    </sect2>
  </sect1>

  <sect1 id="upgrade">
    <title>Upgrading from previous releases of &os;</title>

    <para arch="amd64,i386">Upgrades between RELEASE versions (and
      snapshots of the various security branches) are supported using
      the &man.freebsd-update.8; utility.  The binary upgrade
      procedure will update unmodified userland utilities, as well as
      unmodified GENERIC kernel distributed as a part of an
      official &os; release.  The &man.freebsd-update.8; utility
      requires that the host being upgraded has Internet
      connectivity.</para>

    <para>An older form of binary upgrade is supported through the
      <command>Upgrade</command> option from the main
      &man.sysinstall.8; menu on CDROM distribution media.  This type
      of binary upgrade may be useful on non-&arch.i386;,
      non-&arch.amd64; machines or on systems with no Internet
      connectivity.</para>

    <para>Source-based upgrades (those based on recompiling the &os;
      base system from source code) from previous versions are
      supported, according to the instructions in
      <filename>/usr/src/UPDATING</filename>.</para>

    <important>
      <para>Upgrading &os; should, of course, only be attempted after
	backing up <emphasis>all</emphasis> data and configuration
	files.</para>
    </important>
  </sect1>
</article>

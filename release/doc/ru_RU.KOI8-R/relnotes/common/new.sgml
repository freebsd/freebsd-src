<!--
     The FreeBSD Russian Documentation Project

     $FreeBSDru: frdp/release/doc/ru_RU.KOI8-R/relnotes/common/new.sgml,v 1.2 2004/05/21 10:59:34 den Exp $

     Original revision: 1.731
-->

<articleinfo>
  <title>Информация о релизе &os;/&arch; &release.current;</title>

  <corpauthor>Проект FreeBSD</corpauthor>

  <pubdate>$FreeBSD$</pubdate>

  <copyright>
    <year>2000</year>
    <year>2001</year>
    <year>2002</year>
    <year>2003</year>
    <year>2004</year>
    <holder role="mailto:doc@FreeBSD.org">Проект документирования FreeBSD</holder>
  </copyright>

  <abstract>
    <para>Заметки о релизе для &os; &release.current; содержат общую
      информацию по
<![ %include.historic; [
      изменениям, внесенным в систему &os; с момента выпуска &release.prev;.
]]>
<![ %no.include.historic; [
      последним изменениям, внесенным в ветвь разработки
      &release.branch; системы &os;.
]]>
      Этот документ содержит список сообщений безопасности, выпущенных после
      последнего релиза, а также список значительных изменений, внесенных
      в ядро и пользовательские программы &os;.  Представлены также
      краткие заметки по обновлению системы.</para>
  </abstract>
</articleinfo>

<sect1 id="intro">
  <title>Введение</title>

  <para>Этот документ содержит информацию о релизе &os;
    &release.current; для аппаратной платформы &arch.print;.
    В нем описаны недавно добавленные, измененные, или удаленные возможности
    &os;.  Он также представляет некоторые заметки по обновлению
    с предыдущей версии &os;.</para>

<![ %release.type.snapshot [

  <para>Дистрибутив (&release.type;), для которого предоставлена эта
    информация, представляет собой точку на ветви разработки между
    &release.prev; и будущим релизом &release.next;.  Отдельные
    собранные бинарные дистрибутивы (&release.type;) из этой ветви
    можно найти на <ulink url="&release.url;"></ulink>.</para>

]]>

<![ %release.type.release [

  <para>Этот дистрибутив &os; &release.current; представляет собой
    &release.type;.  Его можно найти на <ulink
    url="&release.url;"></ulink> или на любом из зеркал.  Дополнительная
    информация по получению этого (или другого) &release.type;
    дистрибутива &os; может быть найдена в
    <ulink
    url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/mirrors.html"
>приложении
    <quote>Получение FreeBSD</quote></ulink> <ulink
    url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/">Руководства
    FreeBSD</ulink>.</para>

]]>

  <para>Пользователи, впервые знакомящиеся с серией &release.branch;
    &os; &release.type;, должны также прочесть <quote>Руководство для новых
    пользователей &os; &release.current;</quote>.  Этот документ обычно можно
    найти там же, где и информацию о релизе (как часть дистрибутива &os; или
    на веб-сайте &os;).  Он содержит важную информацию о преимуществах
    и недостатках использования &os; &release.current; по сравнению с
    релизами, основанными на ветви разработки &os; 4-STABLE.</para>

  <para>Всем пользователям рекомендуется ознакомиться с сообщениями о
    проблемах перед установкой &os;.  В этот документ вносятся
    самая последняя информация, полученная в позже в процессе выпуска релиза
    или после релиза.  Обычно в нем находятся информация о известных
    ошибках, сообщениях безопасности и исправления документации.
    Актуальную копию сообщений о проблемах для &os;
    &release.current; можно найти на веб сайте &os;.</para>

</sect1>

<sect1 id="new">
  <title>Что нового</title>

  <para>В этом разделе описаны
<![ %include.historic; [
      основные видимые пользователю добавленные или измененные с
      &release.prev; возможности &os;.  Как правило, изменения, описанные
      здесь, уникальны для &release.branch;, если только они не помечены
      как &merged;.
]]>
<![ %no.include.historic; [
      многие из видимых пользователю добавленных или измененных с
      &release.prev; возможностей &os;.  Он включает информацию, уникальную
      для &release.branch;, и информацию о некоторых возможностях, которые
      были недавно внесены в другие ветви (после &os;
      &release.prev.historic;).  Последние помечены как &merged;.
]]>
  </para>

  <para>Обычно в информации о релизе последовательно включены
    последние сообщения безопасности, выпущенные после
    &release.prev.historic;, информация о поддержки новых драйверов или
    оборудования, новых команд или параметров, информация о основных
    исправлениях ошибок, или обновлениях стороннего программного
    обеспечения.  В нем могут также перечисляться изменения важнейших
    портов/пакетов или практики выпуска релизов.  Конечно, в информацию о
    релизе не вносятся данные о каждом отдельном изменении, сделанном в
    &os; между релизами; этот документ фокусируется в основном на сообщениях
    безопасности, видимых пользователю изменениях, и основных архитектурных
    улучшениях.</para>

  <sect2 id="security">
    <title>Сообщения безопасности</title>

    <para>Исправлена ошибка в &man.mksnap.ffs.8;; она приводила к сбрасыванию
      флагов файловой системы к их значению по умолчанию при создании
      снимка (снэпшота) файловой системы.  Возможные последствия зависят
      от способа использования, но могут привести к отключению дополнительных
      списков контроля доступа, или разрешению использования setuid бита
      на исполняемых файлах, расположенных на недоверяемой файловой системе.
      Эта ошибка также относится к параметру &man.dump.8;
      <option>-L</option>, где используется &man.mksnap.ffs.8;.
      Обратите внимание, что &man.mksnap.ffs.8; обычно доступен только
      суперпользователям и членам группы <groupname>operator</groupname>.
      За дальнейшей информацией обращайтесь к сообщению безопасности <ulink
      url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:01.mksnap_ffs.asc">FreeBSD-SA-04:01</ulink>.</para>

    <para>Исправлена ошибка в интерфейсе System V Shared Memory
      (а именно в системном вызове &man.shmat.2;).  Эта ошибка приводила
      к расположению сегмента совместно используемой памяти в невыделенном
      участке памяти ядра.  Это может привести к получению атакующим
      неавторизованного доступа к частям памяти ядра, с возможным
      раскрытием важной информации, обходу механизмов контроля
      доступа, или расширению привилегий.  Более детальная информация
      может быть найдена в сообщении безопасности <ulink
      url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:02.sh
mat.asc">FreeBSD-SA-04:02</ulink>.
      &merged;</para>

    <para>Была исправлена ошибка в коде системного вызова &man.jail.attach.2;.
      Эта ошибка может позволить процессу с привилегиями суперпользователя
      внутри среды &man.jail.8; изменить свой корневой каталог на корневой
      каталог другой среды jail, и таким образом получить полный доступ на
      чтение и запись к файлам и каталогам внутри этого jail.  Дополнительная
      информация может быть найдена в сообщении безопасности <ulink
      url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:03.jail.asc">FreeBSD-SA-04:03</ulink>.</para>

    <para>Потенциальная DoS атака с низким трафиком на TCP стек &os;
      была предотвращена путем ограничения количества TCP сегментов вне
      последовательности, которые могут одновременно обслуживаться.
      Более детальная информация может быть найдена в сообщении
      безопасности <ulink
      url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:04.tcp.asc">FreeBSD-SA-04:04</ulink>.
      &merged;</para>

    <para>Была исправлена ошибка в SSL/TLS ChangeCipherSpec сообщении
      <application>OpenSSL</application>, которая могла привести к
      удалению нулевого указателя.  Она позволяла удаленной атакующей
      стороне вызвать крах приложений, использующих
      <application>OpenSSL</application>, и привести к отказу в обслуживании
      (DoS).  Более детальная информация может быть найдена в сообщении
      безопасности <ulink
      url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:05.openssl.asc">FreeBSD-SA-04:05</ulink>.
      &merged;</para>

    <para>Была исправлена ошибка в коде обработки некоторых параметров
      сокета IPv6 в системном вызове &man.setsockopt.2;.  Она позволяла
      атакующему локально вызвать системную панику, а также могла позволять
      неавторизованный доступ к частям памяти ядра, что могло привести к
      раскрытию важной информации, обходу механизмов контроля доступа, или
      расширению привилегий.  Более детальная информация может быть найдена в
      сообщении безопасности <ulink
      url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:06.ipv6.asc">FreeBSD-SA-04:06</ulink>.</para>

    <para>Были исправлены две ошибки в коде <application>CVS</application>.
      Они позволяли серверу перезаписывать произвольные файлы клиента,
      а клиенту читать произвольные файлы на сервере при удаленном
      доступе к CVS репозиториям. Более детальная информация может быть
      найдена в сообщении безопасности <ulink
      url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:07.cvs.asc">FreeBSD-SA-04:07</ulink>. &merged;</para>

    <para>Внесено исправление в <application>Heimdal</application>,
      исправляющее проблему, вследствие которой не производилась
      адекватная проверка аутентификации между автономными realm.
      Более подробная информация находится в сообщении безопасности <ulink
      url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:08.heimdal.asc">FreeBSD-SA-04:08</ulink>. &merged;</para>
  </sect2>

  <sect2 id="kernel">
    <title>Изменения в ядре</title>

    <para arch="i386">Был добавлен драйвер &man.acpi.asus.4; для использования
      на лэптопах ASUSTek управляемых ACPI аппаратных возможностей, таких как
      горячие клавиши и LCD.</para>

    <para arch="i386">Был добавлен драйвер &man.acpi.toshiba.4;,
      использующий аппаратный интерфейс Toshiba для управления определенными
      аппаратными возможностями на лэптопах Toshiba.</para>

    <para arch="i386">Драйвер &man.acpi.toshiba.4; теперь поддерживает
      переключение видео вывода.</para>

    <para>Добавлен драйвер &man.acpi.video.4; для обеспечения управления
      переключением экранов и фоновой яркостью с использованием
      видео расширений ACPI.</para>

    <para arch="i386">Был добавлен драйвер &man.ctau.4; для последовательных
      синхронных адаптеров Cronyx Tau.  Этот драйвер долгое время был известен
      как <quote>ct</quote> &ndash; до того, как был помещен в дерево
      исходных текстов &os;.  &merged;

      <note>
	<para>Имя драйвера изменилось, но сетевой интерфейс все еще использует
	  имя <quote>ct</quote>.</para>
      </note>
    </para>

    <para arch="i386,pc98">Был добавлен драйвер &man.cp.4; для
      последовательных синхронных адаптеров Cronyx Tau-PCI.</para>

    <para>Правила path &man.devfs.5; теперь корректно работают с
      каталогами.</para>

    <para arch="i386,pc98">Драйвер dgb (DigiBoard intelligent serial card)
      был удален вследствие неработоспособности.  Его заменой является
      драйвер &man.digi.4;, который поддерживает все оборудование,
      которое поддерживалось драйвером dgb.</para>

    <para>API &man.getvfsent.3; был удален.</para>

    <para arch="sparc64">Драйвер &man.hme.4; теперь поддерживает
      длинные фреймы, и может использоваться для &man.vlan.4; с полным
      размером ethernet MTU.</para>

    <para>&man.jail.8; теперь поддерживает использование raw сокетов
      изнутри jail.  Эта возможность отключена по умолчанию и контролируется
      переменной sysctl
      <varname>security.jail.allow_raw_sockets</varname>.</para>

    <para arch="i386">Драйвер loran (Loran-C receiver) был удален вследствие
      неработоспособности и отсутствии поддержки.</para>

    <para>Ошибка в &man.mmap.2;, вследствие которой страницы, помеченные как
      <literal>PROT_NONE</literal>, могли стать читаемыми при определенных
      условиях, была исправлена.  &merged;</para>

    <para>Драйвер raid(4), диск RAIDframe из NetBSD, был удален.  В настоящее
      время он не функционален, и потребует дополнительного объема работы,
      чтобы стать работоспособным под существующим &man.geom.4; API
      в 5-CURRENT.</para>

    <para arch="i386,pc98">Добавлен драйвер sx, поддерживающий
      Specialix I/O8+ и I/O4+ intelligent multiport serial controllers.</para>

    <para arch="alpha,amd64,i386">Добавлены переменные окружения
      для <varname>hw.uart.console</varname> и
      <varname>hw.uart.dbgport</varname> для устройства &man.uart.4;.
      Они могут быть использованы соответственно для выбора последовательной
      консоли и отладочного порта, как и атрибуты.</para>

    <para>Был добавлен драйвер устройства &man.ubser.4; для поддержки
      управляемых с консоли последовательных адаптеров BWCT.</para>

    <para>Планировщик ULE теперь используется в качестве планировщика по
      умолчанию в ядре <filename>GENERIC</filename>.  Для большинства
      пользователей интерактивность возросла во многих случаях.
      Это означает меньшее количество <quote>пропусков</quote> и
      <quote>рывков</quote> в интерактивных приложениях, когда компьютер
      сильно загружен.  Это не предотвращает проблем с перегруженными
      дисковыми подсистемам, но может помочь при перегруженных CPU.
      На компьютерах с SMP, ULE реализует очереди для каждого CPU,
      позволяя использовать CPU affinity, CPU binding, и расширенную
      поддержку HyperThreading, а также предоставляет основу для
      дальнейших оптимизаций в будущем.  При продолжении разработки
      fine-grained kernel locking, планировщик сможет более эффективно
      использовать доступные параллельные ресурсы.</para>

    <!-- Above this line, sort kernel changes by manpage/keyword-->

    <para>Инфраструктура драйверов устройств (как и многие драйверы)
      была обновлена.  Среди прочих изменений: еще больше драйверов
      теперь используют автоматически выделяемые главные (major) номера
      (вместо старых статических главных номеров).  Расширены функции по
      поддержке клонирования псевдоустройств.  Несколько изменений в
      API драйверов, включая новое поле <varname>d_version</varname>
      в <varname>struct cdevsw</varname>.  Обратите внимание, что
      сторонние драйвера устройств потребуют перекомпиляции после этого
      изменения.</para>

    <para>Был обновлен код ядра, выделяющий файловые дескрипторы, и теперь
      он заимствован из кода OpenBSD.</para>

    <para arch="sparc64">На &os;/sparc64, <varname>time_t</varname>
      была изменена с 32-бит значения на 64-бит значение.

      <note>
	<para>Поскольку это изменение не обратно совместимое, все программы,
	  которые были собраны на старой системе с использованием 32-бит
	  <varname>time_t</varname> и обращаются к системе для обработки
	  значений <varname>time_t</varname>, должны быть перекомпилированы.
	  Более детальная информация и замечание по обновлению из исходных
	  текстов могут быть найдены в
	  <filename>/usr/src/UPDATING.64BTT</filename>.</para>
      </note>
    </para>

    <para arch="i386">Стала возможной компиляция ядра &os;/i386
      с Intel C/C++ Compiler (из порта <filename
      role="package">lang/icc</filename>).</para>

    <sect3 id="proc">
      <title>Платформо-зависимая поддержка оборудования</title>

      <para arch="i386">Генератор случайных чисел &man.random.4; теперь
	поддерживает аппаратный генератор (RNG) процессора VIA C3 Nehemiah
	(Stepping 3 и выше).</para>

      <para arch="i386">Некоторые старые драйверы для ISA карт были удалены,
	включая
	asc драйвер для основанных на GI1904 ручных сканеров,
	ctx драйвер для CORTEX-I Frame Grabber,
	gp драйвер для карт National Instruments AT-GPIB и AT-GPIB/TNT,
	gsc драйвер для ручного сканера Genius GS-4500,
	le драйвер для DEC EtherWORKS II и III контроллеров ethernet,
	rdp драйвер для основанных на RealTek RTL 8002 адаптеров ethernet,
	spigot драйвер для платы видеозахвата Creative Labs Video Spigot,
	stl и stli драйверы для мультипортовых последовательных контроллеров
	Stallion Technologies и драйвер wt для лент Archive/Wangtek.
	В настоящее время они нефункциональны, и потребуется определенный
	объем работы для приведения их в работоспособное состояние под
	новым API в 5-CURRENT.  Поддержка пользовательских программ для
	этих устройств &ndash; соответствующие ioctl и утилиты, включая
	sasc и sgsc также были удалены.</para>
    </sect3>

    <sect3 id="boot">
      <title>Изменения в загрузчике</title>

      <para arch="i386">Добавлена версия <filename>boot0</filename> для
	последовательной консоли.  Она может быть записана на диск с
	использованием &man.boot0cfg.8; и указанием
	<filename>/boot/boot0sio</filename> в качестве аргумента
	к параметру <option>-b</option>.</para>

      <para arch="i386"><filename>cdboot</filename> теперь обходит проблему
	BIOS, встречающуюся на некоторых системах при загрузке с USB
	CDROM приводов.</para>

      <!-- Above this line, order boot loader changes by keyword-->

    </sect3>

    <sect3 id="net-if">
      <title>Поддержка сетевых интерфейсов</title>

      <para arch="i386">Добавлен драйвер &man.arl.4;, поддерживающий
	беспроводные адаптеры Aironet Arlan 655.</para>

      <para arch="sparc64">Драйвер &man.dc.4; теперь поддерживает карты
	sparc64 Davicom, которые хранят свой MAC адрес в OpenFirmware.</para>

      <para>Было исправлено кратковременно отключение в драйвере &man.em.4;
	во время перенастройки параметров.  &merged;</para>

      <para arch="i386,pc98">Драйвер hea (Efficient Networks, Inc. ENI-155p
	ATM adapter) был удален вследствие неработоспособности.
	Его функциональность была добавлена в драйвер &man.en.4;.</para>

      <para arch="i386">Драйвер lmc (LAN Media Corp. PCI WAN adapter)
	был удален вследствие неработоспособности и отсутствия
	поддержки.</para>

      <para arch="i386">&os; теперь предоставляет уровень бинарной
	совместимости для использования &microsoft.windows; NDIS драйверов
	для сетевых адаптеров под &os;/i386.  Он включает relocator/linker
	для &windows; <filename>.SYS</filename> для интерфейса с ядром
	&os; и эмулирует различные части NDIS API используя родные
	функции ядра &os;.  Эта система поддерживает сетевые устройства
	PCI и CardBus, и разработана главным образом для Ethernet
	и беспроводных сетевых интерфейсов.  За дополнительной информацией
	обращайтесь к страницам справочника &man.ndis.4; и
	&man.ndiscvt.8;.</para>

      <para>Был добавлен тип узла Netgraph &man.ng.atmllc.4;,
	который работает с RFC 1483 ATM LLC инкапсуляцией.</para>

      <para>Был добавлен тип узла Netgraph &man.ng.hub.4;,
	который поддерживает простую рассылку пакетов и работает как
	концентратор Ethernet.  &merged;</para>

      <para>Был добавлен тип узла Netgraph &man.ng.sppp.4;, являющийся
	интерфейсом &man.netgraph.4; к оригинальному сетевому модулю
	&man.sppp.4; для синхронных линий.</para>

      <para>Был добавлен тип узла Netgraph &man.ng.vlan.4;,
	который поддерживает IEEE 802.1Q VLAN tagging.  &merged;</para>

      <para>Была исправлена ошибка в драйвере &man.nge.4;, которая
	делала невозможной работу VLAN.  &merged;</para>

      <para>Обновлено управление ресурсами и энергопотреблением шины
	&man.pci.4;.

	<note>
	  <para>Хотя управление состоянием энергопотребления в шине
	    &man.pci.4; было включено, это может привести к проблемам
	    на некоторых системах.  Оно может быть отключено путем
	    установки переменной <varname>hw.pci.do_powerstate</varname>
	    в 0.</para>
	</note>
      </para>

      <para>Были исправлены несколько ошибок, относящиеся к поддержке
	&man.polling.4; в драйвере &man.rl.4;.  &merged;</para>

      <para>Были исправлены несколько ошибок, относящихся к обработке
	multicast и promiscuous режимов в драйвере &man.sk.4;.</para>

      <para>Драйвер &man.ste.4; теперь поддерживает &man.polling.4;.
        &merged;</para>

      <para>Был добавлен драйвер &man.udav.4;.  Он предоставляет поддержку
	USB Ethernet адаптеров, основанных на Davicom DM9601 чипсете.</para>

      <para>Драйвер &man.vr.4; теперь поддерживает &man.polling.4;.
	&merged;</para>

      <para>Поддержка аппаратной TX контрольной суммы в драйвере &man.xl.4;
	была отключена, поскольку она не работала корректно и уменьшала
	скорость передачи данных.  &merged;</para>

      <para>Была реализована поинтерфейсная поддержка &man.polling.4;.
	Все драйвера, поддерживающие &man.polling.4;
	(&man.dc.4;, &man.fxp.4;, &man.em.4;, &man.nge.4;, &man.re.4;,
	&man.rl.4;, &man.sis.4;, &man.ste.4;, и &man.vr.4;)
	теперь также поддерживают эту возможность, которая может управляться
	через &man.ifconfig.8;.  &merged;</para>
    </sect3>

    <sect3 id="net-proto">
      <title>Сетевые протоколы</title>

      <para>Параметр ядра <literal>DA_OLD_QUIRKS</literal>,
	предназначенный для драйвера диска CAM SCSI (&man.cam.4;)
	был удален.  &merged;</para>

      <para>Драйвер туннеля &man.gre.4; теперь поддерживает WCCP версии
	2.</para>

      <para>Правила &man.ipfw.4; теперь поддерживают параметр
	<literal>versrcreach</literal>, для проверки наличия в таблице
	маршрутизатора действующего маршрута к адресу источника пакета.
	Этот параметр очень полезен для маршрутизаторов с полной
	информацией об основных маршрутах интернет в таблице маршрутизации
	(BGP) для отбрасывания пакетов с подделанными или немарштутизируемыми
	адресами источников.  Например,

	<programlisting>deny ip from any to any not versrcreach</programlisting>

	это эквивалент следующей команды в синтаксисе Cisco IOS:

	<programlisting>ip verify unicast source reachable-via any</programlisting>
      </para>

      <para>Были исправленные некоторые ошибки в реализации IPsec от
	KAME Project.  Эти ошибки были связаны с освобождением объектов
	памяти перед тем, как все ссылки на эти объекты были удалены,
	они могли стать причиной странного поведения или паники ядра
	после очистки Security Policy Database (SPD).</para>

      <para>Параметр <literal>PFIL_HOOKS</literal> теперь включен по умолчанию
	в ядре <filename>GENERIC</filename>.  Наиболее заметный эффект
	этого изменения это корректная работа
	<application>IPFilter</application> при загрузке в качестве
	модуля ядра.</para>

      <para>Следующие возможности TCP теперь включены по умолчанию:
	RFC 3042 (Limited Retransmit), RFC 3390 (increased initial
        congestion window sizes), TCP bandwidth-delay product
        limiting.  Дополнительная информация может быть найдена в
	&man.tcp.4;.</para>

      <para>&os; реализация TCP теперь включает поддержку минимального
	MSS (устанавливается через переменную sysctl
	<varname>net.inet.tcp.minmss</varname>) и ограничение потока
	данных через соединения, передающие множество мелких TCP
	сегментов в короткий период времени (через переменную sysctl
	<varname>net.inet.tcp.minmssoverload</varname>).  Соединения,
	превысившие этот предел, могут быть сброшены.  Эта возможность
	предоставляет защиту от целого класса исчерпывающих ресурсы
	атак.</para>

      <para>Реализация TCP теперь включает частичную поддержку (только
	на вывод).  Эта возможность, включаемая параметрами ядра
	<literal>TCP_SIGNATURE</literal> и <literal>FAST_IPSEC</literal>,
	является расширением TCP для аутентификации TCP сессий.
	&man.setkey.8; теперь включает поддержку TCP-MD5 класса
	ассоциаций безопасности.  &merged;</para>

      <para>Обработка reset в TCP соединении была улучшена, чтобы усложнить
	reset атаки настолько, насколько это возможно, при сохранении
	совместимости с широчайшим диапазоном TCP стеков.</para>

      <para>Реализация RFC 1948 была улучшена.  Компонент временного смещения
	в ISN теперь включает случайное положительно число, так что ISN
	всегда увеличивается, независимо от скорости повторного использования
	порта.</para>

      <para>Было реализовано произвольное <quote>эфемерное</quote> выделение
	порта (random ephemeral port allocation), пришедшее из OpenBSD.  Оно
	включено по умолчанию и может быть отключено через переменную
	sysctl <varname>net.inet.ip.portrange.randomized</varname>.
	&merged;</para>
    </sect3>

    <sect3 id="disks">
      <title>Диски и хранение</title>

      <para>Драйвер &man.ata.4; теперь поддерживает контроллеры cardbus
	ATA/SATA.</para>

      <para>Было исправлено множество ошибок в драйвере &man.ata.4;.
	Наиболее заметные из них относятся к улучшению детектирования
	master/slave устройств и к проблемам с задержками.</para>

      <para>Драйвер &man.ata.4; теперь поддерживает Promise command
	sequencer, имеющийся на всех современных контроллерах Promise
	(PDC203** PDC206**).

	<note>
	  <para>Добавлена также предварительная поддержка для
	    Promise SX4/SX4000 в качестве <quote>обычного</quote> Promise ATA
	    контроллера; ATA RAID поддерживается, но только
	    с уровнями RAID0, RAID1 и RAID0+1.</para>
	</note>
      </para>

      <para arch="pc98">Была исправлена ошибка в коде автоматического
	выбора плотности драйвера &man.fd.4;.</para>

      <para>Драйвер &man.ips.4; теперь поддерживает современные контроллеры
	Adaptec ServeRAID series SCSI.</para>

      <para arch="sparc64">Была исправлена ошибка в драйвере &man.isp.4;,
	которая делала невозможной работу карт на SBus.</para>

      <para arch="i386">Был добавлен драйвер &man.twa.4;, поддерживающий
	контроллеры 3ware's 9000 series PATA/SATA RAID.  &merged;</para>

      <para>Драйвер &man.umass.4; теперь поддерживает отсутствовавшие команды
	ATAPI MMC и правильно обрабатывает задержки.  &merged;</para>
    </sect3>

    <sect3 id="fs">
      <title>Файловые системы</title>

      <para>Код файловой системы EXT2FS теперь включает частичную поддержку
	больших файлов (&gt; 4GB).  Частичность поддержки заключается в том,
	невозможно создать большие файлы на файловых системах, которые не
	были обновлены до <literal>EXT2_DYN_REV</literal> или на тех,
	где в суперблоке не установлен флаг
	<literal>EXT2_FEATURE_RO_COMPAT_LARGE_FILE</literal>.</para>

      <para>Была исправлена ошибка в GEOM, которая могла приводить к
	прерыванию ввода/вывода в некоторых редких случаях.</para>

      <para>Был добавлен новый класс geom_concat для соединения нескольких
	дисков в один.  Для настройки соединенных дисков
	используется утилита &man.gconcat.8;.</para>

      <para>Была исправлена паника в NFSv4 клиенте; она случалась при
	попытке работы с поддерживающим только NFSv3/NFSv2
	сервером.</para>

      <para>Клиент SMBFS теперь поддерживает подпись SMB запроса, которая
	предотвращает атаки <quote>man in the middle</quote> и необходима
	для подключения к серверам Windows 2003 в настройке по умолчанию.
	Поскольку подпись каждого сообщения понижает производительность,
	эта возможность включается только если сервер ее требует;
	со временем она может стать параметром &man.mount.smbfs.8;.</para>
    </sect3>

    <sect3 id="mm">
      <title>Поддержка мультимедиа</title>

      <para>Драйвер meteor (видеозахват) был удален вследствие
	неработоспособности и отсутствия поддержки.</para>

    </sect3>

  </sect2>

  <sect2 id="userland">
    <title>Изменения в программах пользователя</title>

    <para>&man.bsdlabel.8; теперь поддерживает параметр <option>-f</option>
      для работы с файлами вместо разделов диска.</para>

    <para>Были добавлены команды <command>bthidcontrol</command> и
      <command>bthidd</command>, поддерживающие Bluetooth
      HID (Human Interface Device).</para>

    <para>Даемон &man.cron.8; теперь принимает два параметра,
      <option>-j</option> и <option>-J</option>, включающие
      рассинхронизацию заданий, запускаемых непривилегированными
      пользователями и суперпользователем соответственно.
      Рассинхронизация означает, что перед выполнением задания
      &man.cron.8; останавливается на небольшой произвольный период
      времени в заданном пределе.  Эта возможность предназначена для
      уменьшения пиков нагрузки, появляющихся при выполнении большого
      количества задач, запланированных на определенный момент
      времени.</para>

    <para>&man.df.1; теперь поддерживает параметр <option>-c</option>
      для отображения полной статистики файловых систем.</para>

    <para>Утилита <command>doscmd</command> была удалена из базовой
      системы &os; и доступна из коллекции портов &os;.</para>

    <para>&man.dump.8; и &man.restore.8; теперь поддерживают параметр
      <option>-P</option> для указания других методов резервного копирования
      (не в файлы или на ленты).  Аргумент передается &man.sh.1;
      с определенной переменной окружения <varname>$DUMP_VOLUME</varname>
      или <varname>$RESTORE_VOLUME</varname> соответственно.
      Дополнительная информация находится на страницах справочника
      &man.dump.8; и &man.restore.8;.</para>

    <para arch="pc98">Утилиты &man.fdcontrol.8;, &man.fdformat.1;, и
      &man.fdread.1; теперь работают в &os;/pc98.</para>

    <para>Утилита &man.find.1; теперь поддерживает параметр
      <option>-acl</option> в основном для поиска файлов с
      &man.acl.3;.</para>

    <para>&man.indent.1; теперь поддерживает параметр <option>-ldi</option>
      для управления выравниванием локальных переменных.  В этой утилите
      было сделано несколько других изменений.</para>

    <para>&man.ifconfig.8; теперь поддерживает переименование сетевых
      интерфейсов на лету, используя параметр <option>name</option>.</para>

    <para>&man.ifconfig.8; теперь выводит &man.polling.4; статус
      интерфейса.  &merged;</para>

    <para>&man.ip6fw.8; теперь поддерживает флаг <option>-n</option> для
      запрета внесения любых изменений в правила ядра</para>

    <para>&man.ipcs.1; теперь поддерживает параметр <option>-u</option>
      для отображения информации о IPC механизмах, принадлежащих
      определенному пользователю.</para>

    <para>&man.ipfw.8; теперь поддерживает параметр <option>-b</option>
      для вывода только действия и комментария каждого правила,
      исключая тело правила.</para>

    <para>&man.killall.1; теперь поддерживает флаг <option>-e</option>,
      с которым <option>-u</option> указывает на эффективный, а не реальный
      ID пользователя. &merged;</para>

    <para>В &man.libalias.3; теперь есть поддержка (и новый API) для
      нескольких синонимов в одном процессе.  Существующий API был
      переписан в терминах нового для сохранения совместимости.</para>

    <para>Была добавлена библиотека <filename>libarchive</filename>
      для работы со сжатыми и несжатыми архивными файлами.  Дополнительная
      информация может быть найдена в &man.libarchive.3;.</para>

    <para arch="pc98"><filename>libdisk</filename> теперь использует
      корректное для PC98 значение дискового раздела &os;.  Это позволяет
      редактору дисковых разделов &man.sysinstall.8; корректно создавать
      единственный раздел &os;, занимающий весь диск.  &merged;</para>

    <para><filename>libdisk</filename> теперь использует
      <varname>d_addr_t</varname> для адресов дисков.
      Это позволяет &man.sysinstall.8; правильно работать с дисками
      и файловыми системами размером более 1 TB.</para>

    <para arch="i386,pc98,amd64,ia64">Библиотека, первоначально известная как
      <filename>libkse</filename>, была переименована в
      <filename>libpthread</filename> и теперь это библиотека потоков по
      умолчанию для платформ i386, amd64 и ia64.  Параметр
      <application>GCC</application> <option>-pthread</option> был
      изменен для использования <filename>libpthread</filename>
      вместо <filename>libc_r</filename>.

      <note>
	<para>Пользователи со старыми бинарными файлами (например,
	  из портов, скомпилированных до внесения этого изменения) должны
	  использовать &man.libmap.conf.5; для создания ссылок
	  <filename>libc_r</filename> и/или
	  <filename>libkse</filename> на
	  <filename>libpthread</filename>.</para>
      </note>

      <note>
	<para>Пользователям поставляемых NVIDIA драйверов и библиотек
	  может потребоваться использование &man.libmap.conf.5;,
	  в котором есть ссылка <filename>libpthread</filename> на
	  старую библиотеку <filename>libc_r</filename>, поскольку
	  эти драйвера не работают с <filename>libpthread</filename>.</para>
      </note>
    </para>

    <para>&man.make.1; теперь поддерживает новую директиву
      <literal>.warning</literal>.</para>

    <para>Была добавлена первичная поддержка для UTF-8 версий всех
      поддерживаемых в настоящее время системных локалей.  Это сделано в
      основном для порта <filename
      role="package">misc/utf8locale</filename>.</para>

    <para>Добавлена локаль Israel Hebrew
      <literal>he_IL.UTF-8</literal>.</para>

    <para>Была добавлена утилита &man.logins.1; для отображения информации о
      пользовательских и системных учетных записях.</para>

    <para>&man.mountd.8; теперь поддерживает параметр <option>-p</option>,
      позволяющий пользователям указывать известный порт для указания
      его в правилах брандмауэра.</para>

    <para>&man.netstat.1; теперь отображает членство в широковещательных
      группах, имеющихся в системе.</para>

    <para>&man.newfs.8; и &man.mdmfs.8; теперь поддерживают флаг
      <option>-l</option> для установки MAC multilabel флага на новых
      системах без использования &man.tunefs.8;.</para>

    <para>&man.nologin.8; теперь сообщает о попытках входа через
       &man.syslogd.8;.</para>

    <para>Программа &man.nologin.8; была перемещена из
      <filename>/sbin/nologin</filename> в
      <filename>/usr/sbin/nologin</filename>, а
      <filename>/sbin/nologin</filename> стал символической ссылкой для
      обратной совместимости.</para>

    <para>В поддержку NSS было внесено исправление, которое решает проблемы
      с использованием сторонних NSS модулей (таких как <filename
      role="package">net/nss_ldap</filename>) и групп с длинным списком
      членов.</para>

    <para>Были добавлены команды &man.pgrep.1; и &man.pkill.1;, пришедшие
      их NetBSD.  Они также поддерживают параметр <option>-M</option>
      для извлечения значений, связанных со списком имен из указанного
      дампа (core) вместо <filename>/dev/kmem</filename> по умолчанию, и
      параметр <option>-N</option> для извлечения списка имен из указанной
      системы вместо ядра (kernel) по умолчанию.</para>

    <para>Была улучшена совместимость &man.ps.1; с POSIX/SUSv3.  Эти изменения
      включают параметры <option>-p</option> для списка ID процессов,
      <option>-t</option> для списка имен терминалов,
      <option>-A</option>, которая эквивалентна <option>-ax</option>,
      <option>-G</option> для списка ID групп,
      <option>-X</option>, которая противоположна <option>-x</option>,
      и некоторые мелкие улучшения.  За дальнейшей информацией обращайтесь
      к &man.ps.1;.  &merged;</para>

    <para>&man.pw.8; теперь поддерживает параметр <option>-H</option>, который
      принимает указатель на файл с зашифрованным паролем.  &merged;</para>

    <para>Была исправлена ошибка в &man.rarpd.8;, которая не позволяла ему
      правильно работать на интерфейсах более чем с одним IP адресом.
      &merged;</para>

    <para>Файлы настройки, используемые &man.resolver.3;, теперь поддерживают
      ключевые слова <literal>timeout:</literal> и
     <literal>attempts:</literal>.</para>

    <para>&man.resolver.3; и ассоциированные интерфейсы теперь гораздо
      лучше подходят для повторного использования и работы с потоками.
      Множественные запросы к DNS теперь могут происходить одновременно,
      что приводит к значительному улучшению производительности некоторых
      многопоточных приложений.  Некоторые многопоточные приложения
      необходимо перекомпилировать; примеры из коллекции портов:
      <filename role="package">www/mozilla</filename> и варианты, <filename
      role="package">mail/evolution</filename>, <filename
      role="package">devel/gnomevfs</filename>, и <filename
      role="package">devel/gnomevfs2</filename>.</para>

    <para>&man.rmdir.1; теперь поддерживает флаг <option>-v</option>,
      для вывода информации об удаляемых файлах.</para>

    <para>&man.savecore.8; теперь правильно работает для дамп файлов
      больше 2GB.</para>

    <para>Ошибка в &man.script.1; была исправлена, и теперь он работает
      корректно если его stdin закрыт.  Это исправление предотвращает
      потенциально опасное взаимодействие с пакетом <filename
      role="package">sysutils/portupgrade</filename>; если он запускался
      не интерактивно, то мог удалить все устаревшие порты без их
      переустановки.</para>

    <para>Был добавлен даемон &man.sdpd.8; Bluetooth Service Discovery
      Protocol.</para>

    <para>Многие утилиты пользователя в базовой системе (в основном
      предоставленные GNU утилиты) теперь используют системную
      версию &man.getopt.long.3;, вместо GNU версии.</para>

    <sect3 id="rc-scripts">
      <title>Скрипты <filename>/etc/rc.d</filename></title>

      <para>Скрипт <filename>diskless</filename> был разделен на
	<filename>hostname</filename>, <filename>resolve</filename>,
	<filename>tmp</filename> и <filename>var</filename>.</para>

      <para>Был добавлен скрипт <filename>gbde_swap</filename>,
	поддерживающий gbde устройства подкачки.  При указании переменной
	<varname>gbde_swap_enable</varname> в &man.rc.conf.5;, устройство
	подкачки <filename>/dev/<replaceable>foo.bde</replaceable></filename>
	из &man.fstab.5; автоматически подключается во время загрузки
	с устройством <filename>/dev/<replaceable>foo</replaceable></filename>
	и случайным ключом, полученным как контрольная сумма MD5 от 512 байт,
	прочитанных из <filename>/dev/random</filename>.
	Обратите внимание, что это делает невозможным восстановление дампов
	ядра.</para>

      <para>Был добавлен скрипт <filename>mixer</filename>.  При завершении
	работы сохраняет текущие настройки всех аудио микшеров, присутствующих
	в системе, и восстанавливает их при загрузке.</para>

      <para>Были добавлены скрипты <filename>pf</filename> и
	<filename>pflog</filename> для &man.pf.4;.</para>
    </sect3>
  </sect2>

  <sect2 id="contrib">
    <title>Стороннее программное обеспечение</title>

    <para>Код <application>ACPI-CA</application> был обновлен с
      с снэпшота 20030619 до снэпшота 20040402.</para>

    <para><application>awk</application> от Bell Labs был обновлен с релиза
      от 29 июня 2003 года до релиза 7 февраля 2004 года.</para>

    <para><application>CVS</application> был обновлен с версии
      1.11.10 до версии 1.11.15.</para>

    <para><application>gdtoa</application> (библиотека, выполняющая
      преобразования чисел между бинарным и десятичным форматами)
      была обновлена с версии 20030324 до версии 20040118.</para>

    <para><application>GNU grep</application> был обновлен с
      2.4d до 2.4.2.</para>

    <para><application>less</application> был обновлен с
      версии 371 до версии 381.</para>

    <para><application>GNU readline</application> 4.3 была обновлена
      официальными патчами с 001 до 005.</para>

    <para>Библиотека <application>GNU regex</application> была обновлена
      до версии, включенной в <application>GNU grep</application>
      2.4.2.</para>

    <para>Реализация <application>GNU tar</application> в основной системе
      теперь называется <filename>gtar</filename>,
      <filename>tar</filename> стал ссылкой на
      <filename>gtar</filename>.</para>

    <para><application>Heimdal Kerberos</application> был обновлен
      с 0.6 до 0.6.1.</para>

    <para><application>libpcap</application> была обновлена с версии
      0.7.1 до версии 0.8.3.</para>

    <para><application>lukemftp</application>
      был обновлен с снэпшота от 3 ноября 2003 года до снэпшота от
      26 апреля 2004 года.</para>

    <para><application>OpenPAM</application> был обновлен с
      релиза Dogwood до релиза Eelgrass.</para>

    <para><application>OpenSSH</application> был обновлен с
      3.6.1p1 до 3.8.1p1.

      <note>
	<para>Настройка по умолчанию для &man.sshd.8; была изменена.
	  SSH протокол версии 1 теперь не включен по умолчанию.
	  Кроме того, аутентификация по паролю через SSH выключена по
	  умолчанию если включен PAM.</para>
      </note>

    </para>

    <para><application>OpenSSL</application> был обновлен с
      0.9.7c до 0.9.7d.  &merged;</para>

    <para><application>pf</application>, пакетный фильтр OpenBSD
      из OpenBSD&nbsp;3.4, был импортирован в дерево исходных текстов &os;,
      и теперь установлен по умолчанию.  Добавлены также новый пользователь
      <username>proxy</username> и две новых группы
      <username>authpf</username> и <username>proxy</username>,
      которые необходимы <application>pf</application>.

      <note>
	<para>При обновлении из исходных текстов, должны быть добавлены
	  эти учетные записи.  Для выключения сборки
	  <application>pf</application> может быть использована
	  переменная <varname>NO_PF</varname> в
	  <filename>make.conf</filename>.</para>
      </note>
    </para>

    <para>Были импортированы несколько утилит пользования из OpenBSD
      <application>pf</application>.
      <filename>libexec/ftp-proxy</filename> это ftp прокси для
      <application>pf</application>,
      <filename>sbin/pfctl</filename> это эквивалент
      <filename>sbin/ipf</filename>,
      <filename>sbin/pflogd</filename>
      это даемон для протоколирования пакетов через <literal>if_pflog</literal>
      в формате pcap, и <filename>usr.sbin/authpf</filename> это
      оболочка для изменения наборов правил pf после аутентификации.</para>

    <para><application>routed</application> был обновлен с
      релиза 2.22 до релиза 2.27 с rhyolite.com.  Обратите внимание, что
      для тех, кто использовал возможность RIP MD5 аутентификацию,
      &man.routed.8; теперь несовместим с предыдущими версиями &os;;
      однако, теперь он совместим с реализациями от Sun, Cisco и
      других поставщиков.</para>

    <para><application>sendmail</application> был обновлен с версии
      8.12.10 до версии 8.12.11.  &merged;</para>

    <para><application>tcpdump</application> был обновлен с версии
      3.7.1 до версии 3.8.3.</para>
  </sect2>

  <sect2 id="ports">
    <title>Инфраструктура коллекции портов/пакетов</title>

    <para>Был добавлен и включен по умолчанию атрибут <literal>SIZE</literal>
      для distfiles, который может быть использован для проверки размеров
      файлов перед загрузкой.  <varname>DISABLE_SIZE</varname>
      может быть использована для запрещения проверки размера.  Это особенно
      полезно на старых версиях &os;, где нет соответствующей поддержки
      в &man.fetch.1;, и для некоторых FTP прокси, которые всегда выдают
      неверные размеры.</para>

    <para>Для отслеживания наиболее важных изменений в дерево портов были
      добавлены два файла: <filename>ports/CHANGES</filename>
      содержит список основных изменений в коллекции портов и ее
      инфраструктуре.  <filename>ports/UPDATING</filename> описывает
      некоторые потенциально проблемные случаи, которые могут встретиться
      при обновлении определенных портов, по аналогии с
      <filename>src/UPDATING</filename> в базовой системе.</para>

  </sect2>

  <sect2 id="releng">
    <title>Подготовка релизов и интеграция</title>

    <para arch="i386,pc98">Процесс сборки загрузочных дискет был полностью
      пересмотрен.  Наиболее значительное изменение изменение заключается
      в том, что загрузчик теперь загружает <filename>GENERIC</filename>
      ядро, разделенное на несколько дисков (два на момент написания).
      Это существенно улучшает установку, начинающуюся загрузкой
      с дискеты, поскольку теперь она использует точно такое же
      ядро (и, таким образом, то же оборудование), что и при установке
      с CDROM.  Урезанное ядро <filename>MFSROOT</filename> больше не нужно,
      и образ <filename>mfsroot</filename> более не требует подключения
      модулей ядра.  Образы <filename>boot.flp</filename> и
      <filename>driver.flp</filename> также более не требуются и не
      собираются.</para>

    <para>Поддерживаемый релиз <application>GNOME</application>
      был обновлен с 2.4 до 2.6.

      <note>
	<para>Если вы используете старый <application>GNOME</application>
	  десктоп отдельно (<filename role="package">x11/gnome2</filename>),
	  простое обновление его из коллекции портов &os; с помощью
	  &man.portupgrade.1; (<filename
	  role="package">sysutils/portupgrade</filename>) вызовет серьезные
	  проблемы.  Если вы используете <application>GNOME</application>
	  в качестве десктопа, внимательно прочтите инструкции
	  <ulink url="http://www.FreeBSD.org/gnome/docs/faq26.html"></ulink>,
	  и используйте скрипт <filename>gnome_upgrade.sh</filename> для
	  правильного обновления до <application>GNOME</application>
	  2.6.</para>

	<para>Обратите внимание, что если вы используете только
	  библиотеки <application>GNOME</application>, &man.portupgrade.1;
	  будет достаточно для обновления портов.</para>
      </note>
    </para>

    <para>Поддерживаемый релиз <application>KDE</application> был
      обновлен с 3.1.4 до 3.2.1.</para>
  </sect2>

  <sect2 id="doc">
    <title>Документация</title>

    <para></para>

  </sect2>

</sect1>

<sect1 id="upgrade">
  <title>Обновление с предыдущих релизов &os;</title>

  <para>Пользователям с уже установленными системами &os; 
    <emphasis>настоятельно</emphasis> рекомендуется прочесть
    <quote>Руководство для новых пользователей &os; &release.current;</quote>.
    На дистрибутивном носителе или в любом другом месте, где можно найти
    информацию о релизе, имя файла этого документа обычно
    <filename>EARLY.TXT</filename>.  Он предоставляет отдельные заметки
    по обновлению, но, что более важно, сравнительно рассматривает работу с
    4.<replaceable>X</replaceable> и обновление до
    5.<replaceable>X</replaceable>.</para>

  <important>
    <para>Обновление &os; конечно же должно производиться только после
      резервного копирования <emphasis>всех</emphasis> данных и
      файлов настройки.</para>
  </important>
</sect1>

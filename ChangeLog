commit cb30fbdbee869f1ce11f06aa97e1cb8717a0b645
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Mar 16 08:28:19 2023 +1100

    depend

commit 1dba63eb10c40b6fda9f5012ed6ae87e2d3d028e
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Mar 16 08:27:54 2023 +1100

    crank version

commit ba7532d0dac9aaf0ad7270664c43837fc9f64a5f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 15 21:19:57 2023 +0000

    upstream: openssh-9.3
    
    OpenBSD-Commit-ID: 8011495f2449c1029bb316bd015eab2e00509848

commit 6fd4daafb949b66bf555f3100f715a9ec64c3390
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Mar 14 07:28:47 2023 +0000

    upstream: Free KRL ptr in addition to its contents.
    
    From Coverity CID 291841, ok djm@
    
    OpenBSD-Commit-ID: f146ba08b1b43af4e0d7ad8c4dae3748b4fa31b6

commit 1d270bd303afaf6d94e9098cbbf18e5e539e2088
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Mar 14 07:26:25 2023 +0000

    upstream: Check pointer for NULL before deref.
    
    None of the existing callers seem to do that, but it's worth checking.
    From Coverity CID 291834, ok djm@
    
    OpenBSD-Commit-ID: a0a97113f192a7cb1a2c97b932f677f573cda7a4

commit d95af508e78c0cd3dce56b83853baaa59ae295cf
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Mar 12 10:40:39 2023 +0000

    upstream: Limit number of entries in SSH2_MSG_EXT_INFO
    
    request. This is already constrained by the maximum SSH packet size but this
    makes it explicit.  Prompted by Coverity CID 291868, ok djm@ markus@
    
    OpenBSD-Commit-ID: aea023819aa44a2dcb9dd0fbec10561896fc3a09

commit 8f287ba60d342b3e2f750e7332d2131e3ec7ecd0
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Mar 12 09:41:18 2023 +0000

    upstream: calloc can return NULL but xcalloc can't.
    
    From Coverity CID 291881, ok djm@
    
    OpenBSD-Commit-ID: 50204b755f66b2ec7ac3cfe379d07d85ca161d2b

commit 83a56a49fd50f4acf900f934279482e4ef329715
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 10 07:17:08 2023 +0000

    upstream: Explicitly ignore return from fcntl
    
    (... FD_CLOEXEC) here too.  Coverity CID 291853.
    
    OpenBSD-Commit-ID: 99d8b3da9d0be1d07ca8dd8e98800a890349e9b5

commit 0fda9d704d3bbf54a5e64ce02a6fecb11fe7f047
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Mar 10 15:59:46 2023 +1100

    bounds checking for getrrsetbyname() replacement;
    
    Spotted by Coverity in CID 405033; ok millert@

commit 89b8df518f21677045599df0ad3e5dd0f39909b5
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 10 04:06:21 2023 +0000

    upstream: Plug mem leak on error path. Coverity CID 405026, ok djm@.
    
    OpenBSD-Commit-ID: 8212ca05d01966fb5e72205c592b2257708a2aac

commit bf4dae0ad192c3e2f03f7223834b00d88ace3d3e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Mar 10 14:46:57 2023 +1100

    Add prototypes for mkstemp replacements.
    
    Should prevent warnings due to our wrapper function.

commit 4e04d68d6a33cdc73b831fd4b5e6124175555d3d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 10 03:01:51 2023 +0000

    upstream: Expliticly ignore return code from fcntl(.. FD_CLOEXEC) since
    
    there's not much we can do anyway.  From Coverity CID 291857, ok djm@
    
    OpenBSD-Commit-ID: 051429dd07af8db3fec10d82cdc78d90bb051729

commit d6d38fd77cbe091c59e1bb720c3a494df4990640
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 10 02:32:04 2023 +0000

    upstream: Like sshd_config, some ssh_config options are not
    
    first-match-wins. sshd_config.5 was fixed in r1.348, this is the same for
    this file
    
    OpenBSD-Commit-ID: 7be55b9351cde449b136afcc52d07aa4113b215e

commit 7187d3f86bf8f2066cc9941f217d23b0cacae25e
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 10 02:24:56 2023 +0000

    upstream: Remove no-op (int) > INT_MAX checks
    
    since they can never be true. From Coverity CID 405031, ok djm@
    
    OpenBSD-Commit-ID: 9df3783b181e056595e2bb9edf7ed41d61cf8e84

commit 77adde4305542ebe3005dd456122624fe2347b01
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Mar 10 13:27:29 2023 +1100

    Wrap mkstemp calls with umask set/restore.
    
    glibc versions 2.06 and earlier did not set a umask on files created by
    mkstemp created the world-writable.  Wrap mkstemp to set and restore
    the umask.  From Coverity (CIDs 291826 291886 291891), ok djm@

commit 633d3dc2a1e9e2a013d019a0576a0771c8423713
Author: jcs@openbsd.org <jcs@openbsd.org>
Date:   Thu Mar 9 21:06:24 2023 +0000

    upstream: modify parentheses in conditionals to make it clearer what is
    
    being assigned and what is being checked
    
    ok djm dtucker
    
    OpenBSD-Commit-ID: 19c10baa46ae559474409f75a5cb3d0eade7a9b8

commit 733030840c4772f858de95d5940ec0c37663e8b0
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Mar 9 07:11:05 2023 +0000

    upstream: Re-split the merge of the reorder-hostkeys test.
    
    In the kex_proposal_populate_entries change I merged the the check for
    reordering hostkeys with the actual reordering, but kex_assemble_names
    mutates options.hostkeyalgorithms which renders the check ineffective.
    Put the check back where it was.  Spotted and tested by jsg@, ok djm@
    
    OpenBSD-Commit-ID: a7469f25a738db5567395d1881e32479a7ffc9de

commit 54ac4ab2b53ce9fcb66b8250dee91c070e4167ed
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Mar 9 06:58:26 2023 +0000

    upstream: include destination constraints for smartcard keys too.
    
    Spotted by Luci Stanescu; ok deraadt@ markus@
    
    OpenBSD-Commit-ID: add879fac6903a1cb1d1e42c4309e5359c3d870f

commit bfd1ad01d974a316b60622759ad17537fa2d92b4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Mar 9 18:24:54 2023 +1100

    Limit the number of PAM environment variables.
    
    xcalloc has its own limits, but these are specific to PAM.  From
    Coverity CID 405198, ok djm@

commit a231414970e01a35f45a295d5f93698fa1249b28
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Mar 9 18:19:44 2023 +1100

    Limit the number of PAM environment variables.
    
    From Coverity CID 405194, tweaks and ok djm@

commit 36c6c3eff5e4a669ff414b9daf85f919666e8e03
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Mar 8 06:21:32 2023 +0000

    upstream: Plug mem leak. Coverity CID 405196, ok djm@
    
    OpenBSD-Commit-ID: 175f09349387c292f626da68f65f334faaa085f2

commit dfb9b736e1ccf9e6b03eea21cd961f4fd0634c98
Author: tb@openbsd.org <tb@openbsd.org>
Date:   Wed Mar 8 05:33:53 2023 +0000

    upstream: ssh-pkcs11: synchronize error messages with errors
    
    A handful of error messages contained incorrect function names or
    otherwise inaccurate descriptions. Fix them to match reality.
    
    input/ok djm
    
    OpenBSD-Commit-ID: 165a15db52f75b31e1804b043480c36af09f3411

commit 51875897b81b5c21b80c256a29597916edbde454
Author: guenther@openbsd.org <guenther@openbsd.org>
Date:   Wed Mar 8 04:43:12 2023 +0000

    upstream: Delete obsolete /* ARGSUSED */ lint comments.
    
    ok miod@ millert@
    
    OpenBSD-Commit-ID: 7be168a570264d59e96a7d2d22e927d45fee0e4c

commit a76085bda883c2104afb33ab0334eca190927362
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Mar 8 17:25:37 2023 +1100

    Extra brackets to prevent warning.

commit 147ae57d4dfa0508109f93b78a7d8b92819e1f83
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 8 00:05:58 2023 +0000

    upstream: use RSA/SHA256 when testing usability of private key in
    
    agent; with/ok dtucker
    
    OpenBSD-Commit-ID: fe1382e2fdf23fcae631308e72342bad56066a56

commit 27fd251bc906a763e70ce0f27c8abdf8bbd1e416
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 8 00:05:37 2023 +0000

    upstream: use RSA/SHA256 when testing usability of private key;
    
    based on fix in bz3546 by Dmitry Belyavskiy; with/ok dtucker
    
    OpenBSD-Commit-ID: 0ef414cc363a832f9fab92a5da0234448bce2eba

commit eee9f3fc3d52ae7d2106929bb06b7f291fb0b81a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Mar 7 21:47:42 2023 +0000

    upstream: refactor to be more readable top to bottom. Prompted by
    
    Coverity CID 405048 which was a false-positive fd leak; ok dtucker@
    
    OpenBSD-Commit-ID: fc55ec2af622a017defb9b768bf26faefc792c00

commit 42a06b29a4c99272bf690f9b3be520b08b448dc5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Mar 7 18:34:41 2023 +1100

    Add header changes missed in previous.

commit 4710077096edff2e6926dd5b15bf586491d317db
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Mar 7 06:09:14 2023 +0000

    upstream: Fix mem leak in environment setup.
    
    From jjelen at redhat.com via bz#2687, ok djm@
    
    OpenBSD-Commit-ID: 9f9e4ba3cac003e6f81da3bcebd1b9ec43e7f353

commit 03acc50d0ccb78fc91d1570de1cd0fdfea646028
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Mar 6 12:15:47 2023 +0000

    upstream: Unit test for kex_proposal_populate_entries.
    
    OpenBSD-Regress-ID: bdb211d80d572a08bf14b49fe2a58b9ff265c006

commit 3f9231c2e1f374ebb08016ba00ea97b47c0ed20b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Mar 7 05:37:26 2023 +0000

    upstream: fix memory leak in process_read() path; Spotted by James
    
    Robinson in GHPR363; ok markus@
    
    OpenBSD-Commit-ID: cdc2d98e6478b7e7f3a36976845adae3820429d8

commit c5e6e890839ec520ab9301a92cba56303749dea2
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Mar 7 01:30:52 2023 +0000

    upstream: correct size for array argument when changing
    
    UMAC_OUTPUT_LEN Coverity CID 291845; ok dtucker@
    
    OpenBSD-Commit-ID: 2eb017d10705bb623d4418691f961c930eafaec0

commit 9641753e0fd146204d57b2a4165f552a81afade4
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Mar 6 12:14:48 2023 +0000

    upstream: Refactor creation of KEX proposal.
    
    This adds kex_proposal_populate_entries (and corresponding free) which
    populates the KEX proposal array with dynamically allocated strings.
    This replaces the previous mix of static and dynamic that has been the
    source of previous leaks and bugs.  Remove unused compat functions.
    With & ok djm@.
    
    OpenBSD-Commit-ID: f2f99da4aae2233cb18bf9c749320c5e040a9c7b

commit aa59d6a489fb20973fa461d0fdb1110db412947b
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Mar 5 09:24:35 2023 +0000

    upstream: Fix mem and FILE leaks in moduli screening.
    
    If multiple -Ocheckpoint= options are passed, the earlier ones would
    be overwritten and leaked.  If we use an input file that wasn't stdin,
    close that.  From Coverity CIDs 291884 and 291894.
    
    OpenBSD-Commit-ID: a4d9d15f572926f841788912e2b282485ad09e8b

commit 23b8cb41767af99a1aac24589d1882d9c8c2c205
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Mar 5 08:18:58 2023 +0000

    upstream: Plug mem leak in moduli checkpoint option parsing.
    
    From Coverity CID 291894.
    
    OpenBSD-Commit-ID: 9b1aba2d049741ae21c8dc4560a7e29ab17310f4

commit fc7f8f2188d4a4fc8ba77eddbe863c7665666db5
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Mar 5 05:34:09 2023 +0000

    upstream: Remove unused compat.h includes.
    
    We've previously removed a lot of the really old compatibility code,
    and with it went the need to include compat.h in most of the files that
    have it.
    
    OpenBSD-Commit-ID: 5af8baa194be00a3092d17598e88a5b29f7ea2b4

commit 6c165c36246d8004c20e1df5cec4961a5ac422d6
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Mar 4 03:22:59 2023 +0000

    upstream: Use time_t for x11 timeout.
    
    Use time_t instead of u_int for remaining x11 timeout checks for 64bit
    time_t safety.  From Coverity CIDs 405197 and 405028, ok djm@
    
    OpenBSD-Commit-ID: 356685bfa1fc3d81bd95722d3fc47101cc1a4972

commit 4a3918f51bd2d968387e7aa87e33b32c78077fb4
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 3 10:23:42 2023 +0000

    upstream: Ensure ms_remain is always initialized
    
    similar to what we do in ssh_packet_write_wait.  bz#2687, from jjelen
    at redhat.com.
    
    OpenBSD-Commit-ID: a50e0541cf823f8d1c72f71ccde925d3dbe6dfac

commit e44846a4487d2885ac7f2610be09b1e2bf52249b
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 3 09:48:51 2023 +0000

    upstream: Check for non-NULL before string
    
    comparison. From jjelen at redhat.com via bz#2687.
    
    OpenBSD-Commit-ID: 0d9b2e0cac88a311b5766b1aef737082583c285f

commit 1842d523fae63b862ce8e60725c9b606cddb86a6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 3 05:00:34 2023 +0000

    upstream: guard against getsockname(-1, ...) from Coverity CID
    
    291832
    
    OpenBSD-Commit-ID: e58d5227327917d189229b7f0b37d2780f360d5f

commit 78571a5fe9847d40d7f220c92b707574ae9ec4ce
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 3 04:36:20 2023 +0000

    upstream: some options are not first-match-wins. Mention that there
    
    are exceptions at the start of the manpage and label some of them in the
    option description.
    
    OpenBSD-Commit-ID: 3b74728446fa6fc8742769eeb8c3674e233e84c4

commit d1c1b3272e8895a96c4f5889bd6e07a8525bd9f1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 3 04:34:49 2023 +0000

    upstream: actually print "channeltimeout none" in config dump mode;
    
    spotted via Coverity CID 405022
    
    OpenBSD-Commit-ID: b074b52bf138b75f08264e8da15880b29c7a630f

commit 8bf61e95610b48192d4e1720cc15d9004617301d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Mar 3 14:50:03 2023 +1100

    Add Coverity badges.

commit 93291bd723959adf462b1df958106cf07a7734dd
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 3 03:12:24 2023 +0000

    upstream: Check return values of dup2. Spotted by Coverity, ok djm@
    
    OpenBSD-Commit-ID: 19fb1b53072826d00c67df677731d2f6c1dd602b

commit e37261dff33af23f37202cfce0848d36f5c1055c
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 3 02:37:58 2023 +0000

    upstream: Use time_t for x11_refuse_time timeout. We need
    
    SSH_TIME_T_MAX for this, so move from misc.c to misc.h so it's available.
    Fixes a Coverity warning for 64bit time_t safety, ok djm@
    
    OpenBSD-Commit-ID: c69c4c3152cdaab953706db4ccf4d5fd682f7d8d

commit 32755a98c29114b13f4c9d47454bbb265b932ad7
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Mar 3 02:34:29 2023 +0000

    upstream: Check return value from fctnl and warn on failure.
    
    Spotted by Coverity, ok djm@
    
    OpenBSD-Commit-ID: 2097c7db3cf657f1e3a6c5077041bacc63143cab

commit 5fc60e8246c36b8255f72a937ebe9787b39648c6
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Mar 2 11:10:27 2023 +0000

    upstream: Remove SUDO in proxy command wrapper. Anything that needs
    
    sudo is already run by it, and it breaks if root isn't in sudoers.
    
    OpenBSD-Regress-ID: 6cf22fda32a89c16915f31a6ed9bbdbef2a3bac9

commit 0d514659b23a257247491179cfbb53a6dd64e164
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Mar 2 08:24:41 2023 +0000

    upstream: Fix breakage on dhgex test.
    
    This was due to the sshd logs being written to the wrong log file.
    While there, make save_debug_logs less verbose, write the name of the
    tarball to regress.log and use $SUDO to remove the old symlinks (which
    shouldn't be needed, but won't hurt).  Initial problem spotted by anton@.
    
    OpenBSD-Regress-ID: 9c44fb9cd418e6ff31165e7a6c1f9f11a6d19f5b

commit 860201201d4ae655702807966901682cff30a171
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Mar 2 08:14:52 2023 +0000

    upstream: Quote grep and log message better.
    
    OpenBSD-Regress-ID: 3823d9063127169736aa274b1784cb28e15b64d4

commit 03a03c6002525f5ad9c8fc874a5d5826a35d9858
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Mar 2 06:41:56 2023 +0000

    upstream: Always call fclose on checkpoints.
    
    In the case of an fprintf failure we would not call fclose which would
    leak the FILE pointer.  While we're there, try to clean up the temp file
    on failure.  Spotted by Coverity, ok djm@
    
    OpenBSD-Commit-ID: 73c7ccc5d4fcc235f54c6b20767a2815408525ef

commit 13fe8f9785e6d90400ce548939a0b0ddc11fcb3c
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Mar 1 21:54:50 2023 +0000

    upstream: Remove old log symlinks
    
    before creating new ones. In -portable some platforms don't like
    overwriting existing symlinks.
    
    OpenBSD-Regress-ID: 7e7ddc0beb73e945e1c4c58d51c8a125b518120f

commit 131fcbcaffd1e3bcf5ab766ec497b5d768955310
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Mar 1 23:23:02 2023 +1100

    Adjust test jobs for new log directory.

commit a6f4ac8a2baf77e5361cfa017d0dc250d1409bec
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Mar 1 09:29:32 2023 +0000

    upstream: Rework logging for the regression tests.
    
    Previously we would log to ssh.log and sshd.log, but that is insufficient
    for tests that have more than one concurent ssh/sshd.
    
    Instead, we'll log to separate datestamped files in a $OBJ/log/ and
    leave a symlink at the previous location pointing at the most recent
    instance with an entry in regress.log showing which files were created
    at each point.  This should be sufficient to reconstruct what happened
    even for tests that use multiple instances of each program.  If the test
    fails, tar up all of the logs for later analysis.
    
    This will let us also capture the output from some of the other tools
    which was previously sent to /dev/null although most of those will be
    in future commits.
    
    OpenBSD-Regress-ID: f802aa9e7fa51d1a01225c05fb0412d015c33e24

commit 8ead62ed5e86c7df597d8604f332f49cd1527b85
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Feb 28 21:31:50 2023 +0000

    upstream: fatal out if allocating banner string fails to avoid
    
    potential null deref later in sscanf.  Spotted by Coverity, ok deraadt@
    
    OpenBSD-Commit-ID: 74e8d228ac00552e96e9e968dfcccf8dd1f46ad5

commit 44ca56ba0b3f531f1d85730cc701097cd49e6868
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Feb 28 08:45:24 2023 +0000

    upstream: Explicitly ignore return from fchmod
    
    similar to other calls to prevent warning.
    
    OpenBSD-Commit-ID: fdc5287dcee0860b5a493186414226c655b0eb0a

commit 803392933a3a6f09f834aa5f0c2aab06a3b382f4
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Feb 27 22:12:40 2023 +0000

    upstream: Plug mem leak on globbed ls error path.
    
     Spotted by Coverity, ok deraadt@
    
    OpenBSD-Commit-ID: de28476025db29820a9a2e56e98b964d8a02861c

commit aa33b4d396abf47a2a45f982f28d054fb1dcb5c3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Feb 27 21:04:22 2023 +1100

    Cast time_t's in debug output to long long.
    
    Should fix Coverity warning about truncation of 64bit time_t.

commit b0fd60a9de62a03189ad57d0c07f0ac51dc00e95
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Feb 27 17:28:59 2023 +1100

    Do shadow expiry calcs using "long long".
    
    Coverity flags these as potentially not 64bit time_t safe so use
    long long for the calculations and debug output.  ok djm@

commit 01dbeb3084d714bbd001ff9d03b9de542e8cdf58
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Feb 27 17:07:52 2023 +1100

    avoid clash between for getopt's struct option
    
    Since we don't use getopt_long() nothing outside the getopt()
    implementation itself uses this structure, so move it into the
    source to remove it from visibility and clashes with libc's
    
    ok dtucker@

commit eb88d07c43afe407094e7d609248d85a15e148ef
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Feb 25 14:45:41 2023 +1100

    Revert explicit chmods on private keys.
    
    This should no longer be needed on Cygwin test runners due to previous
    commit.

commit 52b75db61030a6c8baf66b73644380cf3f58e26a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Feb 25 14:43:28 2023 +1100

    Remove extended ACLs from working dirs.
    
    This should allow umask to work as expected and prevent tests from
    failing due to excessive permissions on private keys.

commit 0c5d4c843df5605b043a758d69f9a611ef63c479
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 24 13:44:13 2023 +1100

    Explicitly set permissions on user and host keys.
    
    On cygwin, the umask might not be sufficient.  Should fix tests on
    Github runners.

commit 6c9fc9d7a9f7abf82c3294d74e6d4a25735862ce
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Feb 22 03:56:43 2023 +0000

    upstream: fix progressmeter corruption on wide displays; bz3534
    
    feedback/ok dtucker@
    
    OpenBSD-Commit-ID: f4affee067cec7c182f3e0b307d758e0472762a3

commit fe0bd3cde9665d364e5eedd2c2c2e60d4cdc3786
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Feb 21 06:48:18 2023 +0000

    upstream: fseek to end of known_hosts before writing to it.
    
    POSIX and ANSI C require that applications call fseek or similar between
    read and writing to a RW file.  OpenBSD doesn't enforce this, but some
    (System V derived) platforms need this to prevent it from writing a
    spurious extra byte (in this case, a newline).  ok djm@ deraadt@
    
    OpenBSD-Commit-ID: 33e680dcd8110582a93a40a8491024e961f45137

commit 357fb8ae14c07cd025eeed66e73de91bab569849
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Feb 21 17:51:09 2023 +1100

    Also run unit tests on AIX VMs.
    
    In the past these tests took too long, but these days it only adds
    about 5 min to the run.

commit 17781aaa5188ee1477f7779b280d105512e3dbed
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Feb 21 17:38:55 2023 +1100

    Wrap stdint.h inside ifdef.

commit ef798bad38505f7bf1b5fa5c0843dfc5a2b192b9
Author: Mayank Sharma <mayank.fit2010@gmail.com>
Date:   Mon Feb 20 17:37:15 2023 +0530

    Add includes to ptimeout test.
    
    Fixes test failures on AIX due to type mismatches.

commit ab69dda05d5268454209f529fa80f477e60d846a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Feb 20 18:24:39 2023 +1100

    Always use the openssl binary configure tells us.
    
    This fixes tests on platforms that do not have the openssl tool
    installed at all.

commit 2a7e3449908571af601a4c2d12ab140096442e47
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Feb 17 04:22:50 2023 +0000

    upstream: Remove now-unused compat bit SSH_BUG_RSASIGMD5. The code
    
    to set this was removed in OpenSSH 7.7 when support for SSH implementations
    dating back to before RFC standardization were removed.  "burn it all" djm@
    
    OpenBSD-Commit-ID: 6330935fbe23dd00be79891505e06d1ffdac7cda

commit 0833ccf2c8b7ae08b296c06f17bd53e3ab94b0b0
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Feb 17 03:06:18 2023 +0000

    upstream: Remove now-unused compat bit SSH_BUG_BIGENDIANAES. This
    
    was previously set for OpenSSH 2.3 (released in 2000) but this check was
    removed in OpenSSH 7.7 (2018).  ok djm@ deraadt@
    
    OpenBSD-Commit-ID: 326426ea328707fc9e83305291ab135c87f678af

commit c81c2bea6e828d52b62b448b4ffdd3c163177975
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Feb 17 10:12:40 2023 +1100

    whitespace fixes

commit 500f90b39db5f0014e6b0c49ff1f45c994b69293
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Feb 17 10:02:08 2023 +1100

    whitespace at EOL

commit 68350152406339170721c15e97afdf827a5e4001
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Feb 16 10:10:00 2023 +0000

    upstream: Remove SSH_BUG_PASSWORDPAD compat bit
    
    since it's no longer used. ok markus@
    
    OpenBSD-Commit-ID: b92c21f56fe4b7f9a54790d6a9650725c226820b

commit 537cccd804eaf65f32bdce037cc31db4e0ab0f44
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Feb 16 07:55:15 2023 +0000

    upstream: Remove SSH_BUG_IGNOREMSG compat flag
    
    since it's only applicable to SSH1 and thus no longer used.  ok markus@
    "kill it with fire" djm@
    
    OpenBSD-Commit-ID: ea13318b1937795d9db4790d3ce0a6ed01584dab

commit 285cf6cd4b91a0a0ce33193c358c99085af33e43
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Feb 10 06:41:53 2023 +0000

    upstream: space between macro and punctuation; sort usage();
    
    OpenBSD-Commit-ID: 6141610cfca037700730e41f868d1d9124958f8c

commit d39a96f70f81878c77336ed35f5c648c1804b71a
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Feb 10 06:40:48 2023 +0000

    upstream: space between macro and punctuation;
    
    OpenBSD-Commit-ID: abc95e550be9e6d9a7ff64b65c104c7be21ab19e

commit 16e82bf53fc34e43e3b948d43b68d5b27a7335e6
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Feb 10 06:39:27 2023 +0000

    upstream: sort SYNOPSIS;
    
    OpenBSD-Commit-ID: dacd9da33277d5669a51213d880632599c890c1e

commit d9685121ff6d57b8797411f3cb123884a4b96e30
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Feb 11 12:32:19 2023 +1100

    Improve seccomp compat on older systems.
    
    Check if flags to mmap and madvise are defined before using them.
    Should fix problems building on older Linux systems that don't have
    these.  bz#3537, with & ok djm@.

commit 6180b0fa4f7996687678702806257e661fd5931e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Feb 10 05:06:03 2023 +0000

    upstream: test -Ohashalg=... and that the default output contains both
    
    specified hash algorithms; prompted by dtucker@
    
    OpenBSD-Regress-ID: 26f309208c8d8b8fa9c5f419767b85f1e9b22f51

commit d651f5c9fe37e61491eee46c49ba9fa03dbc0e6a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Feb 10 04:56:30 2023 +0000

    upstream: let ssh-keygen and ssh-keyscan accept
    
    -Ohashalg=sha1|sha256 when outputting SSHFP fingerprints to allow algorithm
    selection. bz3493 ok dtucker@
    
    OpenBSD-Commit-ID: e6e07fe21318a873bd877f333e189eb963a11b3d

commit 18938d11a90b74d63c20b2d3c965d5bd64786ab1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Feb 10 04:47:19 2023 +0000

    upstream: add a `sshd -G` option that parses and prints the
    
    effective configuration without attempting to load private keys and perform
    other checks. This allows usage of the option before keys have been
    generated.
    
    bz3460 feedback/ok dtucker@
    
    OpenBSD-Commit-ID: 774504f629023fc25a559ab1d95401adb3a7fb29

commit df7d3dbf7194db8e97730ee0425d4d9d7bdb8b10
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Feb 10 04:40:28 2023 +0000

    upstream: make `ssh -Q CASignatureAlgorithms` work as the manpage says
    
    it should bz3532
    
    OpenBSD-Commit-ID: 0ddb17b3fcbd99bfb5baea4ac5e449620cbd3adc

commit d3b8d4198b6595f23b5859d43dc8fc701f97429b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 10 14:26:44 2023 +1100

    Add CentOS 7 test targets.

commit 22efb01e355bba4755b730ed417f91c081445bfc
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Feb 9 09:55:33 2023 +0000

    upstream: Test adding terminating newline to known_hosts.
    
    OpenBSD-Regress-ID: 5fc3010ac450195b3fbdeb68e875564968800365

commit caec6da1a583ed8c32c6ad3b81bbcaab46ac8b61
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Feb 8 08:06:03 2023 +0000

    upstream: ssh-agent doesn't actually take -v,
    
    so the recently-added ones will result in the test not cleaning up
    after itself.  Patch from cjwatson at debian.org vi bz#3536.
    
    OpenBSD-Regress-ID: 1fc8283568f5bf2f918517c2c1e778072cf61b1a

commit 3c379c9a849a635cc7f05cbe49fe473ccf469ef9
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Feb 9 09:54:11 2023 +0000

    upstream: Ensure that there is a terminating newline when adding a new
    
    entry to known_hosts.  bz#3529, with git+openssh at limpsquid.nl, ok deraadt@
    markus@
    
    OpenBSD-Commit-ID: fa8d90698da1886570512b96f051e266eac105e0

commit 95b6bbd2553547260b324b39d602061c88b774bc
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Feb 7 08:43:47 2023 +1100

    Replace 9.1 with 9.2 on CI status page.

commit 195313dfe10a23c82e9d56d5fdd2f59beee1bdcf
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Feb 3 16:33:09 2023 +1100

    harden Linux seccomp sandbox
    
    Linux mmap(2) and madvise(2) syscalls support quite a number of funky
    flags that we don't expect that sshd/libc will ever need. We can
    exclude this kernel attack surface by filtering the mmap(2) flags
    and the madvise(2) advice arguments.
    
    Similarly, the sandboxed process in sshd is a single-threaded program
    that does not use shared memory for synchronisation or communication.
    Therefore, there should be no reason for the advanced priority
    inheritance futex(2) operations to be necessary. These can also be
    excluded.
    
    Motivated by Jann Horn pointing out that there have been kernel bugs
    in nearby Linux kernel code, e.g. CVE-2020-29368, CVE-2020-29374 and
    CVE-2022-42703.
    
    Feedback Jann Horn, ok dtucker@

commit 6dfb65de949cdd0a5d198edee9a118f265924f33
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Feb 2 23:21:54 2023 +1100

    crank versions in RPM specs

commit d07cfb11a0ca574eb68a3931d8c46fbe862a2021
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Feb 2 23:21:45 2023 +1100

    update version in README

commit 9fe207565b4ab0fe5d1ac5bb85e39188d96fb214
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Feb 2 23:17:49 2023 +1100

    adapt compat_kex_proposal() test to portable

commit 903c556b938fff2d7bff8da2cc460254430963c5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Feb 2 12:12:52 2023 +0000

    upstream: test compat_kex_proposal(); by dtucker@
    
    OpenBSD-Regress-ID: 0e404ee264db546f9fdbf53390689ab5f8d38bf2

commit 405fba71962dec8409c0c962408e09049e5624b5
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jan 19 07:53:45 2023 +0000

    upstream: Check if we can copy sshd or need to use sudo to do so
    
    during reexec test. Skip test if neither can work.  Patch from anton@, tweaks
    from me.
    
    OpenBSD-Regress-ID: 731b96ae74d02d5744e1f1a8e51d09877ffd9b6d

commit b2a2a8f69fd7737ea17dc044353c514f2f962f35
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Feb 2 12:10:22 2023 +0000

    upstream: openssh-9.2
    
    OpenBSD-Commit-ID: f7389f32413c74d6e2055f05cf65e7082de03923

commit 12da7823336434a403f25c7cc0c2c6aed0737a35
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Feb 2 12:10:05 2023 +0000

    upstream: fix double-free caused by compat_kex_proposal(); bz3522
    
    by dtucker@, ok me
    
    OpenBSD-Commit-ID: 2bfc37cd2d41f67dad64c17a64cf2cd3806a5c80

commit 79efd95ab5ff99f4cb3a955e2d713b3f54fb807e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Feb 1 17:17:26 2023 +1100

    Skip connection-timeout test on minix3.
    
    Minix 3's Unix domain sockets don't seem to work the way we expect, so
    skip connection-timeout test on that platform.  While there, group
    together all similarly skipped tests and explicitly comment.

commit 6b508c4e039619842bcf5a16f8a6b08dd6bec44a
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Feb 1 12:12:05 2023 +1100

    fix libfido2 detection without pkg-config
    
    Place libfido2 before additional libraries (that it may depend upon)
    and not after. bz3530 from James Zhang; ok dtucker@

commit 358e300fed5e6def233a2c06326e51e20ebed621
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Wed Jan 18 20:56:36 2023 +0000

    upstream: delete useless dependency
    
    OpenBSD-Commit-ID: e1dc11143f83082e3154d6094f9136d0dc2637ad

commit a4cb9be1b021b511e281ee55c356f964487d9e82
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Wed Jan 18 20:43:15 2023 +0000

    upstream: Create and install sshd random relink kit.
    
    ../Makefile.inc and Makfile are concatenated for reuse, which hopefully won't
    be too fragile, we'll see if we need a different approach. The resulting sshd
    binary is tested with the new sshd -V option before installation.  As the
    binary layout is now semi-unknown (meaning relative, fixed, and gadget
    offsets are not precisely known), change the filesystem permissions to 511 to
    prevent what I call "logged in BROP". I have ideas for improving this further
    but this is a first step ok djm
    
    OpenBSD-Commit-ID: 1e0a2692b7e20b126dda60bf04999d1d30d959d8

commit bc7de6f91a9a0ae2f148a9d31a4027d441a51999
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Wed Jan 18 06:55:32 2023 +0000

    upstream: tweak previous; ok djm
    
    OpenBSD-Commit-ID: df71ce4180c58202dfdc1d92626cfe900b91b7c3

commit a20b7e999773e6333c8aa9b0a7fa41966e63b037
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jan 31 19:35:44 2023 +1100

    Skip connection-timeout test under Valgrind.
    
    Valgrind slows things down so much that the timeout test fails.  Skip
    this test until we figure out if we can make it work.

commit c3ffb54b4fc5e608206037921db6ccbc2f5ab25f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jan 25 21:58:40 2023 +1100

    Skip connection-timeout when missing FD passing.
    
    This tests uses multiplexing which uses file descriptor passing, so
    skip it if we don't have that.  Fixes test failures on Cygwin.

commit 35253af01d8c0ab444c8377402121816e71c71f5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 18 02:00:10 2023 +0000

    upstream: when restoring non-blocking mode to stdio fds, restore
    
    exactly the flags that ssh started with and don't just clobber them with
    zero, as this could also remove the append flag from the set;
    
    bz3523; ok dtucker@
    
    OpenBSD-Commit-ID: 1336b03e881db7564a4b66014eb24c5230e9a0c0

commit 7d17ea151c0b2519f023bd9cc7f141128833ac47
Author: millert@openbsd.org <millert@openbsd.org>
Date:   Wed Jan 18 01:50:21 2023 +0000

    upstream: Add a -V (version) option to sshd like the ssh client
    
    has. OK markus@ deraadt@
    
    OpenBSD-Commit-ID: abe990ec3e636fb040132aab8cbbede98f0c413e

commit 62360feb7f08f2a4c6fc36f3b3449309203c42c9
Author: millert@openbsd.org <millert@openbsd.org>
Date:   Tue Jan 17 18:52:44 2023 +0000

    upstream: For "ssh -V" always exit 0, there is no need to check opt
    
    again. This was missed when the fallthrough in the switch case above it was
    removed.  OK deraadt@
    
    OpenBSD-Commit-ID: 5583e5d8f6d62a8a4215cfa95a69932f344c8120

commit 12492c0abf1eb415d08a897cc1d8b9e789888230
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jan 17 10:15:10 2023 +0000

    upstream: also check that an active session inhibits
    
    UnusedConnectionTimeout idea markus@
    
    OpenBSD-Regress-ID: 55c0fb61f3bf9e092b0a53f9041d3d2012f14003

commit cef2593c33ac46a58238ff998818754eabdf64ff
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jan 17 10:02:34 2023 +0000

    upstream: regression test for UnusedConnectionTimeout
    
    OpenBSD-Regress-ID: 7f29001374a68e71e5e078f69e4520cf4bcca084

commit aff9493a89c71d6a080419b49ac64eead9730491
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jan 16 04:11:29 2023 +0000

    upstream: unbreak test: cannot access shell positional parameters
    
    past $9 without wrapping the position in braces (i.e. need ${10}, etc.)
    
    OpenBSD-Regress-ID: 3750ec98d5d409ce6a93406fedde6f220d2ea2ac

commit 0293c19807f83141cdf33b443154459f9ee471f6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jan 17 09:44:48 2023 +0000

    upstream: Add a sshd_config UnusedConnectionTimeout option to terminate
    
    client connections that have no open channels for some length of time. This
    complements the recently-added ChannelTimeout option that terminates inactive
    channels after a timeout.
    
    ok markus@
    
    OpenBSD-Commit-ID: ca983be74c0350364c11f8ba3bd692f6f24f5da9

commit 8ec2e3123802d2beeca06c1644b0b647f6d36dab
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Jan 15 23:35:10 2023 +0000

    upstream: adapt to ed25519 changes in src/usr.bin/ssh
    
    OpenBSD-Regress-ID: 4b3e7ba7ee486ae8a0b4790f8112eded2bb7dcd5

commit 9fbbfeca1ce4c7ec0001c827bbf4189a3ba0964b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Jan 15 23:05:32 2023 +0000

    upstream: update OpenSSH's Ed25519 code to the last version of SUPERCOP
    
    (20221122) and change the import approach to the same one we use for
    Streamlined NTRUPrime: use a shell script to extract the bits we need from
    SUPERCOP, make some minor adjustments and squish them all into a single file.
    
    ok tb@ tobhe@
    
    OpenBSD-Commit-ID: 1bc0fd624cb6af440905b8ba74ac7c03311b8e3b

commit 6283f4bd83eee714d0f5fc55802eff836b06fea8
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jan 14 22:02:44 2023 +1100

    Allow writev is seccomp sandbox.
    
    This seems to be used by recent glibcs at least in some configurations.
    From bz#3512, ok djm@

commit 923c3f437f439cfca238fba37e97a7041782f615
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Jan 14 10:05:54 2023 +0000

    upstream: Shell syntax fix. From ren mingshuai vi github PR#369.
    
    OpenBSD-Regress-ID: 6696b2eeefe128099fc3d7ea9f23252cc35156f9

commit 4d87a00f704e0365e11c3c38b170c1275ec461fc
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Jan 14 09:57:08 2023 +0000

    upstream: Instead of skipping the all-tokens test if we don't have
    
    OpenSSL (since we use it to compute the hash), put the hash at the end and
    just omit it if we don't have it.  Prompted by bz#3521.
    
    OpenBSD-Regress-ID: c79ecba64250ed3b6417294b6c965e6b12ca5eea

commit b05406d6f93b8c8ec11ec8b27e7c76cc7a5a55fb
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Jan 13 07:13:40 2023 +0000

    upstream: fix double phrase in previous;
    
    OpenBSD-Commit-ID: 671e6c8dc5e9230518b2bbfa143daaa88adc66c2

commit 40564812b659c530eb1f4b62d09e85612aef3107
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jan 13 03:16:29 2023 +0000

    upstream: Document "UserKnownHostsFile none". ok djm@
    
    OpenBSD-Commit-ID: f695742d39e34ecdcc3c861c3739a84648a4bce5

commit d03e245e034019a37388f6f5f893ce848ab6d2e2
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jan 13 23:02:34 2023 +1100

    Retry package installation 3 times.
    
    When setting up the CI environment, retry package installation 3 times
    before going up.  Should help prevent spurious failures during
    infrastructure issues.

commit 625f6bc39840167dafb3bf5b6a3e18503ac986e8
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jan 13 04:47:34 2023 +0000

    upstream: Move scp path setting to a helper function. The previous
    
    commit to add scp to the test sshd's path causes the t-envpass test to fail
    when the test scp is given using a fully qualified path.  Put this in a
    helper function and only call it from the scp tests.
    
    OpenBSD-Regress-ID: 7533dc1c4265c1de716abb062957994195b36df4

commit 6e6f88647042b3cde54a628545c2f5fb656a9327
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jan 13 04:23:00 2023 +0000

    upstream: Add scp's path to test sshd's PATH.
    
    If the scp we're testing is fully qualified (eg it's not in the system
    PATH) then add its path to the under-test sshd's PATH so we can find
    it. Prompted by bz#3518.
    
    OpenBSD-Regress-ID: 7df4f5a0be3aa135495b7e5a6719d3cbc26cc4c0

commit 8a5e99a70fcf9b022a8aa175ebf6a71f58511da3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jan 13 15:49:48 2023 +1100

    Remove skipping test when scp not in path.
    
    An upcoming change renders this obsolete by adding scp's path to the
    test sshd's PATH, and removing this first will make the subsequent sync
    easier.

commit 41f36dd896c8fb8337d403fcf476762986976e9d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jan 13 02:58:20 2023 +0000

    upstream: Add a "Host" line to the output of ssh -G showing the
    
    original host arg. Inspired by patch from vincent at bernat.ch via bz#3343,
    ok djm@
    
    OpenBSD-Commit-ID: 59c0f60a222113a44d0650cd394376e3beecc883

commit f673b49f3be3eb51074fbb8a405beb6cd0f7d93e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 13 02:44:02 2023 +0000

    upstream: avoid printf("%s", NULL) if using ssh
    
    -oUserKnownHostsFile=none and a hostkey in one of the system known hosts file
    changes; ok dtucker@
    
    OpenBSD-Commit-ID: 7ca87614bfc6da491315536a7f2301434a9fe614

commit 93fc7c576563e3d88a1dc019dd213f65607784cc
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 11 05:39:38 2023 +0000

    upstream: clamp the minimum buffer lengths and number of inflight
    
    requests too
    
    OpenBSD-Commit-ID: c4965f62fa0ba850940fd66ae3f60cf516bbcd56

commit 48bf234322e639d279c5a28435eae50155e9b514
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 11 05:36:50 2023 +0000

    upstream: ignore bogus upload/download buffer lengths in the limits
    
    extension
    
    OpenBSD-Commit-ID: c5b023e0954693ba9a5376e4280c739b5db575f8

commit 36b00d31833ca74cb0f7c7d8eda1bde55700f929
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 11 02:13:52 2023 +0000

    upstream: remove whitespace at EOL from code extracted from SUPERCOP
    
    OpenBSD-Commit-ID: 1ec524ff2fbb9387d731601437c82008f35a60f4

commit d888de06c5e4d7dbf2f2b85f2b5bf028c570cf78
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 11 00:51:27 2023 +0000

    upstream: rewrite this test to use a multiplexed ssh session so we can
    
    control its lifecycle without risk of race conditions; fixes some of the
    Github integration tests for openssh-portable
    
    OpenBSD-Regress-ID: 5451cad59ba0d43ae9eeda48ec80f54405fee969

commit 4bcc737a35fdd9cc4af7423d6c23dfd0c7ef4786
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Jan 11 11:45:17 2023 +1100

    remove buffer len workaround for NetBSD 4.x
    
    Switching to from pipes to a socketpair for communicating with the
    ssh process avoids the (kernel bug?) problem.

commit f5154d2aac3e6a32a1b13dec23a701a087850cdc
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Jan 11 11:44:19 2023 +1100

    add back use of pipes in scp.c under USE_PIPES
    
    This matches sftp.c which prefers socketpair but uses pipes on
    some older platforms.

commit eec737b59cf13841de46134967a206607000acd4
Author: millert@openbsd.org <millert@openbsd.org>
Date:   Tue Jan 10 23:22:15 2023 +0000

    upstream: Switch scp from using pipes to a socketpair for
    
    communication with it's ssh sub-processes.  We no longer need to reserve two
    descriptors to ensure that we don't end up using fd 0-2 unexpectedly, that is
    handled by sanitise_stdfd() in main(). Based on an original diff from djm@.
    OK deraadt@ djm@
    
    OpenBSD-Commit-ID: b80c372faac462471e955ddeab9480d668a2e48d

commit d213d126a4a343abd3a1eb13687d39c1891fe5c8
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Jan 6 08:44:11 2023 +0000

    upstream: tweak previous; ok djm
    
    OpenBSD-Commit-ID: 229c493452766d70a78b0f02f6ff9894f9028858

commit 4a5590a5ee47b7dfd49773e9fdba48ad3089fe64
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Jan 9 16:33:56 2023 +1100

    try to improve logging for dynamic-forward test
    
    previously the logs from the ssh used to exercise the forwarding
    channel would clobber the logs from the ssh actually doing the
    forwarding

commit 715bc25dcfccf9fb2bee820155fe071d01a618db
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jan 7 23:24:50 2023 +1100

    Skip dynamic-forward test on minix3.
    
    This test relies on loopback addresses which minix does not have.
    Previously the test would not run at all since it also doesn't have
    netcat, but now we use our own netcat it tries and fails.

commit dd1249bd5c45128a908395c61b26996a70f82205
Author: Damien Miller <djm@mindrot.org>
Date:   Sun Jan 8 12:08:59 2023 +1100

    don't test IPv6 addresses if platform lacks support

commit d77fc611a62f2dfee0b654c31a50a814b13310dd
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jan 6 12:33:33 2023 +0000

    upstream: When OpenSSL is not available, skip parts of percent test
    
    that require it. Based on github pr#368 from ren mingshuai.
    
    OpenBSD-Regress-ID: 49a375b2cf61ccb95b52e75e2e025cd10988ebb2

commit 1cd2aac312af9172f1b5cb06c2e1cd090abb83cf
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jan 7 23:01:11 2023 +1100

    Use our own netcat for dynamic-forward test.
    
    That way we can be surer about its behaviour rather than trying to
    second-guess the behaviour of various netcat implementations.

commit 26cab41c05d7b0859d2a1ea5b6ed253d91848a80
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jan 7 14:30:43 2023 +1100

    Use autoconf to find openssl binary.
    
    It's possible to install an OpenSSL in a path not in the system's
    default library search path.  OpenSSH can still use this (eg if you
    specify an rpath) but the openssl binary there may not work.  If one is
    available on the system path just use that.

commit 5532e010a0eeb6aa264396514f9aed7948471538
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jan 7 10:34:18 2023 +1100

    Check openssl_bin path is executable before using.

commit 5d7b16cff48598d5908db970bfdc9ff9326142c8
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jan 6 23:19:07 2023 +1100

    Set OPENSSL_BIN from OpenSSL directory.

commit 344a0e8240eaf08da5d46a5e3a9ecad6e4f64c35
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jan 6 08:50:33 2023 +0000

    upstream: Save debug logs from ssh for debugging purposes.
    
    OpenBSD-Regress-ID: 109e40b06de1c006a3b8e0d8745b790b2c5870a0

commit e1ef172646f7f49c80807eea90225ef5e0be55a8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 08:07:39 2023 +0000

    upstream: regression test for ChannelTimeout
    
    OpenBSD-Regress-ID: 280bfbefcfa415428ad744e43f69a8dede8ad685

commit 2393ea8daf25853459eb07a528d7577688847777
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 07:18:18 2023 +0000

    upstream: fix typo in verbose logging
    
    OpenBSD-Regress-ID: 0497cdb66e003b2f50ed77291a9104fba2e017e9

commit 161a5378a3cc2e7aa3f9674cb7f4686ae6ce9586
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 02:59:50 2023 +0000

    upstream: unit tests for misc.c:ptimeout_* API
    
    OpenBSD-Regress-ID: 01f8fb12d08e5aaadd4bd4e71f456b6588be9a94

commit 018d671d78145f03d6f07ae9d64d51321da70325
Author: tb@openbsd.org <tb@openbsd.org>
Date:   Wed Jan 4 22:48:57 2023 +0000

    upstream: Copy bytes from the_banana[] rather than banana()
    
    Fixes test failure due to segfault seen on arm64 with xonly snap.
    
    ok djm
    
    OpenBSD-Regress-ID: 86e2aa4bbd1dff1bc4ebb2969c0d6474485be046

commit ab6bb69e251faa8b24f81b25c72ec0120f20cad4
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Jan 6 19:13:36 2023 +1100

    unbreak scp on NetBSD 4.x
    
    e555d5cad5 effectively increased the default copy buffer size for SFTP
    transfers. This caused NetBSD 4.x to hang during the "copy local file to
    remote file in place" scp.sh regression test.
    
    This puts back the original 32KB copy buffer size until we can properly
    figure out why.
    
    lots of debugging assistance from dtucker@

commit 2d1ff2b9431393ad99ef496d5e3b9dd0d4f5ac8c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 02:47:18 2023 +0000

    upstream: Implement channel inactivity timeouts
    
    This adds a sshd_config ChannelTimeouts directive that allows channels that
    have not seen traffic in a configurable interval to be automatically closed.
    Different timeouts may be applied to session, X11, agent and TCP forwarding
    channels.
    
    Note: this only affects channels over an opened SSH connection and not
    the connection itself. Most clients close the connection when their channels
    go away, with a notable exception being ssh(1) in multiplexing mode.
    
    ok markus dtucker
    
    OpenBSD-Commit-ID: ae8bba3ed9d9f95ff2e2dc8dcadfa36b48e6c0b8

commit 0e34348d0bc0b1522f75d6212a53d6d1d1367980
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 02:42:34 2023 +0000

    upstream: Add channel_set_xtype()
    
    This sets an "extended" channel type after channel creation (e.g.
    "session:subsystem:sftp") that will be used for setting channel inactivity
    timeouts.
    
    ok markus dtucker
    
    OpenBSD-Commit-ID: 42564aa92345045b4a74300528f960416a15d4ca

commit ceedf09b2977f3a756c759a6e7eb8f8e9db86a18
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 02:41:49 2023 +0000

    upstream: tweak channel ctype names
    
    These are now used by sshd_config:ChannelTimeouts to specify timeouts by
    channel type, so force them all to use a similar format without whitespace.
    
    ok dtucker markus
    
    OpenBSD-Commit-ID: 66834765bb4ae14f96d2bb981ac98a7dae361b65

commit c60438158ad4b2f83d8504257aba1be7d0b0bb4b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 02:39:59 2023 +0000

    upstream: Add channel_force_close()
    
    This will forcibly close an open channel by simulating read/write errors,
    draining the IO buffers and calling the detach function.
    
    Previously the detach function was only ever called during channel garbage
    collection, but there was no way to signal the user of a channel (e.g.
    session.c) that its channel was being closed deliberately (vs. by the
    usual state-machine logic). So this adds an extra "force" argument to the
    channel cleanup callback to indicate this condition.
    
    ok markus dtucker
    
    OpenBSD-Commit-ID: 23052707a42bdc62fda2508636e624afd466324b

commit d478cdc7ad6edd4b1bcd1e86fb2f23194ff33d5a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 02:38:23 2023 +0000

    upstream: replace manual poll/ppoll timeout math with ptimeout API
    
    feedback markus / ok markus dtucker
    
    OpenBSD-Commit-ID: c5ec4f2d52684cdb788cd9cbc1bcf89464014be2

commit 4adf3817a24efe99b06e62630577d683c7cd8065
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 6 02:37:04 2023 +0000

    upstream: add ptimeout API for keeping track of poll/ppoll
    
    timeouts; ok dtucker markus
    
    OpenBSD-Commit-ID: 3335268ca135b3ec15a947547d7cfbb8ff929ead

commit 8c7c69d32375d2f3ce9da0109c9bffc560842316
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 5 05:49:13 2023 +0000

    upstream: suppress "Connection closed" message when in quiet mode
    
    OpenBSD-Commit-ID: 8a3ab7176764da55f60bfacfeae9b82d84e3908f

commit 845ceecea2ac311b0c267f9ecbd34862e1876fc6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jan 2 07:03:57 2023 +0000

    upstream: regression test for PermitRemoteOpen
    
    OpenBSD-Regress-ID: 8271aafbf5c21950cd5bf966f08e585cebfe630c

commit b3daa8dc582348d6ab8150bc1e571b7aa08c5388
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jan 2 07:03:30 2023 +0000

    upstream: fix bug in PermitRemoteOpen which caused it to ignore its
    
    first argument unless it was one of the special keywords "any" or "none".
    
    Reported by Georges Chaudy in bz3515; ok dtucker@
    
    OpenBSD-Commit-ID: c5678a39f1ff79993d5ae3cfac5746a4ae148ea5

commit 0872663a7be0301bcc3d49acdbc9b740a3d972d4
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Mon Dec 26 19:16:03 2022 +0000

    upstream: spelling fixes; from paul tagliamonte amendments to his
    
    diff are noted on tech
    
    OpenBSD-Commit-ID: d776dd03d0b882ca9c83b84f6b384f6f9bd7de4a

commit 797da2812a71785b34890bb6eb44767a7d09cd34
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Dec 16 07:13:22 2022 +0000

    upstream: Mention that scp uses the SFTP protocol and remove
    
    reference to legacy flag. Spotted by, feedback and ok jmc@
    
    OpenBSD-Commit-ID: 9dfe04966f52e941966b46c7a2972147f95281b3

commit 93f2ce8c050a7a2a628646c00b40b9b53fef93ef
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Dec 16 06:56:47 2022 +0000

    upstream: Clear signal mask early in main(); sshd may have been
    
    started with one or more signals masked (sigprocmask(2) is not cleared
    on fork/exec) and this could interfere with various things, e.g. the
    login grace timer.
    
    Execution environments that fail to clear the signal mask before running
    sshd are clearly broken, but apparently they do exist.
    
    Reported by Sreedhar Balasubramanian; ok dtucker@
    
    OpenBSD-Commit-ID: 77078c0b1c53c780269fc0c416f121d05e3010ae

commit 4acfaabfae41badb9d334a2ee88c5c6ad041c0d5
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Dec 16 06:52:48 2022 +0000

    upstream: add -X to usage();
    
    OpenBSD-Commit-ID: 1bdc3df7de11d766587b0428318336dbffe4a9d0

commit e555d5cad5afae7d5ef2bbc02ca591178fe16fed
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Dec 16 03:40:03 2022 +0000

    upstream: add a -X option to both scp(1) and sftp(1) to allow
    
    control over some SFTP protocol knobs: the copy buffer length and
    the number of inflight requests, both of which are used during
    upload/download.
    
    Previously these could be controlled in sftp(1) using the -b/-R options.
    This makes them available in both SFTP protocol clients using the same
    option character sequence.
    
    ok dtucker@
    
    OpenBSD-Commit-ID: 27502bffc589776f5da1f31df8cb51abe9a15f1c

commit 5a7a7acab2f466dc1d7467b5d05d35268c3137aa
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Thu Dec 15 18:20:39 2022 +0000

    upstream: The idiomatic way of coping with signed char vs unsigned
    
    char (which did not come from stdio read functions) in the presence of
    ctype macros, is to always cast to (unsigned char).  casting to (int)
    for a "macro" which is documented to take int, is weird.  And sadly wrong,
    because of the sing extension risk.. same diff from florian
    
    OpenBSD-Commit-ID: 65b9a49a68e22ff3a0ebd593f363e9f22dd73fea

commit b0b58222c7cc62efd8212c4fb65a545f58ebb22d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Dec 19 18:49:51 2022 +1100

    Simply handling of SSH_CONNECTION PAM env var.
    
    Prompted by bz#3508: there's no need to cache the value of
    sshpam_conninfo so remove the global.  While there, add check of
    return value from pam_putenv.  ok djm@

commit ed8444572ae684fdb892f97bae342c6cb6456f04
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Dec 19 18:42:34 2022 +1100

    Add tests for LibreSSL 3.7.0 and OpenSSL 1.1.1s.

commit abb9a8aaddfcacbd12641f6e4f203da0fa85a287
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Dec 18 21:36:25 2022 +1100

    Use sudo when resetting perms on directories.

commit 2f5664c5908d84697cbe91302d5d5c4d83cb2121
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Dec 18 21:19:33 2022 +1100

    Set group perms on regress dir.
    
    This ensures that the tests don't fail due to StrictMode checks.

commit 137196300fc1540affadde880210f02ba6cb4abf
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Dec 18 21:13:42 2022 +1100

    Fetch regress logs from obj dir.

commit 5f93c4836527d9fda05de8944a1c7b4a205080c7
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Dec 13 20:59:54 2022 +1100

    obsdsnap test VMs runs-on libvirt too.

commit 8386886fb1ab7fda73069fb0db1dbe0e5a52f758
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Dec 13 20:55:37 2022 +1100

    Run upstream obsdsnap tests on ephemeral runners.

commit b6e01459b55ece85d7f296b2bc719d1841e1009e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Dec 13 20:48:56 2022 +1100

    Move obsdsnap test VMs to ephemeral runners.

commit ea6fdf9a1aa71a411f7db218a986392c4fb55693
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Dec 9 18:00:21 2022 +1100

    use calloc for allocating arc4random structs
    
    ok dtucker

commit 4403b62f5548e91389cb3339d26a9d0c4bb07b34
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Dec 9 00:22:29 2022 +0000

    upstream: Warn if no host keys for hostbased auth can be loaded.
    
    OpenBSD-Commit-ID: 2a0a13132000cf8d3593133c1b49768aa3c95977

commit a6183e25e3f1842e21999fe88bc40bb99b121dc3
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Dec 9 00:17:40 2022 +0000

    upstream: Add server debugging for hostbased auth.
    
    auth_debug_add queues messages about the auth process which is sent to
    the client after successful authentication.  This also sends those to
    the server debug log to aid in debugging.  From bz#3507, ok djm@
    
    OpenBSD-Commit-ID: 46ff67518cccf9caf47e06393e2a121ee5aa258a

commit b85c3581c16aaf6e83b9a797c80705a56b1f312e
Author: cheloha@openbsd.org <cheloha@openbsd.org>
Date:   Sun Dec 4 23:50:49 2022 +0000

    upstream: remove '?' from getopt(3) loops
    
    userspace: remove vestigial '?' cases from top-level getopt(3) loops
    
    getopt(3) returns '?' when it encounters a flag not present in the in
    the optstring or if a flag is missing its option argument.  We can
    handle this case with the "default" failure case with no loss of
    legibility.  Hence, remove all the redundant "case '?':" lines.
    
    Prompted by dlg@.  With help from dlg@ and millert@.
    
    Link: https://marc.info/?l=openbsd-tech&m=167011979726449&w=2
    
    ok naddy@ millert@ dlg@
    
    OpenBSD-Commit-ID: b2f89346538ce4f5b33ab8011a23e0626a67e66e

commit 9a067e8d28a2249fd73f004961e30c113ee85e5d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Dec 7 11:45:43 2022 +0000

    upstream: Fix comment typo.
    
    OpenBSD-Regress-ID: 3b04faced6511bb5e74648c6a4ef4bf2c4decf03

commit ce3c3e78ce45d68a82c7c8dc89895f297a67f225
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Dec 7 18:58:25 2022 +1100

    Add SANDBOX_DEBUG to the kitchensink test build.

commit bc234605fa3eb10f56bf0d74c8ecb0d91ada9d05
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Dec 7 18:38:25 2022 +1100

    disable SANDBOX_SECCOMP_FILTER_DEBUG
    
    It was mistakenly enabled in 2580916e4872
    
    Reported by Peter sec-openssh-com.22.fichtner AT 0sg.net

commit b087c5cfa011b27992e01589314fec830266f99d
Author: Rose <83477269+AtariDreams@users.noreply.github.com>
Date:   Tue Nov 29 15:12:54 2022 -0500

    Update autotools
    
    Regenerate config files using latest autotools

commit d63f5494978a185c7421d492b9c2f6f05bb54138
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Dec 6 12:22:36 2022 +1100

    Fix typo in comment.  Spotted by tim@

commit 73dcca12115aa12ed0d123b914d473c384e52651
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Dec 4 11:03:11 2022 +0000

    upstream: Remove duplicate includes.
    
     Patch from AtariDreams via github PR#364.
    
    OpenBSD-Commit-ID: b9186638a05cb8b56ef7c0de521922b6723644ea

commit 3cec15543010bc8d6997d896b1717a650afb7e92
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Dec 2 04:40:27 2022 +0000

    upstream: make struct sshbuf private
    
    and remove an unused field; ok dtucker
    
    OpenBSD-Commit-ID: c7a3d77c0b8c153d463398606a8d57569186a0c3

commit 5796bf8ca9535f9fa7d01829a540d2550e05c860
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Dec 2 11:43:36 2022 +1100

    Restore ssh-agent permissions on exit.
    
    ...enough that subsequent builds can overwrite ssh-agent if necessary.

commit ccf5a13868cbb4659107458cac1e017c98abcbda
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Dec 1 02:22:13 2022 +0000

    upstream: Clean up ssh-add and ssh-agent logs.
    
    OpenBSD-Regress-ID: 9eda8e4c3714d7f943ab2e73ed58a233bd29cd2c

commit 7a8b40cf6a5eda80173140cc6750a6db8412fa87
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Dec 1 02:19:29 2022 +0000

    upstream: Log output of ssh-agent and ssh-add
    
    This should  make debugging easier.
    
    OpenBSD-Regress-ID: 5974b02651f428d7e1079b41304c498ca7e306c8

commit 4a1805d532616233dd6072e5cd273b96dd3062e6
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Nov 29 22:41:14 2022 +0000

    upstream: Add void to client_repledge args to fix compiler warning. ok djm@
    
    OpenBSD-Commit-ID: 7e964a641ce4a0a0a11f047953b29929d7a4b866

commit 815c4704930aa449edf6e812e99d69e9ffd31f01
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Nov 28 01:38:22 2022 +0000

    upstream: tighten pledge(2) after session establishment
    
    feedback, ok & testing in snaps deraadt@
    
    OpenBSD-Commit-ID: aecf4d49d28586dfbcc74328d9333398fef9eb58

commit f7cebbbf407d772ed71403d314343766782fe540
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Nov 28 01:37:36 2022 +0000

    upstream: New EnableEscapeCommandline ssh_config(5) option
    
    This option (default "no") controls whether the ~C escape is available.
    Turning it off by default means we will soon be able to use a stricter
    default pledge(2) in the client.
    
    feedback deraadt@ dtucker@; tested in snaps for a while
    
    OpenBSD-Commit-ID: 7e277595d60acb8263118dcb66554472257b387a

commit d323f7ecf52e3d4ec1f4939bf31693e02f891dca
Author: mbuhl@openbsd.org <mbuhl@openbsd.org>
Date:   Fri Nov 18 19:47:40 2022 +0000

    upstream: In channel_request_remote_forwarding the parameters for
    
    permission_set_add are leaked as they are also duplicated in the call. Found
    by CodeChecker. ok djm
    
    OpenBSD-Commit-ID: 4aef50fa9be7c0b138188814c8fe3dccc196f61e

commit 62cc33e6eed847aafdc29e34aa69e9bd82a0ee16
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 30 11:23:11 2022 +1100

    Use -fzero-call-used-regs=used on clang 15.
    
    clang 15 seems to have a problem with -fzero-call-used-reg=all which
    causes spurious "incorrect signature" failures with ED25519.  On those
    versions, use -fzero-call-used-regs=used instead.  (We may add exceptions
    later if specific versions prove to be OK).  Also move the GCC version
    check to match.
    
    Initial investigation by Daniel Pouzzner (douzzer at mega nu), workaround
    suggested by Bill Wendling (morbo at google com).  bz#3475, ok djm@

commit f84b9cffd52c9c5c359a54a1929f9948e803ab1d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 28 21:09:28 2022 +1100

    Skip unit tests on slow riscv64 hardware.

commit 9f2747e0bed3faca92679eae69aef10c95dc82f5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 27 15:26:22 2022 +1100

    Rework how selfhosted tests interact with runners.
    
    Previously there was one runner per test target (mostly VMs).  This had
    a few limitations:
     - multiple tests that ran on the same target (eg multiple build
       configs) were serialized on availability or that runner.
     - it needed manual balancing of VMs over host machines.
    
    To address this, make VMs that use ephemeral disks (ie most of them)
    all use a pool of runners with the "libvirt" label.  This requires that
    we distinguish between "host" and "target" for those.  Native runners
    and VMs with persistent disks (eg the constantly-updated snapshot ones)
    specify the same host and target.
    
    This should improve test throughput.

commit d664ddaec87bdc7385be8ef7f1337793e1679d48
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 27 12:19:37 2022 +1100

    Run vmstartup from temp dir.
    
    This will allow us to create ephemeral disk images per-runner.

commit 0fa16e952b1fc1c4cf65e3dd138b0e87003e2e45
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 27 12:14:00 2022 +1100

    Make "config" in matrix singular and pass in env.
    
    This will allow the startup scripts to adapt their behaviour based on
    the type and config.

commit e8857043af54809187be1e8b06749db61112899f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 27 11:42:22 2022 +1100

    Add "libvirt" label to dfly30.

commit 9775473d84902dc37753686cd10ae71fbe67efda
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 27 09:28:20 2022 +1100

    Rename "os" in matrix to "target".
    
    This is in preparation to distinguish this from the host that the runner
    runs on in case where they are separate (eg VMs).

commit 04fd00ceff39f4544ced6f5342060abe584835d0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 27 09:23:04 2022 +1100

    Remove unused self-hosted test targets.

commit c9d9fcad2a11c1cd1550a541f44091d65f0b5584
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 27 09:16:15 2022 +1100

    Remove explicit "default" test config argument.
    
    Not specifying the test config implicitly selects default args.

commit 15a01cf15f396f87c6d221c5a6af98331c818962
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 23 13:18:54 2022 +1100

    Add fallback for old platforms w/out MAP_ANON.

commit 6b9bbbfe8b26db6e9a30a7e08c223e85421aed98
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 23 13:09:11 2022 +1100

    If we haven't found it yet, recheck for sys/stat.h.
    
    On some very old platforms, sys/stat.h needs sys/types.h, however
    autoconf 2.71's AC_CHECK_INCLUDES_DEFAULT checks for them in the
    opposite order, which in combination with modern autoconf's
    "present but cannot be compiled" behaviour causes it to not be
    detected.

commit 8926956f22639132a9f2433fcd25224e01b900f5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Nov 11 11:25:37 2022 +1100

    Add dfly62 test target.

commit 650de7ecd3567b5a5dbf16dd1eb598bd8c20bca8
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Nov 10 23:03:10 2022 +0000

    upstream: Handle dynamic remote port forwarding in escape commandline's
    
    -R processing. bz#3499, ok djm@
    
    OpenBSD-Commit-ID: 194ee4cfe7ed0e2b8ad0727f493c798a50454208

commit 5372db7e7985ba2c00f20fdff8942145ca99e033
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 10 12:44:51 2022 +1100

    Remove seed passing over reexec.
    
    This was added for the benefit of platforms using ssh-rand-helper to
    prevent a delay on each connection as sshd reseeded itself.
    
    ssh-random-helper is long gone, and since the re-exec happens before the
    chroot the re-execed sshd can reseed itself normally. ok djm@

commit ca98d3f8c64cfc51af81e1b01c36a919d5947ec2
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 9 20:59:20 2022 +1100

    Skip reexec test on OpenSSL 1.1.1 specifically.
    
    OpenSSL 1.1.1 has a bug in its RNG that breaks reexec fallback, so skip
    that test.  See bz#3483 for details.

commit 5ec4ebc2548e5f7f1b55b2a5cef5b67bdca8146f
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Nov 9 09:04:12 2022 +0000

    upstream: Fix typo in fatal error message.
    
    Patch from vapier at chromium.org.
    
    OpenBSD-Commit-ID: 8a0c164a6a25eef0eedfc30df95bfa27644e35cf

commit e6abafe9a6d809422d3432b95b3f9747b0acaa71
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Nov 9 09:01:52 2022 +0000

    upstream: Remove errant colon and simplify format
    
    string in error messages. Patch from vapier at chromium.org.
    
    OpenBSD-Commit-ID: fc28466ebc7b74e0072331947a89bdd239c160d3

commit db2027a687516f87c3fb141e87154bb3d8a7807c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Nov 9 01:37:44 2022 +0000

    upstream: rename client_global_hostkeys_private_confirm() to
    
    client_global_hostkeys_prove_confirm(), as it handles the
    "hostkeys-prove00@openssh.com" message; no functional change
    
    OpenBSD-Commit-ID: 31e09bd3cca6eed26855b88fb8beed18e9bd026d

commit 1c2be7c2004cf1abcd172fee9fe3eab57cd4c426
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Nov 9 00:15:59 2022 +0000

    upstream: typo in comment
    
    OpenBSD-Commit-ID: 39c58f41e0f32d1ff31731fa6f5bbbc3ad25084a

commit cf1a9852d7fc93e4abc4168aed09529a57427cdc
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 9 09:23:47 2022 +1100

    Defer seed_rng until after closefrom call.
    
    seed_rng will initialize OpenSSL, and some engine providers (eg Intel's
    QAT) will open descriptors for their own use.  bz#3483, patch from
    joel.d.schuetze at intel.com, ok djm@

commit dffa64480163fbf76af7e4fb62c26bb0dd6642aa
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 9 08:27:47 2022 +1100

    Fix comment text.  From emaste at freebsd.org.

commit d9df5689c29823ab830ec4f54c83c6cc3c0077ad
Author: Pierre Ossman <ossman@cendio.se>
Date:   Wed Jul 6 13:52:10 2022 +0200

    Avoid assuming layout of fd_set
    
    POSIX doesn't specify the internal layout of the fd_set object, so let's
    not assume it is just a bit mask. This increases compatibility with
    systems that have a different layout.
    
    The assumption is also worthless as we already refuse to use file
    descriptors over FD_SETSIZE anyway. Meaning that the default size of
    fd_set is quite sufficient.

commit 419aa8a312e8d8f491933ca3d5933e602cb05aae
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Nov 8 12:42:52 2022 +1100

    Shutdown any VM before trying to check out repo.
    
    In the case where the previous run did not clean up, the checkout will
    fail as it'll leave a stale mount.

commit a32c07cbb78f65d8527642b96474a83b413f8108
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Nov 8 11:33:25 2022 +1100

    Run vm startup and shutdown from runner temp dir.
    
    Should work even if the github workspace dir is on a stale sshfs mount.

commit 2b40a7dfcdb8e616155b9504145aa52b271455aa
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Nov 8 11:03:31 2022 +1100

    Add valrind-5 test here too.

commit 2ea03d1f6d0a05ee2b63ed2dc0f2d54f1e4655a1
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Nov 8 09:21:10 2022 +1100

    Update checkout and upload actions.
    
    Update actions/checkout and actions/upload-artifact to main branch for
    compatibility with node.js v16.

commit 4e316ff0f18a118232bb9ac6512ee62773a9e8ea
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Nov 8 09:17:04 2022 +1100

    Split out rekey test since it runs the longest.

commit 21625a6424258a92a96a3bb73ae6aabc5ed8a6b4
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Nov 7 10:09:28 2022 +0000

    upstream: The IdentityFile option in ssh_config can also be used to
    
    specify a public key file, as documented in ssh.1 for the -i option. Document
    this also for IdentityFile in ssh_config.5, for documentation completeness.
    From laalsaas at systemli.org via portable github PR#352, ok jmc@ djm@
    
    OpenBSD-Commit-ID: 2f943be9f96e60ef81a9a4faa25b009999f9883b

commit 747691604d3325ed2b62bad85b6fd8563ad32f6c
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Nov 7 10:05:38 2022 +0000

    upstream: Remove some set but otherwise unused variables, spotted
    
    in -portable by clang 16's -Wunused-but-set-variable.  ok djm@
    
    OpenBSD-Commit-ID: 3d943ddf2369b38fbf89f5f19728e7dc1daf3982

commit 1d78d25653805aefc7a8dd9d86cd7359ada3823c
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Nov 7 10:02:59 2022 +0000

    upstream: Check for and disallow MaxStartups values less than or
    
    equal to zero during config parsing, rather than faling later at runtime.
    bz#3489, ok djm@
    
    OpenBSD-Commit-ID: d79c2b7a8601eb9be493629a91245d761154308b

commit a00f59a645072e5f5a8d207af15916a7b23e2642
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Nov 7 04:04:40 2022 +0000

    upstream: fix parsing of hex cert expiry time; was checking whether the
    
    start time began with "0x", not the expiry time.
    
    from Ed Maste
    
    OpenBSD-Commit-ID: 6269242c3e1a130b47c92cfca4d661df15f05739

commit f58acaf8c7315483f4ac87d46a1aa2142a713cd8
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 7 15:10:59 2022 +1100

    Fix merge conflict.

commit 162e5741020a8d996c0c12b988b118e71ed728e6
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 7 15:04:33 2022 +1100

    Branch-specific links for master status badges.

commit e4b7c12ab24579312aa3ed38ce7041a439ec2d56
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 7 14:46:38 2022 +1100

    Add CIFuzz status badge.

commit b496b9f831acd1e5bcd875e26e797488beef494a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 7 14:45:16 2022 +1100

    Do not run CIFuzz on selfhosted tree.
    
    We already run it on the regular tree, no need to double up.

commit 2138b1c4ddb300129a41a5104627b0d561184c7b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 7 14:41:58 2022 +1100

    Whitespace change to trigger CIFuzz workflow.

commit 4670b97ef87c7b0f21283c9b07c7191be88dda05
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 7 14:34:04 2022 +1100

    Run cifuzz workflow on the actions as regular CI.

commit 79391e66ce851ace1baf3c6a35e83a23f08ec2ba
Author: David Korczynski <david@adalogics.com>
Date:   Tue Nov 30 11:45:20 2021 +0000

    Add CIFuzz integration

commit c1893364a0be243270014d7d34362a8101d55112
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Nov 7 02:21:22 2022 +0000

    upstream: Import regenerated moduli.
    
    OpenBSD-Commit-ID: b0e54ee4d703bd6929bbc624068666a7a42ecb1f

commit 5c3f18fb994ef27e685b205ee2351851b80fdbd1
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Nov 7 01:53:01 2022 +0000

    upstream: Fix typo. From pablomh via -portable github PR#344.
    
    OpenBSD-Commit-ID: d056ee2e73691dc3ecdb44a6de68e6b88cd93827

commit e1c6fcc142066417c9832e634463faa3dd5d116c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 7 12:46:58 2022 +1100

    Link to branch-specific queries for V_9_1 status.

commit 4f4a5fad6d8892c3f8ee9cd81ec7de6458210c9f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 6 10:55:59 2022 +1100

    Use "prohibit-password" in -portable comments.
    
    "without-password" is the deprecated alias for "prohibit-password",
    so we should reference the latter. From emaste at freebsd.org.

commit 0f7e1eba55259ec037f515000b4c4afbf446230a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 6 10:50:01 2022 +1100

    Fix tracing disable on FreeBSD.
    
    Some versions of FreeBSD do not support using id 0 to refer to the
    current pid for procctl, so pass getpid() explicitly.  From
    emaste at freebsd.org.

commit 32fddb982fd61b11a2f218a115975a87ab126d43
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 7 10:39:01 2022 +1100

    Fix setres*id checks to work with clang-16.
    
    glibc has the prototypes for setresuid and setresgid behind _GNU_SOURCE,
    and clang 16 will error out on implicit function definitions, so add
    _GNU_SOURCE and the required headers to the configure checks.  From
    sam at @gentoo.org via bz#3497.

commit 12af712d116f42164bcfa56db901d06e4fa27199
Author: Sam James <sam@gentoo.org>
Date:   Sun Nov 6 04:52:38 2022 +0000

    configure.ac: Fix -Wstrict-prototypes
    
    Clang 16 now warns on this and it'll be removed in C23, so let's
    just be future proof. It also reduces noise when doing general
    Clang 16 porting work (which is a big job as it is).  github PR#355.
    
    Signed-off-by: Sam James <sam@gentoo.org>

commit 40b0a5eb6e3edfa2886b60c09c7803353b0cc7f5
Author: Sam James <sam@gentoo.org>
Date:   Sun Nov 6 04:47:35 2022 +0000

    configure.ac: Add <pty.h> include for openpty
    
    Another Clang 16ish fix (which makes -Wimplicit-function-declaration
    an error by default).  github PR#355.
    
    See: 2efd71da49b9cfeab7987058cf5919e473ff466b
    See: be197635329feb839865fdc738e34e24afd1fca8

commit 6b17e128879ec6cc32ca2c28b5d894b4aa72e32d
Author: Rochdi Nassah <rochdinassah.1998@gmail.com>
Date:   Fri Oct 28 01:26:31 2022 +0100

    Fix broken zlib link.

commit 99500df246ccb736ddbdd04160dcc82165d81a77
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Nov 4 16:59:26 2022 +1100

    Don't run openbsd-compat tests on Cygwin.
    
    Add "compat-tests" to the default TEST_TARGET so we can override as
    necessary.  Override TEST_TARGET for Cygwin as the tests don't currently
    compile there.

commit 3cae9f92a31897409666aa1e6f696f779759332b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 3 21:59:20 2022 +0000

    upstream: replace recently-added valid_domain() check for hostnames
    
    going to known_hosts with a more relaxed check for bad characters; previous
    commit broke address literals. Reported by/feedback from florian@
    
    OpenBSD-Commit-ID: 10b86dc6a4b206adaa0c11b58b6d5933898d43e0

commit 9655217231c9056200bea7ae2dffcc9c0c3eb265
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 3 23:07:50 2022 +1100

    Rerun tests on changes to Makefile.in in any dir.

commit 3500f0405a3ab16b59a26f3508c4257a3fc3bce6
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 3 23:04:08 2022 +1100

    Link libssh into compat tests.
    
    The cygwin compat code uses xmalloc, so add libssh.a so pick up that.

commit ec59effcf65b8a4c85d47ff5a271123259dd0ab8
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 3 21:44:23 2022 +1100

    Fix compat regress to work with non-GNU make.

commit 73550a218e7dfbbd599534cbf856309bc924f6fd
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 3 13:41:16 2022 +1100

    Increase selfhosted job timeout.
    
    The default job timeout of 360 (6h) is not enough to complete the
    regress tests for some of the slow VMs depending on the load on the host.
    Increase to 600 (10h).

commit db97d8d0b90c6ce52b94b153d6f8f5f7d3b11777
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 3 10:00:43 2022 +1100

    Only run opensslver tests if built with OpenSSL.

commit ba053709638dff2f6603df0c1f340352261d63ea
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 2 14:16:04 2022 +1100

    Add tests for OpenSSL 3.0.7 and LibreSSL 3.6.1.

commit edd24101c7e17d1a8f6576e1aaf62233b47ad6f5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 3 08:17:39 2022 +1100

    Run compat regress tests too.

commit fe88d67e7599b0bc73f6e4524add28d743e7f977
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 3 08:14:05 2022 +1100

    Compat tests need libcrypto.
    
    This was moved to CHANNELLIBS during the libs refactor.  Spotted by
    rapier at psc.edu.

commit 96b519726b7944eee3c23a54eee3d5c031ba1533
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 3 04:24:39 2022 +1100

    Include time.h when defining timegm.
    
    Fixes build on some platforms eg recent AIX.

commit da6038bd5cd55eb212eb2aec1fc8ae79bbf76156
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Nov 1 19:10:30 2022 +1100

    Always use compat getentropy.
    
    Have it call native getentropy and fall back as required.  Should fix
    issues of platforms where libc has getentropy but it is not implemented
    in the kernel.  Based on github PR#354 from simsergey.

commit 5ebe18cab6be3247b44c807ac145164010465b82
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 2 10:51:48 2022 +1100

    Check for sockaddr_in.sin_len.
    
    If found, set SOCK_HAS_LEN which is used in addr.c.  Should fix keyscan
    tests on platforms with this (eg old NetBSD).

commit a1febadf426536612c2734168d409147c392e7cf
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Oct 30 18:42:07 2022 +0000

    upstream: Use variable for diff options
    
    instead of unconditionally specifying "-rN". This will make life easier
    in -portable where not all diff's understand -N.
    
    OpenBSD-Regress-ID: 8b8a407115546be1c6d72d350b1e4f1f960d3cd3

commit f6d3ed9a8a9280cbb68d6a499850cfe810e92bd0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Oct 31 05:13:02 2022 +1100

    OpenSSL dev branch is 302 not 320.
    
    While there, also accept 301 which it shat it was previously.

commit 25c8a2bbcc10c493d27faea57c42a6bf13fa51f2
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 02:47:04 2022 +0000

    upstream: put sshkey_check_rsa_length() back in sshkey.c to unbreak
    
    OPENSSL=no builds
    
    OpenBSD-Commit-ID: 99eec58abe382ecd14b14043b195ee1babb9cf6e

commit 1192588546c29ceec10775125f396555ea71850f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 02:29:34 2022 +0000

    upstream: allow ssh-keyscan(1) to accept CIDR address ranges, e.g.
    
    ssh-keyscan 192.168.0.0/24
    
    If a CIDR range is passed, then it will be expanded to all possible
    addresses in the range including the all-0s and all-1s addresses.
    
    bz#976 feedback/ok markus@
    
    OpenBSD-Commit-ID: ce6c5211f936ac0053fd4a2ddb415277931e6c4b

commit 64af4209309461c79c39eda2d13f9d77816c6398
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Oct 28 12:54:35 2022 +1100

    fix merge botch

commit 27267642699342412964aa785b98afd69d952c88
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:44:44 2022 +0000

    upstream: refactor sshkey_private_deserialize
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: f5ca6932fdaf840a5e8250becb38315a29b5fc9f

commit 2519a7077a9332f70935e5242ba91ee670ed6b87
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:44:17 2022 +0000

    upstream: refactor sshkey_private_serialize_opt()
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: 61e0fe989897901294efe7c3b6d670cefaf44cbd

commit 11a768adf98371fe4e43f3b06014024c033385d5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:43:30 2022 +0000

    upstream: refactor certify
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: 35d742992e223eaca3537e6fb3d3002c08eed4f6

commit 3fbc58bb249d967cc43ebdc554f6781bb73d4a58
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:43:08 2022 +0000

    upstream: refactor sshkey_sign() and sshkey_verify()
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: 368e662c128c99d05cc043b1308d2b6c71a4d3cc

commit a1deb6cdbbe6afaab74ecb08fcb62db5739267be
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:41:52 2022 +0000

    upstream: refactor sshkey_from_blob_internal()
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: 1f46c0cbb8060ee9666a02749594ad6658c8e283

commit 7d00799c935271ce89300494c5677190779f6453
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:41:17 2022 +0000

    upstream: refactor sshkey_from_private()
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: e5dbe7a3545930c50f70ee75c867a1e08b382b53

commit 262647c2e920492ca57f1b9320d74f4a0f6e482b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:39:29 2022 +0000

    upstream: factor out key generation
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: 5b4211bff4de8d9adb84bc72857a8c42c44e7ceb

commit 401c74e7dc15eab60540653d2f94d9306a927bab
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:38:58 2022 +0000

    upstream: refactor and simplify sshkey_read()
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: 0d93b7a56e31cd06a8bb0d2191d084ce254b0971

commit 591fed94e66a016acf87f4b7cd416ce812f2abe8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:37:24 2022 +0000

    upstream: factor out public key serialization
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: a3570c4b97290c5662890aea7328d87f55939033

commit 1e78844ae2b2dc01ba735d5ae740904c57e13685
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:36:31 2022 +0000

    upstream: factor out sshkey_equal_public()
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: 1368ba114cb37732fe6ec3d89c7e6d27ea6fdc94

commit 25de1c01a8b9a2c8ab9b1da22444a03e89c982de
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 28 00:35:40 2022 +0000

    upstream: begin big refactor of sshkey
    
    Move keytype data and some of the type-specific code (allocation,
    cleanup, etc) out into each key type's implementation. Subsequent
    commits will move more, with the goal of having each key-*.c file
    owning as much of its keytype's implementation as possible.
    
    lots of feedback + ok markus@
    
    OpenBSD-Commit-ID: 0f2b4334f73914344e9e5b3d33522d41762a57ec

commit 445363433ba20b8a3e655b113858c836da46a1cb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Oct 24 22:43:36 2022 +0000

    upstream: Be more paranoid with host/domain names coming from the
    
    never write a name with bad characters to a known_hosts file.
    
    reported by David Leadbeater, ok deraadt@
    
    OpenBSD-Commit-ID: ba9b25fa8b5490b49398471e0c9657b0cbc7a5ad

commit 7190154de2c9fe135f0cc1ad349cb2fa45152b89
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Oct 24 21:52:50 2022 +0000

    upstream: regress test for unmatched glob characters; fails before
    
    previous commit but passes now. bz3488; prodded by dtucker@
    
    OpenBSD-Regress-ID: 0cc5cc9ea4a6fd170dc61b9212f15badaafb3bbd

commit a4821a592456c3add3cd325db433110cdaaa3e5c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Oct 24 21:51:55 2022 +0000

    upstream: when scp(1) is using the SFTP protocol for transport (the
    
    default), better match scp/rcp's handling of globs that don't match the
    globbed characters but do match literally (e.g. trying to transfer
    "foo.[1]").
    
    Previously scp(1) in SFTP mode would not match these pathnames but
    legacy scp/rcp mode would.
    
    Reported by Michael Yagliyan in bz3488; ok dtucker@
    
    OpenBSD-Commit-ID: d8a3773f53015ba811fddba7473769a2fd343e11

commit 18376847b8043ba967eabbe23692ef74c9a3fddc
Author: jsg@openbsd.org <jsg@openbsd.org>
Date:   Thu Oct 13 09:09:28 2022 +0000

    upstream: use correct type with sizeof ok djm@
    
    OpenBSD-Commit-ID: d6c882c2e8a42ff831a5b3cbc2c961ecb2dd6143

commit 4a4883664d6b4e9e4e459a8cdc16bd8d4b735de9
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Oct 7 06:00:58 2022 +0000

    upstream: ssh-agent.1: - use Nm not Xr for self-ref - while here,
    
    wrap a long line
    
    ssh-agent.c:
    - add -O to usage()
    
    OpenBSD-Commit-ID: 855dac4695cef22e96d69c53436496bc408ca389

commit 9fd2441113fce2a83fc7470968c3b27809cc7f10
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 7 04:06:26 2022 +0000

    upstream: document "-O no-restrict-websafe"; spotted by Ross L
    
    Richardson
    
    OpenBSD-Commit-ID: fe9eaa50237693a14ebe5b5614bf32a02145fe8b

commit 614252b05d70f798a0929b1cd3d213030ad4d007
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Oct 18 06:29:16 2022 +1100

    OpenSSL dev branch now identifies as 3.2.0.

commit 195e5a65fd793a738ea8451ebfdd1919db5aff3e
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Oct 17 09:41:47 2022 +1100

    revert c64b62338b4 and guard POLL* defines instead
    
    c64b62338b4 broke OSX builds, which do have poll.h but lack ppoll(2)
    Spotted by dtucker

commit bc2e480d99613bd59720edae244d1764636544c4
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Oct 14 14:52:22 2022 +1100

    undef _get{short,long} before redefining

commit 5eb796a369c64f18d55a6ae9b1fa9b35eea237fb
Author: Harmen Stoppels <harmenstoppels@gmail.com>
Date:   Thu Oct 13 16:08:46 2022 +0200

    Fix snprintf configure test for clang 15
    
    Clang 15 -Wimplicit-int defaults to an error in C99 mode and above.
    A handful of tests have "main(..." and not "int main(..." which caused
    the tests to produce incorrect results.

commit c64b62338b46ffa08839f05f21ad69fa6234dc17
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Oct 10 12:32:43 2022 +1100

    skip bsd-poll.h if poll.h found; ok dtucker

commit 5ee2b8ccfcf4b606f450eb0ff2305e311f68b0be
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Oct 6 22:42:37 2022 +0000

    upstream: honour user's umask if it is more restrictive then the ssh
    
    default (022); based on patch from Alex Henrie, ok dtucker@ deraadt@
    
    OpenBSD-Commit-ID: fe1b9e15fc9a4f49fc338e848ce14d8727abe82d

commit a75cffc2700cebd3e2dd9093f7f7388d2be95cb7
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Oct 7 03:54:56 2022 +1100

    Add LibreSSL 3.6.0 to test suite.
    
    While there, bump OpenSSL to latest 1.1.1q release.

commit fcc0f0c0e96a30076683fea9a7c9eedc72931742
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Oct 6 21:18:16 2022 +1100

    Add 9.1 branch to CI status page.

commit ef211eee63821d894a8bf81f22bfba9f6899d0fe
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Oct 4 23:20:23 2022 +1100

    Test commits to all branches of portable.
    
    Only test OpenBSD upstream on commits to master since that's what it
    tracks.

commit fe646de03cafb6593ff4e4954bca9ec4b4b753a8
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Oct 5 03:47:26 2022 +1100

    whitespace at EOL

commit a6e1852d10c63a830196e82168dadd957aaf28ec
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Oct 5 03:40:01 2022 +1100

    mention libfido2 autodetection

commit 7360c2c206f33d309edbaf64036c96fadf74d640
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Oct 5 03:37:36 2022 +1100

    remove mention of --with-security-key-builtin
    
    it is enabled by default when libfido2 is installed

commit 0ffb46f2ee2ffcc4daf45ee679e484da8fcf338c
Author: Damien Miller <djm@mindrot.org>
Date:   Tue Oct 4 01:51:42 2022 +1100

    update .depend

commit 657e676ff696c7bb787bffb0e249ea1be3b474e1
Author: Damien Miller <djm@mindrot.org>
Date:   Tue Oct 4 01:45:52 2022 +1100

    update release notes URL

commit f059da2b29840c0f048448809c317ce2ae014da7
Author: Damien Miller <djm@mindrot.org>
Date:   Tue Oct 4 01:45:41 2022 +1100

    crank versions in RPM spec files

commit b51f3f172d87cbdb80ca4eb7b2149e56a7647557
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 26 22:18:40 2022 +0000

    upstream: openssh-9.1
    
    OpenBSD-Commit-ID: 5a467b2ee81da01a86adf1ad93b62b1728494e56

commit 4cf8d0c0f3030f594a238bab21a0695735515487
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Sep 21 22:26:50 2022 +0000

    upstream: Fix typo. From AlexanderStohr via github PR#343.
    
    OpenBSD-Commit-ID: a134c9b4039e48803fc6a87f955b0f4a03181497

commit 8179fed3264d5919899900ed8881d5f9bb57ca33
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 19 21:39:16 2022 +0000

    upstream: add RequiredRSASize to the list of keywords accepted by
    
    -o; spotted by jmc@
    
    OpenBSD-Commit-ID: fe871408cf6f9d3699afeda876f8adbac86a035e

commit 5f954929e9f173dd1e279e07d0e8b14fa845814d
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Sep 19 20:59:34 2022 +1000

    no need for glob.h here
    
    it also causes portability problems

commit 03d94a47207d58b3db37eba4f87eb6ae5a63168a
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Sep 19 20:59:04 2022 +1000

    avoid Wuninitialized false positive in gcc-12ish

commit 9d952529113831fb3071ab6e408d2726fd72e771
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 19 10:46:00 2022 +0000

    upstream: use users-groups-by-id@openssh.com sftp-server extension
    
    (when available) to fill in user/group names for directory listings.
    Implement a client-side cache of see uid/gid=>user/group names. ok markus@
    
    OpenBSD-Commit-ID: f239aeeadfa925a37ceee36ee8b256b8ccf4466e

commit 8ff680368b0bccf88ae85d4c99de69387fbad7a6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 19 10:43:12 2022 +0000

    upstream: sftp client library support for
    
    users-groups-by-id@openssh.com; ok markus@
    
    OpenBSD-Commit-ID: ddb2f33a2da6349a9a89a8b5bcb9ca7c999394de

commit 488f6e1c582212c2374a4bf8cd1b703d2e70fb8b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 19 10:41:58 2022 +0000

    upstream: extend sftp-common.c:extend ls_file() to support supplied
    
    user/group names; ok markus@
    
    OpenBSD-Commit-ID: c70c70498b1fdcf158531117e405b6245863bfb0

commit 74b77f7497dba3a58315c8f308883de448078057
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 19 10:40:52 2022 +0000

    upstream: sftp-server(8): add a "users-groups-by-id@openssh.com"
    
    extension request that allows the client to obtain user/group names that
    correspond to a set of uids/gids.
    
    Will be used to make directory listings more useful and consistent
    in sftp(1).
    
    ok markus@
    
    OpenBSD-Commit-ID: 7ebabde0bcb95ef949c4840fe89e697e30df47d3

commit 231a346c0c67cc7ca098360f9a554fa7d4f1eddb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 19 08:49:50 2022 +0000

    upstream: better debugging for connect_next()
    
    OpenBSD-Commit-ID: d16a307a0711499c971807f324484ed3a6036640

commit 1875042c52a3b950ae5963c9ca3774a4cc7f0380
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Sep 17 10:34:29 2022 +0000

    upstream: Add RequiredRSASize for sshd(8); RSA keys that fall
    
    beneath this limit will be ignored for user and host-based authentication.
    
    Feedback deraadt@ ok markus@
    
    OpenBSD-Commit-ID: 187931dfc19d51873df5930a04f2d972adf1f7f1

commit 54b333d12e55e6560b328c737d514ff3511f1afd
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Sep 17 10:33:18 2022 +0000

    upstream: add a RequiredRSASize for checking RSA key length in
    
    ssh(1). User authentication keys that fall beneath this limit will be
    ignored. If a host presents a host key beneath this limit then the connection
    will be terminated (unfortunately there are no fallbacks in the protocol for
    host authentication).
    
    feedback deraadt, Dmitry Belyavskiy; ok markus@
    
    OpenBSD-Commit-ID: 430e339b2a79fa9ecc63f2837b06fdd88a7da13a

commit 07d8771bacfefbcfb37fa8a6dc6103bcc097e0ab
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Sep 17 10:30:45 2022 +0000

    upstream: Add a sshkey_check_rsa_length() call for checking the
    
    length of an RSA key; ok markus@
    
    OpenBSD-Commit-ID: de77cd5b11594297eda82edc594b0d32b8535134

commit 3991a0cf947cf3ae0f0373bcec5a90e86a7152f5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Sep 17 10:11:29 2022 +0000

    upstream: actually hook up restrict_websafe; the command-line flag
    
    was never actually used. Spotted by Matthew Garrett
    
    OpenBSD-Commit-ID: 0b363518ac4c2819dbaa3dfad4028633ab9cdff1

commit 30b2a7e4291fb9e357f80a237931ff008d686d3b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Sep 16 06:55:37 2022 +0000

    upstream: correct error value
    
    OpenBSD-Commit-ID: 780efcbad76281f11f14b2a5ff04eb6db3dfdad4

commit ac1ec9545947d9f9657259f55d04cb49d3a94c8a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Sep 16 03:33:14 2022 +0000

    upstream: sftp: Be a bit more clever about completions
    
    There are commands (e.g. "get" or "put") that accept two
    arguments, a local path and a remote path. However, the way
    current completion is written doesn't take this distinction into
    account and always completes remote or local paths.
    
    By expanding CMD struct and "cmds" array this distinction can be
    reflected and with small adjustment to completer code the correct
    path can be completed.
    
    By Michal Privoznik, ok dtucker@
    
    OpenBSD-Commit-ID: 1396d921c4eb1befd531f5c4a8ab47e7a74b610b

commit 590db83384f9d99fc51c84505792d26d1ef60df9
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Sep 16 03:13:34 2022 +0000

    upstream: sftp: Don't attempt to complete arguments for
    
    non-existent commands
    
    If user entered a non-existent command (e.g. because they made a
    typo) there is no point in trying to complete its arguments. Skip
    calling complete_match() if that's the case.
    
    From Michal Privoznik
    
    OpenBSD-Commit-ID: cf39c811a68cde2aeb98fc85addea4000ef6b07a

commit ff9809fdfd1d9a91067bb14a77d176002edb153c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Sep 14 00:14:37 2022 +0000

    upstream: sk_enroll: never drop SSH_SK_USER_VERIFICATION_REQD flag
    
    from response
    
    Now that all FIDO signing calls attempt first without PIN and then
    fall back to trying PIN only if that attempt fails, we can remove the
    hack^wtrick that removed the UV flag from the keys returned during
    enroll.
    
    By Corinna Vinschen
    
    OpenBSD-Commit-ID: 684517608c8491503bf80cd175425f0178d91d7f

commit 940dc10729cb5a95b7ee82c10184e2b9621c8a1d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Sep 14 00:13:13 2022 +0000

    upstream: a little extra debugging
    
    OpenBSD-Commit-ID: edf1601c1d0905f6da4c713f4d9cecc7d1c0295a

commit 4b5f91cb959358141181b934156513fcb8a6c1e3
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Sep 14 00:02:03 2022 +0000

    upstream: ssh-agent: attempt FIDO key signing without PIN and use
    
    the error to determine whether a PIN is required and prompt only if
    necessary. from Corinna Vinschen
    
    OpenBSD-Commit-ID: dd6be6a0b7148608e834ee737c3479b3270b00dd

commit 113523bf0bc33600b07ebb083572c8c346b6fdf4
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Sun Sep 11 06:38:11 2022 +0000

    upstream: .Li -> .Vt where appropriate; from josiah frentsos,
    
    tweaked by schwarze
    
    ok schwarze
    
    OpenBSD-Commit-ID: 565046e3ce68b46c2f440a93d67c2a92726de8ed

commit 86af013b56cecb5ee58ae0bd9d495cd586fc5918
Author: jsg@openbsd.org <jsg@openbsd.org>
Date:   Sat Sep 10 08:50:53 2022 +0000

    upstream: fix repeated words ok miod@ jmc@
    
    OpenBSD-Commit-ID: 6765daefe26a6b648cc15cadbbe337596af709b7

commit 0ba39b93b326a7d5dfab776cc9b9d326161a9b16
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Sep 9 03:31:42 2022 +0000

    upstream: notifier_complete(NULL, ...) is a noop, so no need to test
    
    that ctx!=NULL; from Corinna Vinschen
    
    OpenBSD-Commit-ID: ade2f2e9cc519d01a586800c25621d910bce384a

commit be197635329feb839865fdc738e34e24afd1fca8
Author: Sam James <sam@gentoo.org>
Date:   Thu Sep 8 02:49:29 2022 +0100

    openbsd-compat/bsd-asprintf: add <stdio.h> include for vsnprintf
    
    Fixes the following build failure with Clang 15 on musl:
    ```
    bsd-asprintf.c:51:8: error: call to undeclared library function 'vsnprintf' with type 'int (char *, unsigned long, const char *, struct __va_list_tag *)'; ISO C99 and laterclang -O2 -pipe -fdiagnostics-color=always -frecord-gcc-switches -pipe -Wunknown-warning-option -Qunused-arguments -Wall -Wpointer-arith -Wuninitialized -Wsign-compare -Wformat-security -Wsizeof-pointer-memaccess -Wno-pointer-sign -Wno-unused-result -Wmisleading-indentation -Wbitwise-instead-of-logical -fno-strict-aliasing -mretpoline  -ftrapv -fzero-call-used-regs=all -fno-builtin-memset -fstack-protector-strong -fPIE   -I. -I.  -D_XOPEN_SOURCE=600 -D_BSD_SOURCE -D_DEFAULT_SOURCE -DSSHDIR=\"/etc/ssh\" -D_PATH_SSH_PROGRAM=\"/usr/bin/ssh\" -D_PATH_SSH_ASKPASS_DEFAULT=\"/usr/lib/misc/ssh-askpass\" -D_PATH_SFTP_SERVER=\"/usr/lib/misc/sftp-server\" -D_PATH_SSH_KEY_SIGN=\"/usr/lib/misc/ssh-keysign\" -D_PATH_SSH_PKCS11_HELPER=\"/usr/lib/misc/ssh-pkcs11-helper\" -D_PATH_SSH_SK_HELPER=\"/usr/lib/misc/ssh-sk-helper\" -D_PATH_SSH_PIDDIR=\"/run\" -D_PATH_PRIVSEP_CHROOT_DIR=\"/var/empty\" -DHAVE_CONFIG_H -c cipher-aes.c -o cipher-aes.o
     do not support
          implicit function declarations [-Wimplicit-function-declaration]
            ret = vsnprintf(string, INIT_SZ, fmt, ap2);
                  ^
    bsd-asprintf.c:51:8: note: include the header <stdio.h> or explicitly provide a declaration for 'vsnprintf'
    1 error generated.
    ```

commit 6cb6f660bb35f77a0456dd2581ddf39c29398a5e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Sep 2 16:43:27 2022 +1000

    Remove DEF_WEAK, it's already in defines.h.

commit ce39e7d8b70c4726defde5d3bc4cb7d40d131153
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Sep 2 14:28:14 2022 +1000

    Resync arc4random with OpenBSD.
    
    This brings us up to current, including djm's random-reseeding change,
    as prompted by logan at cyberstorm.mu in bz#3467.  It brings the
    platform-specific hooks from LibreSSL Portable, simplified to match our
    use case.  ok djm@.

commit beaddde26f30e2195b8aa4f3193970e140e17305
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Sep 2 14:20:04 2022 +1000

    Move OPENBSD ORIGINAL marker.
    
    Putting this after the copyright statement (which doesn't change)
    instead of before the version identifier (which does) prevents merge
    conflicts when resyncing changes.

commit c83e467ead67a8cb48ef4bec8085d6fb880a2ff4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Sep 2 14:17:28 2022 +1000

    Remove arc4random_uniform from arc4random.c
    
    This was previously moved into its own file (matching OpenBSD) which
    prematurely committed in commit 73541f2.

commit 5f45c2395c60865e59fa44152ff1d003a128c5bc
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Sep 2 04:20:02 2022 +0000

    upstream: sk-usbhid: fix key_lookup() on tokens with built-in UV
    
    explicitly test whether the token performs built-in UV (e.g. biometric
    tokens) and enable UV in that case. From Pedro Martelletto via GHPR#388
    
    OpenBSD-Commit-ID: 007eb7e387d27cf3029ab06b88224e03eca62ccd

commit 03277a4aa49b80af541a3e691f264c0c0d8f9cec
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Aug 31 20:26:30 2022 +1000

    Move sftp from valgrind-2 to 3 to rebalance.

commit fcf5365da69c516817321ba89c3a91df98d098df
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Aug 31 02:56:40 2022 +0000

    upstream: whitespace
    
    OpenBSD-Commit-ID: c2bcbf93610d3d62ed206cdf9bf9ff98c6aaf232

commit e60136a3d7a223dd8e84ba8a6895bc3142360993
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Aug 29 13:27:45 2022 +1000

    additional keys

commit 2b02dcb505288c462d1b5dd1ac04e603d01340eb
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Aug 29 13:23:43 2022 +1000

    cross-sign allowed_signers with PGP key
    
    Provides continuity of trust from legacy PGP release key to
    the SSHSIG signing keys that we will use henceforth for git
    signing.

commit 51b345f177ae981b8755f6bdf8358b1cc5e83d67
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Aug 27 21:49:27 2022 +1000

    Add libcrypt-devel to cygwin-release deps.
    
    Based on feedback from vinschen at redhat.com.

commit 9f81736cf16dd8dda1c8942f1973a5f80b8cd78c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Aug 27 09:37:40 2022 +1000

    Add Windows 2022 test targets.

commit 85e1a69243f12be8520438ad6a3cfdc0b7fcbb2d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 26 16:26:06 2022 +1000

    Add cygwin-release test target.
    
    This also moves the cygwin package install from the workflow file to
    setup_ci.sh so that we can install different sets of Cygwin packages
    for different test configs.

commit 92382dbe8bf9ea1225b16858f9b9b208c15c7e8d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Aug 26 08:16:27 2022 +0000

    upstream: whitespace
    
    OpenBSD-Commit-ID: a5d015efbfd228dc598ffdef612d2da3a579e5d8

commit 70a5de0a50e84d7250eb4e4537f765599f64c4af
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Aug 26 08:12:56 2022 +0000

    upstream: whitespace
    
    OpenBSD-Commit-ID: d297e4387935d4aef091c5e9432578c2e513f538

commit 3a683a19fd116ea15ebf8aa13d02646cceb302a9
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Aug 26 14:23:55 2022 +1000

    initial list of allowed signers

commit 6851f4b8c3fc1b3e1114c56106e4dc31369c8513
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 19 17:22:18 2022 +1000

    Install Cygwin packages based on OS not config.

commit f96480906893ed93665df8cdf9065865c51c1475
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Aug 19 06:07:47 2022 +0000

    upstream: attemp FIDO key signing without PIN and use the error
    
    code returned to fall back only if necessary. Avoids PIN prompts for FIDO
    tokens that don't require them; part of GHPR#302
    
    OpenBSD-Commit-ID: 4f752aaf9f2e7c28bcaaf3d4f8fc290131bd038e

commit 5453333b5d28e313284cb9aae82899704103f98d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Aug 19 05:53:28 2022 +0000

    upstream: remove incorrect check that can break enrolling a
    
    resident key (introduced in r1.40)
    
    OpenBSD-Commit-ID: 4cab364d518470e29e624af3d3f9ffa9c92b6f01

commit ff89b1bed80721295555bd083b173247a9c0484e
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Aug 19 04:02:46 2022 +0000

    upstream: Strictly enforce the maximum allowed SSH2 banner size in
    
    ssh-keyscan and prevent a one-byte buffer overflow.  Patch from Qualys, ok
    djm@
    
    OpenBSD-Commit-ID: 6ae664f9f4db6e8a0589425f74cd0bbf3aeef4e4

commit 1b470b9036639cef4f32fb303bb35ea0b711178d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 19 15:18:09 2022 +1000

    Fix cygwin conditional steps.

commit fd6ee741ab16714b7035d60aca924123ba28135a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 19 15:12:57 2022 +1000

    Add a bit more debug output.

commit a9305c4c739f4d91a3d3a92c0b6d4949404a36c5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 12 15:08:47 2022 +1000

    Add Cygwin (on windows-2019) test target.
    
    In addition to installing the requisite Cygwin packages, we also need to
    explicitly invoke "sh" for steps that run other scripts since the runner
    environment doesn't understand #! paths.

commit 5062ad48814b06162511c4f5924a33d97b6b2566
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Aug 19 03:06:30 2022 +0000

    upstream: double free() in error path; from Eusgor via GHPR333
    
    OpenBSD-Commit-ID: 39f35e16ba878c8d02b4d01d8826d9b321be26d4

commit 5a5c580b48fc6006bdfa731fc2f6d4945c2c0e4e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Aug 18 21:36:39 2022 +1000

    Check for perms to run agent-getpeereid test.
    
    Ubuntu 22.04 defaults to private home dirs which prevents "nobody"
    running ssh-add during the agent-getpeereid test.  Check for this and
    add the necessary permissions.

commit cd06a76b7ccc706e2bb4f1cc4aa9e9796a28a812
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Aug 17 16:04:16 2022 +1000

    on Cygwin, prefer WinHello FIDO device
    
    If no FIDO device was explictly specified, then prefer the
    windows://hello FIDO device. An exception to this is when
    probing resident FIDO keys, in which case hardware FIDO
    devices are preferred.

commit 47f72f534ac5cc2cd3027675a3df7b00a8f77575
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Aug 17 06:01:57 2022 +0000

    upstream: add an extra flag to sk_probe() to indicate whether we're
    
    probing for a FIDO resident key or not. Unused here, but will make like
    easier for portable
    
    OpenBSD-Commit-ID: 432c8ff70e270378df9dbceb9bdeaa5b43b5a832

commit edb0bcb3c79b16031dc87a8e57aecc3c4a3414f0
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Tue Aug 16 20:24:08 2022 +0000

    upstream: use .Cm for "sign"; from josiah frentsos
    
    OpenBSD-Commit-ID: 7f80a53d54857ac6ae49ea6ad93c5bd12231d1e4

commit cccb011e130cbbac538b1689d10e4a067298df8b
Author: Corinna Vinschen <vinschen@redhat.com>
Date:   Thu Aug 11 20:19:35 2022 +0200

    Revert "check_sk_options: add temporary WinHello workaround"
    
    Cygwin now comes with libfido2 1.11.0, so this workaround
    isn't required anymore.
    
    This reverts commit 242c044ab111a37aad3b0775727c36a4c5f0102c.
    
    Signed-off-by: Corinna Vinschen <vinschen@redhat.com>

commit 9468cd7cf9d989dfa2ac20e2a0268ba6e93bfa5a
Author: Corinna Vinschen <vinschen@redhat.com>
Date:   Thu Aug 11 20:18:17 2022 +0200

    fido_dev_is_winhello: return 0, not "false"
    
    "false" is not used anywhere in OpenSSH, so return 0 like
    everywhere else.
    
    Signed-off-by: Corinna Vinschen <vinschen@redhat.com>

commit 730a80609472ee0451c99482d75c9c41f3ebc42d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Aug 12 05:20:28 2022 +0000

    upstream: sftp-server: support home-directory request
    
    Add support to the sftp-server for the home-directory extension defined
    in draft-ietf-secsh-filexfer-extensions-00. This overlaps a bit with the
    existing expand-path@openssh.com, but uses a more official protocol name,
    and so is a bit more likely to be implemented by non-OpenSSH clients.
    
    From Mike Frysinger, ok dtucker@
    
    OpenBSD-Commit-ID: bfc580d05cc0c817831ae7ecbac4a481c23566ab

commit 5e820bf79ce3ce99ef7e98b0ab642b0a0a4f396c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 12 14:56:55 2022 +1000

    Replace deprecated ubuntu-18.04 runners with 22.04

commit 87b0d9c1b789d3ff958ec45df2ac912e24461bae
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Aug 11 22:48:23 2022 +1000

    Add a timegm implementation from Heimdal via Samba.
    
    Fixes build on (at least Solaris 10).

commit d0c4fa58594577994921b593f10037c5282597ca
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Aug 11 14:23:58 2022 +1000

    Rerun tests if any .github config file changes.

commit 113fe6c77ab43769fc61e953d07cb619fd7ea54b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Aug 11 13:33:51 2022 +1000

    Skip hostbased during Valgrind tests.
    
    Valgrind doesn't let ssh exec ssh-keysign (because it's setuid) so skip
    it during the Valgrind based tests.
    
    See https://bugs.kde.org/show_bug.cgi?id=119404 for a discussion of this
    (ironically there the problematic binary was ssh(1) back when it could
    still be setuid).

commit b98a42afb69d60891eb0488935990df6ee571c4d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Aug 11 01:57:50 2022 +0000

    upstream: add some tests for parse_absolute_time(), including cases
    
    where it is forced to the UTC timezone. bz3468 ok dtucker
    
    OpenBSD-Regress-ID: ea07ca31c2f3847a38df028ca632763ae44e8759

commit ec1ddb72a146fd66d18df9cd423517453a5d8044
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Aug 11 01:56:51 2022 +0000

    upstream: allow certificate validity intervals, sshsig verification
    
    times and authorized_keys expiry-time options to accept dates in the UTC time
    zone in addition to the default of interpreting them in the system time zone.
    YYYYMMDD and YYMMDDHHMM[SS] dates/times will be interpreted as UTC if
    suffixed with a 'Z' character.
    
    Also allow certificate validity intervals to be specified in raw
    seconds-since-epoch as hex value, e.g. -V 0x1234:0x4567890. This
    is intended for use by regress tests and other tools that call
    ssh-keygen as part of a CA workflow.
    
    bz3468 ok dtucker
    
    OpenBSD-Commit-ID: 454db1cdffa9fa346aea5211223a2ce0588dfe13

commit 4df246ec75751da7eb925e1880498300d8bda187
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Aug 11 10:23:55 2022 +1000

    Fix conditional for running hostbased tests.

commit 2580916e48721802220c61ce9e0df1297c00bc07
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Aug 11 08:58:28 2022 +1000

    fix SANDBOX_SECCOMP_FILTER_DEBUG

commit fdbd5bf507fc271ff813714fab8a72ff2c6cb5ca
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Aug 10 17:35:52 2022 +1000

    Test hostbased auth on github runners.

commit 7e2f51940ba48a1c0fae1107801ea643fa83c971
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Aug 10 17:25:24 2022 +1000

    Rename our getentropy to prevent possible loops.
    
    Since arc4random seeds from getentropy, and we use OpenSSL for that
    if enabled, there's the possibility that if we build on a system that
    does not have getentropy then run on a system that does have it, then
    OpenSSL could end up calling our getentropy and getting stuck in a loop.
    Pointed out by deraadt@, ok djm@

commit 7a01f61be8d0aca0e975e7417f26371495fe7674
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Aug 8 12:17:04 2022 +1000

    Actually put HAVE_STDINT_H around the stdint.h.

commit 73541f29f0b50480da6c20dceb7a7191bd8ea7d3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Aug 8 10:30:34 2022 +1000

    Give unused param a name.
    
    Fixes builds on platforms that do have fido2 but don't have
    fido_dev_is_winhello.

commit 2a108c0ea960381bd9b14ee0d84e818a23df4482
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Aug 5 05:01:40 2022 +0000

    upstream: don't prompt for FIDO passphrase before attempting to enroll
    
    the credential, just let the enroll operating fail and we'll attempt to get a
    PIN anyway. Might avoid some unneccessary PIN prompts.
    
    Part of GHPR#302 from Corinna Vinschen; ok dtucker@
    
    OpenBSD-Commit-ID: bd5342ffc353ee37d39617906867c305564d1ce2

commit 2886975c0ad9244e60dc5e4be34fde3aa573a4b5
Author: Corinna Vinschen <vinschen@redhat.com>
Date:   Fri Feb 11 14:33:41 2022 +0100

    sk_sign: set FIDO2 uv attribute explicitely for WinHello
    
    WinHello via libfido2 performs user verification by default.
    However, if we stick to that, there's no way to differentiate
    between keys created with or without "-O  verify-required".
    Set FIDO2 uv attribute explicitely to FIDO_OPT_FALSE, then check
    if user verification has been requested.
    
    Signed-off-by: Corinna Vinschen <vinschen@redhat.com>

commit 242c044ab111a37aad3b0775727c36a4c5f0102c
Author: Corinna Vinschen <vinschen@redhat.com>
Date:   Tue Feb 15 11:28:08 2022 +0100

    check_sk_options: add temporary WinHello workaround
    
    Up to libfido 1.10.0, WinHello advertises "clientPin" rather
    than "uv" capability.  This is fixed in 1.11.0.  For the time
    being, workaround it here.
    
    Signed-off-by: Corinna Vinschen <vinschen@redhat.com>

commit 78774c08cc4b4997382975b0f414a86e06b6780c
Author: Corinna Vinschen <vinschen@redhat.com>
Date:   Thu Feb 10 18:19:29 2022 +0100

    compat code for fido_dev_is_winhello()
    
    Signed-off-by: Corinna Vinschen <vinschen@redhat.com>

commit 3d3a932a019aedfb891e0779bb4990cd5008a390
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 5 13:12:27 2022 +1000

    Factor out getrnd() and rename to getentropy().
    
    Factor out the arc4random seeding into its own file and change the
    interface to match getentropy.  Use native getentropy if available.
    This will make it easier to resync OpenBSD changes to arc4random.
    Prompted by bz#3467, ok djm@.

commit 9385d277b787403be9dfcb229cf372202496d2f3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Aug 4 18:55:48 2022 +1000

    Include CHANNEL and FIDO2 libs in configure output

commit 141535b904b6fba01724444f38193a8599201f82
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 1 11:09:26 2022 +0000

    upstream: avoid double-free in error path introduced in r1.70; report
    
    and fix based on GHPR#332 by v-rzh ok dtucker@
    
    OpenBSD-Commit-ID: 3d21aa127b1f37cfc5bdc21461db369a663a951f

commit dba7099ffcba3ca07b3946f017ba6a4c3158d9b1
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jul 27 18:40:12 2022 +1000

    Remove deprecated MacOS 10.15 runners.

commit 722a56439aa5972c830e4a9a724cf52aff4a950a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jul 27 18:31:14 2022 +1000

    Move stale-configure check as early as possible.
    
    We added a check in Makefile to catch the case where configure needs to
    be rebuilt, however this did not happen until a build was attempted in
    which case all of the work done by configure was wasted.  Move this check
     to the start of configure to catch it as early as possible.  ok djm@

commit 099d6b56288b421ba38531d26dc1bd6bb685e311
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 22 10:47:19 2022 +1000

    Move libcrypto into CHANNELLIBS.
    
    This will result in sftp, sftp-server and scp no longer being linked
    against libcrypto.  ok djm@

commit 1bdf86725b77733bb5f17c54888b88a10b2f6538
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 22 10:45:47 2022 +1000

    Remove seed_rng calls from scp, sftp, sftp-server.
    
    These binaries don't use OpenSSL's random functions.  The next step
    will be to stop linking them against libcrypto.  ok djm@

commit d73f77b8cb9b422f1ac4facee7890aa10ff2bc21
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 22 09:51:51 2022 +1000

    Group libcrypto and PRNGD checks together.
    
    They're related more than the libcrypt or libiaf checks which are
    currently between them.  ok djm@

commit f117e372b3f42f2fbdb0a578d063b2609ab58e1f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 22 09:24:45 2022 +1000

    Do not link scp, sftp and sftp-server w/ zlib.
    
    Some of our binaries (eg sftp, sftp-server, scp) do not interact with
    the channels code and thus do use libraries such as zlib and libcrypto
    although they are linked with them.  This adds a CHANNELLIBS and starts
    by moving zlib into it, which means the aformentioned binaries are no
    longer linked against zlib.  ok djm@

commit 800c2483e68db38bd1566ff69677124be974aceb
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jul 25 21:49:04 2022 +1000

    Remove workarounds for OpenSSL missing AES-CTR.
    
    We have some compatibility hacks that were added to support OpenSSL
    versions that do not support AES CTR mode.  Since that time, however,
    the minimum OpenSSL version that we support has moved to 1.0.1 which
    *does* have CTR, so this is no longer needed.  ok djm@

commit b7c56b65c12f51fe0dbae798d19c8f58224a5d95
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jul 25 21:43:00 2022 +1000

    Remove workarounds for OpenSSL missing AES-GCM.
    
    We have some compatibility hacks that were added to support OpenSSL
    versions that do not support AES GCM mode.  Since that time, however,
    the minimum OpenSSL version that we support has moved to 1.0.1 which
    *does* have GCM, so this is no longer needed.  ok djm@

commit 5a4a9f7a968fbf92cc1eac519c65638e79ae9f1f
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 25 07:12:45 2022 +0000

    upstream: Restore missing "!" in TEST_SSH_ELAPSED_TIMES test.
    
    OpenBSD-Regress-ID: 38783f9676ec348c5a792caecee9a16e354b37b0

commit 0ff886be132299386cc29d87c2aa16ff68a1aa08
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Jul 24 23:29:10 2022 +0000

    upstream: Test TEST_SSH_ELAPSED_TIMES for empty string not
    
    executable.  No-op on most platforms but should prevent warnings in -portable
    on systems that don't have 'date %s'.
    
    OpenBSD-Regress-ID: e39d79867b8065e33d0c5926fa1a31f85659d2a4

commit f69319ad8ad1dd50f90bbcf5912e11cc8ed3e037
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 23 14:38:22 2022 +1000

    Convert "have_prog" function into "which".
    
    "which" and its behaviour is not standardized, so convert the existing
    have_prog function into "which" so we can rely on it being available
    and what its semantics are.  Add a have_prog wrapper that maintains the
    existing behaviour.

commit ea7ecc2c3ae39fdf5c6ad97b7bc0b47a98847f43
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 23 14:36:38 2022 +1000

    Skip scp3 test if there's no scp on remote path.
    
    scp -3 ends up using the scp that's in the remote path and will fail if
    one is not available.  Based on a patch from rapier at psc.edu.

commit c46f6fed419167c1671e4227459e108036c760f8
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Jul 20 13:39:14 2022 +1000

    crank SSH_SK_VERSION_MAJOR in sk-dummy.so

commit f208e3b9ffb5ee76cf9c95df7ff967adc7f51c7d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jul 20 03:33:22 2022 +0000

    upstream: ssh-keygen: fix touch prompt, pin retries;
    
    part of GHPR329 from Pedro Martelletto
    
    OpenBSD-Commit-ID: 75d1005bd2ef8f29fa834c90d2684e73556fffe8

commit 8638a2ce7e90c8a51d9af3143404282126c524f8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jul 20 03:31:42 2022 +0000

    upstream: sk-usbhid: preserve error code returned by key_lookup()
    
    it conveys useful information, such as the supplied pin being wrong.
    
    Part of GHPR329 from Pedro Martelletto
    
    OpenBSD-Commit-ID: c0647eb9290f793add363d81378439b273756c1b

commit 9ab929ca2d820520327b41929372bcb9e261534c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jul 20 03:29:14 2022 +0000

    upstream: when enrolling a resident key on a security token, check
    
    if a credential with matching application and user ID strings already exists.
    if so, prompt the user for confirmation before overwriting the credential.
    
    patch from Pedro Martelletto via GHPR329
    
    NB. cranks SSH_SK_VERSION_MAJOR, so any third-party FIDO middleware
    implementations will need to adjust
    
    OpenBSD-Commit-ID: e45e9f1bf2b2f32d9850669e7a8dbd64acc5fca4

commit 5bcfc788b38d5b64e4c347bdc04bd9a01bbc36da
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jul 20 03:13:04 2022 +0000

    upstream: pull passphrase reading and confirmation into a separate
    
    function so it can be used for FIDO2 PINs; no functional change
    
    OpenBSD-Commit-ID: bf34f76b8283cc1d3f54633e0d4f13613d87bb2f

commit eb679e2959bdb15454eb94751930eb4c9110da94
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 15 21:31:48 2022 +1000

    Move vmshutdown to first step.
    
    If a previous run on a physical runner has failed to clean up, the next
    run will fail because it'll try to check out the code to a broken
    directory mount.  Make cleanup the first step.

commit 46b91b70ff3cb9c147e2875ef5dc609fd64c0c96
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 15 20:25:27 2022 +1000

    Rename bbone test target to ARM.

commit 751d22cdeffed9fe921db78eedc32a29f9e80510
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 15 13:37:29 2022 +1000

    Add AUDIT_ARCH_PPC to supported seccomp arches.
    
    Patch from dries.deschout at dodeco.eu.

commit a061792a6e8d235fc40a9b5d4c22a1762bb75a7b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Jul 14 19:20:24 2022 +1000

    Remove unintended changes.
    
    I inadvertently included a couple of local changes with the OpenSSL
    3.0.4 change.  Revert, anything that should be there will be committed
    separately.

commit 527cb43fa1b4e55df661feabbac51b8e608b6519
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Jul 14 11:22:08 2022 +1000

    Return ERANGE from getcwd() if buffer size is 1.
    
    If getcwd() is supplied a buffer size of exactly 1 and a path of "/", it
    could result in a nul byte being written out of array bounds.  POSIX says
    it should return ERANGE if the path will not fit in the available buffer
    (with terminating nul). 1 byte cannot fit any possible path with its nul,
    so immediately return ERANGE in that case.
    
    OpenSSH never uses getcwd() with this buffer size, and all current
    (and even quite old) platforms that we are currently known to work
    on have a native getcwd() so this code is not used on those anyway.
    Reported by Qualys, ok djm@

commit 36857fefd8849c4b0e877cfd9d1eb22f79b76650
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Jul 14 10:02:35 2022 +1000

    Split README.platform into its own line.
    
    README.platform has general platform-specific information, having it
    following text about FIDO2 on the same line could imply that it only
    has information about FIDO2.

commit 00a496c6c14f2d41f2a9365714d494dd5f3aac9f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Jul 14 09:56:01 2022 +1000

    Clarify README.md text.
    
    Clarify the text about the implications of building without OpenSSL, and
    prefix the "configure --help" example command with a "./" so it's likely
    to work as-is in more shells.  From bz#3461.

commit f40b52f21fbc52eb513279168a49d3285c65256c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jul 12 19:48:44 2022 +1000

    Remove special casing of crypt().
    
    Configure goes to some lengths to pick crypt() from either libcrypt
    or OpenSSL's libcrypto because they can more or less featureful (eg
    supporting md5-style passwords).
    
    OpenSSL removed its crypt() interface in 2002:
    https://github.com/openssl/openssl/commit/69deec58 so these hijinks
    should no longer be necessary.  This also only links sshd with libcrypt
    which is the only thing that needs it.  ok djm@

commit 76f4e48631d7b09fb243b47d7b393d100d3741b7
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jul 13 13:17:47 2022 +1000

    Only refuse to use OpenSSL 3.0.4 on x86_64.
    
    The potential RCE only impacts x86_64, so only refuse to use it if we're
    targetting a potentially impacted architecture.  ok djm@

commit e75bbc1d88491fa85e61b2cc8783d4bbd00cd131
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jul 12 14:37:15 2022 +1000

    Capture stderr output from configure.

commit d9eaea4bea6271bcee6a2b9428f1271faf2d033b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jul 12 12:54:49 2022 +1000

    Refuse to use OpenSSL 3.0.4 due to potential RCE.
    
    OpenSSL has a potential RCE in its RSA implementation (CVE-2022-2274)
    so refuse to use that specific version.

commit fb2f3a61bf3d28fff285524535f7ffcd177c9235
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jul 12 12:54:24 2022 +1000

    Move unset to before we set anything.

commit c483a5c0fb8e8b8915fad85c5f6113386a4341ca
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jul 6 11:52:54 2022 +1000

    Test against openssl-3.0.5.

commit 669a56bcfe73f8b985f2bba476ba834d55253acf
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jul 5 18:35:53 2022 +1000

    Update sanitizer test targets:
    
     - remove clang-sanitize-memory for now.  It takes so long that the test
       times out.
     - add gcc sanitize-address and sanitize-undefined test targets.

commit 48cc68b69118b3ce8d07fd4f82e00d58667d5379
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jul 5 16:23:28 2022 +1000

    Add GCC address sanitizer build/test.

commit 55c60bdd39b82457e92efa77da8d16cfa6a49391
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jul 5 12:02:33 2022 +1000

    Move sanitizer logs into regress for collection.

commit 35ef2b3b6ef198f8574904a45780487ec2f17858
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 4 09:10:31 2022 +0000

    upstream: Add TEST_REGRESS_CACHE_DIR.
    
    If set, it is used to cache regress test names that have succeeded and
    skip those on a re-run.
    
    OpenBSD-Regress-ID: a7570dd29a58df59f2cca647c3c2ec989b49f247

commit 7394ed80c4de8b228a43c8956cf2fa1b9c6b2622
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Jul 3 21:46:44 2022 +1000

    Add clang sanitizer tests.

commit bfce0e66b6017a9bfab450b9dc7d4b16f90de817
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Jul 3 18:14:09 2022 +1000

    Skip all rlimit tests when sandboxing disabled.
    
    The rlimit tests can hang when being run with some compiler sanitizers
    so skip all of them if sandbox=no.

commit 6208d611520f9ea94d5369f9da404b709930029d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Jul 3 17:54:49 2022 +1000

    Move checks for pollfd.fd and nfds_t.
    
    Move the checks for struct pollfd.fd and nfds_t to before the sandboxing
    checks.  This groups all the sandbox checks together so we can skip them
    all when sandboxing is disabled.

commit 322964f8f2e9c321e77ebae1e4d2cd0ccc5c5a0b
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jul 1 05:08:23 2022 +0000

    upstream: Remove leftover line.
    
    Remove extra line leftover from merge conflict. ok djm@
    
    OpenBSD-Commit-ID: 460e2290875d7ae64971a7e669c244b1d1c0ae2e

commit 7ec81daad0e03a64e8d91c5590960c48c1a899a3
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 1 04:45:50 2022 +0000

    upstream: use consistent field names (s/char/byte)
    
    in format description
    
    OpenBSD-Commit-ID: 3de33572733ee7fcfd7db33d37db23d2280254f0

commit 32e82a392d9f263485effdd606ff5862d289a4a0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 1 13:55:19 2022 +1000

    Skip select+rlimit check if sandboxing is disabled
    
    It's not needed in that case, and the test can fail when being built
    with some compiler memory sanitizer flags.  bz#3441

commit 4be7184ebe2a2ccef175983517a35ee06766e1b4
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 1 03:52:57 2022 +0000

    upstream: bump up loglevel from debug to info when unable to open
    
    authorized keys/principals file for errno != ENOENT; bz2042 ok dtucker
    
    OpenBSD-Commit-ID: e79aa550d91ade6a80f081bda689da24c086d66b

commit 6c31ba10e97b6953c4f325f526f3e846dfea647a
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jul 1 03:39:44 2022 +0000

    upstream: Don't leak the strings allocated by order_hostkeyalgs()
    
    and list_hostkey_types() that are passed to compat_pkalg_proposal(). Part of
    github PR#324 from ZoltanFridrich, ok djm@
    
    This is a roll-forward of the previous rollback now that the required
    changes in compat.c have been done.
    
    OpenBSD-Commit-ID: c7cd93730b3b9f53cdad3ae32462922834ef73eb

commit 486c4dc3b83b4b67d663fb0fa62bc24138ec3946
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jul 1 03:35:45 2022 +0000

    upstream: Always return allocated strings from the kex filtering so
    
    that we can free them later.  Fix one leak in compat_kex_proposal.  Based on
    github PR#324 from ZoltanFridrich with some simplications by me. ok djm@
    
    OpenBSD-Commit-ID: 9171616da3307612d0ede086fd511142f91246e4

commit 96faa0de6c673a2ce84736eba37fc9fb723d9e5c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 1 00:36:30 2022 +0000

    upstream: ignore SIGPIPE earlier in main(), specifically before
    
    muxclient() which performs operations that could cause one; Reported by Noam
    Lewis via bz3454, ok dtucker@
    
    OpenBSD-Commit-ID: 63d8e13276869eebac6d7a05d5a96307f9026e47

commit 33efac790f6b09d54894ba6c3e17dfb08b6fc7e1
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Tue Jun 28 06:09:14 2022 +0000

    upstream: reflect the update to -D arg name in usage();
    
    OpenBSD-Commit-ID: abdcde4f92b1ef094ae44210ee99d3b0155aad9c

commit c71a1442d02f0a3586109dfe2cb366de36dee08e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jun 29 18:28:47 2022 +1000

    Update OpenSSL tests to the most recent releases.

commit 2a822f29300b2de7335fbff65f0b187a0c582304
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jun 27 21:41:55 2022 +0000

    upstream: allow arguments to sftp -D option, e.g. sftp -D
    
    "/usr/libexec/sftp-server -el debug3"
    
    ok markus@
    
    OpenBSD-Commit-ID: 5a002b9f3a7aef2731fc0ffa9c921cf15f38ecce

commit 2369a2810187e08f2af5d58b343956062fb96ee8
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 24 10:45:06 2022 +0000

    upstream: Roll back previous KEX changes as they aren't safe until
    
    compat_pkalg_proposal and friends always allocate their returned strings.
    Reported by Qualys.
    
    OpenBSD-Commit-ID: 1c7a88a0d5033f42f88ab9bec58ef1cf72c81ad0

commit 646686136c34c2dbf6a01296dfaa9ebee029386d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 24 04:37:00 2022 +0000

    upstream: Don't leak the strings allocated by order_hostkeyalgs()
    
    and list_hostkey_types() that are passed to compat_pkalg_proposal(). Part of
    github PR#324 from ZoltanFridrich, ok djm@
    
    OpenBSD-Commit-ID: b2f6e5f60f2bba293b831654328a8a0035ef4a1b

commit 193c6d8d905dde836b628fc07a7b9cf2d347e2a3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jun 25 12:16:15 2022 +1000

    Zero out LIBFIDO2 when SK support not usable.
    
    Prevents us from trying to link them into ssh-sk-helper and failing to
    build.

commit 40f5d849d25c60b4ae21261e78484d435f5cfd51
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jun 25 11:47:28 2022 +1000

    Disable SK support if FIDO libs not found.

commit 5fd922ade1b25880fe8a8249f5c0385e413108f9
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Jun 24 14:43:54 2022 +1000

    fix broken case statement in previous

commit f51423bdaf0008d46b6af082bcfd7a22a87375f0
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Jun 24 14:40:42 2022 +1000

    request 1.1x API compatibility for OpenSSL >=3.x
    
    idea/patch from Pedro Martelletto via GHPR#322; ok dtucker@

commit 455cee8d6c2e4c48c5af9faead3599c49948411e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 24 04:27:14 2022 +0000

    upstream: make it clear that RekeyLimit applies to both transmitted
    
    and received data. GHPR#328 from Jan Pazdziora
    
    OpenBSD-Commit-ID: d180a905fec9ff418a75c07bb96ea41c9308c3f9

commit 17904f05802988d0bb9ed3c8d1d37411e8f459c3
Author: tobhe@openbsd.org <tobhe@openbsd.org>
Date:   Tue Jun 21 14:52:13 2022 +0000

    upstream: Make sure not to fclose() the same fd twice in case of an
    
    error.
    
    ok dtucker@
    
    OpenBSD-Commit-ID: e384c4e05d5521e7866b3d53ca59acd2a86eef99

commit f29d6cf98c25bf044079032d22c1a57c63ab9d8e
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Jun 18 02:17:16 2022 +0000

    upstream: Don't attempt to fprintf a null identity comment. From
    
    Martin Vahlensieck via tech@.
    
    OpenBSD-Commit-ID: 4c54d20a8e8e4e9912c38a7b4ef5bfc5ca2e05c2

commit ad1762173bb38716a106e8979806149fd0f2753e
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 17 01:00:03 2022 +0000

    upstream: Log an error if pipe() fails while accepting a
    
    connection.  bz#3447, from vincent-openssh at vinc17 net, ok djm@
    
    OpenBSD-Commit-ID: 9d59f19872b94900a5c79da2d57850241ac5df94

commit 9c59e7486cc8691401228b43b96a3edbb06e0412
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Jun 24 14:20:43 2022 +1000

    automatically enable built-in FIDO support
    
    If libfido2 is found and usable, then enable the built-in
    security key support unless --without-security-key-builtin
    was requested.
    
    ok dtucker@

commit 7d25b37fb2a5ff4dadabcbdac6087a97479434f5
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Jun 24 13:46:39 2022 +1000

    fix possible NULL deref when built without FIDO
    
    Analysis/fix from kircher in bz3443; ok dtucker@

commit f5ba85daddfc2da6a8dab6038269e02c0695be44
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jun 15 16:08:25 2022 +0000

    upstream: make sure that UseDNS hostname lookup happens in the monitor
    
    and not in the pledge(2)'d unprivileged process; fixes regression caused by
    recent refactoring spotted by henning@
    
    OpenBSD-Commit-ID: a089870b95101cd8881a2dff65b2f1627d13e88d

commit acb2059febaddd71ee06c2ebf63dcf211d9ab9f2
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 3 04:47:21 2022 +0000

    upstream: move auth_openprincipals() and auth_openkeyfile() over to
    
    auth2-pubkeyfile.c too; they make more sense there.
    
    OpenBSD-Commit-ID: 9970d99f900e1117fdaab13e9e910a621b7c60ee

commit 3d9b0845f34510111cc693bb99a667662ca50cd8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 3 04:31:54 2022 +0000

    upstream: test setenv in both client and server, test first-match-wins
    
    too
    
    OpenBSD-Regress-ID: 4c8804f9db38a02db480b9923317457b377fe34b

commit 22e1a3a71ad6d108ff0c5f07f93c3fcbd30f8b40
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 3 04:30:46 2022 +0000

    upstream: Make SetEnv directives first-match-wins in both
    
    sshd_config and sshd_config; previously if the same name was reused then the
    last would win (which is the opposite to how the config is supposed to work).
    
    While there, make the ssh_config parsing more like sshd_config.
    
    bz3438, ok dtucker
    
    OpenBSD-Commit-ID: 797909c1e0262c0d00e09280459d7ab00f18273b

commit 38ed6c57e9e592c08e020fa6e82b45b4e1040970
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 3 04:00:15 2022 +0000

    upstream: Add missing *-sk types to ssh-keyscan manpage. From
    
    skazi0 via github PR#294.
    
    OpenBSD-Commit-ID: fda2c869cdb871f3c90a89fb3f985370bb5d25c0

commit ea97ec98c41ec2b755dfab459347db674ff9a5de
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 3 03:21:09 2022 +0000

    upstream: Add period at end of "not known by any other names"
    
    message.  github PR#320 from jschauma, ok djm@
    
    OpenBSD-Commit-ID: bd60809803c4bfd3ebb7c5c4d918b10e275266f2

commit 88e376fcd67478ad1660d94bc73ab348ac9f4527
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 3 03:17:42 2022 +0000

    upstream: ssh-keygen -A: do not generate DSA keys by default.
    
    Based on github PR#303 from jsegitz with man page text from jmc@, ok markus@
    djm@
    
    OpenBSD-Commit-ID: 5c4c57bdd7063ff03381cfb6696659dd3f9f5b9f

commit 6b3fb624675082a1e5aa615d1b8479873d8b5731
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Tue May 31 14:05:12 2022 +0000

    upstream: ssh-keygen: implement "verify-required" certificate option.
    
    This was already documented when support for user-verified FIDO
    keys was added, but the ssh-keygen(1) code was missing.
    
    ok djm@
    
    OpenBSD-Commit-ID: f660f973391b593fea4b7b25913c9a15c3eb8a06

commit b7f86ffc301be105bba9a3e0618b6fab3ae379bd
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Sat May 28 05:57:56 2022 +0000

    upstream: keywords ref ssh_config.5;
    
    from caspar schutijser
    
    OpenBSD-Commit-ID: f146a19d7d5c9374c3b9c520da43b2732d7d1a4e

commit dc7bc52372f2744fa39191577be5306ee57aacd4
Author: Damien Miller <djm@mindrot.org>
Date:   Mon May 30 09:29:09 2022 +1000

    fix some bugs in the fuzzer

commit 1781f507c113667613351c19898efaf1e311a865
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri May 27 18:19:48 2022 +1000

    Test against OpenSSL 1.1.1o and 3.0.3.

commit c53906e0c59e569691b4095d3e8db79cf78fa058
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri May 27 18:18:31 2022 +1000

    Test against LibreSSL 3.5.3.

commit 9b3ad432ad2f19319bcc089370e356c6315d682f
Author: Damien Miller <djm@mindrot.org>
Date:   Fri May 27 17:00:43 2022 +1000

    fuzzer for authorized_keys parsing
    
    mostly redundant to authopt_fuzz, but it's sensitive code so IMO it
    makes sense to test this layer too

commit c83d8c4d6f3ccceef84d46de107f6b71cda06359
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 27 05:02:46 2022 +0000

    upstream: split the low-level file handling functions out from
    
    auth2-pubkey.c
    
    Put them in a new auth2-pubkeyfile.c to make it easier to refer to them
    (e.g. in unit/fuzz tests) without having to refer to everything else
    pubkey auth brings in.
    
    ok dtucker@
    
    OpenBSD-Commit-ID: 3fdca2c61ad97dc1b8d4a7346816f83dc4ce2217

commit 3b0b142d2a0767d8cd838e2f3aefde8a0aaa41e1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 27 05:01:25 2022 +0000

    upstream: refactor authorized_keys/principals handling
    
    remove "struct ssh *" from arguments - this was only used to pass the
    remote host/address. These can be passed in instead and the resulting
    code is less tightly coupled to ssh_api.[ch]
    
    ok dtucker@
    
    OpenBSD-Commit-ID: 9d4373d013edc4cc4b5c21a599e1837ac31dda0d

commit 2c334fd36f80cb91cc42e4b978b10aa35e0df236
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri May 27 04:29:40 2022 +0000

    upstream: f sshpkt functions fail, then password is not cleared
    
    with freezero. Unconditionally call freezero to guarantee that password is
    removed from RAM.
    
    From tobias@ and c3h2_ctf via github PR#286, ok djm@
    
    OpenBSD-Commit-ID: 6b093619c9515328e25b0f8093779c52402c89cd

commit 5d3a77f4c5ae774c6796387266503f52c7cdc7c2
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri May 27 04:27:49 2022 +0000

    upstream: Avoid kill with -1 argument. The out_ctx label can be
    
    reached before fork has been called. If this happens, then kill -1 would be
    called, sending SIGTERM to all processes reachable by the current process.
    
    From tobias@ and c3h2_ctf via github PR#286, ok djm@
    
    OpenBSD-Commit-ID: 6277af1207d81202f5daffdccfeeaed4c763b1a8

commit 533b31cd08e4b97f455466f91c36915e2924c15a
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri May 27 04:13:24 2022 +0000

    upstream: Note that ProxyJump also accepts the same tokens as
    
    ProxyCommand. From pallxk via github PR#305.
    
    OpenBSD-Commit-ID: 7115ac351b129205f1f1ffa6bbfd62abd76be7c5

commit 9d8c80f8a304babe61ca28f2e3fb5eb6dc9c39bf
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed May 25 06:03:44 2022 +0000

    upstream: revert previous; it was broken (spotted by Theo)
    
    OpenBSD-Commit-ID: 457c79afaca2f89ec2606405c1059b98b30d8b0d

commit 9e0d02ef7ce88b67643bfb1c2272c9f5f04cc680
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed May 25 00:31:13 2022 +0000

    upstream: make SSHBUF_DBG/SSHBUF_TELL (off by default and only enabled
    
    via #define) dump to stderr rather than stdout
    
    OpenBSD-Commit-ID: 10298513ee32db8390aecb0397d782d68cb14318

commit 2487163630f28be28b7e2396b4bd6511b98f1d3e
Author: Tim Rice <tim@multitalents.net>
Date:   Tue May 24 10:21:25 2022 -0700

    configure.ac: Add missing AC_DEFINE for caph_cache_tzdata test causing
    HAVE_CAPH_CACHE_TZDATA to be missing from config.h.in.
    Spotted by Bryan Drewery

commit bedb93415b60db3dfd704a3d525e82adb14a2481
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun May 15 23:48:07 2022 +0000

    upstream: regress test for in-place transfers and clobbering larger
    
    files with smaller ones; would have caught last regression in scp(1)
    
    OpenBSD-Regress-ID: 19de4e88dd3a4f7e5c1618c9be3c32415bd93bc2

commit b4f0d719c2548cb74da509fb65f384dada4ebd37
Author: anton@openbsd.org <anton@openbsd.org>
Date:   Fri Apr 22 05:08:43 2022 +0000

    upstream: Only run agent-ptrace.sh if gdb is available as all
    
    architectures do not ship with gdb.
    
    OpenBSD-Regress-ID: ec53e928803e6b87f9ac142d38888ca79a45348d

commit 9b73345f80255a7f3048026462f2c0c6a241eeac
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun May 15 23:47:21 2022 +0000

    upstream: fix in-place copies; r1.163 incorrectly skipped truncation in
    
    all cases, not just at the start of a transfer. This could cause overwrites
    of larger files to leave junk at the end. Spotted by tb@
    
    OpenBSD-Commit-ID: b189f19cd68119548c8e24e39c79f61e115bf92c

commit 56a0697fe079ff3e1ba30a2d5c26b5e45f7b71f8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 13 06:31:50 2022 +0000

    upstream: arrange for scp, when in sftp mode, to not ftruncate(3) files
    
    early
    
    previous behavious of unconditionally truncating the destination file
    would cause "scp ~/foo localhost:" and "scp localhost:foo ~/" to
    delete all the contents of their destination.
    
    spotted by solene@ sthen@, also bz3431; ok dtucker@
    
    OpenBSD-Commit-ID: ca39fdd39e0ec1466b9666f15cbcfddea6aaa179

commit fbcef70c2832712f027bccea1aa9bc4b4103da93
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon May 9 08:25:27 2022 +0000

    upstream: Remove errant apostrophe. From haruyama at queen-ml org.
    
    OpenBSD-Commit-ID: dc6b294567cb84b384ad6ced9ca469f2bbf0bd10

commit 0086a286ea6bbd11ca9b664ac3bb12b27443d6eb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon May 9 03:09:53 2022 +0000

    upstream: Allow existing -U (use agent) flag to work with "-Y sign"
    
    operations, where it will be interpreted to require that the private keys is
    hosted in an agent; bz3429, suggested by Adam Szkoda; ok dtucker@
    
    OpenBSD-Commit-ID: a7bc69873b99c32c42c7628ed9ea91565ba08c2f

commit cb010744cc98f651b1029bb09efa986eb54e4ccf
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun May 8 22:58:35 2022 +0000

    upstream: improve error message when 'ssh-keygen -Y sign' is unable to
    
    load a private key; bz3429, reported by Adam Szkoda ok dtucker@
    
    OpenBSD-Commit-ID: bb57b285e67bea536ef81b1055467be2fc380e74

commit aa61fc82c63d309a90c22ca74fb1da6c6f4372fd
Author: Tobias Heider <me@tobhe.de>
Date:   Mon May 9 02:00:01 2022 +0200

    Remove duplicate bcrypt_pbkdf.o from Makefile
    
    bcrypt_pbkdf.o is duplicated in the openbsd-compat Makefile's object
    file list.

commit deb506d00da8d11fb04c1e7b9b1e1cc379c1705c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun May 8 22:32:36 2022 +0000

    upstream: When performing operations that glob(3) a remote path, ensure
    
    that the implicit working directory used to construct that path escapes
    glob(3) characters.
    
    This prevents glob characters from being processed in places they
    shouldn't, e.g. "cd /tmp/a*/", "get *.txt" should have the get operation
    treat the path "/tmp/a*" literally and not attempt to expand it.
    
    Reported by Lusia Kundel; ok markus@
    
    OpenBSD-Commit-ID: 4f647f58482cbad3d58b1eab7f6a1691433deeef

commit f38cf74f20b5da113cfa823afd5bfb5c6ba65f3d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri May 6 14:50:18 2022 +1000

    Also retest OpenBSD upstream on .yml changes.

commit f87a132800ba3710ab130d703448a31ef1128d77
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri May 6 14:46:09 2022 +1000

    Note that, for now, we need variadic macros.

commit 217b518e0f7c52c4b909e935141a55344c61e644
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri May 6 14:39:34 2022 +1000

    Add ubsan minimal testcase on OpenBSD.
    
    As suggested by djm@.

commit 457dce2cfef6a48f5442591cd8b21c7e8cba13f8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu May 5 01:04:14 2022 +0000

    upstream: sshkey_unshield_private() contains a exact duplicate of
    
    the code in private2_check_padding(). Pull private2_check_padding() up so the
    code can be reused. From Martin Vahlensieck, ok deraadt@
    
    OpenBSD-Commit-ID: 876884c3f0e62e8fd8d1594bab06900f971c9c85

commit 0e44db4d9cb313e68a59a44d27884af66c02356e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu May 5 00:56:58 2022 +0000

    upstream: channel_new no longer frees remote_name. So update the
    
    comment accordingly.  As remote_name is not modified, it can be const as
    well. From Martin Vahlensieck
    
    OpenBSD-Commit-ID: e4e10dc8dc9f40c166ea5a8e991942bedc75a76a

commit 37b62fd5caf19c85a48241535277cefff65adace
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu May 5 00:55:11 2022 +0000

    upstream: mux.c: mark argument as const; from Martin Vahlensieck
    
    OpenBSD-Commit-ID: 69a1a93a55986c7c2ad9f733c093b46a47184341

commit f4e67c0ad259b4cf10177277a5827fa5545bac53
Author: markus@openbsd.org <markus@openbsd.org>
Date:   Wed May 4 07:31:22 2022 +0000

    upstream: make sure stdout is non-blocking; ok djm@
    
    OpenBSD-Commit-ID: 64940fffbd1b882eda2d7c8c7a43c79368309c0d

commit e5c036d2092c00bef395e9161dc5ce42d4be9565
Author: florian@openbsd.org <florian@openbsd.org>
Date:   Tue May 3 07:42:27 2022 +0000

    upstream: Add FIDO AUTHENTICATOR section and explain a bit how FIDO
    
    works. The wording came mostly from the 8.2 OpenSSH release notes, addapted
    to fit the man page. Then move the -O bits into the new section as is already
    done for CERTIFICATES and MODULI GENERATION. Finally we can explain the
    trade-offs of resident keys. While here, consistently refer to the FIDO
    thingies as "FIDO authenticators", not "FIDO tokens".
    
    input & OK jmc, naddy
    
    OpenBSD-Commit-ID: dd98748d7644df048f78dcf793b3b63db9ab1d25

commit 575771bf79bef7127be6aaccddc46031ea15529e
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Mon May 2 05:40:37 2022 +0000

    upstream: remove an obsolete rsa1 format example from an example;
    
    from megan batty
    ok djm
    
    OpenBSD-Commit-ID: db2c89879c29bf083df996bd830abfb1e70d62bf

commit 0bc6b4c8f04e292577bdb44d5dc6b630d3448087
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun May 1 23:20:30 2022 +0000

    upstream: fix some integer overflows in sieve_large() that show up when
    
    trying to generate modp groups > 16k bits. Reported via GHPR#306 by Bertram
    Felgenhauer, but fixed in a different way. feedback/ok tb@
    
    OpenBSD-Commit-ID: 81cbc6dd3a21c57bd6fadea10e44afe37bca558e

commit a45615cb172bc827e21ec76750de39dfb30ecc05
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Apr 29 04:55:07 2022 +0000

    upstream: be stricter in which characters will be accepted in
    
    specifying a mask length; allow only 0-9. From khaleesicodes via GHPR#278; ok
    dtucker@
    
    OpenBSD-Commit-ID: e267746c047ea86665cdeccef795a8a56082eeb2

commit 4835544d2dd31de6ffc7dba59f92093aea98155b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 30 10:56:41 2022 +1000

    Add Mac OS X 12 test target.

commit 97a6a8b8c1f2da09712d0e72d0ef800e4edd34cd
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 29 18:27:34 2022 +1000

    Only run tests when source files change.
    
    Also run tests on changes to V_9_0 branch.

commit 6d0392b9ff4b50a56ac5685d1b9392e2cd432ca3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 29 18:22:34 2022 +1000

    Remove now-empty int32_minmax.inc.

commit af59463553b5ad52d3b42c4455ee3c5600158bb7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Apr 29 03:24:30 2022 +0000

    upstream: mention that the helpers are used by ssh(1), ssh-agent(1)
    
    and ssh-keygen(1). Previously only ssh(1) was mentioned. From Pedro
    Martelletto
    
    OpenBSD-Commit-ID: 30f880f989d4b329589c1c404315685960a5f153

commit 3e26b3a6eebcee27be177207cc0846fb844b7a56
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Apr 29 03:16:48 2022 +0000

    upstream: Don't leak SK device. Patch from Pedro Martelletto via
    
    github PR#316. ok djm@
    
    OpenBSD-Commit-ID: 17d11327545022e727d95fd08b213171c5a4585d

commit 247082b5013f0d4fcae8f97453f2a2f01bcda811
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Apr 29 03:13:32 2022 +0000

    upstream: fix memleak on session-bind path; from Pedro Martelletto, ok
    
    dtucker@
    
    OpenBSD-Commit-ID: e85899a26ba402b4c0717b531317e8fc258f0a7e

commit e05522008092ceb86a87bdd4ad7878424315db89
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Apr 28 02:53:31 2022 +0000

    upstream: avoid printing hash algorithm twice; from lucas AT sexy.is
    
    OpenBSD-Commit-ID: 9d24671e10a84141b7c504396cabad600e47a941

commit 0979e29356915261d69a9517a1e0aaade7c9fc75
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Apr 27 11:08:55 2022 +0000

    upstream: Add authfd path to debug output. ok markus@
    
    OpenBSD-Commit-ID: f735a17d1a6f2bee63bfc609d76ef8db8c090890

commit 67b7c784769c74fd4d6b147d91e17e1ac1a8a96d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Apr 26 07:41:44 2022 +0000

    upstream: Check sshauthopt_new() for NULL. bz#3425, from
    
    tessgauthier at microsoft.com.  ok djm@
    
    OpenBSD-Commit-ID: af0315bc3e44aa406daa7e0ae7c2d719a974483f

commit d571314d14b919fbd7c84a61f9bf2065fc0a6841
Author: millert@openbsd.org <millert@openbsd.org>
Date:   Wed Apr 20 16:00:25 2022 +0000

    upstream: Remove unnecessary includes: openssl/hmac.h and
    
    openssl/evp.h. From Martin Vahlensieck.
    
    OpenBSD-Commit-ID: a6debb5fb0c8a44e43e8d5ca7cc70ad2f3ea31c3

commit da8dddf8cc1f2516ff894b8183e83a7c5ba3ef80
Author: millert@openbsd.org <millert@openbsd.org>
Date:   Wed Apr 20 15:59:18 2022 +0000

    upstream: Add missing includes of stdlib.h and stdint.h. We need
    
    stdlib.h for malloc(3) and stdint.h for SIZE_MAX. Unlike the other xmss
    files, ssh-xmss.c does not include xmss_commons.h so ssh-xmss.c must include
    those headers itself. From Martin Vahlensieck
    
    OpenBSD-Commit-ID: 70e28a9818cee3da1be2ef6503d4b396dd421e6b

commit fe9d87a6800a7a33be08f4d5ab662a758055ced2
Author: millert@openbsd.org <millert@openbsd.org>
Date:   Wed Apr 20 15:56:49 2022 +0000

    upstream: Avoid an unnecessary xstrdup in rm_env() when matching
    
    patterns. Since match_pattern() doesn't modify its arguments (they are
    const), there is no need to make an extra copy of the strings in
    options->send_env. From Martin Vahlensieck
    
    OpenBSD-Commit-ID: 2c9db31e3f4d3403b49642c64ee048b2a0a39351

commit 7bf2eb958fbb551e7d61e75c176bb3200383285d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Apr 26 23:30:59 2022 +1000

    Add debian-riscv64 test target.

commit 3913c935523902482974c4c503bcff20bd850a6a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 25 17:20:06 2022 +1000

    Update OpenSSL and LibreSSL versions in tests.

commit dcd8dca29bcdb193ff6be35b96fc55e6e30d37d9
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 23 20:40:28 2022 +1000

    Include stdlib.h for free() prototype.
    
    ... which is used inside the CUSTOM_SYS_AUTH_GET_LASTLOGIN_MSG block.

commit 4cc05de568e1c3edd7834ff3bd9d8214eb34861b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 23 20:17:26 2022 +1000

    Cache timezone data in capsicum sandbox.
    
    From emaste at freebsd.org, originally part of FreeBSD commit r339216
    / fc3c19a9 with autoconf bits added by me.

commit c31404426d212e2964ff9e5e58e1d0fce3d83f27
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Apr 21 01:36:46 2022 +0000

    upstream: It looks like we can't completely avoid
    
    waiting for processes to exit so retrieve the pid via controlmaster and
    use that.
    
    OpenBSD-Regress-ID: 8246f00f22b14e49d2ff1744c94897ead33d457b

commit d19b21afab5c8e2f3df6bd8aee9766bdad3d8c58
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Apr 20 13:25:55 2022 +0000

    upstream: Use ssh -f and ControlPersist ..
    
    to start up test forwards and ssh -O stop to shut them down intead of
    sleep loops.  This speeds up the test by an order of magnitude.
    
    OpenBSD-Regress-ID: eb3db5f805100919b092a3b2579c611fba3e83e7

commit 5f76286a126721fa005de6edf3d1c7a265555f19
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Apr 20 05:24:13 2022 +0000

    upstream: Simplify forward-control test.
    
    Since we no longer need to support SSH1 we don't need to run shell
    commands on the other end of the connection and can use ssh -N instead.
    This also makes the test less racy.
    
    OpenBSD-Regress-ID: 32e94ce272820cc398f30b848b2b0f080d10302c

commit 687bbf23572d8bdf25cbbcdf8ac583514e1ba710
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Mar 31 03:07:33 2022 +0000

    upstream: regression test for sftp cp command
    
    OpenBSD-Regress-ID: c96bea9edde3a384b254785e7f9b2b24a81cdf82

commit f1233f19a6a9fe58f52946f50df4772f5b136761
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Apr 20 01:13:47 2022 +0000

    upstream: Import regenerated moduli
    
    OpenBSD-Commit-ID: f9a0726d957cf10692a231996a1f34e7f9cdfeb0

commit fec014785de198b9a325d1b94e324bb958c5fe7b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Apr 20 04:19:11 2022 +0000

    upstream: Try to continue running local I/O for channels in state
    
    OPEN during SSH transport rekeying. The most visible benefit is that it
    should make ~-escapes work in the client (e.g. to exit) if the connection
    happened to have stalled during a rekey event. Based work by and ok dtucker@
    
    OpenBSD-Commit-ID: a66e8f254e92edd4ce09c9f750883ec8f1ea5f45

commit e68154b0d4f0f5085a050ea896955da1b1be6e30
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Apr 20 01:13:47 2022 +0000

    upstream: Import regenerated moduli
    
    OpenBSD-Commit-ID: f9a0726d957cf10692a231996a1f34e7f9cdfeb0

commit 69928b106d8f0fa15b88cf3850d992ed81c44ae0
Author: tj@openbsd.org <tj@openbsd.org>
Date:   Sat Apr 16 00:22:31 2022 +0000

    upstream: list the correct version number
    
    for when usage of the sftp protocol became default and fix a typo
    from ed maste
    
    OpenBSD-Commit-ID: 24e1795ed2283fdeacf16413c2f07503bcdebb31

commit 21042a05c0b304c16f655efeec97438249d2e2cc
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Apr 12 05:09:49 2022 +0000

    upstream: Correct path for system known hosts file in description
    
    of IgnoreUserKnownHosts.  Patch from Martin Vahlensieck via tech@
    
    OpenBSD-Commit-ID: 9b7784f054fa5aa4d63cb36bd563889477127215

commit 53f4aff60a7c1a08a23917bd47496f8901c471f5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 16 14:33:20 2022 +1000

    Resync moduli.5 with upstream.
    
    1.18: remove duplicate publication year; carsten dot kunze at arcor dot de
    1.19: ssh-keygen's -G/-T have been replaced with -M generate/screen.

commit d2b888762b9844eb0d8eb59909cdf5af5159f810
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 16 14:31:13 2022 +1000

    Retire fbsd6 test VM.
    
    It's long since out of support, relatively slow (it's i686) and the
    compiler has trouble with PIE.

commit cd1f70009860a154b51230d367c55ea5f9a4504e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Apr 11 22:52:08 2022 +0000

    upstream: clear io_want/io_ready flags at start of poll() cycle;
    
    avoids plausible spin during rekeying if channel io_want flags are reused
    across cycles. ok markus@ deraadt@
    
    OpenBSD-Commit-ID: 91034f855b7c73cd2591657c49ac30f10322b967

commit aa1920302778273f7f94c2091319aba199068ca0
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Apr 8 05:43:39 2022 +0000

    upstream: Note that curve25519-sha256 was later published in
    
    RFC8731.  ok djm@
    
    OpenBSD-Commit-ID: 2ac2b5d642d4cf5918eaec8653cad9a4460b2743

commit 4673fa8f2be983f2f88d5afd754adb1a2a39ec9e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Apr 8 04:40:40 2022 +0000

    upstream: two defensive changes from Tobias Stoeckmann via GHPR287
    
    enforce stricter invarient for sshbuf_set_parent() - never allow
    a buffer to have a previously-set parent changed.
    
    In sshbuf_reset(), if the reallocation fails, then zero the entire
    buffer and not the (potentially smaller) default initial alloc size.
    
    OpenBSD-Commit-ID: 14583203aa5d50ad38d2e209ae10abaf8955e6a9

commit 26eef015e2d2254375e13afaaf753b78932b1bf5
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Apr 11 16:07:09 2022 +1000

    Revert "update build-aux files to match autoconf-2.71"
    
    This reverts commit 0a8ca39fac6ad19096b6c263436f8b2dd51606f2.
    
    It turns out that the checked-in copies of these files are actually newer
    than autoconf-2.71's copies, so this was effectively a downgrade.
    Spotted by Bo Anderson via github

commit 0a8ca39fac6ad19096b6c263436f8b2dd51606f2
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Apr 8 14:48:58 2022 +1000

    update build-aux files to match autoconf-2.71
    
    i.e. config.guess, config.sub and install-sh

commit 94eb6858efecc1b4f02d8a6bd35e149f55c814c8
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Apr 6 10:47:48 2022 +1000

    update version numbers for release

commit 8e4a8eadf4fe74e65e6492f34250f8cf7d67e8da
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Apr 4 22:45:25 2022 +0000

    upstream: openssh-9.0
    
    OpenBSD-Commit-ID: 0dfb461188f4513ec024c1534da8c1ce14c20b64

commit a9f23ea2e3227f406880c2634d066f6f50fa5eaa
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Thu Mar 31 17:58:44 2022 +0000

    upstream: ssh: document sntrup761x25519-sha512@openssh.com as
    
    default KEX
    
    OpenBSD-Commit-ID: 12545bfa10bcbf552d04d9d9520d0f4e98b0e171

commit 9ec2713d122af79d66ebb9c1d6d9ae8621a8945f
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Thu Mar 31 17:27:27 2022 +0000

    upstream: man pages: add missing commas between subordinate and
    
    main clauses
    
    jmc@ dislikes a comma before "then" in a conditional, so leave those
    untouched.
    
    ok jmc@
    
    OpenBSD-Commit-ID: 9520801729bebcb3c9fe43ad7f9776ab4dd05ea3

commit 3741df98ffaaff92b474ee70d8ef276b5882f85a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 4 23:52:11 2022 +1000

    Disable security key on fbsd6 test host.

commit 32c12236f27ae83bfe6d2983b67c9bc67a83a417
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 4 15:16:51 2022 +1000

    Specify TEST_SHELL=bash on AIX.
    
    The system shells cause the agent-restrict test to fail due to some
    quoting so explicitly specify bash until we can get configure to
    autmatically work around that.

commit 90452c8b69d065b7c7c285ff78b81418a75bcd76
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 1 23:38:44 2022 +1100

    Only return events from ppoll that were requested.
    
    If the underlying system's select() returns bits that were not in the
    request set, our ppoll() implementation can return revents for events
    not requested, which can apparently cause a hang.  Only return revents
    for activity in the requested event set.  bz#3416, analysis and fix by
    yaroslav.kuzmin at vmssoftware com, ok djm@

commit 6c49eb5fabc56f4865164ed818aa5112d09c31a8
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 1 23:21:40 2022 +1100

    Only run regression tests on slow VMs.

commit f67e47903977b42cb6abcd5565a61bd7293e4dc3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 1 23:21:06 2022 +1100

    Increase test timeout to allow slow VMs to finish

commit 02488c1b54065ddc4f25835dbd2618b2a2fe21f5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 1 16:27:38 2022 +1100

    Use bash or ksh if available for SH in Makefile.

commit 34c7018c316af4773e432066de28d0ef9d0888cd
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 1 14:56:54 2022 +1100

    Set Makefile SHELL as determined by configure.
    
    This should improve compatibility for users with non-POSIX shells.  If
    using Makefile.in directly (eg make -f Makefile.in distprep) then SHELL
    will need to be specified on the command line (along with MANFMT in that
    particular case).  ok djm@

commit 5b054d76402faab38c48377efd112426469553a0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 1 13:16:47 2022 +1100

    Skip slow tests on (very) slow test targets.

commit b275818065b31a865142c48c2acf6a7c1655c542
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Mar 31 14:11:36 2022 +1100

    depend

commit 3fa539c3ffaabd6211995512d33e29150f88c5c5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Mar 31 03:07:03 2022 +0000

    upstream: add a sftp client "cp" command that supports server-side
    
    copying of files. Useful for this task and for testing the copy-data
    extension. Patch from Mike Frysinger; ok dtucker@
    
    OpenBSD-Commit-ID: 1bb1b950af0d49f0d5425b1f267e197aa1b57444

commit 7988bfc4b701c4b3fe9b36c8561a3d1c5d4c9a74
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Mar 31 03:05:49 2022 +0000

    upstream: add support for the "corp-data" protocol extension to
    
    allow server-side copies to be performed without having to go via the client.
    Patch by Mike Frysinger, ok dtucker@
    
    OpenBSD-Commit-ID: 00aa510940fedd66dab1843b58682de4eb7156d5

commit 32dc1c29a4ac9c592ddfef0a4895eb36c1f567ba
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 30 21:13:23 2022 +0000

    upstream: select post-quantum KEX
    
    sntrup761x25519-sha512@openssh.com as the default; ok markus@
    
    OpenBSD-Commit-ID: f02d99cbfce22dffec2e2ab1b60905fbddf48fb9

commit d6556de1db0822c76ba2745cf5c097d9472adf7c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 30 21:10:25 2022 +0000

    upstream: fix poll() spin when a channel's output fd closes without
    
    data in the channel buffer. Introduce more exact packing of channel fds into
    the pollfd array. fixes bz3405 and bz3411; ok deraadt@ markus@
    
    OpenBSD-Commit-ID: 06740737849c9047785622ad5d472cb6a3907d10

commit 8a74a96d25ca4d32fbf298f6c0ac5a148501777d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 30 04:33:09 2022 +0000

    upstream: ssh is almost out of getopt() characters; note the
    
    remaining remaining available ones in a comment
    
    OpenBSD-Commit-ID: 48d38cef59d6bc8e84c6c066f6d601875d3253fd

commit 6d4fc51adb9d8a42f67b5474f02f877422379de6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 30 04:27:51 2022 +0000

    upstream: avoid NULL deref via ssh-keygen -Y find-principals.
    
    bz3409, reported by Mateusz Adamowski
    
    OpenBSD-Commit-ID: a3b2c02438052ee858e0ee18e5a288586b5df2c5

commit e937514920335b92b543fd9be79cd6481d1eb0b6
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Mar 28 17:51:03 2022 +1100

    Add AIX 5.1 test target.

commit 4bbe815ba974b4fd89cc3fc3e3ef1be847a0befe
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Mar 26 22:01:31 2022 +1100

    Drop leading "v" from release version identifier.
    
    It's present in the git tags but not in the release tarball names.
    Also drop extra "/" from URL path.

commit f5cdd3b3c275dffaebfca91df782dca29975e9ac
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Mar 26 16:28:04 2022 +1100

    Use tarballs when testing LibreSSL releases.
    
    This means they'll still work when the combination of -portable and
    openbsd github repos no longer match.

commit 24dc37d198f35a7cf71bf4d5384363c7ef4209d4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Mar 26 15:02:45 2022 +1100

    Remove now-unused passwd variable.

commit 5b467ceef2c356f0a77f5e8ab4eb0fac367e4d24
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Mar 26 13:15:44 2022 +1100

    Missing semicolon.

commit 2923d026e55998133c0f6e5186dca2a3c0fa5ff5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Mar 26 12:49:50 2022 +1100

    Factor out platform-specific locked account check.
    
    Also fixes an incorrect free on platforms with both libiaf and shadow
    passwords (probably only Unixware).  Prompted by github PR#284,
    originally from @c3h2_ctf and stoeckmann@.

commit d23efe4b12886ffe416be10bc0a7da6ca8aa72d1
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Mar 26 08:13:46 2022 +1100

    Add OpenWRT mips and mipsel test targets.

commit 16ea8b85838dd7a4dbeba4e51ac4f43fd68b1e5b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Mar 20 08:52:17 2022 +0000

    upstream: don't leak argument list; bz3404, reported by Balu
    
    Gajjala ok dtucker@
    
    OpenBSD-Commit-ID: fddc32d74e5dd5cff1a49ddd6297b0867eae56a6

commit a72bde294fe0518c9a44ba63864093a1ef2425e3
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Mar 20 08:51:21 2022 +0000

    upstream: make addargs() and replacearg() a little more robust and
    
    improve error reporting
    
    make freeargs(NULL) a noop like the other free functions
    
    ok dtucker as part of bz3403
    
    OpenBSD-Commit-ID: 15f86da83176978b4d1d288caa24c766dfa2983d

commit 731087d2619fa7f01e675b23f57af10d745e8af2
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 18 04:04:11 2022 +0000

    upstream: don't try to resolve ListenAddress directives in the sshd
    
    re-exec path - we're never going to use the result and if the operation fails
    then it can prevent connections from being accepted. Reported by Aaron
    Poffenberger; with / ok dtucker@
    
    OpenBSD-Commit-ID: 44c53a43909a328e2f5ab26070fdef3594eded60

commit 1c83c082128694ddd11ac05fdf31d70312ff1763
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 18 02:50:21 2022 +0000

    upstream: remove blank line
    
    OpenBSD-Commit-ID: d5e0182965b2fbfb03ad5f256d1a1ce5706bcddf

commit 807be68684da7a1fe969c399ddce2fafb7997dcb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 18 02:32:22 2022 +0000

    upstream: helpful comment
    
    OpenBSD-Commit-ID: e3315a45cb04e7feeb614d76ec80a9fe4ca0e8c7

commit a0b5816f8f1f645acdf74f7bc11b34455ec30bac
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 18 02:31:25 2022 +0000

    upstream: ssh-keygen -Y check-novalidate requires namespace or SEGV
    
    will ensue. Patch from Mateusz Adamowski via GHPR#307
    
    OpenBSD-Commit-ID: 99e8ec38f9feb38bce6de240335be34aedeba5fd

commit 5a252d54a63be30d5ba4be76210942d754a531c0
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Mar 15 05:27:37 2022 +0000

    upstream: improve DEBUG_CHANNEL_POLL debugging message
    
    OpenBSD-Commit-ID: 2275eb7bc4707d019b1a0194b9c92c0b78da848f

commit ce324cf58ba2840e31afeb996935800780c8fa4b
Author: cheloha@openbsd.org <cheloha@openbsd.org>
Date:   Sun Mar 13 23:27:54 2022 +0000

    upstream: ssh: xstrdup(): use memcpy(3)
    
    Copying the given string into the buffer with strlcpy(3) confers no
    benefit in this context because we have already determined the
    string's length with strlen(3) in order to allocate that buffer.
    
    Thread: https://marc.info/?l=openbsd-tech&m=164687525802691&w=2
    
    ok dtucker@ millert@
    
    OpenBSD-Commit-ID: f8bfc082e36e2d2dc4e1feece02fe274155ca11a

commit 2893c5e764557f48f9d6a929e224ed49c59545db
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Mar 11 18:43:58 2022 +1100

    Resync fmt_scaled. with OpenBSD.
    
    Fixes underflow reported in bz#3401.

commit 5ae31a0fdd27855af29f48ff027491629fff5979
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Mar 9 09:41:56 2022 +1100

    Provide killpg implementation.
    
    Based on github PR#301 for Tandem NonStop.

commit c41c84b439f4cd74d4fe44298a4b4037ddd7d2ae
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Mar 9 09:29:30 2022 +1100

    Check for missing ftruncate prototype.
    
    From github PR#301 in conjunction with rsbeckerca.

commit 8cf5275452a950869cb90eeac7d220b01f77b12e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Mar 8 20:04:06 2022 +1100

    Default to not using sandbox when cross compiling.
    
    On most systems poll(2) does not work when the number of FDs is reduced
    with setrlimit, so assume it doesn't when cross compiling and we can't
    run the test.  bz#3398.

commit 379b30120da53d7c84aa8299c26b18c51c2a0dac
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Mar 1 01:59:19 2022 +0000

    upstream: pack pollfd array before server_accept_loop() ppoll()
    
    call, and terminate sshd if ppoll() returns errno==EINVAL
    
    avoids spin in ppoll when MaxStartups > RLIMIT_NOFILE, reported by
    Daniel Micay
    
    feedback/ok deraadt
    
    OpenBSD-Commit-ID: dbab1c24993ac977ec24d83283b8b7528f7c2c15

commit eceafbe0bdbbd9bd2f3cf024ccb350666a9934dd
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Sun Feb 27 01:33:59 2022 +0000

    upstream: include rejected signature algorithm in error message and
    
    not the (useless) key type; ok djm@
    
    OpenBSD-Commit-ID: d0c0f552a4d9161203e07e95d58a76eb602a76ff

commit f2f3269423618a83157e18902385e720f9776007
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Feb 25 09:46:24 2022 +0000

    upstream: Remove the char * casts from arguments to do_lstat,
    
    do_readdir and do_stat paths since the underlying functions now take a const
    char *. Patch from vapier at gentoo.org.
    
    OpenBSD-Commit-ID: 9e4d964dbfb0ed683a2a2900711b88e7f1c0297b

commit 4a66dac052c5ff5047161853f36904607649e4f9
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Feb 25 02:09:27 2022 +0000

    upstream: save an unneccessary alloc/free, based on patch from
    
    Martin Vahlensieck; ok dtucker@
    
    OpenBSD-Commit-ID: 90ffbf1f837e509742f2c31a1fbf2c0fd376fd5f

commit 6f117cb151efe138ac57bdd8e26165f350328f5f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Mar 1 09:02:06 2022 +1100

    Remove unused ivbits argument from chacha_keysetup

commit 15974235dd528aeab0ec67fb92a0a1d733f62be2
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Mar 1 09:00:20 2022 +1100

    Add OPENBSD ORIGINAL marker.

commit f2ff669347d320532e7c1b63cdf5c62f46e73150
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Feb 28 22:21:36 2022 +1100

    No unused param warnings for clang-12 and gcc-11.
    
    These have too many false positives in -Werror tests on the github CI
    since we often provide empty stub functions for functionality not needed
    for particular configurations.

commit 96558ecd87adac62efa9a2b5479f686ab86b0be1
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Feb 26 14:10:41 2022 +1100

    Add debian-i386 test target.

commit 284b6e5394652d519e31782e3b3cdfd7b21d1a81
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Feb 26 14:06:14 2022 +1100

    Allow ppoll_time64 in seccomp sandbox.
    
    Should fix sandbox violations on (some? at least i386 and armhf) 32bit
    Linux platforms.  Patch from chutzpahu at gentoo.org and cjwatson at
    debian.org via bz#3396.

commit 0132056efabc5edb85c3c7105d2fb6dee41843c6
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 25 19:47:48 2022 +1100

    Improve handling of _getshort and _getlong.
    
    If the system native ones are exactly as required then use them,
    otherwise use the local versions mapped to another name to prevent
    name collisions.

commit 8e206e0dd6b9f757b07979e48f53ad5bf9b7b52b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 25 15:14:22 2022 +1100

    Constify utimes in compat library to match specs.
    
    Patch from vapier at chromium.org.

commit 1b2920e3b63db2eddebeec7330ffe8b723055573
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 25 13:50:56 2022 +1100

    ANSIfy getshort and getlong.
    
    These functions appear to have come from OpenBSD's lib/libc/net/res_comp.c
    which made this change in 2005.

commit 54a86f4f6e1c43a2ca2be23ef799ab8910d4af70
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 25 13:23:04 2022 +1100

    Use PICFLAG instead of hard coding -fPIC.

commit 3016ba47035ac3561aabd48e2be70167fe157d6a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 25 11:37:11 2022 +1100

    Add tests for latest releases of {Libre,Open}SSL.

commit f107467179428a0e3ea9e4aa9738ac12ff02822d
Author: Colin Watson <cjwatson@debian.org>
Date:   Thu Feb 24 16:04:18 2022 +0000

    Improve detection of -fzero-call-used-regs=all support
    
    GCC doesn't tell us whether this option is supported unless it runs into
    the situation where it would need to emit corresponding code.

commit 3383b2cac0e9275bc93c4b4760e6e048f537e1d6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Feb 23 21:21:49 2022 +0000

    upstream: free(3) wants stdlib.h
    
    OpenBSD-Commit-ID: 227a8c70a95b4428c49e46863c9ef4bd318a3b8a

commit a4537e79ab4ac6db4493c5158744b9ebde5efcb0
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Feb 23 21:21:16 2022 +0000

    upstream: put back the scp manpage changes for SFTP mode too
    
    OpenBSD-Commit-ID: 05dc53921f927e1b5e5694e1f3aa314549f2e768

commit 449bcb8403adfb9724805d02a51aea76046de185
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Wed Feb 23 19:01:00 2022 +0000

    upstream: and we go back to testing sftp-scp after the 8.9
    
    release...
    
    OpenBSD-Commit-ID: a80440168258adca543a4607b871327a279c569c

commit 166456cedad3962b83b848b1e9caf80794831f0f
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Feb 23 22:31:11 2022 +1100

    makedepend

commit 32ebaa0dbca5d0bb86e384e72bebc153f48413e4
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Feb 23 11:18:13 2022 +0000

    upstream: avoid integer overflow of auth attempts (harmless, caught
    
    by monitor)
    
    OpenBSD-Commit-ID: 488ad570b003b21e0cd9e7a00349cfc1003b4d86

commit 6e0258c64c901753df695e06498b26f9f4812ea6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Feb 23 11:17:10 2022 +0000

    upstream: randomise the password used in fakepw
    
    OpenBSD-Commit-ID: 34e159f73b1fbf0a924a9c042d8d61edde293947

commit bf114d6f0a9df0b8369823d9a0daa6c72b0c4cc9
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Feb 23 11:15:57 2022 +0000

    upstream: use asprintf to construct .rhosts paths
    
    OpenBSD-Commit-ID: 8286e8d3d2c6ff916ff13d041d1713073f738a8b

commit c07e154fbdc7285e9ec54e78d8a31f7325d43537
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Feb 23 11:07:09 2022 +0000

    upstream: openssh-8.9
    
    OpenBSD-Commit-ID: 5c5f791c87c483cdab6d9266b43acdd9ca7bde0e

commit bc16667b4a1c3cad7029304853c143a32ae04bd4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Feb 22 15:29:22 2022 +1100

    Extend select+rlimit sanbox test to include poll.
    
    POSIX specifies that poll() shall fail if "nfds argument is greater
    than {OPEN_MAX}".  The setrlimit sandbox sets this to effectively zero
    so this causes poll() to fail in the preauth privsep process.
    
    This is likely the underlying cause for the previously observed similar
    behaviour of select() on plaforms where it is implement in userspace on
    top of poll().

commit 6520c488de95366be031d49287ed243620399e23
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Feb 22 13:08:59 2022 +1100

    Add Alpine Linux test VM.

commit a4b325a3fc82d11e0f5d61f62e7fde29415f7afb
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Feb 22 12:27:07 2022 +1100

    Include sys/param.h if present.
    
    Needed for howmany() on MUSL systems such as Alpine.

commit 5a102e9cb287a43bd7dfe594b775a89a8e94697c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Feb 22 12:25:52 2022 +1100

    Only include sys/poll.h if we don't have poll.h.
    
    Prevents warnings on MUSL based systems such as Alpine.

commit 7c0d4ce911d5c58b6166b2db754a4e91f352adf5
Author: Damien Miller <djm@mindrot.org>
Date:   Tue Feb 22 11:14:51 2022 +1100

    disable agent-restrict test on minix3
    
    Minix seems to have a platform-wide limit on the number of
    select(2) syscalls that can be concurrently issued. This test
    seems to exceed this limit.
    
    Refer to:
    
    https://github.com/Stichting-MINIX-Research-Foundation/minix/blob/R3.3.0/minix/servers/vfs/select.c#L114
    https://github.com/Stichting-MINIX-Research-Foundation/minix/blob/R3.3.0/minix/servers/vfs/select.c#L30-L31

commit 81d33d8e3cf7ea5ce3a5653c6102b623e019428a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Feb 21 21:27:20 2022 +1100

    Skip agent-getpeereid when running as root.

commit fbd772570a25436a33924d91c164d2b24021f010
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Feb 20 03:47:26 2022 +0000

    upstream: Aproximate realpath on the expected output by deduping
    
    leading slashes. Fixes test failure when user's home dir is / which is
    possible in some portable configurations.
    
    OpenBSD-Regress-ID: 53b8c53734f8893806961475c7106397f98d9f63

commit 336685d223a59f893faeedf0a562e053fd84058e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Feb 20 13:30:52 2022 +1100

    Really move DSA to end of list.
    
    In commit ad16a84e syncing from OpenBSD, RSA was accidentally moved to
    the end of the list instead of DSA.  Spotted by andrew at fyfe.gb.net.

commit 63bf4f49ed2fdf2da6f97136c9df0c8168546eb3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 18 12:12:21 2022 +1100

    Add test configs for MUSL C library.

commit f7fc6a43f1173e8b2c38770bf6cee485a562d03b
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Feb 17 22:54:19 2022 +1100

    minix needs BROKEN_POLL too; chokes on /dev/null

commit 667fec5d4fe4406745750a32f69b5d2e1a75e94b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Feb 17 10:58:27 2022 +0000

    upstream: check for EINTR/EAGAIN failures in the rfd fast-path; caught
    
    by dtucker's minix3 vm :) ok dtucker@
    
    OpenBSD-Commit-ID: 2e2c895a3e82ef347aa6694394a76a438be91361

commit 41417dbda9fb55a0af49a8236e3ef9d50d862644
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Feb 17 22:05:29 2022 +1100

    Comment hurd test, the VM is currently broken.

commit b2aee35a1f0dc798339b3fcf96136da71b7e3f6d
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Feb 17 21:15:16 2022 +1100

    find sk-dummy.so when build_dir != src_dir
    
    spotted by Corinna Vinschen; feedback & ok dtucker@

commit 62a2d4e50b2e89f2ef04576931895d5139a5d037
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Feb 16 16:26:17 2022 +1100

    update versions in preparation for 8.9 release

commit dd6d3dded721ac653ea73c017325e5bfeeec837f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Feb 15 05:13:36 2022 +0000

    upstream: document the unbound/host-bound options to
    
    PubkeyAuthentication; spotted by HARUYAMA Seigo
    
    OpenBSD-Commit-ID: 298f681b66a9ecd498f0700082c7a6c46e948981

commit df93529dd727fdf2fb290700cd4f1adb0c3c084b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Feb 14 14:19:40 2022 +1100

    Test if sshd accidentally acquires controlling tty
    
    When SSHD_ACQUIRES_CTTY is defined, test for the problematic behaviour
    in the STREAMS code before activating the workaround.  ok djm@

commit 766176cfdbfd7ec38bb6118dde6e4daa0df34888
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Feb 12 10:24:56 2022 +1100

    Add cygwin-release test config.
    
    This tests the flags used to build the cygwin release binaries.

commit b30698662b862f5397116d23688aac0764e0886e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 11 21:00:35 2022 +1100

    Move SSHD_ACQUIRES_CTTY workaround into compat.
    
    On some (most? all?) SysV based systems with STREAMS based ptys,
    sshd could acquire a controlling terminal during pty setup when
    it pushed the "ptem" module, due to what is probably a bug in
    the STREAMS driver that's old enough to vote.  Because it was the
    privileged sshd's controlling terminal, it was not available for
    the user's session, which ended up without one.  This is known to
    affect at least Solaris <=10, derivatives such as OpenIndiana and
    several other SysV systems.  See bz#245 for the backstory.
    
    In the we past worked around that by not calling setsid in the
    privileged sshd child, which meant it was not a session or process
    group leader.  This solved controlling terminal problem because sshd
    was not eligble to acquire one, but had other side effects such as
    not cleaning up helper subprocesses in the SIGALRM handler since it
    was not PG leader.  Recent cleanups in the signal handler uncovered
    this, resulting in the LoginGraceTime timer not cleaning up privsep
    unprivileged processes.
    
    This change moves the workaround into the STREAMS pty allocation code,
    by allocating a sacrificial pty to act as sshd's controlling terminal
    before allocating user ptys, so those are still available for users'
    sessions.
    
    On the down side:
     - this will waste a pty per ssh connection on affected platforms.
    
    On the up side:
     - it makes the process group behaviour consistent between platforms.
    
     - it puts the workaround nearest the code that actually causes the
       problem and competely out of the mainline code.
    
     - the workaround is only activated if you use the STREAMS code.  If,
       say, Solaris 11 has the bug but also a working openpty() it doesn't
       matter that we defined SSHD_ACQUIRES_CTTY.
    
     - the workaround is only activated when the fist pty is allocated,
       ie in the post-auth privsep monitor.  This means there's no risk
       of fd leaks to the unprivileged processes, and there's no effect on
       sessions that do not allocate a pty.
    
    Based on analysis and work by djm@, ok djm@

commit cd00b48cf10f3565936a418c1e6d7e48b5c36140
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 11 20:09:32 2022 +1100

    Simplify handling of --with-ssl-dir.
    
    ok djm@

commit ea13fc830fc0e0dce2459f1fab2ec5099f73bdf0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 11 13:39:29 2022 +1100

    Stop testing OpenBSD HEAD on 6.9 and 7.0.
    
    HEAD is not guaranteed to work on previous stable branches, and at the
    moment is broken due to libfido API changes.

commit 50b9e4a4514697ffb9592200e722de6b427cb9ff
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Feb 11 00:43:56 2022 +0000

    upstream: Always initialize delim before passing to hpdelim2 which
    
    might not set it. Found by the Valgrind tests on github, ok deraadt@
    
    OpenBSD-Commit-ID: c830c0db185ca43beff3f41c19943c724b4f636d

commit 6ee53064f476cf163acd5521da45b11b7c57321b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Feb 11 10:03:06 2022 +1100

    Fix helper include path and remove excess code.
    
    Looks like test_hpdelim.c was imported twice into the same file.
    Spotted by kevin.brott at gmail com and chris at cataclysmal org.

commit 9fa63a19f68bc87452d3cf5c577cafad2921b7a4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Feb 10 23:27:02 2022 +1100

    Put poll.h inside ifdef.

commit 3ac00dfeb54b252c15dcbf1971582e9e3b946de6
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Feb 10 22:17:31 2022 +1100

    We now support POLLPRI so actually define it.

commit 25bd659cc72268f2858c5415740c442ee950049f
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Feb 6 22:58:33 2022 +0000

    upstream: Add test for empty hostname with port.
    
    OpenBSD-Regress-ID: e19e89d3c432b68997667efea44cf015bbe2a7e3

commit a29af853cff41c0635f0378c00fe91bf9c91dea4
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Feb 4 07:53:44 2022 +0000

    upstream: Add unit tests for hpdelim.
    
    OpenBSD-Regress-ID: be97b85c19895e6a1ce13c639765a3b48fd95018

commit 9699151b039ecc5fad9ac6c6c02e9afdbd26f15f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Feb 10 04:12:38 2022 +0000

    upstream: revert for imminent OpenSSH release, which wil ship with
    
    scp in RCP mode.
    
    > revision 1.106
    > date: 2021/10/15 14:46:46;  author: deraadt;  state: Exp;  lines: +13 -9;  commitid: w5n9B2RE38tFfggl;
    > openbsd 7.0 release shipped with the (hopefully last) scp that uses RCP
    > protocol for copying.  Let's get back to testing the SFTP protocol.
    
    This will be put back once the OpenSSH release is done.
    
    OpenBSD-Commit-ID: 0c725481a78210aceecff1537322c0b2df03e768

commit 45279abceb37c3cbfac8ba36dde8b2c8cdd63d32
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Feb 8 08:59:12 2022 +0000

    upstream: Switch hpdelim interface to accept only ":" as delimiter.
    
    Historicallly, hpdelim accepted ":" or "/" as a port delimiter between
    hosts (or addresses) and ports.  These days most of the uses for "/"
    are no longer accepted, so there are several places where it checks the
    delimiter to disallow it.  Make hpdelim accept only ":" and use hpdelim2
    in the other cases.  ok djm@
    
    OpenBSD-Commit-ID: 7e6420bd1be87590b6840973f5ad5305804e3102

commit a1bcbf04a7c2d81944141db7ecd0ba292d175a66
Author: pedro martelletto <pedro@yubico.com>
Date:   Mon Feb 7 09:09:59 2022 +0100

    fix typos in previous

commit 56192518e329b39f063487bc2dc4d796f791eca0
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Feb 7 12:53:47 2022 +1100

    compat code for fido_assert_set_clientdata()

commit d6b5aa08fdcf9b527f8b8f932432941d5b76b7ab
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Feb 7 01:25:12 2022 +0000

    upstream: use libfido2 1.8.0+ fido_assert_set_clientdata() instead
    
    of manually hashing data outselves. Saves a fair bit of code and makes life
    easier for some -portable platforms.
    
    OpenBSD-Commit-ID: 351dfaaa5ab1ee928c0e623041fca28078cff0e0

commit 86cc93fd3c26b2e0c7663c6394995fb04ebfbf3b
Author: jsg@openbsd.org <jsg@openbsd.org>
Date:   Sun Feb 6 00:29:03 2022 +0000

    upstream: remove please from manual pages ok jmc@ sthen@ millert@
    
    OpenBSD-Commit-ID: 6543acb00f4f38a23472538e1685c013ca1a99aa

commit ad16a84e64a8cf1c69c63de3fb9008320a37009c
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Feb 4 02:49:17 2022 +0000

    upstream: Since they are deprecated, move DSA to the end of the
    
    default list of public keys so that they will be tried last.  From github
    PR#295 from "ProBackup-nl", ok djm@
    
    OpenBSD-Commit-ID: 7e5d575cf4971d4e2de92e0b6d6efaba53598bf0

commit 253de42753de85dde266e061b6fec12ca6589f7d
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Feb 2 16:52:07 2022 +1100

    portable-specific string array constification
    
    from Mike Frysinger

commit dfdcc2220cf359c492d5d34eb723370e8bd8a19e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Feb 1 23:37:15 2022 +0000

    upstream: test 'ssh-keygen -Y find-principals' with wildcard
    
    principals; from Fabian Stelzer
    
    OpenBSD-Regress-ID: fbe4da5f0032e7ab496527a5bf0010fd700f8f40

commit 968e508967ef42480cebad8cf3172465883baa77
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jan 21 02:54:41 2022 +0000

    upstream: Enable all supported ciphers and macs in the server
    
    before trying to benchmark them.  Increase the data file size to get more
    signal.
    
    OpenBSD-Regress-ID: dc3697d9f7defdfc51c608782c8e750128e46eb6

commit 15b7199a1fd37eff4c695e09d573f3db9f4274b7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Feb 1 23:34:47 2022 +0000

    upstream: allow 'ssh-keygen -Y find-principals' to match wildcard
    
    principals in allowed_signers files; from Fabian Stelzer
    
    OpenBSD-Commit-ID: 1e970b9c025b80717dddff5018fe5e6f470c5098

commit 541667fe6dc26d7881e55f0bb3a4baa6f3171645
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Feb 1 23:32:51 2022 +0000

    upstream: mark const string array contents const too, i.e. static
    
    const char *array => static const char * const array from Mike Frysinger
    
    OpenBSD-Commit-ID: a664e31ea6a795d7c81153274a5f47b22bdc9bc1

commit 8cfa73f8a2bde4c98773f33f974c650bdb40dd3c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Feb 1 23:11:11 2022 +0000

    upstream: better match legacy scp behaviour: show un-expanded paths
    
    in error messages. Spotted by and ok tb@
    
    OpenBSD-Commit-ID: 866c8ffac5bd7d38ecbfc3357c8adfa58af637b7

commit 4e62c13ab419b4b224c8bc6a761e91fcf048012d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Feb 1 07:57:32 2022 +0000

    upstream: Remove explicit kill of privsep preauth child's PID in
    
    SIGALRM handler. It's no longer needed since the child will get terminated by
    the SIGTERM to the process group that cleans up any auth helpers, it
    simplifies the signal handler and removes the risk of a race when updating
    the PID. Based on analysis by HerrSpace in github PR#289, ok djm@
    
    OpenBSD-Commit-ID: 2be1ffa28b4051ad9e33bb4371e2ec8a31d6d663

commit 2a7ccd2ec4022917b745af7186f514f365b7ebe9
Author: guenther@openbsd.org <guenther@openbsd.org>
Date:   Fri Jan 28 06:18:42 2022 +0000

    upstream: When it's the possessive of 'it', it's spelled "its",
    
    without the apostrophe.
    
    OpenBSD-Commit-ID: fb6ab9c65bd31de831da1eb4631ddac018c5fae7

commit 8a0848cdd3b25c049332cd56034186b7853ae754
Author: Alex James <theracermaster@gmail.com>
Date:   Sun Jan 30 16:13:36 2022 -0600

    sandbox-seccomp-filter: allow gettid
    
    Some allocators (such as Scudo) use gettid while tracing allocations [1].
    Allow gettid in preauth to prevent sshd from crashing with Scudo.
    
    [1]: https://github.com/llvm/llvm-project/blob/llvmorg-13.0.0/compiler-rt/lib/gwp_asan/common.cpp#L46

commit b30d32159dc3c7052f4bfdf36357996c905af739
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 22 00:49:34 2022 +0000

    upstream: add a ssh_packet_process_read() function that reads from
    
    a fd directly into the transport input buffer.
    
    Use this in the client and server mainloops to avoid unnecessary
    copying. It also lets us use a more greedy read size without penalty.
    
    Yields a 2-3% performance gain on cipher-speed.sh (in a fairly
    unscientific test tbf)
    
    feedback dtucker@ ok markus@
    
    OpenBSD-Commit-ID: df4112125bf79d8e38e79a77113e1b373078e632

commit a1a8efeaaa9cccb15cdc0a2bd7c347a149a3a7e3
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 22 00:45:31 2022 +0000

    upstream: Use sshbuf_read() to read directly into the channel input
    
    buffer rather than into a stack buffer that needs to be copied again;
    Improves performance by about 1% on cipher-speed.sh feedback dtucker@ ok
    markus@
    
    OpenBSD-Commit-ID: bf5e6e3c821ac3546dc8241d8a94e70d47716572

commit 29a76994e21623a1f84d68ebb9dc5a3c909fa3a7
Author: Damien Miller <djm@mindrot.org>
Date:   Tue Jan 25 11:52:34 2022 +1100

    depend

commit 754e0d5c7712296a7a3a83ace863812604c7bc4f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 22 00:43:43 2022 +0000

    upstream: Add a sshbuf_read() that attempts to read(2) directly in
    
    to a sshbuf; ok markus@
    
    OpenBSD-Commit-ID: 2d8f249040a4279f3bc23c018947384de8d4a45b

commit c7964fb9829d9ae2ece8b51a76e4a02e8449338d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 21 07:04:19 2022 +0000

    upstream: add a helper for writing an error message to the
    
    stderr_buf and setting quit_pending; no functional change but saves a bunch
    of boilerplate
    
    OpenBSD-Commit-ID: 0747657cad6b9eabd514a6732adad537568e232d

commit d23b4f7fdb1bd87e2cd7a9ae7c198ae99d347916
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 21 06:58:06 2022 +0000

    upstream: correct comment and use local variable instead of long
    
    indirection; spotted by dtucker@
    
    OpenBSD-Commit-ID: 5f65f5f69db2b7d80a0a81b08f390a63f8845965

commit d069b020a02b6e3935080204ee44d233e8158ebb
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Fri Jan 21 00:53:40 2022 +0000

    upstream: When poll(2) returns -1, for some error conditions
    
    pfd[].revents is not cleared.  There are subtle errors in various programs.
    In this particular case, the program should error out. ok djm millert
    
    OpenBSD-Commit-ID: 00f839b16861f7fb2adcf122e95e8a82fa6a375c

commit e204b34337a965feb439826157c191919fd9ecf8
Author: Damien Miller <djm@mindrot.org>
Date:   Sat Jan 22 11:38:21 2022 +1100

    restore tty force-read hack
    
    This portable-specific hack fixes a hang on exit for ttyful sessions
    on Linux and some SysVish Unix variants. It was accidentally disabled
    in commit 5c79952dfe1a (a precursor to the mainloop poll(2) conversion).
    
    Spotted by John in bz3383

commit 68085066b6bad43643b43f5957fcc5fd34782ccd
Author: Corinna Vinschen <vinschen@redhat.com>
Date:   Fri Jan 21 03:22:56 2022 +1100

    Fix signedness bug in Cygwin code
    
    The Cygwin-specific pattern match code has a bug.  It checks
    the size_t value returned by mbstowcs for being < 0.  The right
    thing to do is to check against (size_t) -1.  Fix that.
    
    Signed-off-by: Corinna Vinschen <vinschen@redhat.com>

commit 2e5cfed513e84444483baf1d8b31c40072b05103
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Jan 20 13:26:27 2022 +1100

    Improve compatibility of early exit trap handling.
    
    Dash (as used by the github runners) has some differences in its trap
    builtin:
     - it doesn't have -p (which is fine, that's not in posix).
     - it doesn't work in a subshell (which turns out to be in compliance
       with posix, which means bash isn't).
     - it doesn't work in a pipeline, ie "trap|cat" produces no output.

commit 3fe6800b6027add478e648934cbb29d684e51943
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Jan 20 00:49:57 2022 +1100

    Move more tests out of valgrind-1 runner.

commit 20da6ed136dd76e6a0b229ca3036ef9c7c7ef798
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jan 19 15:37:39 2022 +1100

    Invoke EXIT handler early when using Valgrind.
    
    When using Valgrind, we need to wait for all invoked programs to
    complete before checking their valgrind logs.  Some tests, notably
    agent-restrict, set an EXIT trap handler to clean up things like
    ssh-agent, but those do not get invoked until test-exec.sh exits.
    This causes the Valgrind wait to deadlock, so if present invoke
    the EXIT handler before checking the Valgrind logs.

commit ad2e0580c87b0714cf166bca9d926a95ddeee1c8
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jan 18 12:55:21 2022 +1100

    Remove line leftover from upstream sync.

commit d1051c0f11a6b749027e26bbeb61b07df4b67e15
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jan 17 22:56:04 2022 +0000

    upstream: when decompressing zlib compressed packets, use
    
    Z_SYNC_FLUSH instead of Z_PARTIAL_FLUSH as the latter is not actually
    specified as a valid mode for inflate(). There should be no practical change
    in behaviour as the compression side ensures a flush that should make all
    data available to the receiver in all cases.
    
    repoted by lamm AT ibm.com via bz3372; ok markus
    
    OpenBSD-Commit-ID: 67cfc1fa8261feae6d2cc0c554711c97867cc81b

commit d5981b1883746b1ae178a46229c26b53af99e37a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jan 17 21:41:04 2022 +0000

    upstream: make most of the sftp errors more idiomatic, following
    
    the general form of "[local/remote] operation path: error message"; ok markus
    
    OpenBSD-Commit-ID: 61364cd5f3a9fecaf8d63b4c38a42c0c91f8b571

commit ac7c9ec894ed0825d04ef69c55babb49bab1d32e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jan 17 21:39:51 2022 +0000

    upstream: when transferring multiple files in SFTP mode, create the
    
    destination directory if it doesn't already exist to match olde-scp(1)
    behaviour. noticed by deraadt@ ok markus@
    
    OpenBSD-Commit-ID: cf44dfa231d4112f697c24ff39d7ecf2e6311407

commit 39d17e189f8e72c34c722579d8d4e701fa5132da
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 14 03:43:48 2022 +0000

    upstream: allow pin-required FIDO keys to be added to ssh-agent(1).
    
    ssh-askpass will be used to request the PIN at authentication time.
    
    From Pedro Martelletto, ok djm
    
    OpenBSD-Commit-ID: de8189fcd35b45f632484864523c1655550e2950

commit 52423f64e13db2bdc31a51b32e999cb1bfcf1263
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 14 03:35:10 2022 +0000

    upstream: ssh-sk: free a resident key's user id
    
    From Pedro Martelletto; ok dtucker & me
    
    OpenBSD-Commit-ID: 47be40d602b7a6458c4c71114df9b53d149fc2e9

commit 014e2f147a2788bfb3cc58d1b170dcf2bf2ee493
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 14 03:34:00 2022 +0000

    upstream: sshsk_load_resident: don't preallocate resp
    
    resp is allocated by client_converse(), at which point we lose
    the original pointer.
    
    From Pedro Martelletto; ok dtucker & me
    
    OpenBSD-Commit-ID: 1f1b5ea3282017d6584dfed4f8370dc1db1f44b1

commit c88265f207dfe0e8bdbaf9f0eda63ed6b33781cf
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 14 03:32:52 2022 +0000

    upstream: sshsk_sign: trim call to sshkey_fingerprint()
    
    the resulting fingerprint doesn't appear to be used for anything,
    and we end up leaking it.
    
    from Pedro Martelletto; ok dtucker & me
    
    OpenBSD-Commit-ID: 5625cf6c68f082bc2cbbd348e69a3ed731d2f9b7

commit 1cd1b2eac39661b849d5a4b4b56363e22bb5f61e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jan 14 03:31:52 2022 +0000

    upstream: use status error message to communicate ~user expansion
    
    failures; provides better experience for scp in sftp mode, where ~user paths
    are more likely to be used; spotted jsg, feedback jsg & deraadt ok jsg &
    markus
    
    (forgot to include this file in previous commit)
    
    OpenBSD-Commit-ID: d37cc4c8c861ce48cd6ea9899e96aaac3476847b

commit a1d42a6ce0398da3833bedf374ef2571af7fea50
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Jan 14 13:49:32 2022 +1100

    fix edge case in poll(2) wrapper
    
    Correct handling of select(2) exceptfds. These should only be consulted
    for POLLPRI flagged pfds and not unconditionally converted to POLLERR.
    
    with and ok dtucker@

commit 976b9588b4b5babcaceec4767a241c11a67a5ccb
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jan 14 13:46:35 2022 +1100

    Wrap OpenSSL includes in unit tests in ifdef.
    
    Fixes unit test on systems that do not have OpenSSL headers installed.

commit c171879374b2e8b07157503f5639ed0bce59ce89
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Jan 13 15:53:33 2022 +1100

    Remove sort wrapper.
    
    agent-restrict now takes care of this itself.

commit 9cc2654403f1a686bb26c07a6ac790edf334cef5
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jan 13 04:53:16 2022 +0000

    upstream: Set LC_ALL in both local and remote shells so that sorted
    
    output matches regardless of what the user's shell sets it to.  ok djm@
    
    OpenBSD-Regress-ID: 4e97dd69a68b05872033175a4c2315345d01837f

commit 7a75f748cb2dd2f771bf70ea72698aa027996ab1
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jan 13 04:22:10 2022 +0000

    upstream: Avoid %'s in commands (not used in OpenBSD, but used in
    
    -portable's Valgrind test) being interpretted as printf format strings.
    
    OpenBSD-Regress-ID: dc8655db27ac4acd2c386c4681bf42a10d80b043

commit 6c435bd4994d71442192001483a1cdb846e5ffcd
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jan 12 16:58:13 2022 +1100

    Stop on first test failure to minimize logs.

commit 4bc2ba6095620a4484b708ece12842afd8c7685b
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Jan 12 07:18:37 2022 +0000

    upstream: Use egrep when searching for an anchored string.
    
    OpenBSD-Regress-ID: dd114a2ac27ac4b06f9e4a586d3f6320c54aeeb4

commit 6bf2efa2679da1e8e60731f41677b2081dedae2c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jan 12 18:25:06 2022 +1100

    Add "rev" command replacement if needed.

commit 72bcd7993dadaf967bb3d8564ee31cbf38132b5d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Jan 12 03:30:32 2022 +0000

    upstream: Don't log NULL hostname in restricted agent code,
    
    printf("%s", NULL) is not safe on all platforms.  with & ok djm
    
    OpenBSD-Commit-ID: faf10cdae4adde00cdd668cd1f6e05d0a0e32a02

commit acabefe3f8fb58c867c99fed9bbf84dfa1771727
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jan 11 22:33:16 2022 +0000

    upstream: remove hardcoded domain and use window.location.host, so this
    
    can be run anywhere
    
    OpenBSD-Regress-ID: 2ac2ade3b6227d9c547351d3ccdfe671e62b7f92

commit 96da0946e44f34adc0397eb7caa6ec35a3e79891
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Jan 11 02:56:19 2022 +0000

    upstream: "void" functions should not return anything. From Tim Rice
    
    via -portable.
    
    OpenBSD-Commit-ID: ce6616304f4c9881b46413e616b226c306830e2a

commit a882a09722c9f086c9edb65d0c4022fd965ec1ed
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jan 11 01:26:47 2022 +0000

    upstream: suppress "Connection to xxx closed" messages at LogLevel >=
    
    error bz3378; ok dtucker@
    
    OpenBSD-Commit-ID: d5bf457d5d2eb927b81d0663f45248a31028265c

commit 61a1a6af22e17fc94999a5d1294f27346e6c4668
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Jan 12 08:57:49 2022 +1100

    OS X poll(2) is broken; use compat replacement
    
    Darwin's poll(2) implementation is broken. For character-special
    devices like /dev/null, it returns POLLNVAL when polled with
    POLLIN.
    
    Apparently this is Apple bug 3710161, which is AFAIK not public,
    but a websearch will find other OSS projects rediscovering it
    periodically since it was first identified in 2005 (!!)

commit 613a6545fc5a9542753b503cbe5906538a640b60
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jan 11 20:56:01 2022 +1100

    libhardended_malloc.so moved into out dir.

commit 61761340be5e11046556623f8f5412b236cefa95
Author: Tim Rice <tim@multitalents.net>
Date:   Mon Jan 10 11:07:04 2022 -0800

    Make USL compilers happy
    UX:acomp: ERROR: "sftp-server.c", line 567: void function cannot return value

commit 3ef403f351e80a59b6f7e9d43cb82c181855483c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jan 10 21:07:38 2022 +1100

    Add wrapper for "sort" to set LC_ALL=C.
    
    Found by djm, this should make sorts stable and reduce test flakiness.

commit bd69e29f5716090181dbe0b8272eb7eab1a383bb
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Jan 8 07:55:26 2022 +0000

    upstream: Remove errant "set -x" left over from debugging.
    
    OpenBSD-Regress-ID: cd989268e034264cec5df97be7581549032c87dc

commit 1a7c88e26fd673813dc5f61c4ac278564845e004
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Jan 8 07:01:13 2022 +0000

    upstream: Enable all supported hostkey algorithms (but no others).
    
    Allows hostbased test to pass when built without OpenSSL.
    
    OpenBSD-Regress-ID: 5ddd677a68b672517e1e78460dc6ca2ccc0a9562

commit 12b457c2a42ff271e7967d9bedd068cebb048db9
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 8 07:37:32 2022 +0000

    upstream: use status error message to communicate ~user expansion
    
    failures; provides better experience for scp in sftp mode, where ~user paths
    are more likely to be used; spotted jsg, feedback jsg & deraadt ok jsg &
    markus
    
    OpenBSD-Commit-ID: fc610ce00ca0cdc2ecdabbd49ce7cb82033f905f

commit 63670d4e9030bcee490d5a9cce561373ac5b3b23
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 8 07:36:11 2022 +0000

    upstream: fix some corner-case bugs in scp sftp-mode handling of
    
    ~-prefixed paths; spotted by jsg; feedback jsg & deraadt, ok jsg & markus
    
    OpenBSD-Commit-ID: d1697dbaaa9f0f5649d69be897eab25c7d37c222

commit e14940bbec57fc7d3ce0644dbefa35f5a8ec97d0
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 8 07:34:57 2022 +0000

    upstream: more idiomatic error messages; spotted by jsg & deraadt
    
    ok jsg & markus
    
    OpenBSD-Commit-ID: 43618c692f3951747b4151c477c7df22afe2bcc8

commit 9acddcd5918c623f7ebf454520ffe946a8f15e90
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 8 07:33:54 2022 +0000

    upstream: add a variant of send_status() that allows overriding the
    
    default, generic error message. feedback/ok markus & jsg
    
    OpenBSD-Commit-ID: 81f251e975d759994131b717ee7c0b439659c40f

commit 961411337719d4cd78f1ab33e4ac549f3fa22f50
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 8 07:32:45 2022 +0000

    upstream: refactor tilde_expand_filename() and make it handle ~user
    
    paths with no trailing slash; feedback/ok markus and jsg
    
    OpenBSD-Commit-ID: a2ab365598a902f0f14ba6a4f8fb2d07a9b5d51d

commit dc38236ab6827dec575064cac65c8e7035768773
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jan 6 22:14:25 2022 +0000

    upstream: Don't explicitly set HostbasedAuthentication in
    
    sshd_config. It defaults to "no", and not explicitly setting it allows us to
    enable it for the (optional) hostbased test.
    
    OpenBSD-Regress-ID: aa8e3548eb5793721641d26e56c29f363b767c0c

commit e12d912ddf1c873cb72e5de9a197afbe0b6622d2
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jan 6 21:46:56 2022 +0000

    upstream: Add test for hostbased auth. It requires some external
    
    setup (see comments at the top) and thus is disabled unless
    TEST_SSH_HOSTBASED_AUTH and SUDO are set.
    
    OpenBSD-Regress-ID: 3ec8ba3750c5b595fc63e7845d13483065a4827a

commit a48533a8da6a0f4f05ecd055dc8048047e53569e
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Jan 7 09:24:26 2022 +1100

    depend

commit d9dbb5d9a0326e252d3c7bc13beb9c2434f59409
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 22:06:51 2022 +0000

    upstream: allow hostbased auth to select RSA keys when only
    
    RSA/SHA2 are configured (this is the default case); ok markus@
    
    OpenBSD-Commit-ID: 411c18c7bde40c60cc6dfb7017968577b4d4a827

commit fdb1d58d0d3888b042e5a500f6ce524486aaf782
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 22:05:42 2022 +0000

    upstream: add a helper function to match a key type to a list of
    
    signature algorithms. RSA keys can make signatures with multiple algorithms,
    so some special handling is required. ok markus@
    
    OpenBSD-Commit-ID: 03b41b2bda06fa4cd9c84cef6095033b9e49b6ff

commit 11e8c4309a5086a45fbbbc87d0af5323c6152914
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 22:04:20 2022 +0000

    upstream: log some details on hostkeys that ssh loads for
    
    hostbased authn ok markus@
    
    OpenBSD-Commit-ID: da17061fa1f0e58cb31b88478a40643e18233e38

commit c6706f661739514a34125aa3136532a958929510
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 22:03:59 2022 +0000

    upstream: log signature algorithm during verification by monitor;
    
    ok markus
    
    OpenBSD-Commit-ID: 02b92bb42c4d4bf05a051702a56eb915151d9ecc

commit 8832402bd500d1661ccc80a476fd563335ef6cdc
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 22:02:52 2022 +0000

    upstream: piece of UpdateHostkeys client strictification: when
    
    updating known_hosts with new keys, ignore NULL keys (forgot to include in
    prior commit)
    
    OpenBSD-Commit-ID: 49d2eda6379490e1ceec40c3b670b973f63dea08

commit c2d9ced1da0276961d86690b3bd7ebdaca7fdbf7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 22:01:14 2022 +0000

    upstream: include rejected signature algorithm in error message
    
    and not the (useless) key type; ok markus
    
    OpenBSD-Commit-ID: 4180b5ec7ab347b43f84e00b1972515296dab023

commit 7aa7b096cf2bafe2777085abdeed5ce00581f641
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 22:00:18 2022 +0000

    upstream: make ssh-keysign use the requested signature algorithm
    
    and not the default for the keytype. Part of unbreaking hostbased auth for
    RSA/SHA2 keys. ok markus@
    
    OpenBSD-Commit-ID: b5639a14462948970da3a8020dc06f9a80ecccdc

commit 291721bc7c840d113a49518f3fca70e86248b8e8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 21:57:28 2022 +0000

    upstream: stricter UpdateHostkey signature verification logic on
    
    the client- side. Require RSA/SHA2 signatures for RSA hostkeys except when
    RSA/SHA1 was explicitly negotiated during initial KEX; bz3375
    
    ok markus@
    
    OpenBSD-Commit-ID: 46e75e8dfa2c813781805b842580dcfbd888cf29

commit 0fa33683223c76289470a954404047bc762be84c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 21:55:23 2022 +0000

    upstream: Fix signature algorithm selection logic for
    
    UpdateHostkeys on the server side. The previous code tried to prefer RSA/SHA2
    for hostkey proofs of RSA keys, but missed some cases. This will use RSA/SHA2
    signatures for RSA keys if the client proposed these algorithms in initial
    KEX. bz3375
    
    Mostly by Dmitry Belyavskiy with some tweaks by me.
    
    ok markus@
    
    OpenBSD-Commit-ID: c17ba0c3236340d2c6a248158ebed042ac6a8029

commit 17877bc81db3846e6e7d4cfb124d966bb9c9296b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 21:48:38 2022 +0000

    upstream: convert ssh, sshd mainloops from select() to poll();
    
    feedback & ok deraadt@ and markus@ has been in snaps for a few months
    
    OpenBSD-Commit-ID: a77e16a667d5b194dcdb3b76308b8bba7fa7239c

commit 5c79952dfe1aa36105c93b3f383ce9be04dee384
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Jan 6 21:46:23 2022 +0000

    upstream: prepare for conversion of ssh, sshd mainloop from
    
    select() to poll() by moving FD_SET construction out of channel handlers into
    separate functions. ok markus
    
    OpenBSD-Commit-ID: 937fbf2a4de12b19fb9d5168424e206124807027

commit 24c5187edfef4651a625b7d5d692c8c7e794f71f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 21:54:37 2022 +0000

    upstream: add a comment so I don't make this mistake again
    
    OpenBSD-Commit-ID: 69c7f2362f9de913bb29b6318580c5a1b52c921e

commit 7369900441929058263a17f56aa67e05ff7ec628
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 21:50:00 2022 +0000

    upstream: fix cut-and-pasto in error message
    
    OpenBSD-Commit-ID: 4cc5c619e4b456cd2e9bb760d17e3a9c84659198

commit 294c11b1c7d56d3fb61e329603a782315ed70c62
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 08:25:05 2022 +0000

    upstream: select all RSA hostkey algorithms for UpdateHostkeys tests,
    
    not just RSA-SHA1
    
    OpenBSD-Regress-ID: b40e62b65863f2702a0c10aca583b2fe76772bd8

commit 2ea1108c30e3edb6f872dfc1e6da10b041ddf2c0
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 04:56:15 2022 +0000

    upstream: regress test both sshsig message hash algorithms, possible
    
    now because the algorithm is controllable via the CLI
    
    OpenBSD-Regress-ID: 0196fa87acc3544b2b4fd98de844a571cb09a39f

commit 2327c306b5d4a2b7e71178e5a4d139af9902c2b0
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 04:50:11 2022 +0000

    upstream: allow selection of hash at sshsig signing time; code
    
    already supported either sha512 (default) or sha256, but plumbing wasn't
    there mostly by Linus Nordberg
    
    OpenBSD-Commit-ID: 1b536404b9da74a84b3a1c8d0b05fd564cdc96cd

commit 56e941d0a00d6d8bae88317717d5e1b7395c9529
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 04:27:54 2022 +0000

    upstream: add missing -O option to usage() for ssh-keygen -Y sign;
    
    from Linus Nordberg
    
    OpenBSD-Commit-ID: 4e78feb4aa830727ab76bb2e3d940440ae1d7af0

commit 141a14ec9b0924709c98df2dd8013bde5d8d12c7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 04:27:01 2022 +0000

    upstream: move sig_process_opts() to before sig_sign(); no
    
    functional code change
    
    OpenBSD-Commit-ID: da02d61f5464f72b4e8b299f83e93c3b657932f9

commit 37a14249ec993599a9051731e4fb0ac5e976aec1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 04:10:39 2022 +0000

    upstream: regression test for find-principals NULL deref; from Fabian
    
    Stelzer
    
    OpenBSD-Regress-ID: f845a8632a5a7d5ae26978004c93e796270fd3e5

commit eb1f042142fdaba93f6c9560cf6c91ae25f6884a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Jan 5 04:02:42 2022 +0000

    upstream: NULL deref when using find-principals when matching an
    
    allowed_signers line that contains a namespace restriction, but no
    restriction specified on the command-line; report and fix from Fabian Stelzer
    
    OpenBSD-Commit-ID: 4a201b86afb668c908d1a559c6af456a61f4b145

commit 8f3b18030579f395eca2181da31a5f945af12a59
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Jan 4 08:38:53 2022 +0000

    upstream: Log command invocation while debugging.
    
    This will aid in manually reproducing failing commands.
    
    OpenBSD-Regress-ID: b4aba8d5ac5675ceebeeeefa3261ce344e67333a

commit bbf285164df535f0d38c36237f007551bbdae27f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Dec 26 10:31:15 2021 +1100

    Always save config.h as build artifact.
    
    Should allow better comparison between failing and succeeding test
    platforms.

commit 03bd4ed0db699687c5cd83405d26f81d2dc28d22
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Dec 25 16:42:51 2021 +1100

    Add OpenBSD 7.0 target.  Retire 6.8.

commit c45a752f0de611afd87755c2887c8a24816d08ee
Author: jsg@openbsd.org <jsg@openbsd.org>
Date:   Sat Jan 1 05:55:06 2022 +0000

    upstream: spelling
    
    OpenBSD-Commit-ID: c63e43087a64d0727af13409c708938e05147b62

commit c672f83a89a756564db0d3af9934ba0e1cf8fa3e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jan 4 07:20:33 2022 +0000

    upstream: unbreak test: was picking up system ssh-add instead of the
    
    one supposedly being tested. Spotted by dtucker and using his VM zoo (which
    includes some systems old enough to lack ed25519 key support)
    
    OpenBSD-Regress-ID: 7976eb3df11cc2ca3af91030a6a8c0cef1590bb5

commit a23698c3082ffe661abed14b020eac9b0c25eb9f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jan 1 04:18:06 2022 +0000

    upstream: fix memleak in process_extension(); oss-fuzz issue #42719
    
    OpenBSD-Commit-ID: d8d49f840162fb7b8949e3a5adb8107444b6de1e

commit cb885178f36b83d0f14cfe9f345d2068103feed0
Author: jsg@openbsd.org <jsg@openbsd.org>
Date:   Sat Jan 1 01:55:30 2022 +0000

    upstream: spelling ok dtucker@
    
    OpenBSD-Commit-ID: bfc7ba74c22c928de2e257328b3f1274a3dfdf19

commit 6b977f8080a32c5b3cbb9edb634b9d5789fb79be
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 26 23:34:41 2021 +0000

    upstream: split method list search functionality from
    
    authmethod_lookup() into a separate authmethod_byname(), for cases where we
    don't need to check whether a method is enabled, etc.
    
    use this to fix the "none" authentication method regression reported
    by Nam Nguyen via bugs@
    
    ok deraadt@
    
    OpenBSD-Commit-ID: 8cd188dc3a83aa8abe5b7693e762975cd8ea8a17

commit 0074aa2c8d605ee7587279a22cdad4270b4ddd07
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Wed Dec 22 06:56:41 2021 +0000

    upstream: sort -H and -h in SYNOPSIS/usage(); tweak the -H text;
    
    ok djm
    
    OpenBSD-Commit-ID: 90721643e41e9e09deb5b776aaa0443456ab0965

commit 1c9853a68b2319f2e5f929179735e8fbb9988a67
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Dec 22 19:33:10 2021 +1100

    Use SHA.*_HMAC_BLOCK_SIZE if needed.
    
    If the platform has a native SHA2, does not define SHA.*_BLOCK_LENGTH
    but does define SHA.*_HMAC_BLOCK_SIZE (eg Solaris) then use the latter.
    Should fix --without-openssl build on Solaris.

commit 715c892f0a5295b391ae92c26ef4d6a86ea96e8e
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Dec 22 09:02:50 2021 +1100

    remove sys/param.h in -portable, after upstream

commit 7a7c69d8b4022b1e5c0afb169c416af8ce70f3e8
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Dec 20 13:05:20 2021 +1100

    add agent-restrict.sh file, missed in last commit

commit f539136ca51a4976644db5d0be8158cc1914c72a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:20:12 2021 +0000

    upstream: regression test for destination restrictions in ssh-agent
    
    OpenBSD-Regress-ID: 3c799d91e736b1753b4a42d80c42fc40de5ad33d

commit 6e4980eb8ef94c04874a79dd380c3f568e8416d6
Author: anton@openbsd.org <anton@openbsd.org>
Date:   Sat Dec 18 06:53:59 2021 +0000

    upstream: Make use of ntests variable, pointed out by clang 13.
    
    OpenBSD-Regress-ID: 4241a3d21bdfa1630ed429b6d4fee51038d1be72

commit 3eead8158393b697f663ec4301e3c7b6f24580b1
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Tue Dec 14 21:25:27 2021 +0000

    upstream: sys/param.h cleanup, mostly using MINIMUM() and
    
    <limits.h> ok dtucker
    
    OpenBSD-Regress-ID: 172a4c45d3bcf92fa6cdf6c4b9db3f1b3abe4db0

commit 266678e19eb0e86fdf865b431b6e172e7a95bf48
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:15:42 2021 +0000

    upstream: document host-bound publickey authentication
    
    OpenBSD-Commit-ID: ea6ed91779a81f06d961e30ecc49316b3d71961b

commit 3d00024b3b156aa9bbd05d105f1deb9cb088f6f7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:15:21 2021 +0000

    upstream: document agent protocol extensions
    
    OpenBSD-Commit-ID: 09e8bb391bbaf24c409b75a4af44e0cac65405a7

commit c385abf76511451bcba78568167b1cd9e90587d5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:14:47 2021 +0000

    upstream: PubkeyAuthentication=yes|no|unbound|host-bound
    
    Allow control over which pubkey methods are used. Added out of
    concern that some hardware devices may have difficulty signing
    the longer pubkey authentication challenges. This provides a
    way for them to disable the extension. It's also handy for
    testing.
    
    feedback / ok markus@
    
    OpenBSD-Commit-ID: ee52580db95c355cf6d563ba89974c210e603b1a

commit 34b1e9cc7654f41cd4c5b1cc290b999dcf6579bb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:14:12 2021 +0000

    upstream: document destination-constrained keys
    
    feedback / ok markus@
    
    OpenBSD-Commit-ID: cd8c526c77268f6d91c06adbee66b014d22d672e

commit a6d7677c4abcfba268053e5867f2acabe3aa371b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:13:55 2021 +0000

    upstream: Use hostkey parsed from hostbound userauth request
    
    Require host-bound userauth requests for forwarded SSH connections.
    
    The hostkey parsed from the host-bound userauth request is now checked
    against the most recently bound session ID / hostkey on the agent socket
    and the signature refused if they do not match.
    
    ok markus@
    
    OpenBSD-Commit-ID: d69877c9a3bd8d1189a5dbdeceefa432044dae02

commit baaff0ff4357cc5a079621ba6e2d7e247b765061
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:13:33 2021 +0000

    upstream: agent support for parsing hostkey-bound signatures
    
    Allow parse_userauth_request() to work with blobs from
    publickey-hostbound-v00@openssh.com userauth attempts.
    
    Extract hostkey from these blobs.
    
    ok markus@
    
    OpenBSD-Commit-ID: 81c064255634c1109477dc65c3e983581d336df8

commit 3e16365a79cdeb2d758cf1da6051b1c5266ceed7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:13:12 2021 +0000

    upstream: EXT_INFO negotiation of hostbound pubkey auth
    
    the EXT_INFO packet gets a new publickey-hostbound@openssh.com to
    advertise the hostbound public key method.
    
    Client side support to parse this feature flag and set the kex->flags
    indicator if the expected version is offered (currently "0").
    
    ok markus@
    
    OpenBSD-Commit-ID: 4cdb2ca5017ec1ed7a9d33bda95c1d6a97b583b0

commit 94ae0c6f0e35903b695e033bf4beacea1d376bb1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:12:54 2021 +0000

    upstream: client side of host-bound pubkey authentication
    
    Add kex->flags member to enable the publickey-hostbound-v00@openssh.com
    authentication method.
    
    Use the new hostbound method in client if the kex->flags flag was set,
    and include the inital KEX hostkey in the userauth request.
    
    Note: nothing in kex.c actually sets the new flag yet
    
    ok markus@
    
    OpenBSD-Commit-ID: 5a6fce8c6c8a77a80ee1526dc467d91036a5910d

commit 288fd0218dbfdcb05d9fbd1885904bed9b6d42e6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:12:30 2021 +0000

    upstream: sshd side of hostbound public key auth
    
    This is identical to the standard "publickey" method, but it also includes
    the initial server hostkey in the message signed by the client.
    
    feedback / ok markus@
    
    OpenBSD-Commit-ID: 7ea01bb7238a560c1bfb426fda0c10a8aac07862

commit dbb339f015c33d63484261d140c84ad875a9e548
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:12:07 2021 +0000

    upstream: prepare for multiple names for authmethods
    
    allow authentication methods to have one additional name beyond their
    primary name.
    
    allow lookup by this synonym
    
    Use primary name for authentication decisions, e.g. for
    PermitRootLogin=publickey
    
    Pass actual invoked name to the authmethods, so they can tell whether they
    were requested via the their primary name or synonym.
    
    ok markus@
    
    OpenBSD-Commit-ID: 9e613fcb44b8168823195602ed3d09ffd7994559

commit 39f00dcf44915f20684160f0a88d3ef8a3278351
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:11:39 2021 +0000

    upstream: ssh-agent side of destination constraints
    
    Gives ssh-agent the ability to parse restrict-destination-v00@openssh.com
    constraints and to apply them to keys.
    
    Check constraints against the hostkeys recorded for a SocketEntry when
    attempting a signature, adding, listing or deleting keys. Note that
    the "delete all keys" request will remove constrained keys regardless of
    location.
    
    feedback Jann Horn & markus@
    ok markus@
    
    OpenBSD-Commit-ID: 84a7fb81106c2d609a6ac17469436df16d196319

commit ce943912df812c573a33d00bf9e5435b7fcca3f7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:11:06 2021 +0000

    upstream: ssh-add side of destination constraints
    
    Have ssh-add accept a list of "destination constraints" that allow
    restricting where keys may be used in conjunction with a ssh-agent/ssh
    that supports session ID/hostkey binding.
    
    Constraints are specified as either "[user@]host-pattern" or
    "host-pattern>[user@]host-pattern".
    
    The first form permits a key to be used to authenticate as the
    specified user to the specified host.
    
    The second form permits a key that has previously been permitted
    for use at a host to be available via a forwarded agent to an
    additional host.
    
    For example, constraining a key with "user1@host_a" and
    "host_a>host_b". Would permit authentication as "user1" at
    "host_a", and allow the key to be available on an agent forwarded
    to "host_a" only for authentication to "host_b". The key would not
    be visible on agent forwarded to other hosts or usable for
    authentication there.
    
    Internally, destination constraints use host keys to identify hosts.
    The host patterns are used to obtain lists of host keys for that
    destination that are communicated to the agent. The user/hostkeys are
    encoded using a new restrict-destination-v00@openssh.com key
    constraint.
    
    host keys are looked up in the default client user/system known_hosts
    files. It is possible to override this set on the command-line.
    
    feedback Jann Horn & markus@
    ok markus@
    
    OpenBSD-Commit-ID: 6b52cd2b637f3d29ef543f0ce532a2bce6d86af5

commit 5e950d765727ee0b20fc3d2cbb0c790b21ac2425
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:10:24 2021 +0000

    upstream: ssh-add side of destination constraints
    
    Have ssh-add accept a list of "destination constraints" that allow
    restricting where keys may be used in conjunction with a ssh-agent/ssh
    that supports session ID/hostkey binding.
    
    Constraints are specified as either "[user@]host-pattern" or
    "host-pattern>[user@]host-pattern".
    
    The first form permits a key to be used to authenticate as the
    specified user to the specified host.
    
    The second form permits a key that has previously been permitted
    for use at a host to be available via a forwarded agent to an
    additional host.
    
    For example, constraining a key with "user1@host_a" and
    "host_a>host_b". Would permit authentication as "user1" at
    "host_a", and allow the key to be available on an agent forwarded
    to "host_a" only for authentication to "host_b". The key would not
    be visible on agent forwarded to other hosts or usable for
    authentication there.
    
    Internally, destination constraints use host keys to identify hosts.
    The host patterns are used to obtain lists of host keys for that
    destination that are communicated to the agent. The user/hostkeys are
    encoded using a new restrict-destination-v00@openssh.com key
    constraint.
    
    host keys are looked up in the default client user/system known_hosts
    files. It is possible to override this set on the command-line.
    
    feedback Jann Horn & markus@
    ok markus@
    
    OpenBSD-Commit-ID: ef47fa9ec0e3c2a82e30d37ef616e245df73163e

commit 4c1e3ce85e183a9d0c955c88589fed18e4d6a058
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:09:23 2021 +0000

    upstream: ssh-agent side of binding
    
    record session ID/hostkey/forwarding status for each active socket.
    
    Attempt to parse data-to-be-signed at signature request time and extract
    session ID from the blob if it is a pubkey userauth request.
    
    ok markus@
    
    OpenBSD-Commit-ID: a80fd41e292b18b67508362129e9fed549abd318

commit e9497ecf73f3c16667288bce48d4e3d7e746fea1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:08:48 2021 +0000

    upstream: ssh client side of binding
    
    send session ID, hostkey, signature and a flag indicating whether the
    agent connection is being forwarded to ssh agent each time a connection
    is opened via a new "session-bind@openssh.com" agent extension.
    
    ok markus@
    
    OpenBSD-Commit-ID: 2f154844fe13167d3ab063f830d7455fcaa99135

commit b42c61d6840d16ef392ed0f365e8c000734669aa
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Dec 19 22:08:06 2021 +0000

    upstream: Record session ID, host key and sig at intital KEX
    
    These will be used later for agent session ID / hostkey binding
    
    ok markus@
    
    OpenBSD-Commit-ID: a9af29e33772b18e3e867c6fa8ab35e1694a81fe

commit 26ca33d186473d58a32d812e19273ce078b6ffff
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Dec 7 22:06:45 2021 +0000

    upstream: better error message for FIDO keys when we can't match
    
    them to a token
    
    OpenBSD-Commit-ID: 58255c2a1980088f4ed144db67d879ada2607650

commit adb0ea006d7668190f0c42aafe3a2864d352e34a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Dec 15 10:50:33 2021 +1100

    Correct value for IPTOS_DSCP_LE.
    
    It needs to allow for the preceeding two ECN bits.  From daisuke.higashi
    at gmail.com via OpenSSH bz#3373, ok claudio@, job@, djm@.

commit 3dafd3fe220bd9046f11fcf5191a79ec8800819f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Dec 10 11:57:30 2021 +1100

    Increase timeout for test step.

commit 5aefb05cd5b843e975b191d6ebb7ddf8de35c112
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Dec 10 10:27:27 2021 +1100

    Update the list of tests that don't work on Minix.
    
    While there, remove CC (configure will now find clang) and make the test
    list easier to update via cut and paste.

commit 1c09bb1b2e207d091cec299c49416c23d24a1b31
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Dec 10 10:12:57 2021 +1100

    Add minix host tuple.
    
    Define SETEUID_BREAKS_SETUID for it which should make privsep work.

commit a2188579032cf080213a78255373263466cb90cc
Author: jsg@openbsd.org <jsg@openbsd.org>
Date:   Sun Dec 5 12:28:27 2021 +0000

    upstream: fix unintended sizeof pointer in debug path ok markus@
    
    OpenBSD-Commit-ID: b9c0481ffc0cd801e0840e342e6a282a85aac93c

commit da40355234068c82f1a36196f2d18dd2d81aaafd
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Sat Dec 4 00:05:39 2021 +0000

    upstream: RSA/SHA-1 is not used by default anymore on the server
    
    OpenBSD-Commit-ID: 64abef6cfc3e53088225f6b8a1dcd86d52dc8353

commit e9c71498a083a8b502aa831ea931ce294228eda0
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Dec 2 23:45:36 2021 +0000

    upstream: hash full host:port when asked to hash output, fixes hashes
    
    for non- default ports. bz3367 ok dtucker@
    
    OpenBSD-Commit-ID: 096021cc847da7318ac408742f2d0813ebe9aa73

commit b5601202145a03106012c22cb8980bcac2949f0b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Dec 2 23:23:13 2021 +0000

    upstream: improve the testing of credentials against inserted FIDO
    
    keys a little more: ask the token whether a particular key belongs to it in
    cases where the token support on-token user- verification (e.g. biometrics)
    rather than just assuming that it will accept it.
    
    Will reduce spurious "Confirm user presence" notifications for key
    handles that relate to FIDO keys that are not currently inserted in at
    least some cases.
    
    Motivated by bz3366; by Pedro Martelletto
    
    OpenBSD-Commit-ID: ffac7f3215842397800e1ae2e20229671a55a63d

commit ca709e27c41c90f4565b17282c48dca7756e083c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Dec 2 22:40:05 2021 +0000

    upstream: move check_sk_options() up so we can use it earlier
    
    OpenBSD-Commit-ID: 67fe98ba1c846d22035279782c4664c1865763b4

commit b711bc01a7ec76bb6a285730990cbce9b8ca5773
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Dec 2 22:35:05 2021 +0000

    upstream: ssh-rsa is no longer in the default for
    
    PubkeyAcceptedAlgorithms.
    
    OpenBSD-Commit-ID: 34a9e1bc30966fdcc922934ae00f09f2596cd73c

commit dc91ceea33cd4a9f05be953e8d8062f732db5c8a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Dec 2 02:44:44 2021 +0000

    upstream: don't put the tty into raw mode when SessionType=none, avoids
    
    ^c being unable to kill such a session. bz3360; ok dtucker@
    
    OpenBSD-Commit-ID: 83960c433052303b643b4c380ae2f799ac896f65

commit e6e7d2654a13ba10141da7b42ea683ea4eeb1f38
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Nov 29 14:11:03 2021 +1100

    previous commit broke bcrypt_pbkdf()
    
    Accidentally reverted part of the conversion to use SHA512 from SUPERCOP
    instead of OpenBSD-style libc SHA512.

commit c0459588b8d00b73e506c6095958ecfe62a4a7ba
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Nov 29 14:03:19 2021 +1100

    Fix typo in Neils' name.

commit 158bf854e2a22cf09064305f4a4e442670562685
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Nov 29 12:30:22 2021 +1100

    sync bcrypt-related files with OpenBSD
    
    The main change is that Niels Provos kindly agreed to rescind the
    BSD license advertising clause, shifting them to the 3-term BSD
    license.
    
    This was the last thing in OpenSSH that used the advertising clause.

commit e8976d92a42883ff6b8991438f07df60c2c0d82d
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Nov 29 12:29:29 2021 +1100

    depend

commit 8249afeec013e557fe7491a72ca3285de03e25b1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Nov 28 07:21:26 2021 +0000

    upstream: sshsig: return "key not found" when searching empty files
    
    rather than "internal error"
    
    OpenBSD-Commit-ID: e2ccae554c78d7a7cd33fc5d217f35be7e2507ed

commit 9e3227d4dbb5ad9c9091b4c14982cab4bba87b4d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Nov 28 07:15:10 2021 +0000

    upstream: ssh-keygen -Y match-principals doesn't accept any -O
    
    options at present, so don't say otherwise in SYNOPSIS; spotted jmc@
    
    OpenBSD-Commit-ID: 9cc43a18f4091010741930b48b3db2f2e4f1d35c

commit 56db1f4a4cf5039fc3b42e84c4b16291fdff32b1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Nov 28 07:14:29 2021 +0000

    upstream: fix indenting in last commit
    
    OpenBSD-Commit-ID: 8b9ba989815d0dec1fdf5427a4a4b58eb9cac4d2

commit 50bea24a9a9bdebad327c76e700def3261f5694e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Nov 28 07:10:18 2021 +0000

    upstream: missing initialisation for oerrno
    
    OpenBSD-Commit-ID: 05d646bba238080259bec821c831a6f0b48d2a95

commit 5a0f4619041d09cd29f3a08da41db5040372bdd1
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Nov 28 15:31:37 2021 +1100

    Correct ifdef to activate poll() only if needed.

commit d4035c81a71237f690edd7eda32bef7d63fd9528
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Nov 27 07:23:35 2021 +0000

    upstream: whitespac e
    
    OpenBSD-Regress-ID: b9511d41568056bda489e13524390167889908f8

commit a443491e6782ef0f5a8bb87a5536c8ee4ff233a1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Nov 27 07:20:58 2021 +0000

    upstream: regression test for match-principals. Mostly by Fabian
    
    Stelzer
    
    OpenBSD-Regress-ID: ced0bec89af90935103438986bbbc4ad1df9cfa7

commit 78230b3ec8cbabc1e7de68732dc5cbd4837c6675
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Nov 27 07:14:46 2021 +0000

    upstream: Add ssh-keygen -Y match-principals operation to perform
    
    matching of principals names against an allowed signers file.
    
    Requested by and mostly written by Fabian Stelzer, towards a TOFU
    model for SSH signatures in git. Some tweaks by me.
    
    "doesn't bother me" deraadt@
    
    OpenBSD-Commit-ID: 8d1b71f5a4127bc5e10a880c8ea6053394465247

commit 15db86611baaafb24c40632784dabf82e3ddb1a7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 25 23:02:24 2021 +0000

    upstream: debug("func: ...") -> debug_f("...")
    
    OpenBSD-Commit-ID: d58494dc05c985326a895adfbe16fbd5bcc54347

commit b7ffbb17e37f59249c31f1ff59d6c5d80888f689
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Nov 19 18:53:46 2021 +1100

    Allow for fd = -1 in compat ppoll overflow check.
    
    Fixes tests on at least FreeBSD 6, possibly others.

commit 04b172da5b96a51b0d55c905b423ababff9f4e0b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Nov 19 16:01:51 2021 +1100

    Don't auto-enable Capsicum sandbox on FreeBSD 9/10.
    
    Since we changed from select() to ppoll() tests have been failing.
    This seems to be because FreeBSD 10 (and presumably 9) do not allow
    ppoll() in the privsep process and sshd will fail with "Not permitted in
    capability mode".  Setting CAP_EVENT on the FDs doesn't help, but weirdly,
    poll() works without that.  Those versions are EOL so this situation is
    unlikely to change.

commit a823f39986e7b879f26412e64c15630e1cfa0dc5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 18 03:53:48 2021 +0000

    upstream: regression test for ssh-keygen -Y find-principals fix; from
    
    Fabian Stelzer ok djm markus
    
    OpenBSD-Regress-ID: 34fe4088854c1a2eb4c0c51cc4676ba24096bac4

commit 199c4df66c0e39dd5c3333b162af274678c0501d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 18 21:32:11 2021 +0000

    upstream: less confusing debug message; bz#3365
    
    OpenBSD-Commit-ID: 836268d3642c2cdc84d39b98d65837f5241e4a50

commit 97f9b6e61316c97a32dad94b7a37daa9b5f6b836
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 18 21:11:01 2021 +0000

    upstream: avoid xmalloc(0) for PKCS#11 keyid for ECDSA keys (we
    
    already did this for RSA keys). Avoids fatal errors for PKCS#11 libraries
    that return empty keyid, e.g. Microchip ATECC608B "cryptoauthlib"; bz#3364
    
    OpenBSD-Commit-ID: 054d4dc1d6a99a2e6f8eebc48207b534057c154d

commit c74aa0eb73bd1edf79947d92d9c618fc3424c4a6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 18 03:50:41 2021 +0000

    upstream: ssh-keygen -Y find-principals was verifying key validity
    
    when using ca certs but not with simple key lifetimes within the allowed
    signers file.
    
    Since it returns the first keys principal it finds this could
    result in a principal with an expired key even though a valid
    one is just below.
    
    patch from Fabian Stelzer; feedback/ok djm markus
    
    OpenBSD-Commit-ID: b108ed0a76b813226baf683ab468dc1cc79e0905

commit d902d728dfd81622454260e23bc09d5e5a9a795e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 18 23:44:07 2021 +1100

    Correct calculation of tv_nsec in poll().

commit 21dd5a9a3fb35e8299a1fbcf8d506f1f6b752b85
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 18 23:11:37 2021 +1100

    Add compat implementation of ppoll using pselect.

commit b544ce1ad4afb7ee2b09f714aa63efffc73fa93a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Nov 18 23:05:34 2021 +1100

    Put poll.h inside ifdef HAVE_POLL_H.

commit 875408270c5a7dd69ed5449e5d85bd7120c88f70
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 18 03:31:44 2021 +0000

    upstream: check for POLLHUP wherever we check for POLLIN
    
    OpenBSD-Commit-ID: 6aa6f3ec6b17c3bd9bfec672a917f003a76d93e5

commit 36b5e37030d35bbaa18ba56825b1af55971d18a0
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 18 03:07:59 2021 +0000

    upstream: fd leak in sshd listen loop error path; from Gleb
    
    Smirnoff
    
    OpenBSD-Commit-ID: a7a2be27a690a74bf2381bc16cea38e265657412

commit b99498d0c93f1edd04857b318308a66b28316bd8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 18 03:07:20 2021 +0000

    upstream: check for POLLHUP as well as POLLIN in sshd listen loop;
    
    ok deraadt millert
    
    OpenBSD-Commit-ID: a4f1244c5a9c2b08dac4f3b1dc22e9d1dc60c587

commit 1f3055d788e8cf80851eb1728b535d57eb0dba6a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Nov 18 03:06:03 2021 +0000

    upstream: check for POLLHUP as well as POLLIN, handle transient IO
    
    errors as well as half-close on the output side; ok deraadt millert
    
    OpenBSD-Commit-ID: de5c5b9939a37476d256328cbb96305bdecf511e

commit 9778a15fa6dbdac6a95bf15865c2688b4bd6944e
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Nov 18 10:16:55 2021 +1100

    adjust seccomp filter for select->poll conversion
    
    Needed to add ppoll syscall but also to relax the fallback rlimit
    sandbox. Linux poll() fails with EINVAL if npfds > RLIMIT_NOFILE,
    so we have to allow a single fd in the rlimit.

commit fcd8d895bbb849c64f0aed934e3303d37f696f5d
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Nov 18 10:16:44 2021 +1100

    update depends

commit 76292787a1e93e668f10e36b4bf59ce0ae28e156
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Nov 18 09:26:20 2021 +1100

    compat for timespecsub() and friends

commit fd7e7de4ddb4399c7e929b44f2bbfc118eddfcf8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Nov 17 21:06:39 2021 +0000

    upstream: set num_listen_socks to 0 on close-all instead of -1,
    
    which interferes with the new poll()-based listen loop; spotted and debugged
    by anton@+deraadt@
    
    OpenBSD-Commit-ID: f7ab8ab124f615a2e0c45fee14c38d2f2abbabbd

commit fd9343579afac30a971f06643a669733d9acb407
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Sun Nov 14 18:47:43 2021 +0000

    upstream: use ppoll() instead of pselect() with djm
    
    OpenBSD-Commit-ID: 980f87c9564d5d2ad55722b7a6f44f21284cd215

commit 092d29b232ef1a19609a5316ed7e4d896bb2e696
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Sun Nov 14 06:15:36 2021 +0000

    upstream: match .events with .fd better
    
    OpenBSD-Commit-ID: 77eef212ca0add905949532af390164489c5984b

commit 8d642c9a90fa4ed5a3effd785fb3591e14de00cd
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Sun Nov 14 03:25:10 2021 +0000

    upstream: convert select() to poll() ok djm
    
    OpenBSD-Commit-ID: b53e4940ff10dd24f8d16e8db8ef1970015d7ead

commit 6582a31c388968f4073af2bd8621880735c3d42b
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Sat Nov 13 21:14:13 2021 +0000

    upstream: replace select() with ppoll(), including converting
    
    timeval's to timespec's to make things easier. back and forth and ok; djm
    
    OpenBSD-Commit-ID: 89d3b23c60875da919e7820f9de6213286ffbec9

commit 7c025c005550c86a40200a2bcdd355d09413d61a
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Sat Nov 13 17:26:13 2021 +0000

    upstream: It really looks like pledge "stdio dns" is possible
    
    earlier. Discussed with mestre
    
    OpenBSD-Commit-ID: 610873de63a593e0ac7bbbcb7a0f2894d36f4c01

commit 06acb04c20ee483fe4757bd12aec870cc4bb1076
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Fri Nov 12 05:23:49 2021 +0000

    upstream: aggressively pre-fill the pollfd array with fd=-1
    
    OpenBSD-Commit-ID: c2a525de8f83c1a04405bd79122c424140552a5b

commit 7eec76793dec06e8f06b6cf71f9473141c69d109
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Thu Nov 11 15:32:32 2021 +0000

    upstream: Convert from select() to ppoll(). Along the way, I
    
    observed that the select() code was using exceptfds incorrectly.. ok millert
    
    OpenBSD-Commit-ID: 548e05bfc31b2af02319eb3d051286d4128dec96

commit e665ed2d0c24fe11d5470ce72fa1e187377d3fc4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Nov 12 22:55:27 2021 +1100

    Switch from LibreSSL 3.4.0 to 3.4.1.
    
    The LibreSSL 3.4.0 release has an OPENBSD_BRANCH that points to
    "master" and that branch no longer has the files LibreSSL expects
    and thus it will no longer build, breaking the test.

commit 21b6b5a06c8c53c548d25e6074c5240e88e2ef34
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Nov 10 06:29:25 2021 +0000

    upstream: add the sntrup761x25519-sha512@openssh.com hybrid
    
    ECDH/x25519 + Streamlined NTRU Prime post-quantum KEX to the default
    KEXAlgorithms list (after the ECDH methods but before the prime-group DH
    ones).
    
    ok markus@
    
    OpenBSD-Commit-ID: 22b77e27a04e497a10e22f138107579652854210

commit 239da797cbf07a640d7b1ea02d3f99ace3ef792d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Nov 10 06:25:08 2021 +0000

    upstream: fix ssh-keysign for KEX algorithms that use SHA384/512
    
    exchange hashes; feedback/ok markus@
    
    OpenBSD-Commit-ID: 09a8fda1c081f5de1e3128df64f28b7bdadee239

commit 6997a592ecb1013df0c6d7f8df3e6517827aef11
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Nov 8 21:32:49 2021 +0000

    upstream: improve error message when trying to expand a ~user path
    
    for a user that doesn't exist; better matches what the shell does
    
    ok deraadt@
    
    OpenBSD-Commit-ID: 1ddefa3c3a78b69ce13d1b8f67bc9f2cefd23ad6

commit 10b899a15c88eb40eb5f73cd0fa84ef0966f79c9
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Nov 10 12:34:25 2021 +1100

    Don't trust closefrom() on Linux.
    
    glibc's closefrom implementation does not work in a chroot when the kernel
    does not have close_range.  It tries to read from /proc/self/fd and when
    that fails dies with an assertion of sorts.  Instead, call close_range
    ourselves from our compat code and fall back if that fails.  bz#3349,
    with william.wilson at canonical.com and fweimer at redhat.com.

commit eb1f63195a9a38b519536a5b398d9939261ec081
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Nov 6 10:13:39 2021 +0000

    upstream: Plug a couple of minor mem leaks. From beldmit at
    
    gmail.com via github PR#283, ok markus@
    
    OpenBSD-Commit-ID: ec1fa7d305d46226861c3ca6fb9c9beb2ada2892

commit e4f501bf1d3b53f1cc23d9521fd7c5163307b760
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Nov 5 03:10:58 2021 +0000

    upstream: move cert_filter_principals() to earlier in the file for
    
    reuse; no code change
    
    OpenBSD-Commit-ID: 598fa9528b656b2f38bcc3cf5b6f3869a8c115cf

commit 59c60f96fee321c7f38f00372826d37f289534af
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Wed Nov 3 22:00:56 2021 +0000

    upstream: Many downstreams expect ssh to compile as non-C99...
    
    OpenBSD-Commit-ID: e6aa3e08bda68e5fb838fc8a49b1d2dfc38ee783

commit 7a78fe63b0b28ef7231913dfefe9d08f9bc41c61
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Nov 6 21:07:03 2021 +1100

    Skip getline() on HP-UX 10.x.
    
    HP-UX 10.x has a getline() implementation in libc that does not behave
    as we expect so don't use it.  With correction from Thorsten Glaser and
    typo fix from Larkin Nickle.

commit 343ae252ebb35c6ecae26b447bf1551a7666720e
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Nov 3 12:08:21 2021 +1100

    basic SECURITY.md (refers people to the website)

commit ed45a0168638319e0a710633f6085b96b9cec656
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Nov 2 22:57:27 2021 +0000

    upstream: crank SSH_SK_VERSION_MAJOR to match recent change in
    
    usr/bin/ssh
    
    OpenBSD-Regress-ID: 113d181c7e3305e138db9b688cdb8b0a0019e552

commit f3c34df860c4c1ebddacb973954e58167d9dbade
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Nov 2 22:56:40 2021 +0000

    upstream: Better handle FIDO keys on tokens that provide user
    
    verification (UV) on the device itself, including biometric keys.
    
    Query the token during key creation to determine whether it supports
    on-token UV and, if so, clear the SSH_SK_USER_VERIFICATION_REQD flag
    in the key so that ssh(1) doesn't automatically prompty for PIN later.
    
    When making signatures with the key, query the token's capabilities
    again and check whether the token is able (right now) to perform user-
    verification without a PIN. If it is then the PIN prompt is bypassed
    and user verification delegated to the token. If not (e.g. the token
    is biometric capable, but no biometric are enrolled), then fall back
    to user verification via the usual PIN prompt.
    
    Work by Pedro Martelletto; ok myself and markus@
    
    NB. cranks SSH_SK_VERSION_MAJOR
    
    OpenBSD-Commit-ID: e318a8c258d9833a0b7eb0236cdb68b5143b2f27

commit 0328a081f38c09d2d4d650e94461a47fb5eef536
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 29 03:03:06 2021 +0000

    upstream: sshsig: add tests for signing key validity and
    
    find-principals
    
    - adds generic find-principals tests (this command had none before)
    - tests certs with a timeboxed validity both with and without a
     restriced lifetime for the CA
    - test for a revoked CA cert
    
    by Fabian Stelzer
    
    OpenBSD-Regress-ID: 9704b2c6df5b8ccfbdf2c06c5431f5f8cad280c9

commit ccd358e1e25e25c13f0825996283cbf7a1647a3b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 29 02:48:19 2021 +0000

    upstream: avoid signedness warning; spotted in -portable
    
    OpenBSD-Regress-ID: 4cacc126086487c0ea7f3d86b42dec458cf0d0c6

commit 2741f52beb11490d7033a25e56ed0496f0c78006
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 29 03:20:46 2021 +0000

    upstream: ssh-keygen: make verify-time argument parsing optional
    
    From Fabian Stelzer
    
    OpenBSD-Commit-ID: 1ff35e4c366a45a073663df90381be6a8ef4d370

commit a1217d363b88b32cfe54c4f02c6c1cf4bdefdd23
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Oct 29 13:48:34 2021 +1100

    unbreak fuzz harness for recent changes

commit 68e522ed8183587c9367fa3842c5b75f64f3d12b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Oct 29 13:32:24 2021 +1100

    Use -Wbitwise-instead-of-logical if supported.

commit be28b23012aa3fa323be7ec84863cf238927c078
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Oct 28 16:24:53 2021 +1100

    use -Wmisleading-indentation cflag if available
    
    ok dtucker@

commit 2e6f5f24dd2f9217f4ab8b737ed428d5d5278f91
Author: Damien Miller <djm@mindrot.org>
Date:   Thu Oct 28 16:24:44 2021 +1100

    depend

commit a5ab4882348d26addc9830a44e053238dfa2cb58
Author: Damien Miller <djm@mindrot.org>
Date:   Thu May 6 10:08:30 2021 +1000

    remove built-in support for md5crypt()
    
    Users of MD5-hashed password should arrange for ./configure to link
    against libxcrypt or similar. Though it would be better to avoid use
    of MD5 password hashing entirely, it's arguably worse than DEScrypt.
    
    feedback and ok dtucker@

commit c5de1fffa6328b8246b87da28fa9df05813f76a3
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Oct 28 02:55:30 2021 +0000

    upstream: increment SSH_SK_VERSION_MAJOR to match last change
    
    OpenBSD-Regress-ID: 17873814d1cbda97f49c8528d7b5ac9cadf6ddc0

commit 0001d04e55802d5bd9d6dece1081a99aa4ba2828
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Oct 28 02:54:18 2021 +0000

    upstream: When downloading resident keys from a FIDO token, pass
    
    back the user ID that was used when the key was created and append it to the
    filename the key is written to (if it is not the default).
    
    Avoids keys being clobbered if the user created multiple
    resident keys with the same application string but different
    user IDs.
    
    feedback Pedro Martelletto; ok markus
    
    NB. increments SSH_SK_VERSION_MAJOR
    
    OpenBSD-Commit-ID: dbd658b5950f583106d945641a634bc6562dd3a3

commit d4bed5445646e605c383a4374fa962e23bf9e3a3
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Sun Oct 24 21:24:17 2021 +0000

    upstream: For open/openat, if the flags parameter does not contain
    
    O_CREAT, the 3rd (variadic) mode_t parameter is irrelevant.  Many developers
    in the past have passed mode_t (0, 044, 0644, or such), which might lead
    future people to copy this broken idiom, and perhaps even believe this
    parameter has some meaning or implication or application. Delete them all.
    This comes out of a conversation where tb@ noticed that a strange (but
    intentional) pledge behaviour is to always knock-out high-bits from mode_t on
    a number of system calls as a safety factor, and his bewilderment that this
    appeared to be happening against valid modes (at least visually), but no
    sorry, they are all irrelevant junk.  They could all be 0xdeafbeef. ok
    millert
    
    OpenBSD-Commit-ID: 503d11633497115688c0c6952686524f01f53121

commit d575cf44895104e0fcb0629920fb645207218129
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Oct 22 23:27:41 2021 +1100

    kitchensink test target now needs krb5.

commit 4ae39cada214e955bcfd3448ff28f0ed18886706
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Oct 22 22:54:33 2021 +1100

    Test both MIT KRB5 and Heimdal.

commit 22b2681d88619e5247dc53c9f112058a7e248d48
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Oct 22 10:51:57 2021 +0000

    upstream: Plug mem addrinfo mem leaks.
    
    Prevent mem leaks in the (unlikely) event that getaddrinfo returns
    no addresses.  ALso, remove an unneeded NULL check in addr_ntop. From
    khaleesicodes via github PR#281, ok deraadt@
    
    OpenBSD-Commit-ID: e8a5afc686376637c355c5f7e122dc4b080b9c1a

commit 27c8c343b610263f83ac2328735feeb881c6c92f
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Oct 22 09:22:04 2021 +0000

    upstream: Remove unnecessary semicolons
    
    ... in case statements. From khaleesicodes via github PR#280.
    
    OpenBSD-Commit-ID: e1e89360b65775cff83e77ce040b342015caf4ed

commit e7eb73b8d1fe1008d92433ea949491ce654bfaba
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Oct 22 09:19:34 2021 +0000

    upstream: Fix typos in comments.
    
    From khaleesicodes via github PR#280.
    
    OpenBSD-Commit-ID: 26fdd83652c40f098bf7c685e8ebb9eb72cc45fc

commit 052a9d8494175e24312daa6c132665e58c17fe6e
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Fri Oct 15 14:46:46 2021 +0000

    upstream: switch scp(1) back to sftp protocol.
    
    openbsd 7.0 release shipped with the (hopefully last) scp that uses RCP
    protocol for copying.  Let's get back to testing the SFTP protocol.
    
    OpenBSD-Commit-ID: 9eaa35d95fd547b78b0a043b3f518e135f151f30

commit a07664646bf6d293f5bbd45a5de54f3c36bb85da
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Oct 22 14:00:05 2021 +1100

    Source configs script so setup_ci can use settings

commit 34df52c201c6b47e5a46b50c215e4d98a8bf6587
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Oct 22 09:42:14 2021 +1100

    Install libedit and pam based on config flags.

commit 8c626cc563e8d21d844d06f9971a9ee01de6aa2a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Oct 21 16:53:39 2021 +1100

    Don't use 'here string", it's not POSIX.

commit 086a4b5977472aefa3de918b88efad0faf83b2b1
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Oct 21 15:33:27 2021 +1100

    Remove -Werror from compiler package to install.

commit 5a7a4687507d057f9b5e7497f3d3f82e64753c02
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Oct 21 15:00:53 2021 +1100

    Build with -Werror on most recent gcc and clang.

commit 4d2cbdb525d673acf941d48a7044fcf03125611a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Oct 15 12:59:06 2021 +1100

    Include string.h and stdio.h for strerror.

commit fff13aaa262b7b3ec83ed21e29674cbf331780a7
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Oct 15 12:43:36 2021 +1100

    Include error reason if trace disabling fails.

commit d4b38144c02f3faa5271e5fb35df93507e06f1b4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Oct 12 22:55:51 2021 +1100

    Add tcmalloc test target.

commit 002d65b0a30063c6e49bf8a53e709d8d5a0d45c1
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Oct 9 10:52:42 2021 +0000

    upstream: Document that CASignatureAlgorithms, ExposeAuthInfo and
    
    PubkeyAuthOptions can be used in a Match block.  Patch from eehakkin via
    github PR#277.
    
    OpenBSD-Commit-ID: c0a63f5f52e918645967ac022b28392da4b866aa

commit 40bd3709dddaae3a1b6113748bec3faa6a607531
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Oct 7 15:55:49 2021 +1100

    Skip SK unit tests when built without security-key

commit 482f73be10f10b93f818df19fcc8a912c0c371fc
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Oct 7 15:55:04 2021 +1100

    Include relevant env vars on command line.
    
    Makes it easier to reproduce a build by cut/pasting the configure line.

commit ef5916b8acd9b1d2f39fad4951dae03b00dbe390
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Oct 7 14:28:02 2021 +1100

    Only enable sk-* key types if ENABLE_SK is defined

commit 52d4232b493a9858fe616e28a8bbcc89afa2ad4d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Oct 6 18:14:37 2021 +1100

    Disable security key on minix3.
    
    The test doesn't work so disable.

commit 7cd062c3a29669b8d7dc2a97e6575f4dcb7d35a2
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Oct 6 17:45:28 2021 +1100

    Add USE_LIBC_SHA2 for (at least) NetBSD 9.

commit 639c440f6c3c2a8216a5eb9455ef13bf4204089c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Oct 6 17:09:31 2021 +1100

    Define OPENSSL_NO_SHA including OpenSSL from test.
    
    We don't use SHA256 from OpenSSL in the sk-dummy module and the
    definitions can conflict with system sha2.h (eg on NetBSD) so define
    OPENSSL_NO_SHA so we don't attempt to redefine them.

commit 8f4be526a338d06624f146fa26007bb9dd3a4f7b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Oct 6 15:40:58 2021 +1100

    Disable security key on NetBSD4 test.
    
    sk-dummy used for the security key test includes both sha2.h and OpenSSL
    causing the definitions conflict so disable security key support on this
    platform.

commit 3b353ae58aa07a1cbbeb1da3ace21fc0dcccd66a
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Oct 6 15:07:01 2021 +1100

    clean regress/misc/sk-dummy in cleandir target

commit 57680a2ab43518c5ccbd8242c40482106cde6ac1
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Oct 2 03:17:01 2021 +0000

    upstream: Dynamically allocate encoded HashKnownHosts and free as
    
    appropriate. Saves 1k of static storage and prevents snprintf "possible
    truncation" warnings from newer compilers (although in this case it's false
    positive since the actual sizes are limited by the output size of the SHA1).
    ok djm@
    
    OpenBSD-Commit-ID: e254ae723f7e3dce352c7d5abc4b6d87faf61bf4

commit e3e62deb549fde215b777d95276c304f84bf00c6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Oct 6 03:35:13 2021 +0000

    upstream: use libc SHA256 functions; make this work when compiled
    
    !WITH_OPENSSL
    
    OpenBSD-Regress-ID: fda0764c1097cd42f979ace29b07eb3481259890

commit 12937d867019469ebce83c2ff614cdc6688fc2d8
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Oct 1 05:20:20 2021 +0000

    upstream: Add test for ssh hashed known_hosts handling.
    
    OpenBSD-Regress-ID: bcef3b3cd5a1ad9899327b4b2183de2541aaf9cf

commit 5a37cc118f464416d08cd0291a9b1611d8de9943
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Oct 6 13:16:21 2021 +1100

    fix broken OPENSSL_HAS_ECC test
    
    spotted by dtucker

commit 16a25414f303cd6790eb967aeb962040e32c9c7a
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Oct 1 22:40:06 2021 +1000

    make sk-dummy.so work without libcrypto installed

commit dee22129bbc61e25b1003adfa2bc584c5406ef2d
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Oct 1 16:35:49 2021 +1000

    make OPENSSL_HAS_ECC checks more thorough
    
    ok dtucker

commit 872595572b6c9a584ed754165e8b7c4c9e7e1d61
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Oct 1 16:35:05 2021 +1000

    fix FIDO key support for !OPENSSL_HAS_ECC case
    
    ok dtucker

commit 489741dc68366940d369ac670b210b4834a6c272
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Oct 1 14:51:37 2021 +1000

    enable security key support for --without-openssl

commit c978565c8589acfe4ea37ab5099d39c84158c713
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Oct 1 13:27:50 2021 +1000

    need stdlib.h for free(3)

commit 76a398edfb51951b2d65d522d7b02c72304db300
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Sep 30 05:26:26 2021 +0000

    upstream: Fix up whitespace left by previous
    
    change removing privsep.  No other changes.
    
    OpenBSD-Regress-ID: 87adec225d8afaee4d6a91b2b71203f52bf14b15

commit ddcb53b7a7b29be65d57562302b2d5f41733e8dd
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Sep 30 05:20:08 2021 +0000

    upstream: Remove references to privsep.
    
    This removes several do..while loops but does not change the
    indentation of the now-shallower loops, which will be done in a separate
    whitespace-only commit to keep changes of style and substance separate.
    
    OpenBSD-Regress-ID: 4bed1a0249df7b4a87c965066ce689e79472a8f7

commit ece2fbe486164860de8df3f8b943cccca3085eff
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Sep 30 04:22:50 2021 +0000

    upstream: Use "skip" instead of "fatal"
    
    if SUDO isn't set for the *-command tests. This means running "make tests"
    without SUDO set will perform all of the tests that it can instead of
    failing on the ones it cannot run.
    
    OpenBSD-Regress-ID: bd4dbbb02f34b2e8c890558ad4a696248def763a

commit bb754b470c360e787a99fb4e88e2668198e97b41
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Oct 1 04:50:36 2021 +0000

    upstream: unbreak FIDO sk-ed25519 key enrollment for OPENSSL=no builds;
    
    ok dtucker@
    
    OpenBSD-Commit-ID: 6323a5241728626cbb2bf0452cf6a5bcbd7ff709

commit 207648d7a6415dc915260ca75850404dbf9f0a0b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 20:03:58 2021 +1000

    Include stdlib.h for arc4random_uniform prototype.

commit 696aadc854582c164d5fc04933d2f3e212dc0e06
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 20:00:30 2021 +1000

    Look for clang after cc and gcc.

commit a3c6375555026d85dbf811fab566b9f76f196144
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 19:30:59 2021 +1000

    Use backticks instead of $(..) for portability.
    
    Older shells (eg /bin/sh on Solaris 10) don't support $() syntax.

commit 958aaa0387133d51f84fe9c8f30bca03025f2867
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 18:53:32 2021 +1000

    Skip file-based tests by default on Mac OS.
    
    The file-based tests need OpenSSL so skip them.

commit 55c8bdf6e9afb0f9fa8e4f10c25c7f0081b48fd0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 18:42:47 2021 +1000

    Build without OpenSSL on Mac OS.
    
    Modern versions don't ship enough libcrypto to build against.

commit c9172193ea975415facf0afb356d87df21535f88
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 18:33:38 2021 +1000

    Remove TEST_SSH_ECC.
    
    Convert the only remaining user of it to runtime detection using ssh -Q.

commit 5e6d28b7874b0deae95d2c68947c45212d32e599
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 17:48:09 2021 +1000

    Split c89 test openssl setting out.

commit c4ac7f98e230e83c015678dc958b1ffe828564ad
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 17:40:50 2021 +1000

    Expand TEST_SHELL consistently with other vars.

commit cfe5f7b0eb7621bfb0a756222de0431315c2ab8b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 17:26:50 2021 +1000

    Replace `pwd` with make variable in regress cmd.

commit 899be59da5fbc3372444bd0fbe74af48313bed33
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 17:14:33 2021 +1000

    Get BUILDDIR from autoconf.
    
    Use this to replace `pwd`s in regress test command line.

commit c8d92d3d4f7d560146f2f936156ec4dac3fc5811
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 13:28:56 2021 +1000

    Add make clean step to tests.

commit 360fb41ef8359619ab90b0d131c914494e55d3dd
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 11:36:13 2021 +1000

    Test all available clang and gcc versions.

commit 4fb49899d7da22952d35a4bc4c9bdb2311087893
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Sep 29 01:32:21 2021 +0000

    upstream: Test certificate hostkeys held in ssh-agent too. Would have
    
    caught regression fixed in sshd r1.575
    
    ok markus@
    
    OpenBSD-Regress-ID: 1f164d7bd89f83762db823eec4ddf2d2556145ed

commit ce4854e12e749a05646e5775e9deb8cfaf49a755
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Sep 29 01:33:32 2021 +0000

    upstream: add some debug output showing how many key file/command lines
    
    were processed. Useful to see whether a file or command actually has keys
    present
    
    OpenBSD-Commit-ID: 0bd9ff94e84e03a22df8e6c12f6074a95d27f23c

commit 15abdd523501c349b703d9a27e2bb4252ad921ef
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Sep 28 11:14:50 2021 +0000

    upstream: Make prototype for rijndaelEncrypt match function
    
    including the bounds. Fixes error in portable where GCC>=11 takes notice of
    the bounds. ok deraadt@
    
    OpenBSD-Commit-ID: cdd2f05fd1549e1786a70871e513cf9e9cf099a6

commit d1d29ea1d1ef1a1a54b209f062ec1dcc8399cf03
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Sep 28 11:10:05 2021 +0000

    upstream: Import regenerated moduli.
    
    OpenBSD-Commit-ID: 4bec5db13b736b64b06a0fca704cbecc2874c8e1

commit 39f2111b1d5f00206446257377dcce58cc72369f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 29 10:53:55 2021 +1000

    Add new compiler hardening flags.
    
    Add -fzero-call-used-regs and -ftrivial-auto-var-init to the list of
    compiler hardening flags that configure checks for.  These are supported
    by clang and gcc, and make ROP gadgets less useful and mitigate
    stack-based infoleaks respectively.  ok djm@

commit bf944e3794eff5413f2df1ef37cddf96918c6bde
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Sep 27 00:03:19 2021 +1000

    initgroups needs grp.h

commit 8c5b5655149bd76ea21026d7fe73ab387dbc3bc7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Sep 26 14:01:11 2021 +0000

    upstream: openssh-8.8
    
    OpenBSD-Commit-ID: 12357794602ac979eb7312a1fb190c453f492ec4

commit f3cbe43e28fe71427d41cfe3a17125b972710455
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Sep 26 14:01:03 2021 +0000

    upstream: need initgroups() before setresgid(); reported by anton@,
    
    ok deraadt@
    
    OpenBSD-Commit-ID: 6aa003ee658b316960d94078f2a16edbc25087ce

commit 8acaff41f7518be40774c626334157b1b1c5583c
Author: Damien Miller <djm@mindrot.org>
Date:   Sun Sep 26 22:16:36 2021 +1000

    update version numbers for release

commit d39039ddc0010baa91c70a0fa0753a2699bbf435
Author: kn@openbsd.org <kn@openbsd.org>
Date:   Sat Sep 25 09:40:33 2021 +0000

    upstream: RSA/SHA-1 is not used by default anymore
    
    OK dtucker deraadt djm
    
    OpenBSD-Commit-ID: 055c51a221c3f099dd75c95362f902da1b8678c6

commit 9b2ee74e3aa8c461eb5552a6ebf260449bb06f7e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Sep 24 11:08:03 2021 +1000

    Move the fgrep replacement to hostkey-rotate.sh.
    
    The fgrep replacement for buggy greps doesn't work in the sftp-glob test
    so move it to just where we know it's needed.

commit f7039541570d4b66d76e6f574544db176d8d5c02
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Sep 24 08:04:14 2021 +1000

    Replacement function for buggy fgrep.
    
    GNU (f)grep <=2.18, as shipped by FreeBSD<=12 and NetBSD<=9 will
    occasionally fail to find ssh host keys in the hostkey-rotate test.
    If we have those versions, use awk instead.

commit f6a660e5bf28a01962af87568e118a2d2e79eaa0
Author: David Manouchehri <david.manouchehri@riseup.net>
Date:   Thu Sep 23 17:03:18 2021 -0400

    Don't prompt for yes/no questions.

commit 7ed1a3117c09f8c3f1add35aad77d3ebe1b85b4d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 20 06:53:56 2021 +0000

    upstream: fix missing -s in SYNOPSYS and usage() as well as a
    
    capitalisation mistake; spotted by jmc@
    
    OpenBSD-Commit-ID: 0ed8ee085c7503c60578941d8b45f3a61d4c9710

commit 8c07170135dde82a26886b600a8bf6fb290b633d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Sep 20 04:02:13 2021 +0000

    upstream: Fix "Allocated port" debug message
    
    for unix domain sockets. From peder.stray at gmail.com via github PR#272,
    ok deraadt@
    
    OpenBSD-Commit-ID: 8d5ef3fbdcdd29ebb0792b5022a4942db03f017e

commit 277d3c6adfb128b4129db08e3d65195d94b55fe7
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Sep 20 01:55:42 2021 +0000

    upstream: Switch scp back to use the old protocol by default, ahead of
    
    release. We'll wait a little longer for people to pick up sftp-server(8) that
    supports the extension that scp needs for ~user paths to continue working in
    SFTP protocol mode. Discussed with deraadt@
    
    OpenBSD-Commit-ID: f281f603a705fba317ff076e7b11bcf2df941871

commit ace19b34cc15bea3482be90450c1ed0cd0dd0669
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Sep 18 02:03:25 2021 +0000

    upstream: better error message for ~user failures when the
    
    sftp-server lacks the expand-path extension; ok deraadt@
    
    OpenBSD-Commit-ID: 9c1d965d389411f7e86f0a445158bf09b8f9e4bc

commit 6b1238ba971ee722a310d95037b498ede5539c03
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Sep 16 15:22:22 2021 +0000

    upstream: make some more scp-in-SFTP mode better match Unix idioms
    
    suggested by deraadt@
    
    OpenBSD-Commit-ID: 0f2439404ed4cf0b0be8bf49a1ee734836e1ac87

commit e694f8ac4409931e67d08ac44ed251b20b10a957
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Sep 16 15:11:19 2021 +0000

    upstream: allow log_stderr==2 to prefix log messages with argv[0]
    
    use this to make scp's SFTP mode error messages more scp-like
    
    prompted by and ok deraadt@
    
    OpenBSD-Commit-ID: 0e821dbde423fc2280e47414bdc22aaa5b4e0733

commit 8a7a06ee505cb833e613f74a07392e9296286c30
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Sep 17 13:03:31 2021 +1000

    Test against LibreSSL 3.2.6, 3.3.4, 3.4.0.

commit c25c84074a47f700dd6534995b4af4b456927150
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Sep 16 05:36:03 2021 +0000

    upstream: missing space character in ssh -G output broke the
    
    t-sshcfgparse regression test; spotted by anton@
    
    OpenBSD-Commit-ID: bcc36fae2f233caac4baa8e58482da4aa350eed0

commit a4bee1934bf5e5575fea486628f4123d6a29dff8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Sep 15 06:56:01 2021 +0000

    upstream: allow CanonicalizePermittedCNAMEs=none in ssh_config; ok
    
    markus@
    
    OpenBSD-Commit-ID: 668a82ba8e56d731b26ffc5703213bfe071df623

commit d0fffc88c8fe90c1815c6f4097bc8cbcabc0f3dd
Author: mbuhl@openbsd.org <mbuhl@openbsd.org>
Date:   Tue Sep 14 11:04:21 2021 +0000

    upstream: put back the mux_ctx memleak fix for SSH_CHANNEL_MUX_CLIENT
    
    OK mfriedl@
    
    OpenBSD-Commit-ID: 1aba1da828956cacaadb81a637338734697d9798

commit 19b3d846f06697c85957ab79a63454f57f8e22d6
Author: schwarze@openbsd.org <schwarze@openbsd.org>
Date:   Sat Sep 11 09:05:50 2021 +0000

    upstream: Do not ignore SIGINT while waiting for input if editline(3)
    
    is not used. Instead, in non-interactive mode, exit sftp(1), like for other
    serious errors. As pointed out by dtucker@, when compiled without editline(3)
    support in portable OpenSSH, the el == NULL branch is also used for
    interactive mode. In that case, discard the input line and provide a fresh
    prompt to the user just like in the case where editline(3) is used. OK djm@
    
    OpenBSD-Commit-ID: 7d06f4d3ebba62115527fafacf38370d09dfb393

commit ba61123eef9c6356d438c90c1199a57a0d7bcb0a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Sep 11 00:40:24 2021 +0000

    upstream: when using SFTP protocol, continue transferring files after a
    
    transfer error occurs. This matches original scp/rcp behaviour. ok dtucker@
    
    OpenBSD-Commit-ID: dfe4558d71dd09707e9b5d6e7d2e53b793da69fa

commit b0ec59a708b493c6f3940336b1a537bcb64dd2a7
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Sep 10 11:38:38 2021 +0000

    upstream: Document that non-interactive commands are run via the user's
    
    shell using the -c flag.  ok jmc@
    
    OpenBSD-Commit-ID: 4f0d912077732eead10423afd1acf4fc0ceec477

commit 66a658b5d9e009ea11f8a0ca6e69c7feb2d851ea
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Sep 10 10:26:02 2021 +0000

    upstream: Document behaviour of arguments following non-interactive
    
    commands. Prompted by github PR#139 from EvanTheB, feedback & ok djm@ jmc@
    
    OpenBSD-Commit-ID: fc758d1fe0471dfab4304fcad6cd4ecc3d79162a

commit 1d47e28e407d1f95fdf8f799be23f48dcfa5206b
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Sep 10 07:11:11 2021 +0000

    upstream: Clarify which file's attributes -p preserves, and that
    
    it's specifically the file mode bits. bz#3340 from calestyo at scientia.net,
    ok djm@ jmc@
    
    OpenBSD-Commit-ID: f09e6098ed1c4be00c730873049825f8ee7cb884

commit b344db7a413478e4c21e4cadba4a970ad3e6128a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Sep 10 05:46:09 2021 +0000

    upstream: openssh-7.4 was incorrectly listed twice; spotted by
    
    Dmitry Belyavskiy, ok dtucker@
    
    OpenBSD-Commit-ID: 4b823ae448f6e899927ce7b04225ac9e489f58ef

commit 9136d6239ad7a4a293e0418a49b69e70c76d58b8
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Thu Sep 9 06:17:39 2021 +0000

    upstream: - move CAVEATS to its correct order - use the term
    
    "legacy" protocol rather than "original", as the latter made the text
    misleading - uppercase SCP
    
    ok djm
    
    OpenBSD-Commit-ID: 8479255746d5fa76a358ee59e7340fecf4245ff0

commit 2d678c5e3bdc2f5c99f7af5122e9d054925d560d
Author: David Carlier <devnexen@gmail.com>
Date:   Wed Sep 8 19:49:54 2021 +0100

    Disable tracing on FreeBSD using procctl.
    
    Placed at the start of platform_disable_tracing() to prevent declaration
    after code errors from strict C89 compilers (in the unlikely event that
    more than one method is enabled).

commit 73050fa38fb36ae3326d768b574806352b97002d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Sep 8 23:31:39 2021 +0000

    upstream: Use the SFTP protocol by default. The original scp/rcp
    
    protocol remains available via the -O flag.
    
    Note that ~user/ prefixed paths in SFTP mode require a protocol extension
    that was first shipped in OpenSSH 8.7.
    
    ok deraadt, after baking in snaps for a while without incident
    
    OpenBSD-Commit-ID: 23588976e28c281ff5988da0848cb821fec9213c

commit c4565e69ffa2485cff715aa842ea7a350296bfb6
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 8 21:09:49 2021 +1000

    Really fix test on OpenSSL 1.1.1 stable.

commit 79f1bb5f56cef3ae9276207316345b8309248478
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 8 18:51:39 2021 +1000

    Correct OpenSSL 1.1.1 stable identifier.

commit b6255593ed5ccbe5e7d3d4b26b2ad31ad4afc232
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 8 18:39:44 2021 +1000

    Increment nfds when coming from startup_pipe.
    
    If we have to increase nfds because startup_pipe[0] is above any of the
    descriptors passed in the fd_sets, we also need to add 1 to nfds since
    select takes highest FD number plus one.  bz#3345 from yaroslav.kuzmin
    at vmssoftware.com.

commit a3e92a6794817df6012ac8546aea19652cc91b61
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Sep 8 13:45:10 2021 +1000

    Tests for OpenSSL 3.0.0 release & 1.1.1 branch.

commit 4afe431da98ec1cf6a2933fe5658f4fd68dee9e2
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Sep 8 03:23:44 2021 +0000

    upstream: correct my mistake in previous fix; spotted by halex
    
    OpenBSD-Commit-ID: 3cc62d92e3f70006bf02468fc146bfc36fffa183

commit ca0e455b9331213ff9505a21b94c38e34faa2bba
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Sep 7 06:03:51 2021 +0000

    upstream: avoid NULL deref in -Y find-principals. Report and fix
    
    from Carlo Marcelo Arenas Beln
    MIME-Version: 1.0
    Content-Type: text/plain; charset=UTF-8
    Content-Transfer-Encoding: 8bit
    
    OpenBSD-Commit-ID: 6238486f8ecc888d6ccafcd9ad99e621bb41f1e0

commit 37616807f150fb46610bbd5031c31af4857ad1e9
Author: millert@openbsd.org <millert@openbsd.org>
Date:   Mon Sep 6 00:36:01 2021 +0000

    upstream: revision 1.381 neglected to remove
    
    sChallengeResponseAuthentication from the enum.  Noticed by
    christos@zoulas.com.  OK dtucker@
    
    OpenBSD-Commit-ID: b533283a4dd6d04a867da411a4c7a8fbc90e34ff

commit 7acb3578cdfec0b3d34501408071f7a96c1684ea
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Sep 5 20:45:42 2021 +1000

    Correct version_num for OpenSSL dev branch.

commit 65bb01111320dfd0d25e21e1fd4d3f2b77532669
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Sep 5 19:37:39 2021 +1000

    Test against OpenSSL 3 branch as well as dev.
    
    Now that OpenSSL development has moved to 3.1, test against the most
    recent version of the openssl-3.0 branch too.

commit 864ed0d5e04a503b97202c776b7cf3f163f3eeaa
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Sep 5 19:33:22 2021 +1000

    OpenSSL development is now 3.1.*

commit a60209a586a928f92ab323bf23bd07f57093342e
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Sep 3 07:43:23 2021 +0000

    upstream: Use .Cm instead of .Dq in StrictHostKeyChecking list for
    
    consistency. Patch from scop via github PR#257, ok jmc@
    
    OpenBSD-Commit-ID: 3652a91564570779431802c31224fb4a9cf39872

commit 8d1d9eb6de37331e872700e9e399a3190cca1242
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Sep 3 07:27:03 2021 +0000

    upstream: Mention using ssh -i for specifying the public key file
    
    in the case where the private key is loaded into ssh-agent but is not present
    locally.  Based on patch from rafork via github PR#215, ok jmc@
    
    OpenBSD-Commit-ID: 2282e83b0ff78d2efbe705883b67240745fa5bb2

commit eb4362e5e3aa7ac26138b11e44d8c191910aff64
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Sep 3 05:25:50 2021 +0000

    upstream: Refer to KEX "algorithms" instead of "methods" to match
    
    other references and improve consistency.  Patch from scop via github PR#241,
    ok djm@
    
    OpenBSD-Commit-ID: 840bc94ff6861b28d8603c8e8c16499bfb65e32c

commit b3318946ce5725da43c4bf7eeea1b73129c47d2a
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Sep 3 05:12:25 2021 +0000

    upstream: Remove redundant attrib_clear in upload_dir_internal.
    
    The subsequent call to stat_to_attrib clears the struct as its first step
    anyway. From pmeinhardt via github PR#220, ok djm@
    
    OpenBSD-Commit-ID: f5234fc6d7425b607e179acb3383f21716f3029e

commit 7cc3fe28896e653956a6a2eed0a25d551b83a029
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Sep 3 04:11:13 2021 +0000

    upstream: Add test for client termination status on signal.
    
    Based on patch from Alexxz via github PR#235 with some tweaks, to
    match patch in bz#3281.
    
    OpenBSD-Regress-ID: d87c7446fb8b5f8b45894fbbd6875df326e729e2

commit 5428b0d239f6b516c81d1dd15aa9fe9e60af75d4
Author: deraadt@openbsd.org <deraadt@openbsd.org>
Date:   Thu Sep 2 21:03:54 2021 +0000

    upstream: sys/param.h is not needed for any visible reason
    
    OpenBSD-Commit-ID: 8bdea2d0c75692e4c5777670ac039d4b01c1f368

commit 1ff38f34b4c4545eb28106629cafa1e0496bc726
Author: Shchelkunov Artem <a.shchelkunov@ideco.ru>
Date:   Wed Aug 11 18:07:58 2021 +0500

    Fix memory leak in error path.
    
    *info is allocated via xstrdup but was leaked in the PAM_AUTH_ERR path.
    From github PR#266.

commit cb37e2f0c0ca4fef844ed7edc5d0e3b7d0e83f6a
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Sep 1 03:16:06 2021 +0000

    upstream: Fix ssh-rsa fallback for old PuTTY interop tests.
    
    OpenBSD-Regress-ID: a19ac929da604843a5b5f0f48d2c0eb6e0773d37

commit 8b02ef0f28dc24cda8cbcd8b7eb02bda8f8bbe59
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Sep 1 00:50:27 2021 +0000

    upstream: Add a function to skip remaining tests.
    
    Many tests skip tests for various reasons but not in a consistent way and
    don't always clean up, so add that and switch the tests that do that over.
    
    OpenBSD-Regress-ID: 72d2ec90a3ee8849486956a808811734281af735

commit d486845c07324c04240f1674ac513985bd356f66
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Aug 31 07:13:59 2021 +0000

    upstream: Specify path to PuTTY keys.
    
    Portable needs this and it makes no difference on OpenBSD, so resync
    them.  (Id sync only, Portable already had this.)
    
    OpenBSD-Regress-ID: 33f6f66744455886d148527af8368811e4264162

commit d22b299115e27606e846b23490746f69fdd4fb38
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Aug 31 06:13:23 2021 +0000

    upstream: Better compat tests with old PuTTY.
    
    When running PuTTY interop tests and using a PuTTY version older than
    0.76, re-enable the ssh-rsa host key algorithm (the 256 and 512 variants
    of RSA were added some time between 0.73 and 0.76).
    
    OpenBSD-Regress-ID: e6138d6987aa705fa1e4f216db0bb386e1ff38e1

commit 87ad70d605c3e39c9b8aa275db27120d7cc09b77
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Aug 31 17:04:50 2021 +1000

    Resync PuTTY interop tests.
    
    Resync behaviour when REGRESS_INTEROP_PUTTY is not set with OpenBSD.

commit e47b82a7bf51021afac218bf59a3be121827653d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Aug 31 01:25:27 2021 +0000

    upstream: Specify hostkeyalgorithms in SSHFP test.
    
    Specify host key algorithms in sshd's default set for the SSHFP test,
    from djm@.  Make the reason for when the test is skipped a bit clearer.
    
    OpenBSD-Regress-ID: 4f923dfc761480d5411de17ea6f0b30de3e32cea

commit 7db3e0a9e8477c018757b59ee955f7372c0b55fb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 30 01:15:45 2021 +0000

    upstream: adapt to RSA/SHA1 deprectation
    
    OpenBSD-Regress-ID: 952397c39a22722880e4de9d1c50bb1a14f907bb

commit 2344750250247111a6c3c6a4fe84ed583a61cc11
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Aug 29 23:53:10 2021 +0000

    upstream: After years of forewarning, disable the RSA/SHA-1
    
    signature algorithm by default. It is feasible to create colliding SHA1
    hashes, so we need to deprecate its use.
    
    RSA/SHA-256/512 remains available and will be transparently selected
    instead of RSA/SHA1 for most SSH servers released in the last five+
    years. There is no need to regenerate RSA keys.
    
    The use of RSA/SHA1 can be re-enabled by adding "ssh-rsa" to the
    PubkeyAcceptedAlgorithms directives on the client and server.
    
    ok dtucker deraadt
    
    OpenBSD-Commit-ID: 189bcc4789c7254e09e23734bdd5def8354ff1d5

commit 56c4455d3b54b7d481c77c82115c830b9c8ce328
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Aug 29 23:44:07 2021 +0000

    upstream: wrap at 80 columns
    
    OpenBSD-Commit-ID: 47ca2286d6b52a9747f34da16d742879e1a37bf0

commit 95401eea8503943449f712e5f3de52fc0bc612c5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 20 18:14:13 2021 +1000

    Replace shell function with ssh-keygen -A.
    
    Prevents the init script in the SysV package from trying (and failing)
    to generate unsupported key types.  Remove now-unused COMMENT_OUT_ECC.
    ok tim@

commit d83ec9ed995a76ed1d5c65cf10b447222ec86131
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 20 15:39:05 2021 +1000

    Remove obsolete Redhat PAM config and init script.

commit e1a596186c81e65a34ce13076449712d3bf97eb4
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Aug 20 14:03:49 2021 +1000

    depend

commit 5450606c8f7f7a0d70211cea78bc2dab74ab35d1
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Aug 20 13:59:43 2021 +1000

    update version numbers

commit feee2384ab8d694c770b7750cfa76a512bdf8246
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Aug 20 03:22:55 2021 +0000

    upstream: openssh-8.7
    
    OpenBSD-Commit-ID: 8769dff0fd76ae3193d77bf83b439adee0f300cd

commit 9a2ed62173cc551b2b5f479460bb015b19499de8
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 20 10:48:13 2021 +1000

    Also check pid in pselect_notify_setup.
    
    Spotted by djm@.

commit deaadcb93ca15d4f38aa38fb340156077792ce87
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 20 08:39:33 2021 +1000

    Prefix pselect functions to clarify debug messages

commit 10e45654cff221ca60fd35ee069df67208fcf415
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 20 08:30:42 2021 +1000

    Fix race in pselect replacement code.
    
    On the second and subsequent calls to pselect the notify_pipe was not
    added to the select readset, opening up a race that om G. Christensen
    discovered on multiprocessor Solaris <=9 systems.
    
    Also reinitialize notify_pipe if the pid changes.  This will prevent a
    parent and child from using the same FD, although this is not an issue
    in the current structure it might be in future.

commit 464ba22f1e38d25402e5ec79a9b8d34a32df5a3f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Aug 18 12:51:30 2021 +1000

    Check compiler for c99 declarations after code.
    
    The sntrup761 reference code contains c99-style declarations after code
    so don't try to build that if the compiler doesn't support it.

commit 7d878679a4b155a359d32104ff473f789501748d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Aug 17 15:12:04 2021 +1000

    Remove trailing backslash on regress-unit-binaries

commit b71b2508f17c68c5d9dbbe537686d81cedb9a781
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Aug 17 07:59:27 2021 +1000

    Put stdint.h inside HAVE_STDINT_H.
    
    From Tom G. Christensen.

commit 6a24567a29bd7b4ab64e1afad859ea845cbc6b8c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Aug 16 14:13:02 2021 +1000

    Improve github test driver script.
    
     - use a trap to always output any failed regress logs (since the script
       sets -e, the existing log output is never invoked).
     - pass LTESTS and SKIP_LTESTS when re-running with sshd options (eg.
       UsePAM).

commit b467cf13705f59ed348b620722ac098fe31879b7
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Aug 16 11:32:23 2021 +1000

    Remove deprecated ubuntu-16.04 test targets.
    
    Github has deprecated ubuntu-16.04 and it will be removed on 20
    September.

commit 20e6eefcdf78394f05e453d456c1212ffaa6b6a4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Aug 15 23:25:26 2021 +1000

    Skip agent ptrace test on hurd.

commit 7c9115bbbf958fbf85259a061c1122e2d046aabf
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Aug 15 19:37:22 2021 +1000

    Add hurd test target.

commit 7909a566f6c6a78fcd30708dc49f4e4f9bb80ce3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Aug 15 12:45:10 2021 +1000

    Skip scp3 tests on all dfly58 and 60 configs.

commit e65198e52cb03534e8c846d1bca74c310b1526de
Author: Tim Rice <tim@multitalents.net>
Date:   Sat Aug 14 13:08:07 2021 -0700

    openbsd-compat/openbsd-compat.h: put bsd-signal.h before bsd-misc.h
    to get sigset_t from signal.h needed for the pselect replacement.

commit e50635640f79920d9375e0155cb3f4adb870eee5
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 13 13:21:00 2021 +1000

    Test OpenSSH from OpenBSD head on 6.8 and 6.9.

commit e0ba38861c490c680117b7fe0a1d61a181cd00e7
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Aug 13 13:00:14 2021 +1000

    Skip scp3 test on dragonfly 58 and 60.
    
    The tests hang, so skip until we figure them out.

commit dcce2a2bcf007bf817a2fb0dce3db83fa9201e92
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Thu Aug 12 23:59:25 2021 +0000

    upstream: mention that CASignatureAlgorithms accepts +/- similarly to
    
    the other algorithm list directives; ok jmc bz#3335
    
    OpenBSD-Commit-ID: 0d46b53995817052c78e2dce9dbd133963b073d9

commit 090a82486e5d7a8f7f16613d67e66a673a40367f
Author: schwarze@openbsd.org <schwarze@openbsd.org>
Date:   Thu Aug 12 09:59:00 2021 +0000

    upstream: In the editline(3) branch of the sftp(1) event loop,
    
    handle SIGINT rather than ignoring it, such that the user can use Ctrl-C to
    discard the currently edited command line and get a fresh prompt, just like
    in ftp(1), bc(1), and in shells.
    
    It is critical to not use ssl_signal() for this particular case
    because that function unconditionally sets SA_RESTART, but here we
    need the signal to interrupt the read(2) in the el_gets(3) event loop.
    
    OK dtucker@ deraadt@
    
    OpenBSD-Commit-ID: 8025115a773f52e9bb562eaab37ea2e021cc7299

commit e1371e4f58404d6411d9f95eb774b444cea06a26
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Wed Aug 11 14:07:54 2021 +0000

    upstream: scp: tweak man page and error message for -3 by default
    
    Now that the -3 option is enabled by default, flip the documentation
    and error message logic from "requires -3" to "blocked by -R".
    
    ok djm@
    
    OpenBSD-Commit-ID: a872592118444fb3acda5267b2a8c3d4c4252020

commit 49f46f6d77328a3d10a758522b670a3e8c2235e7
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Wed Aug 11 14:05:19 2021 +0000

    upstream: scp: do not spawn ssh with two -s flags for
    
    remote-to-remote copies
    
    Do not add another "-s" to the argument vector every time an SFTP
    connection is initiated.  Instead, introduce a subsystem flag to
    do_cmd() and add "-s" when the flag is set.
    
    ok djm@
    
    OpenBSD-Commit-ID: 25df69759f323661d31b2e1e790faa22e27966c1

commit 2a2cd00783e1da45ee730b7f453408af1358ef5b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Aug 11 08:55:04 2021 +0000

    upstream: test -Oprint-pubkey
    
    OpenBSD-Regress-ID: 3d51afb6d1f287975fb6fddd7a2c00a3bc5094e0

commit b9f4635ea5bc33ed5ebbacf332d79bae463b0f54
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Aug 11 08:54:17 2021 +0000

    upstream: when verifying sshsig signatures, support an option
    
    (-Oprint-pubkey) to dump the full public key to stdout; based on patch from
    Fabian Stelzer; ok markus@
    
    OpenBSD-Commit-ID: 0598000e5b9adfb45d42afa76ff80daaa12fc3e2

commit 750c1a45ba4e8ad63793d49418a0780e77947b9b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Aug 11 05:21:32 2021 +0000

    upstream: oops, missed one more %p
    
    OpenBSD-Commit-ID: e7e62818d1564cc5cd9086eaf7a51cbd1a9701eb

commit b5aa27b69ab2e1c13ac2b5ad3f8f7d389bad7489
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Aug 11 05:20:17 2021 +0000

    upstream: remove a bunch of %p in format strings; leftovers of
    
    debuggings past. prompted by Michael Forney, ok dtucker@
    
    OpenBSD-Commit-ID: 4853a0d6c9cecaba9ecfcc19066e52d3a8dcb2ac

commit 419aa01123db5ff5dbc68b2376ef23b222862338
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Aug 11 09:21:09 2021 +1000

    Add includes.h to compat tests.
    
    On platforms where closefrom returns void (eg glibc>=2.34) the prototype
    for closefrom in its compat tests would cause compile errors.  Remove
    this and have the tests pull in the compat headers in the same way as
    the main code.  bz#3336.

commit 931f592f26239154eea3eb35a086585897b1a185
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Aug 10 03:35:45 2021 +0000

    upstream: adapt to scp -M flag change; make scp3.sh test SFTP mode too
    
    OpenBSD-Regress-ID: 43fea26704a0f0b962b53c1fabcb68179638f9c0

commit 391ca67fb978252c48d20c910553f803f988bd37
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Aug 10 03:33:34 2021 +0000

    upstream: Prepare for a future where scp(1) uses the SFTP protocol by
    
    default. Replace recently added -M option to select the protocol with -O
    (olde) and -s (SFTP) flags, and label the -s flag with a clear warning that
    it will be removed in the near future (so no, don't use it in scripts!).
    
    prompted by/feedback from deraadt@
    
    OpenBSD-Commit-ID: 92ad72cc6f0023c9be9e316d8b30eb6d8d749cfc

commit bfdd4b722f124a4fa9173d20dd64dd0fc69856be
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 9 23:56:36 2021 +0000

    upstream: make scp -3 the default for remote-to-remote copies. It
    
    provides a much better and more intuitive user experience and doesn't require
    exposing credentials to the source host.
    
    thanks naddy@ for catching the missing argument in usage()
    
    "Yes please!" - markus@
    "makes a lot of sense" - deraadt@
    "the right thing to do" - dtucker@
    
    OpenBSD-Commit-ID: d0d2af5f0965c5192ba5b2fa461c9f9b130e5dd9

commit 2f7a3b51cef689ad9e93d0c6c17db5a194eb5555
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 9 23:49:31 2021 +0000

    upstream: make scp in SFTP mode try to use relative paths as much
    
    as possible. Previosuly, it would try to make relative and ~/-rooted paths
    absolute before requesting transfers.
    
    prompted by and much discussion deraadt@
    ok markus@
    
    OpenBSD-Commit-ID: 46639d382ea99546a4914b545fa7b00fa1be5566

commit 2ab864010e0a93c5dd95116fb5ceaf430e2fc23c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 9 23:47:44 2021 +0000

    upstream: SFTP protocol extension to allow the server to expand
    
    ~-prefixed paths, in particular ~user ones. Allows scp in sftp mode to accept
    these paths, like scp in rcp mode does.
    
    prompted by and much discussion deraadt@
    ok markus@
    
    OpenBSD-Commit-ID: 7d794def9e4de348e1e777f6030fc9bafdfff392

commit 41b019ac067f1d1f7d99914d0ffee4d2a547c3d8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 9 23:44:32 2021 +0000

    upstream: when scp is in SFTP mode, try to deal better with ~
    
    prefixed paths. ~user paths aren't supported, but ~/ paths will be accepted
    and prefixed with the SFTP server starting directory (more to come)
    
    prompted by and discussed with deraadt@
    ok markus@
    
    OpenBSD-Commit-ID: 263a071f14555c045fd03132a8fb6cbd983df00d

commit b4b3f3da6cdceb3fd168b5fab69d11fba73bd0ae
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 9 07:21:01 2021 +0000

    upstream: on fatal errors, make scp wait for ssh connection before
    
    exiting avoids LogLevel=verbose (or greater) messages from ssh appearing
    after scp has returned exited and control has returned to the shell; ok
    markus@
    
    (this was originally committed as r1.223 along with unrelated stuff that
    I rolled back in r1.224)
    
    OpenBSD-Commit-ID: 1261fd667ad918484889ed3d7aec074f3956a74b

commit 2ae7771749e0b4cecb107f9d4860bec16c3f4245
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 9 07:19:12 2021 +0000

    upstream: rever r1.223 - I accidentally committed unrelated changes
    
    OpenBSD-Commit-ID: fb73f3865b2647a27dd94db73d6589506a9625f9

commit 986abe94d481a1e82a01747360bd767b96b41eda
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 9 07:16:09 2021 +0000

    upstream: show only the final path component in the progress meter;
    
    more useful with long paths (that may truncate) and better matches
    traditional scp behaviour; spotted by naddy@ ok deraadt@
    
    OpenBSD-Commit-ID: 26b544d0074f03ebb8a3ebce42317d8d7ee291a3

commit 2b67932bb3176dee4fd447af4368789e04a82b93
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 9 07:13:54 2021 +0000

    upstream: on fatal errors, make scp wait for ssh connection before
    
    exiting avoids LogLevel=verbose (or greater) messages from ssh appearing
    after scp has returned exited and control has returned to the shell; ok
    markus@
    
    OpenBSD-Commit-ID: ef9dab5ef5ae54a6a4c3b15d380568e94263456c

commit 724eb900ace30661d45db2ba01d0f924d95ecccb
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Aug 8 08:49:09 2021 +0000

    upstream: xstrdup environment variable used by ForwardAgent. bz#3328
    
    from goetze at dovetail.com, ok djm@ deraadt@
    
    OpenBSD-Commit-ID: 760320dac1c3b26904284ba417a7d63fccc5e742

commit 86b4cb3a884846b358305aad17a6ef53045fa41f
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Aug 8 08:27:28 2021 +0000

    upstream: Although it's POSIX, not all shells used in Portable support
    
    the implicit 'in "$@"' after 'for i'.
    
    OpenBSD-Regress-ID: 3c9aec6bca4868f85d2742b6ba5223fce110bdbc

commit f2ccf6c9f395923695f22345e626dfd691227aaf
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Aug 8 17:39:56 2021 +1000

    Move portable specific settings down.
    
    This brings the top hunk of the file back in sync with OpenBSD
    so patches to the CVS Id should apply instead of always being
    rejected.

commit 71b0eb997e220b0fc9331635af409ad84979f2af
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Aug 8 07:27:52 2021 +0000

    upstream: Move setting of USER further down the startup In portable
    
    we have to change this and having it in the same hunk as the CVS Id string
    means applying changes fails every. single. time.
    
    OpenBSD-Regress-ID: 87cd603eb6db58c9b430bf90adacb7f90864429b

commit f0aca2706c710a0da1a4be705f825a807cd15400
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Aug 8 06:38:33 2021 +0000

    upstream: Drop -q in ssh-log-wrapper.sh to preserve logs.
    
    scp and sftp like to add -q to the command line passed to ssh which
    overrides the LogLevel we set in the config files and suppresses output
    to the debug logs so drop any "-q" from the invoked ssh.  In the one
    case where we actually want to use -q in the banner test, call the ssh
    binary directly bypassing the logging wrapper.
    
    OpenBSD-Regress-ID: e2c97d3c964bda33a751374c56f65cdb29755b75

commit cf27810a649c5cfae60f8ce66eeb25caa53b13bc
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Aug 7 01:57:08 2021 +0000

    upstream: Fix prototype mismatch for do_cmd. ok djm@
    
    OpenBSD-Commit-ID: 1c1598bb5237a7ae0be99152f185e0071163714d

commit 85de69f64665245786e28c81ab01fe18b0e2a149
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 01:55:01 2021 +0000

    upstream: sftp-client.c needs poll.h
    
    remove unused variable
    
    OpenBSD-Commit-ID: 233ac6c012cd23af62f237167a661db391055a16

commit 397c4d72e50023af5fe3aee5cc2ad407a6eb1073
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Aug 7 11:30:57 2021 +1000

    Include poll.h and friends for struct pollfd.

commit a9e2c533195f28627f205682482d9da384c4c52e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:14:17 2021 +0000

    upstream: do_upload() used a near-identical structure for
    
    tracking expected status replies from the server to what do_download() was
    using.
    
    Refactor it to use the same structure and factor out some common
    code into helper functions.
    
    OpenBSD-Commit-ID: 0c167df8ab6df4a5292c32421922b0cf379e9054

commit 7b1cbcb7599d9f6a3bbad79d412604aa1203b5ee
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:12:09 2021 +0000

    upstream: make scp(1) in SFTP mode follow symlinks like
    
    traditional scp(1) ok markus@
    
    OpenBSD-Commit-ID: 97255e55be37e8e26605e4ba1e69f9781765d231

commit 133b44e500422df68c9c25c3b6de35c0263132f1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:10:49 2021 +0000

    upstream: fix incorrect directory permissions on scp -3
    
    transfers; ok markus@
    
    OpenBSD-Commit-ID: 64b2abaa5635a2be65ee2e77688ad9bcebf576c2

commit 98b59244ca10e62ff67a420856770cb700164f59
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:09:57 2021 +0000

    upstream: a bit more debugging of file attributes being
    
    sent/received over the wire
    
    OpenBSD-Commit-ID: f68c4e207b08ef95200a8b2de499d422808e089b

commit c677e65365d6f460c084e41e0c4807bb8a9cf601
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:08:52 2021 +0000

    upstream: make scp(1) in SFTP mode output better match original
    
    scp(1) by suppressing "Retrieving [path]" lines that were emitted to support
    the interactive sftp(1) client. ok markus@
    
    OpenBSD-Commit-ID: 06be293df5f156a18f366079be2f33fa68001acc

commit 48cd39b7a4e5e7c25101c6d1179f98fe544835cd
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:07:18 2021 +0000

    upstream: factor out a structure duplicated between downloading
    
    and crossloading; ok markus@
    
    OpenBSD-Commit-ID: 96eede24d520569232086a129febe342e4765d39

commit 318c06bb04ee21a0cfa6b6022a201eacaa53f388
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:06:30 2021 +0000

    upstream: use sftp_client crossloading to implement scp -3
    
    feedback/ok markus@
    
    OpenBSD-Commit-ID: 7db4c0086cfc12afc9cfb71d4c2fd3c7e9416ee9

commit de7115b373ba0be3861c65de9b606a3e0e9d29a3
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:02:41 2021 +0000

    upstream: support for "cross"-loading files/directories, i.e.
    
    downloading from one SFTP server while simultaneously uploading to another.
    
    feedback & ok markus@
    
    OpenBSD-Commit-ID: 3982878e29d8df0fa4ddc502f5ff6126ac714235

commit a50bd0367ff2063bbc70a387740a2aa6914de094
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:01:29 2021 +0000

    upstream: factor our SSH2_FXP_OPEN calls into their own function;
    
    "looks fine" markus@
    
    OpenBSD-Commit-ID: d3dea2153f08855c6d9dacc01973248944adeffb

commit e3c0ba05873cf3d3f7d19d595667a251026b2d84
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Aug 7 00:00:33 2021 +0000

    upstream: prepare for scp -3 implemented via sftp
    
    OpenBSD-Commit-ID: 194aac0dd87cb175334b71c2a30623a5ad55bb44

commit 395d8fbdb094497211e1461cf0e2f80af5617e0a
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Aug 6 09:00:18 2021 +0000

    upstream: Make diff invocation more portable.
    
    POSIX does not require diff to have -N, so compare in both directions
    with just -r, which should catch missing files in either directory.
    
    OpenBSD-Regress-ID: 0e2ec8594556a6f369ed5a0a90c6806419b845f7

commit d247a73ce27b460138599648d9c637c6f2b77605
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Aug 4 21:28:00 2021 +0000

    upstream: regression test for scp -3
    
    OpenBSD-Regress-ID: b44375d125c827754a1f722ec6b6b75b634de05d

commit 35c8e41a6f6d8ad76f8d1cd81ac2ea23d0d993b2
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Aug 6 05:04:42 2021 +0000

    upstream: Document "ProxyJump none". bz#3334.
    
    OpenBSD-Commit-ID: f78cc6f55731f2cd35c3a41d5352ac1ee419eba7

commit 911ec6411821bda535d09778df7503b92f0eafab
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Aug 4 01:34:55 2021 +0000

    upstream: Allow for different (but POSIX compliant) behaviour of
    
    basename(3) and prevent a use-after-free in that case in the new sftp-compat
    code.
    
    POSIX allows basename(3) to either return a pointer to static storage
    or modify the passed string and return a pointer to that.  OpenBSD does
    the former and works as is, but on other platforms "filename" points
    into "tmp" which was just freed.  This makes the freeing of tmp
    consistent with the other variable in the loop.
    
    Pinpointed by the -portable Valgrind regress test.  ok djm@ deraadt@
    
    OpenBSD-Commit-ID: 750f3c19bd4440e4210e30dd5d7367386e833374

commit 6df1fecb5d3e51f3a8027a74885c3a44f6cbfcbd
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Aug 4 11:05:11 2021 +1000

    use openbsd-compat glob.h is required

commit 9ebd1828881dfc9014a344587934a5ce7db6fa1b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Aug 3 21:03:23 2021 +1000

    Missing space between macro arg and punctuation.
    
    From jmc@

commit 0fd3f62eddc7cf54dcc9053be6f58998f3eb926a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Aug 3 21:02:33 2021 +1000

    Avoid lines >80 chars.  From jmc@

commit af5d8094d8b755e1daaf2e20ff1dc252800b4c9b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Aug 3 01:05:24 2021 +0000

    upstream: regression tests for scp SFTP protocol support; mostly by
    
    Jakub Jelen in GHPR#194 ok markus
    
    OpenBSD-Regress-ID: 36f1458525bcb111741ec8547eaf58b13cddc715

commit e4673b7f67ae7740131a4ecea29a846593049a91
Author: anton@openbsd.org <anton@openbsd.org>
Date:   Thu Jul 29 15:34:09 2021 +0000

    upstream: Treat doas with arguments as a valid SUDO variable.
    
    Allows one to specify SUDO="doas -n" which I do while running make regress.
    
    ok dtucker@
    
    OpenBSD-Regress-ID: 4fe5814b5010dbf0885500d703bea06048d11005

commit 197e29f1cca190d767c4b2b63a662f9a9e5da0b3
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Aug 2 23:38:27 2021 +0000

    upstream: support for using the SFTP protocol for file transfers in
    
    scp, via a new "-M sftp" option. Marked as experimental for now.
    
    Some corner-cases exist, in particular there is no attempt to
    provide bug-compatibility with scp's weird "double shell" quoting
    rules.
    
    Mostly by Jakub Jelen in GHPR#194 with some tweaks by me. ok markus@
    Thanks jmc@ for improving the scp.1 bits.
    
    OpenBSD-Commit-ID: 6ce4c9157ff17b650ace571c9f7793d92874051c

commit dd533c7ab79d61a7796b77b64bd81b098e0d7f9f
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Jul 30 14:28:13 2021 +0000

    upstream: fix a formatting error and add some Xr; from debian at
    
    helgefjell de
    
    removed references to rlogin etc. as no longer relevant;
    suggested by djm
    
    ok djm dtucker
    
    OpenBSD-Commit-ID: 3c431c303068d3aec5bb18573a0bd5e0cd77c5ae

commit c7cd347a8823819411222c1e10a0d26747d0fd5c
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Jul 30 14:25:01 2021 +0000

    upstream: fix a formatting error and mark up known_hosts
    
    consistently; issues reported by debian at helgefjell de
    
    ok djm dtucker
    
    OpenBSD-Commit-ID: a1fd8d21dc77f507685443832df0c9700481b0ce

commit 4455aec2e4fc90f64ae4fc47e78ebc9c18721738
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Wed Jul 28 05:57:42 2021 +0000

    upstream: no need to talk about version 2 with the -Q option, so
    
    rewrite the text to read better;
    
    issue reported by debian at helgefjell de
    ok djm dtucker
    
    OpenBSD-Commit-ID: 59fe2e8219c37906740ad062e0fdaea487dbe9cf

commit bec429338e9b30d2c7668060e82608286a8a4777
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Tue Jul 27 14:28:46 2021 +0000

    upstream: word fix; reported by debian at helgefjell de
    
    OpenBSD-Commit-ID: 0c6fd22142422a25343c5bd1a618f31618f41ece

commit efad4deb5a1f1cf79ebefd63c6625059060bfbe1
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Tue Jul 27 14:14:25 2021 +0000

    upstream: standardise the grammar in the options list; issue
    
    reported by debian at helgefjell de
    
    ok dtucker djm
    
    OpenBSD-Commit-ID: 7ac15575045d82f4b205a42cc7d5207fe4c3f8e6

commit 1e11fb24066f3fc259ee30db3dbb2a3127e05956
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Aug 2 18:56:29 2021 +1000

    Check for RLIMIT_NOFILE before trying to use it.

commit 0f494236b49fb48c1ef33669f14822ca4f3ce2f4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Jul 27 17:45:34 2021 +1000

    lastenv is only used in setenv.
    
    Prevents an unused variable warning on platforms that have setenv but
    not unsetenv.

commit a1f78e08bdb3eaa88603ba3c6e01de7c8671e28a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jul 26 12:45:30 2021 +1000

    Move SUDO to "make test" command line.
    
    Environment variables don't get passed by vmrun, so move to command
    line.

commit 02e624273b9c78a49a01239159b8c09b8409b1a0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Jul 25 23:26:36 2021 +1000

    Set SUDO for tests and cleanup.

commit 460ae5d93051bab70239ad823dd784822d58baad
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Jul 25 22:37:55 2021 +1000

    Pass OPENSSL=no to make tests too.

commit b398f499c68d74ebe3298b73757cf3f36e14e0cb
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Jul 25 12:27:37 2021 +0000

    upstream: Skip unit and makefile-based key conversion tests when
    
    we're building with OPENSSL=no.
    
    OpenBSD-Regress-ID: 20455ed9a977c93f846059d1fcb48e29e2c8d732

commit 727ce36c8c5941bde99216d27109405907caae4f
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Jul 25 12:13:03 2021 +0000

    upstream: Replace OPENSSL as the variable that points to the
    
    openssl binary with OPENSSL_BIN.  This will allow us to use the OPENSSL
    variable from mk.conf or the make(1) command line indicating if we're
    building with our without OpenSSL, and ultimately get the regress tests
    working in the OPENSSL=no configuration.
    
    OpenBSD-Regress-ID: 2d788fade3264d7803e5b54cae8875963f688c4e

commit 55e17101a9075f6a63af724261c5744809dcb95c
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Jul 24 02:57:28 2021 +0000

    upstream: Skip RFC4716 format import and export tests when built
    
    without OpenSSL.
    
    OpenBSD-Regress-ID: d2c2d5d38c1acc2b88cc99cfe00a2eb8bb39dfa4

commit f5ccb5895d39cd627ad9e7b2c671d2587616100d
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Jul 24 02:51:14 2021 +0000

    upstream: Don't omit ssh-keygen -y from usage when built without
    
    OpenSSL.  It is actually available, albeit only for ed25519 keys.
    
    OpenBSD-Commit-ID: 7a254c33d0e6a55c30c6b016a8d298d3cb7a7674

commit 819d57ac23469f1f03baa8feb38ddefbada90fdc
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sat Jul 24 02:08:13 2021 +0000

    upstream: Exclude key conversion options from usage when built
    
    without OpenSSL since those are not available, similar to what we currently
    do with the moduli screening options.  We can also use this to skip the
    conversion regression tests in this case.
    
    OpenBSD-Commit-ID: 3c82caa398cf99cd4518c23bba5a2fc66b16bafe

commit b6673b1d2ee90b4690ee84f634efe40225423c38
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 24 13:02:51 2021 +1000

    Test OpenBSD upstream with and without OpenSSL.

commit 9d38074b5453c1abbdf888e80828c278d3b886ac
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jul 24 01:54:23 2021 +0000

    upstream: test for first-match-wins in authorized_keys environment=
    
    options
    
    OpenBSD-Regress-ID: 1517c90276fe84b5dc5821c59f88877fcc34c0e8

commit 2b76f1dd19787e784711ea297ad8fc938b4484fd
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jul 23 05:53:02 2021 +0000

    upstream: Simplify keygen-convert by using $SSH_KEYTYPES directly.
    
    OpenBSD-Regress-ID: cdbe408ec3671ea9ee9b55651ee551370d2a4108

commit 7d64a9fb587ba9592f027f7a2264226c713d6579
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jul 24 01:55:19 2021 +0000

    upstream: don't leak environment= variable when it is not the first
    
    match
    
    OpenBSD-Commit-ID: 7fbdc3dfe0032deaf003fd937eeb4d434ee4efe0

commit db2130e2340bf923e41c791aa9cd27b9e926042c
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Fri Jul 23 06:01:17 2021 +0000

    upstream: punctuation;
    
    OpenBSD-Commit-ID: 64be152e378c45975073ab1c07e0db7eddd15806

commit 03190d10980c6fc9124e988cb2df13101f266507
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 23 05:56:47 2021 +0000

    upstream: mention in comment that read_passphrase(..., RP_ALLOW_STDIN)
    
    will try to use askpass first. bz3314
    
    convert a couple of debug() -> debug_f() while here
    
    OpenBSD-Commit-ID: c7e812aebc28fcc5db06d4710e0f73613dee545c

commit 1653ece6832b2b304d46866b262d5f69880a9ec7
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jul 23 05:07:16 2021 +0000

    upstream: Test conversion of ed25519 and ecdsa keys too.
    
    OpenBSD-Regress-ID: 3676d2d00e58e0d6d37f2878f108cc2b83bbe4bb

commit 8b7af02dcf9d2b738787efd27da7ffda9859bed2
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jul 23 04:56:21 2021 +0000

    upstream: Add test for exporting pubkey from a passphrase-protected
    
    private key.
    
    OpenBSD-Regress-ID: da99d93e7b235fbd5b5aaa01efc411225e6ba8ac

commit 441095d4a3e5048fe3c87a6c5db5bc3383d767fb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 23 03:54:55 2021 +0000

    upstream: regression test for time-limited signature keys
    
    OpenBSD-Regress-ID: 2a6f3bd900dbee0a3c96f1ff23e032c93ab392bc

commit 9e1882ef6489a7dd16b6d7794af96629cae61a53
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 23 05:24:02 2021 +0000

    upstream: note successful authentication method in final "Authenticated
    
    to ..." message and partial auth success messages (all at LogLevel=verbose)
    ok dtucker@
    
    OpenBSD-Commit-ID: 06834b89ceb89f8f16c5321d368a66c08f441984

commit a917e973a1b90b40ff1e950df083364b48fc6c78
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 23 04:04:52 2021 +0000

    upstream: Add a ForkAfterAuthentication ssh_config(5) counterpart
    
    to the ssh(1) -f flag. Last part of GHPR231 from Volker Diels-Grabsch. ok
    dtucker
    
    OpenBSD-Commit-ID: b18aeda12efdebe2093d55263c90fe4ea0bce0d3

commit e0c5088f1c96a145eb6ea1dee438010da78f9ef5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 23 04:00:59 2021 +0000

    upstream: Add a StdinNull directive to ssh_config(5) that allows
    
    the config file to do the same thing as -n does on the ssh(1) commandline.
    Patch from Volker Diels-Grabsch via GHPR231; ok dtucker
    
    OpenBSD-Commit-ID: 66ddf3f15c76796d4dcd22ff464aed1edd62468e

commit e3957e21ffdc119d6d04c0b1686f8e2fe052f5ea
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 23 03:57:20 2021 +0000

    upstream: make authorized_keys environment="..." directives
    
    first-match-wins and more strictly limit their maximum number; prompted by
    OOM reported by OSS-fuzz (35470).
    
    feedback and ok dtucker@
    
    OpenBSD-Commit-ID: 01f63fc10dcd995e7aed9c378ad879161af83121

commit d0bb1ce731762c55acb95817df4d5fab526c7ecd
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 23 03:37:52 2021 +0000

    upstream: Let allowed signers files used by ssh-keygen(1)
    
    signatures support key lifetimes, and allow the verification mode to specify
    a signature time to check at. This is intended for use by git to support
    signing objects using ssh keys. ok dtucker@
    
    OpenBSD-Commit-ID: 3e2c67b7dcd94f0610194d1e8e4907829a40cf31

commit 44142068dc7ef783d135e91ff954e754d2ed432e
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 19 08:48:33 2021 +0000

    upstream: Use SUDO when setting up hostkey.
    
    OpenBSD-Regress-ID: 990cf4481cab8dad62e90818a9b4b36c533851a7

commit 6b67f3f1d1d187597e54a139cc7785c0acebd9a2
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 19 05:08:54 2021 +0000

    upstream: Increase time margin for rekey tests. Should help
    
    reliability on very heavily loaded hosts.
    
    OpenBSD-Regress-ID: 4c28a0fce3ea89ebde441d7091464176e9730533

commit 7953e1bfce9e76bec41c1331a29bc6cff9d416b8
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jul 19 13:47:51 2021 +1000

    Add sshfp-connect.sh file missed in previous.

commit b75a80fa8369864916d4c93a50576155cad4df03
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 19 03:13:28 2021 +0000

    upstream: Ensure that all returned SSHFP records for the specified host
    
    name and hostkey type match instead of only one.  While there, simplify the
    code somewhat and add some debugging.  Based on discussion in bz#3322, ok
    djm@.
    
    OpenBSD-Commit-ID: 0a6a0a476eb7f9dfe8fe2c05a1a395e3e9b22ee4

commit 1cc1fd095393663cd72ddac927d82c6384c622ba
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 19 02:21:50 2021 +0000

    upstream: Id sync only, -portable already has this.
    
    Put dh_set_moduli_file call inside ifdef WITH_OPENSSL. Fixes
    build with OPENSSL=no.
    
    OpenBSD-Commit-ID: af54abbebfb12bcde6219a44d544e18204defb15

commit 33abbe2f4153f5ca5c874582f6a7cc91ae167485
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 19 02:46:34 2021 +0000

    upstream: Add test for host key verification via SSHFP records. This
    
    requires some external setup to operate so is disabled by default (see
    comments in sshfp-connect.sh).
    
    OpenBSD-Regress-ID: c52c461bd1df3a803d17498917d156ef64512fd9

commit f0cd000d8e3afeb0416dce1c711c3d7c28d89bdd
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 19 02:29:28 2021 +0000

    upstream: Add ed25519 key and test SSHFP export of it. Only test
    
    RSA SSHFP export if we have RSA functionality compiled in.
    
    OpenBSD-Regress-ID: b4ff5181b8c9a5862e7f0ecdd96108622333a9af

commit 0075511e27e5394faa28edca02bfbf13b9a6693e
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 19 00:16:26 2021 +0000

    upstream: Group keygen tests together.
    
    OpenBSD-Regress-ID: 07e2d25c527bb44f03b7c329d893a1f2d6c5c40c

commit 034828820c7e62652e7c48f9ee6b67fb7ba6fa26
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Sun Jul 18 23:10:10 2021 +0000

    upstream: Add test for ssh-keygen printing of SSHFP records.
    
    OpenBSD-Regress-ID: fde9566b56eeb980e149bbe157a884838507c46b

commit 52c3b6985ef1d5dadb4c4fe212f8b3a78ca96812
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jul 17 00:38:11 2021 +0000

    upstream: wrap some long lines
    
    OpenBSD-Commit-ID: 4f5186b1466656762dae37d3e569438d900c350d

commit 43ec991a782791d0b3f42898cd789f99a07bfaa4
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Jul 17 00:36:53 2021 +0000

    upstream: fix sftp on ControlPersist connections, broken by recent
    
    SessionType change; spotted by sthen@
    
    OpenBSD-Commit-ID: 4c5ddc5698790ae6ff50d2a4f8f832f0eeeaa234

commit 073f45c236550f158c9a94003e4611c07dea5279
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 16 09:00:23 2021 +0000

    upstream: Explicitly check for and start time-based rekeying in the
    
    client and server mainloops.
    
    Previously the rekey timeout could expire but rekeying would not start
    until a packet was sent or received. This could cause us to spin in
    select() on the rekey timeout if the connection was quiet.
    
    ok markus@
    
    OpenBSD-Commit-ID: 4356cf50d7900f3df0a8f2117d9e07c91b9ff987

commit ef7c4e52d5d840607f9ca3a302a4cbb81053eccf
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Wed Jul 14 06:46:38 2021 +0000

    upstream: reorder SessionType; ok djm
    
    OpenBSD-Commit-ID: c7dd0b39e942b1caf4976a0b1cf0fed33d05418c

commit 8aa2f9aeb56506dca996d68ab90ab9c0bebd7ec3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jul 14 11:26:50 2021 +1000

    Make whitespace consistent.

commit 4f4297ee9b8a39f4dfd243a74c5f51f9e7a05723
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jul 14 11:26:12 2021 +1000

    Add ARM64 Linux self-hosted runner.

commit eda8909d1b0a85b9c3804a04d03ec6738fd9dc7f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jul 13 23:48:36 2021 +0000

    upstream: add a SessionType directive to ssh_config, allowing the
    
    configuration file to offer equivalent control to the -N (no session) and -s
    (subsystem) command-line flags.
    
    Part of GHPR#231 by Volker Diels-Grabsch with some minor tweaks;
    feedback and ok dtucker@
    
    OpenBSD-Commit-ID: 726ee931dd4c5cc7f1d7a187b26f41257f9a2d12

commit 7ae69f2628e338ba6e0eae7ee8a63bcf8fea7538
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jul 12 02:12:22 2021 +0000

    upstream: fix some broken tests; clean up output
    
    OpenBSD-Regress-ID: 1d5038edb511dc4ce1622344c1e724626a253566

commit f5fc6a4c3404bbf65c21ca6361853b33d78aa87e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jul 12 18:00:05 2021 +1000

    Add configure-time detection for SSH_TIME_T_MAX.
    
    Should fix printing cert times exceeding INT_MAX (bz#3329) on platforms
    were time_t is a long long.  The limit used is for the signed type, so if
    some system has a 32bit unsigned time_t then the lower limit will still
    be imposed and we would need to add some way to detect this.  Anyone using
    an unsigned 64bit can let us know when it starts being a problem.

commit fd2d06ae4442820429d634c0a8bae11c8e40c174
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 12 06:22:57 2021 +0000

    upstream: Make limit for time_t test unconditional in the
    
    format_absolute_time fix for bz#3329 that allows printing of timestamps past
    INT_MAX. This was incorrectly included with the previous commit.   Based on
    discussion with djm@.
    
    OpenBSD-Commit-ID: 835936f6837c86504b07cabb596b613600cf0f6e

commit 6c29b387cd64a57b0ec8ae7d2c8d02789d88fcc3
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 12 06:08:57 2021 +0000

    upstream: Use existing format_absolute_time() function when
    
    printing cert validity instead of doing it inline.  Part of bz#3329.
    
    OpenBSD-Commit-ID: a13d4e3c4f59644c23745eb02a09b2a4e717c00c

commit 99981d5f8bfa383791afea03f6bce8454e96e323
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jul 9 09:55:56 2021 +0000

    upstream: silence redundant error message; reported by Fabian Stelzer
    
    OpenBSD-Commit-ID: 9349a703016579a60557dafd03af2fe1d44e6aa2

commit e86097813419b49d5bff5c4b51d1c3a5d4d2d804
Author: John Ericson <John.Ericson@Obsidian.Systems>
Date:   Sat Dec 26 11:40:49 2020 -0500

    Re-indent krb5 section after pkg-config addition.

commit 32dd2daa56c294e40ff7efea482c9eac536d8cbb
Author: John Ericson <John.Ericson@Obsidian.Systems>
Date:   Sat Dec 26 11:40:49 2020 -0500

    Support finding Kerberos via pkg-config
    
    This makes cross compilation easier.

commit def7a72234d7e4f684d72d33a0f7229f9eee0aa4
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 9 14:34:06 2021 +1000

    Update comments about EGD to include prngd.

commit b5d23150b4e3368f4983fd169d432c07afeee45a
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 5 01:21:07 2021 +0000

    upstream: Fix a couple of whitespace things. Portable already has
    
    these so this removes two diffs between the two.
    
    OpenBSD-Commit-ID: 769f017ebafd8e741e337b3e9e89eb5ac73c9c56

commit 8f57be9f279b8e905f9883066aa633c7e67b31cf
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 5 01:16:46 2021 +0000

    upstream: Order includes as per style(9). Portable already has
    
    these so this removes a handful of diffs between the two.
    
    OpenBSD-Commit-ID: 8bd7452d809b199c19bfc49511a798f414eb4a77

commit b75624f8733b3ed9e240f86cac5d4a39dae11848
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon Jul 5 00:50:25 2021 +0000

    upstream: Remove comment referencing now-removed
    
    RhostsRSAAuthentication.  ok djm@
    
    OpenBSD-Commit-ID: 3d864bfbd99a1d4429a58e301688f3be464827a9

commit b67eb12f013c5441bb4f0893a97533582ad4eb13
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jul 5 00:25:42 2021 +0000

    upstream: allow spaces to appear in usernames for local to remote,
    
    and scp -3 remote to remote copies. with & ok dtucker bz#1164
    
    OpenBSD-Commit-ID: e9b550f3a85ffbb079b6720833da31317901d6dd

commit 8c4ef0943e574f614fc7c6c7e427fd81ee64ab87
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jul 2 07:20:44 2021 +0000

    upstream: Remove obsolete comments about SSHv1 auth methods. ok
    
    djm@
    
    OpenBSD-Commit-ID: 6060f70966f362d8eb4bec3da2f6c4712fbfb98f

commit 88908c9b61bcb99f16e8d398fc41e2b3b4be2003
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 3 23:00:19 2021 +1000

    Remove reference to ChallengeResponse.
    
    challenge_response_authentication was removed from the struct, keeping
    kbd_interactive_authentication.

commit 321874416d610ad2158ce6112f094a4862c2e37f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 3 20:38:09 2021 +1000

    Move signal.h up include order to match upstream.

commit 4fa83e2d0e32c2dd758653e0359984bbf1334f32
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 3 20:36:06 2021 +1000

    Remove old OpenBSD version marker.
    
    Looks like an accidental leftover from a sync.

commit 9d5e31f55d5f3899b72645bac41a932d298ad73b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 3 20:34:19 2021 +1000

    Remove duplicate error on error path.
    
    There's an extra error() call on the listen error path, it looks like
    its removal was missed during an upstream sync.

commit 888c459925c7478ce22ff206c9ac1fb812a40caf
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 3 20:32:46 2021 +1000

    Remove some whitespace not in upstream.
    
    Reduces diff vs OpenBSD by a small amount.

commit 4d2d4d47a18d93f3e0a91a241a6fdb545bbf7dc2
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 3 19:27:43 2021 +1000

    Replace remaining references to ChallengeResponse.
    
    Portable had a few additional references to ChallengeResponse related to
    UsePAM, replaces these with equivalent keyboard-interactive ones.

commit 53237ac789183946dac6dcb8838bc3b6b9b43be1
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 3 19:23:28 2021 +1000

    Sync remaining ChallengeResponse removal.
    
    These were omitted from commit 88868fd131.

commit 2c9e4b319f7e98744b188b0f58859d431def343b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Jul 3 19:17:31 2021 +1000

    Disable rocky84 to figure out why agent test fails

commit bfe19197a92b7916f64a121fbd3c179abf15e218
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 2 15:43:28 2021 +1000

    Remove now-unused SSHv1 enums.
    
    sRhostsRSAAuthentication and sRSAAuthentication are protocol 1 options
    and are no longer used.

commit c73b02d92d72458a5312bd098f32ce88868fd131
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jul 2 05:11:20 2021 +0000

    upstream: Remove references to ChallengeResponseAuthentication in
    
    favour of KbdInteractiveAuthentication.  The former is what was in SSHv1, the
    latter is what is in SSHv2 (RFC4256) and they were treated as somewhat but
    not entirely equivalent.  We retain the old name as deprecated alias so
    config files continue to work and a reference in the man page for people
    looking for it.
    
    Prompted by bz#3303 which pointed out the discrepancy between the two
    when used with Match.  Man page help & ok jmc@, with & ok djm@
    
    OpenBSD-Commit-ID: 2c1bff8e5c9852cfcdab1f3ea94dfef5a22f3b7e

commit f841fc9c8c7568a3b5d84a4cc0cefacb7dbc16b9
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jul 2 15:20:32 2021 +1000

    Fix ifdefs around get_random_bytes_prngd.
    
    get_random_bytes_prngd() is used if either of PRNGD_PORT or PRNGD_SOCKET
    are defined, so adjust ifdef accordingly.

commit 0767627cf66574484b9c0834500b42ea04fe528a
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Jul 2 14:30:23 2021 +1000

    wrap get_random_bytes_prngd() in ifdef
    
    avoid unused static function warning

commit f93fdc4de158386efe1116bd44c5b3f4a7a82c25
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jun 28 13:06:37 2021 +1000

    Add rocky84 test target.

commit d443006c0ddfa7f6a5bd9c0ae92036f3d5f2fa3b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 25 06:30:22 2021 +0000

    upstream: fix decoding of X.509 subject name; from Leif Thuresson
    
    via bz3327 ok markus@
    
    OpenBSD-Commit-ID: 0ea2e28f39750dd388b7e317bc43dd997a217ae8

commit 2a5704ec142202d387fda2d6872fd4715ab81347
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 25 06:20:39 2021 +0000

    upstream: Use better language to refer to the user. From l1ving
    
    via github PR#250, ok jmc@
    
    OpenBSD-Commit-ID: 07ca3526626996613e128aeddf7748c93c4d6bbf

commit 4bdf7a04797a0ea1c431a9d54588417c29177d19
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 25 03:38:17 2021 +0000

    upstream: Replace SIGCHLD/notify_pipe kludge with pselect.
    
    Previously sshd's SIGCHLD handler would wake up select() by writing a
    byte to notify_pipe.  We can remove this by blocking SIGCHLD, checking
    for child terminations then passing the original signal mask through
    to pselect.  This ensures that the pselect will immediately wake up if
    a child terminates between wait()ing on them and the pselect.
    
    In -portable, for platforms that do not have pselect the kludge is still
    there but is hidden behind a pselect interface.
    
    Based on other changes for bz#2158, ok djm@
    
    OpenBSD-Commit-ID: 202c85de0b3bdf1744fe53529a05404c5480d813

commit c9f7bba2e6f70b7ac1f5ea190d890cb5162ce127
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jun 25 15:08:18 2021 +1000

    Move closefrom() to before first malloc.
    
    When built against tcmalloc, tcmalloc allocates a descriptor for its
    internal use, so calling closefrom() afterward causes the descriptor
    number to be reused resulting in a corrupted connection.  Moving the
    closefrom a little earlier should resolve this.  From kircherlike at
    outlook.com via bz#3321, ok djm@

commit 7ebfe4e439853b88997c9cfc2ff703408a1cca92
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jun 18 20:41:45 2021 +1000

    Put second -lssh in link line for sftp-server.
    
    When building --without-openssl the recent port-prngd.c change adds
    a dependency on atomicio, but since nothing else in sftp-server uses
    it, the linker may not find it.  Add a second -lssh similar to other
    binaries.

commit e409d7966785cfd9f5970e66a820685c42169717
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jun 18 18:34:08 2021 +1000

    Try EGD/PRNGD if random device fails.
    
    When built --without-openssl, try EGD/PRGGD (if configured) as a last
    resort before failing.

commit e43a898043faa3a965dbaa1193cc60e0b479033d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jun 18 18:32:51 2021 +1000

    Split EGD/PRNGD interface into its own file.
    
    This will allow us to use it when building --without-openssl.

commit acb2887a769a1b1912cfd7067f3ce04fad240260
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Jun 17 21:03:19 2021 +1000

    Handle GIDs > 2^31 in getgrouplist.
    
    When compiled in 32bit mode, the getgrouplist implementation may fail
    for GIDs greater than LONG_MAX.  Analysis and change from ralf.winkel
    at tui.com.

commit 31fac20c941126281b527605b73bff30a8f02edd
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jun 10 09:46:28 2021 +0000

    upstream: Use $SUDO when reading sshd's pidfile here too.
    
    OpenBSD-Regress-ID: 6bfb0d455d493f24839034a629c5306f84dbd409

commit a3a58acffc8cc527f8fc6729486d34e4c3d27643
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jun 10 09:43:51 2021 +0000

    upstream: Use $SUDO when reading sshd's pidfile in case it was
    
    created with a very restrictive umask.  This resyncs with -portable.
    
    OpenBSD-Regress-ID: 07fd2af06df759d4f64b82c59094accca1076a5d

commit 249ad4ae51cd3bc235e75a4846eccdf8b1416611
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jun 10 09:37:59 2021 +0000

    upstream: Set umask when creating hostkeys to prevent excessive
    
    permissions warning.
    
    OpenBSD-Regress-ID: 382841db0ee28dfef7f7bffbd511803e1b8ab0ef

commit 9d0892153c005cc65897e9372b01fa66fcbe2842
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jun 10 03:45:31 2021 +0000

    upstream: Add regress test for SIGHUP restart
    
    while handling active and unauthenticated clients.  Should catch anything
    similar to the pselect bug just fixed in sshd.c.
    
    OpenBSD-Regress-ID: 3b3c19b5e75e43af1ebcb9586875b3ae3a4cac73

commit 73f6f191f44440ca3049b9d3c8e5401d10b55097
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Thu Jun 10 03:14:14 2021 +0000

    upstream: Continue accept loop when pselect
    
    returns -1, eg if it was interrupted by a signal.  This should prevent
    the hang discovered by sthen@ wherein sshd receives a SIGHUP while it has
    an unauthenticated child and goes on to a blocking read on a notify_pipe.
    feedback deraadt@, ok djm@
    
    OpenBSD-Commit-ID: 0243c1c5544fca0974dae92cd4079543a3fceaa0

commit c785c0ae134a8e8b5c82b2193f64c632a98159e4
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jun 8 22:30:27 2021 +0000

    upstream: test that UserKnownHostsFile correctly accepts multiple
    
    arguments; would have caught readconf.c r1.356 regression
    
    OpenBSD-Regress-ID: 71ca54e66c2a0211b04999263e56390b1f323a6a

commit 1a6f6b08e62c78906a3032e8d9a83e721c84574e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jun 8 22:06:12 2021 +0000

    upstream: fix regression in r1.356: for ssh_config options that
    
    accepted multiple string arguments, ssh was only recording the first.
    Reported by Lucas via bugs@
    
    OpenBSD-Commit-ID: 7cbf182f7449bf1cb7c5b4452667dc2b41170d6d

commit 78e30af3e2b2dd540a341cc827c6b98dd8b0a6de
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jun 8 07:40:12 2021 +0000

    upstream: test argv_split() optional termination on comments
    
    OpenBSD-Regress-ID: 9fd1c4a27a409897437c010cfd79c54b639a059c

commit a023138957ea2becf1c7f93fcc42b0aaac6f2b03
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Jun 8 07:05:27 2021 +0000

    upstream: Add testcases from bz#3319 for IPQoS and TunnelDevice
    
    being overridden on the command line.
    
    OpenBSD-Regress-ID: 801674d5d2d02abd58274a78cab2711f11de14a8

commit 660cea10b2cdc11f13ba99c89b1bbb368a4d9ff2
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jun 8 06:52:43 2021 +0000

    upstream: sprinkle some "# comment" at end of configuration lines
    
    to test comment handling
    
    OpenBSD-Regress-ID: cb82fbf40bda5c257a9f742c63b1798e5a8fdda7

commit acc9c32dcb6def6c7d3688bceb4c0e59bd26b411
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jun 8 06:51:47 2021 +0000

    upstream: more descriptive failure message
    
    OpenBSD-Regress-ID: 5300f6faf1d9e99c0cd10827b51756c5510e3509

commit ce04dd4eae23d1c9cf7c424a702f48ee78573bc1
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jun 7 01:16:34 2021 +0000

    upstream: test AuthenticationMethods inside a Match block as well
    
    as in the main config section
    
    OpenBSD-Regress-ID: ebe0a686621b7cb8bb003ac520975279c28747f7

commit 9018bd821fca17e26e92f7a7e51d9b24cd62f2db
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jun 7 00:00:50 2021 +0000

    upstream: prepare for stricter sshd_config parsing that will refuse
    
    a config that has {Allow,Deny}{Users,Groups} on a line with no subsequent
    arguments. Such lines are permitted but are nonsensical noops ATM
    
    OpenBSD-Regress-ID: ef65463fcbc0bd044e27f3fe400ea56eb4b8f650

commit a10f929d1ce80640129fc5b6bc1acd9bf689169e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jun 8 07:09:42 2021 +0000

    upstream: switch sshd_config parsing to argv_split()
    
    similar to the previous commit, this switches sshd_config parsing to
    the newer tokeniser. Config parsing will be a little stricter wrt
    quote correctness and directives appearing without arguments.
    
    feedback and ok markus@
    
    tested in snaps for the last five or so days - thanks Theo and those who
    caught bugs
    
    OpenBSD-Commit-ID: 9c4305631d20c2d194661504ce11e1f68b20d93e

commit ea9e45c89a4822d74a9d97fef8480707d584da4d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jun 8 07:07:15 2021 +0000

    upstream: Switch ssh_config parsing to use argv_split()
    
    This fixes a couple of problems with the previous tokeniser,
    strdelim()
    
    1. strdelim() is permissive wrt accepting '=' characters. This is
      intended to allow it to tokenise "Option=value" but because it
      cannot keep state, it will incorrectly split "Opt=val=val2".
    2. strdelim() has rudimentry handling of quoted strings, but it
      is incomplete and inconsistent. E.g. it doesn't handle escaped
      quotes inside a quoted string.
    3. It has no support for stopping on a (unquoted) comment. Because
      of this readconf.c r1.343 added chopping of lines at '#', but
      this caused a regression because these characters may legitimately
      appear inside quoted strings.
    
    The new tokeniser is stricter is a number of cases, including #1 above
    but previously it was also possible for some directives to appear
    without arguments. AFAIK these were nonsensical in all cases, and the
    new tokeniser refuses to accept them.
    
    The new code handles quotes much better, permitting quoted space as
    well as escaped closing quotes. Finally, comment handling should be
    fixed - the tokeniser will terminate only on unquoted # characters.
    
    feedback & ok markus@
    
    tested in snaps for the last five or so days - thanks Theo and those who
    caught bugs
    
    OpenBSD-Commit-ID: dc72fd12af9d5398f4d9e159d671f9269c5b14d5

commit d786424986c04d1d375f231fda177c8408e05c3e
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Jun 8 07:02:46 2021 +0000

    upstream: Check if IPQoS or TunnelDevice are already set before
    
    overriding. Prevents values in config files from overriding values supplied
    on the command line.  bz#3319, ok markus.
    
    OpenBSD-Commit-ID: f3b08b898c324debb9195e6865d8999406938f74

commit aae4b4d3585b9f944d7dbd3c9e5ba0006c55e457
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Jun 8 06:54:40 2021 +0000

    upstream: Allow argv_split() to optionally terminate tokenisation
    
    when it encounters an unquoted comment.
    
    Add some additional utility function for working with argument
    vectors, since we'll be switching to using them to parse
    ssh/sshd_config shortly.
    
    ok markus@ as part of a larger diff; tested in snaps
    
    OpenBSD-Commit-ID: fd9c108cef2f713f24e3bc5848861d221bb3a1ac

commit da9f9acaac5bab95dca642b48e0c8182b246ab69
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jun 7 19:19:23 2021 +1000

    Save logs on failure for upstream test

commit 76883c60161e5f3808787085a27a8c37f8cc4e08
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Jun 7 14:36:32 2021 +1000

    Add obsdsnap-i386 upstream test target.

commit d45b9c63f947ec5ec314696e70281f6afddc0ac3
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon Jun 7 03:38:38 2021 +0000

    upstream: fix debug message when finding a private key to match a
    
    certificate being attempted for user authentication. Previously it would
    print the certificate's path, whereas it was supposed to be showing the
    private key's path. Patch from Alex Sherwin via GHPR247
    
    OpenBSD-Commit-ID: d5af3be66d0f22c371dc1fe6195e774a18b2327b

commit 530739d42f6102668aecd699be0ce59815c1eceb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Jun 6 11:34:16 2021 +0000

    upstream: Match host certificates against host public keys, not private
    
    keys. Allows use of certificates with private keys held in a ssh-agent.
    Reported by Miles Zhou in bz3524; ok dtucker@
    
    OpenBSD-Commit-ID: 25f5bf70003126d19162862d9eb380bf34bac22a

commit 4265215d7300901fd7097061c7517688ade82f8e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Jun 6 03:40:39 2021 +0000

    upstream: Client-side workaround for a bug in OpenSSH 7.4: this release
    
    allows RSA/SHA2 signatures for public key authentication but fails to
    advertise this correctly via SSH2_MSG_EXT_INFO. This causes clients of these
    server to incorrectly match PubkeyAcceptedAlgorithms and potentially refuse
    to offer valid keys.
    
    Reported by and based on patch from Gordon Messmer via bz3213, thanks
    also for additional analysis by Jakub Jelen. ok dtucker
    
    OpenBSD-Commit-ID: d6d0b7351d5d44c45f3daaa26efac65847a564f7

commit bda270d7fb8522d43c21a79a4b02a052d7c64de8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Jun 6 03:17:02 2021 +0000

    upstream: degrade gracefully if a sftp-server offers the
    
    limits@openssh.com extension but fails when the client tries to invoke it.
    Reported by Hector Martin via bz3318
    
    OpenBSD-Commit-ID: bd9d1839c41811616ede4da467e25746fcd9b967

commit d345d5811afdc2d6923019b653cdd93c4cc95f76
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sun Jun 6 03:15:39 2021 +0000

    upstream: the limits@openssh.com extension was incorrectly marked
    
    as an operation that writes to the filesystem, which made it unavailable in
    sftp-server read-only mode. Spotted by Hector Martin via bz3318
    
    OpenBSD-Commit-ID: f054465230787e37516c4b57098fc7975e00f067

commit 2b71010d9b43d7b8c9ec1bf010beb00d98fa765a
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Sat Jun 5 13:47:00 2021 +0000

    upstream: PROTOCOL.certkeys: update reference from IETF draft to
    
    RFC
    
    Also fix some typos.
    ok djm@
    
    OpenBSD-Commit-ID: 5e855b6c5a22b5b13f8ffa3897a868e40d349b44

commit aa99b2d9a3e45b943196914e8d8bf086646fdb54
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jun 4 23:41:29 2021 +1000

    Clear notify_pipe from readset if present.
    
    Prevents leaking an implementation detail to the caller.

commit 6de8dadf6b4d0627d35bca0667ca44b1d61c2c6b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jun 4 23:24:25 2021 +1000

    space->tabs.

commit c8677065070ee34c05c7582a9c2f58d8642e552d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Jun 4 18:39:48 2021 +1000

    Add pselect implementation for platforms without.
    
    This is basically the existing notify_pipe kludge from serverloop.c
    moved behind a pselect interface.  It works by installing a signal
    handler that writes to a pipe that the select is watching, then calls
    the original handler.
    
    The select call in serverloop will become pselect soon, at which point the
    kludge will be removed from thereand will only exist in the compat layer.
    Original code by markus, help from djm.

commit 7cd7f302d3a072748299f362f9e241d81fcecd26
Author: Vincent Brillault <vincent.brillault@cern.ch>
Date:   Sun May 24 09:15:06 2020 +0200

    auth_log: dont log partial successes as failures
    
    By design, 'partial' logins are successful logins, so initially with
    authenticated set to 1, for which another authentication is required. As
    a result, authenticated is always reset to 0 when partial is set to 1.
    However, even if authenticated is 0, those are not failed login
    attempts, similarly to attempts with authctxt->postponed set to 1.

commit e7606919180661edc7f698e6a1b4ef2cfb363ebf
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 4 06:19:07 2021 +0000

    upstream: The RB_GENERATE_STATIC(3) macro expands to a series of
    
    function definitions and not a statement, so there should be no semicolon
    following them. Patch from Michael Forney
    
    OpenBSD-Commit-ID: c975dd180580f0bdc0a4d5b7d41ab1f5e9b7bedd

commit c298c4da574ab92df2f051561aeb3e106b0ec954
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 4 05:59:18 2021 +0000

    upstream: rework authorized_keys example section, removing irrelevant
    
    stuff, de-wrapping the example lines and better aligning the examples with
    common usage and FAQs; ok jmc
    
    OpenBSD-Commit-ID: d59f1c9281f828148e2a2e49eb9629266803b75c

commit d9cb35bbec5f623589d7c58fc094817b33030f35
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 4 05:10:03 2021 +0000

    upstream: adjust SetEnv description to clarify $TERM handling
    
    OpenBSD-Commit-ID: 8b8cc0124856bc1094949d55615e5c44390bcb22

commit 771f57a8626709f2ad207058efd68fbf30d31553
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Jun 4 05:09:08 2021 +0000

    upstream: Switch the listening select loop from select() to
    
    pselect() and mask signals while checking signal flags, umasking for pselect
    and restoring afterwards. Also restore signals before sighup_restart so they
    don't remain blocked after restart.
    
    This prevents a race where a SIGTERM or SIGHUP can arrive between
    checking the flag and calling select (eg if sshd is processing a
    new connection) resulting in sshd not shutting down until the next
    time it receives a new connection.  bz#2158, with & ok djm@
    
    OpenBSD-Commit-ID: bf85bf880fd78e00d7478657644fcda97b9a936f

commit f64f8c00d158acc1359b8a096835849b23aa2e86
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 4 05:02:40 2021 +0000

    upstream: allow ssh_config SetEnv to override $TERM, which is otherwise
    
    handled specially by the protocol. Useful in ~/.ssh/config to set TERM to
    something generic (e.g. "xterm" instead of "xterm-256color") for destinations
    that lack terminfo entries. feedback and ok dtucker@
    
    OpenBSD-Commit-ID: 38b1ef4d5bc159c7d9d589d05e3017433e2d5758

commit 60107677dc0ce1e93c61f23c433ad54687fcd9f5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Jun 4 04:02:21 2021 +0000

    upstream: correct extension name "no-presence-required" =>
    
    "no-touch-required"
    
    document "verify-required" option
    
    OpenBSD-Commit-ID: 1879ff4062cf61d79b515e433aff0bf49a6c55c5

commit ecc186e46e3e30f27539b4311366dfda502f0a08
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jun 2 13:54:11 2021 +1000

    Retire fbsd7 test target.
    
    It's the slowest of the selfhosted targets (since it's 32bit but has
    most of the crypto algos). We still have coverage for 32bit i386.

commit 5de0867b822ec48b5eec9abde0f5f95d1d646546
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jun 2 11:21:40 2021 +1000

    Check for $OPENSSL in md5 fallback too.

commit 1db69d1b6542f8419c04cee7fd523a4a11004be2
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Jun 2 11:17:54 2021 +1000

    Add dfly60 target.

commit a3f2dd955f1c19cad387a139f0e719af346ca6ef
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed Jun 2 00:17:45 2021 +0000

    upstream: Merge back shell portability changes
    
    bringing it back in sync with -portable.
    
    OpenBSD-Regress-ID: c07905ba931e66ad7d849b87b7d19648007175d1

commit 9d482295c9f073e84d75af46b720a1c0f7ec2867
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Jun 1 23:56:20 2021 +0000

    upstream: Use a default value for $OPENSSL,
    
    allowing it to be overridden. Do the same in the PuTTY tests since it's
    needed there and not exported by test-exec.sh.
    
    OpenBSD-Regress-ID: c49dcd6aa7602a8606b7afa192196ca1fa65de16

commit 07660b3c99f8ea74ddf4a440e55c16c9f7fb3dd1
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon May 24 10:25:18 2021 +0000

    upstream: Find openssl binary via environment variable. This
    
    allows overriding if necessary (eg in -portable where we're testing against a
    specific version of OpenSSL).
    
    OpenBSD-Regress-ID: 491f39cae9e762c71aa4bf045803d077139815c5

commit 1a4d1da9188d7c88f646b61f0d6a3b34f47c5439
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 21 04:03:47 2021 +0000

    upstream: fix memleak in test
    
    OpenBSD-Regress-ID: 5e529d0982aa04666604936df43242e97a7a6f81

commit 60455a5d98065a73ec9a1f303345856bbd49aecc
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 21 03:59:01 2021 +0000

    upstream: also check contents of remaining string
    
    OpenBSD-Regress-ID: d526fa07253f4eebbc7d6205a0ab3d491ec71a28

commit 39f6cd207851d7b67ca46903bfce4a9f615b5b1c
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 21 03:48:07 2021 +0000

    upstream: unit test for misc.c:strdelim() that mostly servces to
    
    highlight its inconsistencies
    
    OpenBSD-Regress-ID: 8d2bf970fcc01ccc6e36a5065f89b9c7fa934195

commit 7a3a1dd2c7d4461962acbcc0ebee9445ba892be0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu May 27 21:23:15 2021 +1000

    Put minix3 config in the host-specific block.

commit 59a194825f12fff8a7f75d91bf751ea17645711b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon May 31 06:48:42 2021 +0000

    upstream: Hash challenge supplied by client during FIDO key enrollment
    
    prior to passing it to libfido2, which does expect a hash.
    
    There is no effect for users who are simply generating FIDO keys using
    ssh-keygen - by default we generate a random 256 bit challenge, but
    people building attestation workflows around our tools should now have
    a more consistent experience (esp. fewer failures when they fail to
    guess the magic 32-byte challenge length requirement).
    
    ok markus@
    
    OpenBSD-Commit-ID: b8d5363a6a7ca3b23dc28f3ca69470472959f2b5

commit eb68e669bc8ab968d4cca5bf1357baca7136a826
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu May 27 21:14:15 2021 +1000

    Include login_cap.h for login_getpwclass override.
    
    On minix3, login_getpwclass is __RENAME'ed to __login_getpwclass50 so
    without this the include overriding login_getpwclass causes a compile
    error.

commit 2063af71422501b65c7a92a5e14c0e6a3799ed89
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu May 27 21:13:38 2021 +1000

    Add minix3 test target.

commit 2e1efcfd9f94352ca5f4b6958af8a454f8cf48cd
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed May 26 01:47:24 2021 +0000

    upstream: fix SEGV in UpdateHostkeys debug() message, triggered
    
    when the update removed more host keys than remain present. Fix tested by
    reporter James Cook, via bugs@
    
    OpenBSD-Commit-ID: 44f641f6ee02bb957f0c1d150495b60cf7b869d3

commit 9acd76e6e4d2b519773e7119c33cf77f09534909
Author: naddy@openbsd.org <naddy@openbsd.org>
Date:   Sun May 23 18:22:57 2021 +0000

    upstream: ssh: The client configuration keyword is
    
    "hostbasedacceptedalgorithms"
    
    This fixes a mistake that slipped in when "HostbasedKeyTypes" was
    renamed to "HostbasedAcceptedAlgorithms".
    
    Bug report by zack@philomathiclife.com
    
    OpenBSD-Commit-ID: d745a7e8e50b2589fc56877f322ea204bc784f38

commit 078a0e60c92700da4c536c93c007257828ccd05b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue May 25 11:40:47 2021 +1000

    Rename README.md to ci-status.md.
    
    The original intent was to provide a status page for the CIs configured
    in that directory, but it had the side effect of replacing the top-level
    README.md.

commit 7be4ac813662f68e89f23c50de058a49aa32f7e4
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed May 19 01:24:05 2021 +0000

    upstream: restore blocking status on stdio fds before close
    
    ssh(1) needs to set file descriptors to non-blocking mode to operate
    but it was not restoring the original state on exit. This could cause
    problems with fds shared with other programs via the shell, e.g.
    
    > $ cat > test.sh << _EOF
    > #!/bin/sh
    > {
    >         ssh -Fnone -oLogLevel=verbose ::1 hostname
    >         cat /usr/share/dict/words
    > } | sleep 10
    > _EOF
    > $ ./test.sh
    > Authenticated to ::1 ([::1]:22).
    > Transferred: sent 2352, received 2928 bytes, in 0.1 seconds
    > Bytes per second: sent 44338.9, received 55197.4
    > cat: stdout: Resource temporarily unavailable
    
    This restores the blocking status for fds 0,1,2 (stdio) before ssh(1)
    abandons/closes them.
    
    This was reported as bz3280 and GHPR246; ok dtucker@
    
    OpenBSD-Commit-ID: 8cc67346f05aa85a598bddf2383fcfcc3aae61ce

commit c4902e1a653c67fea850ec99c7537f358904c0af
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon May 17 11:43:16 2021 +0000

    upstream: fix breakage of -W forwaring introduced in 1.554; reported by
    
    naddy@ and sthen@, ok sthen@
    
    OpenBSD-Commit-ID: f72558e643a26dc4150cff6e5097b5502f6c85fd

commit afea01381ad1fcea1543b133040f75f7542257e6
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Mon May 17 07:22:45 2021 +0000

    upstream: Regenerate moduli.
    
    OpenBSD-Commit-ID: 83c93a2a07c584c347ac6114d6329b18ce515557

commit be2866d6207b090615ff083c9ef212b603816a56
Author: Damien Miller <djm@mindrot.org>
Date:   Mon May 17 09:40:23 2021 +1000

    Handle Android libc returning NULL pw->pw_passwd
    
    Reported by Luke Dashjr

commit 5953c143008259d87342fb5155bd0b8835ba88e5
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 14 05:20:32 2021 +0000

    upstream: fix previous: test saved no_shell_flag, not the one that just
    
    got clobbered
    
    OpenBSD-Commit-ID: b8deace085d9d941b2d02f810243b9c302e5355d

commit 1e9fa55f4dc4b334651d569d3448aaa3841f736f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 14 03:09:48 2021 +0000

    upstream: Fix ssh started with ControlPersist incorrectly executing a
    
    shell when the -N (no shell) option was specified. bz3290 reported by Richard
    Schwab; patch from markus@ ok me
    
    OpenBSD-Commit-ID: ea1ea4af16a95687302f7690bdbe36a6aabf87e1

commit d1320c492f655d8f5baef8c93899d79dded217a5
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Wed May 12 11:34:30 2021 +0000

    upstream: Clarify language about moduli. While both ends of the
    
    connection do need to use the same parameters (ie groups), the DH-GEX
    protocol takes care of that and both ends do not need the same contents in
    the moduli file, which is what the previous text suggested.  ok djm@ jmc@
    
    OpenBSD-Commit-ID: f0c18cc8e79c2fbf537a432a9070ed94e96a622a

commit d3cc4d650ce3e59f3e370b101778b0e8f1c02c4d
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 7 04:11:51 2021 +0000

    upstream: include pid in LogVerbose spam
    
    OpenBSD-Commit-ID: aacb86f96ee90c7cb84ec27452374285f89a7f00

commit e3c032333be5fdbbaf2751f6f478e044922b4ec4
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 7 03:09:38 2021 +0000

    upstream: don't sigdie() in signal handler in privsep child process;
    
    this can end up causing sandbox violations per bz3286; ok dtucker@
    
    OpenBSD-Commit-ID: a7f40b2141dca4287920da68ede812bff7ccfdda

commit a4039724a3f2abac810735fc95cf9114a3856049
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri May 7 09:23:40 2021 +0000

    upstream: Increase ConnectionAttempts from 4 to 10 as the tests
    
    occasionally time out on heavily loaded hosts.
    
    OpenBSD-Regress-ID: 29a8cdef354fc9da471a301f7f65184770434f3a

commit c0d7e36e979fa3cdb60f5dcb6ac9ad3fd018543b
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 7 02:26:55 2021 +0000

    upstream: dump out a usable private key string too; inspired by Tyson
    
    Whitehead
    
    OpenBSD-Regress-ID: 65572d5333801cb2f650ebc778cbdc955e372058

commit 24fee8973abdf1c521cd2c0047d89e86d9c3fc38
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri May 7 02:29:40 2021 +0000

    upstream: correct mistake in spec - the private key blobs are encoded
    
    verbatim and not as strings (i.e. no 4-byte length header)
    
    OpenBSD-Commit-ID: 3606b5d443d72118c5b76c4af6dd87a5d5a4f837

commit f43859159cc62396ad5d080f0b1f2635a67dac02
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue May 4 22:53:52 2021 +0000

    upstream: Don't pass NULL as a string in debugging as it does not work
    
    on some platforms in -portable.  ok djm@
    
    OpenBSD-Commit-ID: 937c892c99aa3c9c272a8ed78fa7c2aba3a44fc9

commit ac31aa3c6341905935e75f0539cf4a61bbe99779
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Mon May 3 00:16:45 2021 +0000

    upstream: more debugging for UpdateHostKeys signature failures
    
    OpenBSD-Commit-ID: 1ee95f03875e1725df15d5e4bea3e73493d57d36

commit 8e32e97e788e0676ce83018a742203614df6a2b3
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat May 1 20:07:47 2021 +1000

    Add obsd69 test target.

commit f06893063597c5bb9d9e93f851c4070e77d2fba9
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Apr 30 04:29:53 2021 +0000

    upstream: a little debugging in the main mux process for status
    
    confirmation failures in multiplexed sessions
    
    OpenBSD-Commit-ID: 6e27b87c95176107597035424e1439c3232bcb49

commit e65cf00da6bc31e5f54603b7feb7252dc018c033
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Fri Apr 30 04:02:52 2021 +0000

    upstream: Remove now-unused skey function prototypes leftover from
    
    skey removal.
    
    OpenBSD-Commit-ID: 2fc36d519fd37c6f10ce74854c628561555a94c3

commit ae5f9b0d5c8126214244ee6b35aae29c21028133
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Apr 29 13:01:50 2021 +1000

    Wrap sntrup761x25519 inside ifdef.
    
    From balu.gajjala at gmail.com via bz#3306.

commit 70a8dc138a6480f85065cdb239915ad4b7f928cf
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Apr 28 14:44:07 2021 +1000

    Add status badges for Actions-based tests.

commit 40b59024cc3365815381474cdf4fe423102e391b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Apr 28 12:22:11 2021 +1000

    Add obsdsnap (OpenBSD snapshot) test target.

commit e627067ec8ef9ae8e7a638f4dbac91d52dee3e6d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Apr 28 11:35:28 2021 +1000

    Add test building upstream OpenBSD source.

commit 1b8108ebd12fc4ed0fb39ef94c5ba122558ac373
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Apr 27 14:22:20 2021 +1000

    Test against OpenSSL 1.1.0h instead of 1.1.0g.
    
    1.1.0g requires a perl glob module that's not installed by default.

commit 9bc20efd39ce8525be33df3ee009f5a4564224f1
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Apr 27 12:37:59 2021 +1000

    Use the default VM type for libcrypto ver tests.

commit 9f79e80dc40965c2e73164531250b83b176c1eea
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Apr 27 12:24:10 2021 +1000

    Always build OpenSSL shared.
    
    This is the default for current versions but we need it to test against
    earlier versions.

commit b3cc9fbdff2782eca79e33e02ac22450dc63bce9
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Apr 27 09:18:02 2021 +1000

    Fix custom OpenSSL tests.
    
    Check out specified OpenSSL version.  Install custom libcrypto where
    configure expects to find it.  Remove unneeded OpenSSL config time
    options.  Older OpenSSL versions were not make -j safe so remove it.

commit 77532609874a99a19e3e2eb2d1b7fa93aef963bb
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 26 17:18:25 2021 +1000

    Export CC and CFLAGS for c89 test.

commit 33f62dfbe865f4de77980ab88774bf1eb5e4e040
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 26 17:13:44 2021 +1000

    Add c89 here too.

commit da9d59f526fce58e11cba49cd8eb011dc0bf5677
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 26 15:34:23 2021 +1000

    Add test against OpenSSL w/out ECC.

commit 29e194a752359ebf85bf7fce100f23a0477fc4de
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 26 14:49:59 2021 +1000

    Ensure we can still build with C89.

commit a38016d369d21df5d35f761f2b67e175e132ba22
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 26 14:29:03 2021 +1000

    Interop test agains PuTTY.

commit 095b0307a77be8803768857cc6c0963fa52ed85b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 26 14:02:03 2021 +1000

    Support testing against arbitary libcrytpo vers.
    
    Add tests against various LibreSSL and OpenSSL versions.

commit b16082aa110fa7128ece2a9037ff420c4a285317
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 26 13:35:44 2021 +1000

    Add fbsd10 test target.

commit 2c805f16b24ea37cc051c6018fcb05defab6e57a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Apr 25 14:15:02 2021 +1000

    Disable compiler hardening on nbsd4.
    
    The system compiler supports -fstack-protector-all, but using it will
    result in an internal compiler error on some files.

commit 6a5d39305649da5dff1934ee54292ee0cebd579d
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sun Apr 25 13:01:34 2021 +1000

    Add nbsd3, nbsd4 and nbsd9 test targets.

commit d1aed05bd2e4ae70f359a394dc60a2d96b88f78c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 24 22:03:46 2021 +1000

    Comment out nbsd2 test target for now.

commit a6b4ec94e5bd5a8a18cd2c9942d829d2e5698837
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 24 17:52:24 2021 +1000

    Add OPENBSD ORIGINAL marker.

commit 3737c9f66ee590255546c4b637b6d2be669a11eb
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 23 19:49:46 2021 +1000

    Replace "==" (a bashism) with "=".

commit a116b6f5be17a1dd345b7d54bf8aa3779a28a0df
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 23 16:34:48 2021 +1000

    Add nbsd2 test target.

commit 196bf2a9bb771f45d9b0429cee7d325962233c44
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 23 14:54:10 2021 +1000

    Add obsd68 test target.

commit e3ba6574ed69e8b7af725cf5e8a9edaac04ff077
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 23 14:53:32 2021 +1000

    Remove dependency on bash.

commit db1f9ab8feb838aee9f5b99c6fd3f211355dfdcf
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 23 14:41:13 2021 +1000

    Add obsd67 test target.

commit c039a6bf79192fe1daa9ddcc7c87dd98e258ae7c
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 23 11:08:23 2021 +1000

    Re-add macos-11.0 test target.

commit a6db3a47b56adb76870d59225ffb90a65bc4daf2
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 23 10:28:28 2021 +1000

    Add openindiana test target.

commit 3fe7e73b025c07eda46d78049f1da8ed7dfc0c69
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 23 10:26:35 2021 +1000

    Test krb5 on Solaris 11 too.

commit f57fbfe5eb02df1a91f1a237c4d27165afd87c13
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Apr 22 22:27:26 2021 +1000

    Don't always set SUDO.
    
    Rely on sourcing configs to set as appropriate.

commit e428f29402fb6ac140b52f8f12e06ece7bb104a0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Apr 22 22:26:08 2021 +1000

    Remove now-unused 2nd arg to configs.

commit cb4ff640d79b3c736879582139778f016bbb2cd7
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Apr 21 01:08:04 2021 +1000

    Add win10 test target.

commit 4457837238072836b2fa3107d603aac809624983
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Tue Apr 20 23:31:29 2021 +1000

    Add nbsd8 test target.

commit bd4fba22e14da2fa196009010aabec5a8ba9dd42
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 17 09:55:47 2021 +1000

    Add obsd51 target.

commit 9403d0e805c77a5741ea8c3281bbe92558c2f125
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Fri Apr 16 18:14:25 2021 +1000

    Add fbsd13 target.

commit e86968280e358e62649d268d41f698d64d0dc9fa
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Apr 16 13:55:25 2021 +1000

    depend

commit 2fb25ca11e8b281363a2a2a4dec4c497a1475d9a
Author: Damien Miller <djm@mindrot.org>
Date:   Fri Apr 16 13:53:02 2021 +1000

    crank version in README and RPM spec files

commit b2b60ebab0cb77b5bc02d364d72e13db882f33ae
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Apr 16 03:42:00 2021 +0000

    upstream: openssh-8.6
    
    OpenBSD-Commit-ID: b5f3e133c846127ec114812248bc17eff07c3e19

commit faf2b86a46c9281d237bcdec18c99e94a4eb820a
Author: markus@openbsd.org <markus@openbsd.org>
Date:   Thu Apr 15 16:24:31 2021 +0000

    upstream: do not pass file/func to monitor; noted by Ilja van Sprundel;
    
    ok djm@
    
    OpenBSD-Commit-ID: 85ae5c063845c410283cbdce685515dcd19479fa

commit 2dc328023f60212cd29504fc05d849133ae47355
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Apr 14 11:42:55 2021 +1000

    sshd don't exit on transient read errors
    
    openssh-8.5 introduced a regression that would cause sshd to exit
    because of transient read errors on the network socket (e.g. EINTR,
    EAGAIN). Reported by balu.gajjala AT gmail.com via bz3297

commit d5d6b7d76d171a2e6861609dcd92e714ee62ad88
Author: Damien Miller <djm@mindrot.org>
Date:   Sat Apr 10 18:45:00 2021 +1000

    perform report_failed_grab() inline

commit ea996ce2d023aa3c6d31125e2c3ebda1cb42db8c
Author: Damien Miller <djm@mindrot.org>
Date:   Sat Apr 10 18:22:57 2021 +1000

    dedicated gnome-ssk-askpass3 source
    
    Compatibility with Wayland requires that we use the gdk_seat_grab()
    API for grabbing mouse/keyboard, however these API don't exist in
    Gtk+2.
    
    This branches gnome-ssk-askpass2.c => gnome-ssk-askpass3.c and
    makes the changes to use the gdk_seat_grab() instead of grabbing
    mouse/focus separately via GDK.
    
    In the future, we can also use the branched file to avoid some
    API that has been soft-deprecated in GTK+3, e.g. gtk_widget_modify_fg

commit bfa5405da05d906ffd58216eb77c4375b62d64c2
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Apr 8 15:18:15 2021 +1000

    Ensure valgrind-out exists.
    
    Normally the regress tests would create it, but running the unit tests
    on their own would fail because the directory did not exist.

commit 1f189181f3ea09a9b08aa866f78843fec800874f
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Apr 8 15:17:19 2021 +1000

    Pass OBJ to unit test make invocation.
    
    At least the Valgrind unit tests uses $OBJ.

commit f42b550c281d28bd19e9dd6ce65069164f3482b0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Apr 8 14:20:12 2021 +1000

    Add pattern for valgrind-unit.

commit 19e534462710e98737478fd9c44768b50c27c4c6
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Apr 8 13:31:08 2021 +1000

    Run unit tests under valgrind.
    
    Run a separate build for the unit tests under Valgrind.  They take long
    enough that running in parallel with the other Valgrind tests helps.

commit 80032102d05e866dc2a48a5caf760cf42c2e090e
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Thu Apr 8 13:25:57 2021 +1000

    ifdef out MIN and MAX.
    
    In -portable, defines.h ensures that these are defined, so redefining
    potentially causes a warning.  We don't just delete it to make any
    future code syncs a little but easier.  bz#3293.

commit d1bd184046bc310c405f45da3614a1dc5b3e521a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Apr 7 10:23:51 2021 +1000

    Remove only use of warn().
    
    The warn() function is only used in one place in portable and does not
    exist upstream.  Upgrade the only instance it's used to fail()
    (the privsep/sandbox+proxyconnect, from back when that was new) and
    remove the now-unused function.

commit fea8f4b1aa85026ad5aee5ad8e1599a8d5141fe0
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Apr 7 10:18:32 2021 +1000

    Move make_tmpdir() into portable-specific area.
    
    Reduces diff vs OpenBSD and makes it more likely diffs will apply
    cleanly.

commit 13e5fa2acffd26e754c6ee1d070d0afd035d4cb7
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Apr 6 23:57:56 2021 +0000

    upstream: Add TEST_SSH_ELAPSED_TIMES environment variable to print the
    
    elapsed time in seconds of each test.  This depends on "date +%s" which is
    not specified by POSIX but is commonly implemented.
    
    OpenBSD-Regress-ID: ec3c8c19ff49b2192116a0a646ee7c9b944e8a9c

commit ef4f46ab4387bb863b471bad124d46e8d911a79a
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Apr 7 09:59:15 2021 +1000

    Move the TEST_SSH_PORT section down a bit.
    
    This groups the portable-specific changes together and makes it a
    little more likely that patches will apply cleanly.

commit 3674e33fa70dfa1fe69b345bf576113af7b7be11
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Wed Apr 7 10:05:10 2021 +1000

    Further split Valgrind tests.
    
    Even split in two, the Valgrind tests take by far the longest to run,
    so split them four ways to further increase parallelism.

commit 961af266b861e30fce1e26170ee0dbb5bf591f29
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Apr 6 23:24:30 2021 +0000

    upstream: include "ssherr.h" not <ssherr.h>; from Balu Gajjala via
    
    bz#3292
    
    OpenBSD-Commit-ID: e9535cd9966eb2e69e73d1ede1f44905c30310bd

commit e7d0a285dbdd65d8df16123ad90f15e91862f959
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Apr 7 08:50:38 2021 +1000

    wrap struct rlimit in HAVE_GETRLIMIT too

commit f283a6c2e0a9bd9369e18462acd00be56fbe5b0d
Author: Damien Miller <djm@mindrot.org>
Date:   Wed Apr 7 08:20:35 2021 +1000

    wrap getrlimit call in HAVE_GETRLIMIT; bz3291

commit 679bdc4a5c9244f427a7aee9c14b0a0ed086da1f
Author: dtucker@openbsd.org <dtucker@openbsd.org>
Date:   Tue Apr 6 09:07:33 2021 +0000

    upstream: Don't check return value of unsetenv(). It's part of the
    
    environment setup and not part of the actual test, and some platforms
    -portable runs on declare it as returning void, which prevents the test from
    compiling.
    
    OpenBSD-Regress-ID: 24f08543ee3cdebc404f2951f3e388cc82b844a1

commit 320af2f3de6333aa123f1b088eca146a245e968a
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Sun Apr 4 11:36:56 2021 +0000

    upstream: remove stray inserts; from matthias schmidt
    
    OpenBSD-Commit-ID: 2c36ebdc54e14bbf1daad70c6a05479a073d5c63

commit 801f710953b24dd2f21939171c622eac77c7484d
Author: jmc@openbsd.org <jmc@openbsd.org>
Date:   Sun Apr 4 06:11:24 2021 +0000

    upstream: missing comma; from kawashima james
    
    OpenBSD-Commit-ID: 31cec6bf26c6db4ffefc8a070715ebef274e68ea

commit b3ca08cb174266884d44ec710a84cd64c12414ea
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Mon Apr 5 23:46:42 2021 +1000

    Install libcbor with libfido2.

commit f3ca8af87a4c32ada660da12ae95cf03d190c083
Author: Damien Miller <djm@mindrot.org>
Date:   Sat Apr 3 18:21:08 2021 +1100

    enable authopt and misc unit tests
    
    Neither were wired into the build, both required some build
    adaptations for -portable

commit dc1b45841fb97e3d7f655ddbcfef3839735cae5f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Apr 3 06:58:30 2021 +0000

    upstream: typos in comments; GHPR#180 from Vill
    
    =?UTF-8?q?e=20Skytt=C3=A4?=
    MIME-Version: 1.0
    Content-Type: text/plain; charset=UTF-8
    Content-Transfer-Encoding: 8bit
    
    OpenBSD-Commit-ID: 93c732381ae0e2b680c79e67c40c1814b7ceed2c

commit 53ea05e09b04fd7b6dea66b42b34d65fe61b9636
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Apr 3 06:55:52 2021 +0000

    upstream: sync CASignatureAlgorithms lists with reality. GHPR#174 from
    
    Matt Hazinski
    
    OpenBSD-Commit-ID: f05e4ca54d7e67b90fe58fe1bdb1d2a37e0e2696

commit 57ed647ee07bb883a2f2264231bcd1df6a5b9392
Author: Damien Miller <djm@mindrot.org>
Date:   Sat Apr 3 17:47:37 2021 +1100

    polish whitespace for portable files

commit 31d8d231eb9377df474746a822d380c5d68d7ad6
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Apr 3 06:18:40 2021 +0000

    upstream: highly polished whitespace, mostly fixing spaces-for-tab
    
    and bad indentation on continuation lines. Prompted by GHPR#185
    
    OpenBSD-Commit-ID: e5c81f0cbdcc6144df1ce468ec1bac366d8ad6e9

commit 34afde5c73b5570d6f8cce9b49993b23b77bfb86
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Apr 3 05:54:14 2021 +0000

    upstream: whitespace (tab after space)
    
    OpenBSD-Commit-ID: 0e2b3f7674e985d3f7c27ff5028e690ba1c2efd4

commit 7cd262c1c5a08cc7f4f30e3cab108ef089d0a57b
Author: Darren Tucker <dtucker@dtucker.net>
Date:   Sat Apr 3 16:59:10 2021 +1100

    Save config.h and config.log on failure too.

commit 460aee9298f365357e9fd26851c22e0dca51fd6a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Apr 3 05:46:41 2021 +0000

    upstream: fix incorrect plural; from Ville Skyt
    
    =?UTF-8?q?t=C3=A4=20via=20GHPR#181?=
    MIME-Version: 1.0
    Content-Type: text/plain; charset=UTF-8
    Content-Transfer-Encoding: 8bit
    
    OpenBSD-Commit-ID: 92f31754c6296d8f403d7c293e09dc27292d22c9

commit 082804c14e548cada75c81003a3c68ee098138ee
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Apr 3 05:40:39 2021 +0000

    upstream: ensure that pkcs11_del_provider() is called before exit -
    
    some PKCS#11 providers get upset if C_Initialize is not matched with
    C_Finalize.
    
    From Adithya Baglody via GHPR#234; ok markus
    
    OpenBSD-Commit-ID: f8e770e03b416ee9a58f9762e162add900f832b6

commit 464ebc82aa926dd132ec75a0b064574ef375675e
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Apr 3 05:28:43 2021 +0000

    upstream: unused variable
    
    OpenBSD-Commit-ID: 85f6a394c8e0f60d15ecddda75176f112007b205

commit dc3c0be8208c488e64a8bcb7d9efad98514e0ffb
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Sat Apr 3 05:21:46 2021 +0000

    upstream: Fix two problems in string->argv conversion: 1) multiple
    
    backslashes were not being dequoted correctly and 2) quoted space in the
    middle of a string was being incorrectly split.
    MIME-Version: 1.0
    Content-Type: text/plain; charset=UTF-8
    Content-Transfer-Encoding: 8bit
    
    A unit test for these cases has already been committed
    
    prompted by and based on GHPR#223 by Eero Hkkinen; ok markus@
    
    OpenBSD-Commit-ID: d7ef27abb4eeeaf6e167e9312e4abe9e89faf1e4

commit f75bcbba58a08c670727ece5e3f8812125969799
Author: Damien Miller <djm@mindrot.org>
Date:   Sat Apr 3 16:22:48 2021 +1100

    missing bits from 259d648e

commit 4cbc4a722873d9b68cb5496304dc050d7168df78
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 31 21:59:26 2021 +0000

    upstream: cannot effectively test posix-rename extension after
    
    changes in feature advertisment.
    
    OpenBSD-Regress-ID: 5e390bf88d379162aaa81b60ed86b34cb0c54d29

commit 259d648e63e82ade4fe2c2c73c8b67fe57d9d049
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 19 04:23:50 2021 +0000

    upstream: add a test for misc.c:argv_split(), currently fails
    
    OpenBSD-Regress-ID: ad6b96d6ebeb9643b698b3575bdd6f78bb144200

commit 473ddfc2d6b602cb2d1d897e0e5c204de145cd9a
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 19 03:25:01 2021 +0000

    upstream: split
    
    OpenBSD-Regress-ID: f6c03c0e4c58b3b9e04b161757b8c10dc8378c34

commit 1339800fef8d0dfbfeabff71b34670105bcfddd2
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 31 22:16:34 2021 +0000

    upstream: Use new limits@openssh.com protocol extension to let the
    
    client select good limits based on what the server supports. Split the
    download and upload buffer sizes to allow them to be chosen independently.
    
    In practice (and assuming upgraded sftp/sftp-server at each end), this
    increases the download buffer 32->64KiB and the upload buffer
    32->255KiB.
    
    Patches from Mike Frysinger; ok dtucker@
    
    OpenBSD-Commit-ID: ebd61c80d85b951b794164acc4b2f2fd8e88606c

commit 6653c61202d104e59c8e741329fcc567f7bc36b8
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Wed Mar 31 21:58:07 2021 +0000

    upstream: do not advertise protocol extensions that have been
    
    disallowed by the command-line options (e.g. -p/-P/-R); ok dtucker@
    
    OpenBSD-Commit-ID: 3a8a76b3f5131741aca4b41bfab8d101c9926205

commit 71241fc05db4bbb11bb29340b44b92e2575373d8
Author: Damien Miller <djm@mindrot.org>
Date:   Mon Mar 29 15:14:25 2021 +1100

    gnome-ssh-askpass3 is a valid target here

commit 8a9520836e71830f4fccca066dba73fea3d16bda
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 19 02:22:34 2021 +0000

    upstream: return non-zero exit status when killed by signal; bz#3281 ok
    
    dtucker@
    
    OpenBSD-Commit-ID: 117b31cf3c807993077b596bd730c24da9e9b816

commit 1269b8a686bf1254b03cd38af78167a04aa6ec88
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Fri Mar 19 02:18:28 2021 +0000

    upstream: increase maximum SSH2_FXP_READ to match the maximum
    
    packet size. Also handle zero-length reads that are borderline nonsensical
    but not explicitly banned by the spec. Based on patch from Mike Frysinger,
    feedback deraadt@ ok dtucker@
    
    OpenBSD-Commit-ID: 4e67d60d81bde7b84a742b4ee5a34001bdf80d9c

commit 860b67604416640e8db14f365adc3f840aebcb1f
Author: djm@openbsd.org <djm@openbsd.org>
Date:   Tue Mar 16 06:15:43 2021 +0000

    upstream: don't let logging clobber errno before use
    
    OpenBSD-Commit-ID: ce6cca370005c270c277c51c111bb6911e1680ec
